{"version":3,"file":"mpcCoreKit.cjs.js","mappings":"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","sources":["webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/tss-lib\"","webpack://@web3auth/mpc-core-kit/webpack/bootstrap","webpack://@web3auth/mpc-core-kit/webpack/runtime/compat get default export","webpack://@web3auth/mpc-core-kit/webpack/runtime/create fake namespace object","webpack://@web3auth/mpc-core-kit/webpack/runtime/define property getters","webpack://@web3auth/mpc-core-kit/webpack/runtime/hasOwnProperty shorthand","webpack://@web3auth/mpc-core-kit/webpack/runtime/make namespace object","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/constants\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@web3auth-mpc/base\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"elliptic\"","webpack://@web3auth/mpc-core-kit/./src/constants.ts","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@tkey-mpc/common-types\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/eccrypto\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/torus.js\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"bn.js\"","webpack://@web3auth/mpc-core-kit/./src/utils.ts","webpack://@web3auth/mpc-core-kit/./src/helper/browserStorage.ts","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@tkey-mpc/share-serialization\"","webpack://@web3auth/mpc-core-kit/./src/helper/factorSerialization.ts","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@babel/runtime/helpers/objectSpread2\"","webpack://@web3auth/mpc-core-kit/./src/point.ts","webpack://@web3auth/mpc-core-kit/./src/helper/securityQuestion.ts","webpack://@web3auth/mpc-core-kit/./src/helper/index.ts","webpack://@web3auth/mpc-core-kit/./src/interfaces.ts","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@tkey-mpc/core\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@tkey-mpc/service-provider-torus\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@tkey-mpc/storage-layer-torus\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/customauth\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/fetch-node-details\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/metadata-helpers\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/openlogin-session-manager\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@toruslabs/tss-client\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"@web3auth-mpc/ethereum-provider\"","webpack://@web3auth/mpc-core-kit/external commonjs2 \"bowser\"","webpack://@web3auth/mpc-core-kit/./src/mpcCoreKit.ts","webpack://@web3auth/mpc-core-kit/./src/index.ts"],"sourcesContent":["module.exports = require(\"@toruslabs/tss-lib\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/constants\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@web3auth-mpc/base\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"elliptic\");","import { TORUS_SAPPHIRE_NETWORK } from \"@toruslabs/constants\";\nimport { CHAIN_NAMESPACES, CustomChainConfig } from \"@web3auth-mpc/base\";\nimport { ec as EllipticCurve } from \"elliptic\";\n\nexport const DEFAULT_CHAIN_CONFIG: CustomChainConfig = {\n  chainNamespace: CHAIN_NAMESPACES.EIP155,\n  chainId: \"0x5\",\n  rpcTarget: \"https://rpc.ankr.com/eth_goerli\",\n  displayName: \"Goerli Testnet\",\n  blockExplorer: \"https://goerli.etherscan.io\",\n  ticker: \"ETH\",\n  tickerName: \"Ethereum\",\n  decimals: 18,\n};\n\nexport const WEB3AUTH_NETWORK = {\n  MAINNET: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET,\n  DEVNET: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET,\n} as const;\n\nexport const USER_PATH = {\n  NEW: \"NewAccount\",\n  EXISTING: \"ExistingAccount\",\n  REHYDRATE: \"RehydrateAccount\",\n  RECOVER: \"RecoverAccount\",\n} as const;\n\nexport enum FactorKeyTypeShareDescription {\n  HashedShare = \"hashedShare\",\n  SecurityQuestions = \"tssSecurityQuestions\",\n  DeviceShare = \"deviceShare\",\n  SeedPhrase = \"seedPhrase\",\n  PasswordShare = \"passwordShare\",\n  SocialShare = \"socialShare\",\n  Other = \"Other\",\n}\n\nexport const DELIMITERS = {\n  Delimiter1: \"\\u001c\",\n  Delimiter2: \"\\u0015\",\n  Delimiter3: \"\\u0016\",\n  Delimiter4: \"\\u0017\",\n};\n\nexport const ERRORS = {\n  TKEY_SHARES_REQUIRED: \"required more shares\",\n  INVALID_BACKUP_SHARE: \"invalid backup share\",\n};\n\nexport const SOCIAL_FACTOR_INDEX = 1;\n\n/**\n * Defines the TSS Share Index in a simplified way for better implementation.\n **/\nexport enum TssShareType {\n  DEVICE = 2,\n  RECOVERY = 3,\n}\n\nexport const VALID_SHARE_INDICES = [TssShareType.DEVICE, TssShareType.RECOVERY];\n\nexport const SCALAR_LEN = 32; // Length of secp256k1 scalar in bytes.\nexport const FIELD_ELEMENT_HEX_LEN = 32 * 2; // Length of secp256k1 field element in hex form.\nexport const CURVE = new EllipticCurve(\"secp256k1\");\n\nexport const MAX_FACTORS = 10; // Maximum number of factors that can be added to an account.\nexport const SOCIAL_TKEY_INDEX = 1;\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey-mpc/common-types\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/eccrypto\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/torus.js\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bn.js\");","import { getPubKeyPoint, Point, Point as TkeyPoint, randomSelection } from \"@tkey-mpc/common-types\";\nimport ThresholdKey from \"@tkey-mpc/core\";\nimport { generatePrivate } from \"@toruslabs/eccrypto\";\nimport { keccak256 } from \"@toruslabs/torus.js\";\nimport BN from \"bn.js\";\n\nimport { SCALAR_LEN, VALID_SHARE_INDICES as VALID_TSS_INDICES } from \"./constants\";\n\nexport const generateFactorKey = (): { private: BN; pub: TkeyPoint } => {\n  const factorKey = new BN(generatePrivate());\n  const factorPub = getPubKeyPoint(factorKey);\n  return { private: factorKey, pub: factorPub };\n};\n\nexport const generateTSSEndpoints = (tssNodeEndpoints: string[], parties: number, clientIndex: number, nodeIndexes: number[]) => {\n  const endpoints: string[] = [];\n  const tssWSEndpoints: string[] = [];\n  const partyIndexes: number[] = [];\n  const nodeIndexesReturned: number[] = [];\n\n  for (let i = 0; i < parties; i++) {\n    partyIndexes.push(i);\n    if (i === clientIndex) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      endpoints.push(null as any);\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      tssWSEndpoints.push(null as any);\n    } else {\n      const targetNodeIndex = nodeIndexes[i] - 1;\n      endpoints.push(tssNodeEndpoints[targetNodeIndex]);\n      tssWSEndpoints.push(new URL(tssNodeEndpoints[targetNodeIndex]).origin);\n      nodeIndexesReturned.push(nodeIndexes[i]);\n    }\n  }\n  return { endpoints, tssWSEndpoints, partyIndexes, nodeIndexesReturned };\n};\n\nexport function storageAvailable(type: string): boolean {\n  let storage: Storage;\n  try {\n    if (type === \"localStorage\") storage = window.localStorage;\n    else storage = window.sessionStorage;\n\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n\n// TODO think which conversion functions to keep and how to export them.\n\n/**\n * Parses a JWT Token, without verifying the signature.\n * @param token - JWT Token\n * @returns Extracted JSON payload from the token\n */\nexport function parseToken(token: string) {\n  const base64Url = token.split(\".\")[1];\n  const base64 = base64Url.replace(\"-\", \"+\").replace(\"_\", \"/\");\n  return JSON.parse(atob(base64 || \"\"));\n}\n\n/**\n * Refreshes TSS shares. Allows to change number of shares. New user shares are\n * only produced for the target indices.\n * @param tKey - Tkey instance to use.\n * @param factorPubs - Factor pub keys after refresh.\n * @param tssIndices - Target tss indices to generate new shares for.\n * @param factorKeyForExistingTSSShare - Factor key for existing TSS share.\n * @param signatures - Signatures for authentication against RSS servers.\n */\nasync function refreshTssShares(\n  tKey: ThresholdKey,\n  factorPubs: Point[],\n  tssIndices: number[],\n  factorKeyForExistingTSSShare: BN,\n  signatures: string[],\n  updateMetadata = false\n) {\n  const { tssShare, tssIndex } = await tKey.getTSSShare(factorKeyForExistingTSSShare);\n\n  const rssNodeDetails = await tKey._getRssNodeDetails();\n  const { serverEndpoints, serverPubKeys, serverThreshold } = rssNodeDetails;\n  const randomSelectedServers = randomSelection(\n    new Array(rssNodeDetails.serverEndpoints.length).fill(null).map((_, i) => i + 1),\n    Math.ceil(rssNodeDetails.serverEndpoints.length / 2)\n  );\n\n  const verifierNameVerifierId = tKey.serviceProvider.getVerifierNameVerifierId();\n  await tKey._refreshTSSShares(updateMetadata, tssShare, tssIndex, factorPubs, tssIndices, verifierNameVerifierId, {\n    selectedServers: randomSelectedServers,\n    serverEndpoints,\n    serverPubKeys,\n    serverThreshold,\n    authSignatures: signatures,\n  });\n}\n\nexport async function addFactorAndRefresh(\n  tKey: ThresholdKey,\n  newFactorPub: Point,\n  newFactorTSSIndex: number,\n  factorKeyForExistingTSSShare: BN,\n  signatures: string[]\n) {\n  if (!tKey) {\n    throw new Error(\"tkey does not exist, cannot add factor pub\");\n  }\n  if (VALID_TSS_INDICES.indexOf(newFactorTSSIndex) === -1) {\n    throw new Error(`invalid new share index: must be one of ${VALID_TSS_INDICES}`);\n  }\n  if (!tKey.metadata.factorPubs || !Array.isArray(tKey.metadata.factorPubs[tKey.tssTag])) {\n    throw new Error(`factorPubs for tssTag = \"${tKey.tssTag}\" does not exist`);\n  }\n\n  const existingFactorPubs = tKey.metadata.factorPubs[tKey.tssTag];\n  const updatedFactorPubs = existingFactorPubs.concat([newFactorPub]);\n\n  const existingTSSIndexes = existingFactorPubs.map((fb) => tKey.getFactorEncs(fb).tssIndex);\n  const updatedTSSIndexes = existingTSSIndexes.concat([newFactorTSSIndex]);\n\n  await refreshTssShares(tKey, updatedFactorPubs, updatedTSSIndexes, factorKeyForExistingTSSShare, signatures);\n}\n\nexport async function deleteFactorAndRefresh(tKey: ThresholdKey, factorPubToDelete: Point, factorKeyForExistingTSSShare: BN, signatures: string[]) {\n  if (!tKey) {\n    throw new Error(\"tkey does not exist, cannot add factor pub\");\n  }\n  if (!tKey.metadata.factorPubs || !Array.isArray(tKey.metadata.factorPubs[tKey.tssTag])) {\n    throw new Error(`factorPubs for tssTag = \"${tKey.tssTag}\" does not exist`);\n  }\n\n  const existingFactorPubs = tKey.metadata.factorPubs[tKey.tssTag];\n  const factorIndex = existingFactorPubs.findIndex((p) => p.x.eq(factorPubToDelete.x));\n  if (factorIndex === -1) {\n    throw new Error(`factorPub ${factorPubToDelete} does not exist`);\n  }\n\n  const updatedFactorPubs = existingFactorPubs.slice();\n  updatedFactorPubs.splice(factorIndex, 1);\n  const updatedTSSIndexes = updatedFactorPubs.map((fb) => tKey.getFactorEncs(fb).tssIndex);\n\n  await refreshTssShares(tKey, updatedFactorPubs, updatedTSSIndexes, factorKeyForExistingTSSShare, signatures);\n}\n\nexport const getHashedPrivateKey = (postboxKey: string, clientId: string): BN => {\n  const uid = `${postboxKey}_${clientId}`;\n  let hashUid = keccak256(Buffer.from(uid, \"utf8\"));\n  hashUid = hashUid.replace(\"0x\", \"\");\n  return new BN(hashUid, \"hex\");\n};\n\n/**\n * Converts a elliptic curve scalar represented by a BN to a byte buffer in SEC1\n * format (i.e., padded to maximum length).\n * @param s - The scalar of type BN.\n * @returns The SEC1 encoded representation of the scalar.\n */\nexport function scalarBNToBufferSEC1(s: BN): Buffer {\n  return s.toArrayLike(Buffer, \"be\", SCALAR_LEN);\n}\n","import BN from \"bn.js\";\n\nimport { FIELD_ELEMENT_HEX_LEN } from \"../constants\";\nimport { IAsyncStorage, ICoreKit, IStorage, SupportedStorageType, TkeyLocalStoreData } from \"../interfaces\";\nimport { storageAvailable } from \"../utils\";\n\nexport class MemoryStorage implements IStorage {\n  private _store: Record<string, string> = {};\n\n  getItem(key: string): string | null {\n    return this._store[key] || null;\n  }\n\n  setItem(key: string, value: string): void {\n    this._store[key] = value;\n  }\n\n  removeItem(key: string): void {\n    delete this._store[key];\n  }\n\n  clear(): void {\n    this._store = {};\n  }\n}\n\nexport class BrowserStorage {\n  // eslint-disable-next-line no-use-before-define\n  private static instance: BrowserStorage;\n\n  public storage: IStorage;\n\n  private _storeKey: string;\n\n  private constructor(storeKey: string, storage: IStorage) {\n    this.storage = storage;\n    this._storeKey = storeKey;\n    try {\n      if (!storage.getItem(storeKey)) {\n        this.resetStore();\n      }\n    } catch (error) {\n      // Storage is not available\n    }\n  }\n\n  static getInstance(key: string, storageKey: SupportedStorageType = \"local\"): BrowserStorage {\n    if (!this.instance) {\n      let storage: IStorage | undefined;\n      if (storageKey === \"local\" && storageAvailable(\"localStorage\")) {\n        storage = localStorage;\n      } else if (storageKey === \"session\" && storageAvailable(\"sessionStorage\")) {\n        storage = sessionStorage;\n      } else if (storageKey === \"memory\") {\n        storage = new MemoryStorage();\n      } else if (typeof storageKey === \"object\") {\n        storage = storageKey;\n      }\n\n      if (!storage) {\n        throw new Error(\"No valid storage available\");\n      }\n      this.instance = new this(key, storage);\n    }\n    return this.instance;\n  }\n\n  toJSON(): string {\n    const result = this.storage.getItem(this._storeKey);\n    if (!result) throw new Error(`storage ${this._storeKey} is null`);\n    return result;\n  }\n\n  resetStore(): Record<string, unknown> {\n    const currStore = this.getStore();\n    this.storage.setItem(this._storeKey, JSON.stringify({}));\n    return currStore;\n  }\n\n  getStore(): Record<string, unknown> {\n    return JSON.parse(this.storage.getItem(this._storeKey) || \"{}\");\n  }\n\n  get<T>(key: string): T {\n    const store = JSON.parse(this.storage.getItem(this._storeKey) || \"{}\");\n    return store[key];\n  }\n\n  set<T>(key: string, value: T): void {\n    const store = JSON.parse(this.storage.getItem(this._storeKey) || \"{}\");\n    store[key] = value;\n    this.storage.setItem(this._storeKey, JSON.stringify(store));\n  }\n\n  remove(key: string): void {\n    const store = JSON.parse(this.storage.getItem(this._storeKey) || \"{}\");\n    delete store[key];\n    this.storage.setItem(this._storeKey, JSON.stringify(store));\n  }\n}\n\nexport class AsyncStorage {\n  // eslint-disable-next-line no-use-before-define\n  private static instance: AsyncStorage;\n\n  public storage: IAsyncStorage;\n\n  private _storeKey: string;\n\n  private constructor(storeKey: string, storage: IAsyncStorage) {\n    this.storage = storage;\n    this._storeKey = storeKey;\n  }\n\n  static getInstance(key: string, storageKey: IAsyncStorage): AsyncStorage {\n    if (!this.instance) {\n      const storage: IAsyncStorage = storageKey;\n      if (!storage) {\n        throw new Error(\"No valid storage available\");\n      }\n      this.instance = new this(key, storage);\n    }\n    return this.instance;\n  }\n\n  async toJSON(): Promise<string> {\n    const result = await this.storage.getItem(this._storeKey);\n    if (!result) throw new Error(`storage ${this._storeKey} is null`);\n    return result;\n  }\n\n  async resetStore(): Promise<Record<string, unknown>> {\n    const currStore = await this.getStore();\n    await this.storage.setItem(this._storeKey, JSON.stringify({}));\n    return currStore;\n  }\n\n  async getStore(): Promise<Record<string, unknown>> {\n    return JSON.parse((await this.storage.getItem(this._storeKey)) || \"{}\");\n  }\n\n  async get<T>(key: string): Promise<T> {\n    const store = JSON.parse((await this.storage.getItem(this._storeKey)) || \"{}\");\n    return store[key];\n  }\n\n  async set<T>(key: string, value: T): Promise<void> {\n    const store = JSON.parse((await this.storage.getItem(this._storeKey)) || \"{}\");\n    store[key] = value;\n    await this.storage.setItem(this._storeKey, JSON.stringify(store));\n  }\n\n  async remove(key: string): Promise<void> {\n    const store = JSON.parse((await this.storage.getItem(this._storeKey)) || \"{}\");\n    delete store[key];\n    await this.storage.setItem(this._storeKey, JSON.stringify(store));\n  }\n}\n\nexport async function asyncStoreFactor(factorKey: BN, mpcCoreKit: ICoreKit, storageKey: IAsyncStorage): Promise<void> {\n  const metadata = mpcCoreKit.tKey.getMetadata();\n  const currentStorage = AsyncStorage.getInstance(\"mpc_corekit_store\", storageKey);\n\n  const tkeyPubX = metadata.pubKey.x.toString(16, FIELD_ELEMENT_HEX_LEN);\n  await currentStorage.set(\n    tkeyPubX,\n    JSON.stringify({\n      factorKey: factorKey.toString(\"hex\").padStart(64, \"0\"),\n    } as TkeyLocalStoreData)\n  );\n}\n\nexport async function asyncGetFactor(mpcCoreKit: ICoreKit, storageKey: IAsyncStorage): Promise<string | undefined> {\n  const metadata = mpcCoreKit.tKey.getMetadata();\n  const currentStorage = AsyncStorage.getInstance(\"mpc_corekit_store\", storageKey);\n\n  const tkeyPubX = metadata.pubKey.x.toString(16, FIELD_ELEMENT_HEX_LEN);\n  const tKeyLocalStoreString = await currentStorage.get<string>(tkeyPubX);\n  const tKeyLocalStore = JSON.parse(tKeyLocalStoreString || \"{}\") as TkeyLocalStoreData;\n  return tKeyLocalStore.factorKey;\n}\n\nexport async function storeWebBrowserFactor(factorKey: BN, mpcCoreKit: ICoreKit, storageKey: SupportedStorageType = \"local\"): Promise<void> {\n  const metadata = mpcCoreKit.tKey.getMetadata();\n  const currentStorage = BrowserStorage.getInstance(\"mpc_corekit_store\", storageKey);\n\n  const tkeyPubX = metadata.pubKey.x.toString(16, FIELD_ELEMENT_HEX_LEN);\n  currentStorage.set(\n    tkeyPubX,\n    JSON.stringify({\n      factorKey: factorKey.toString(\"hex\").padStart(64, \"0\"),\n    } as TkeyLocalStoreData)\n  );\n}\n\nexport async function getWebBrowserFactor(mpcCoreKit: ICoreKit, storageKey: SupportedStorageType = \"local\"): Promise<string | undefined> {\n  const metadata = mpcCoreKit.tKey.getMetadata();\n  const currentStorage = BrowserStorage.getInstance(\"mpc_corekit_store\", storageKey);\n\n  const tkeyPubX = metadata.pubKey.x.toString(16, FIELD_ELEMENT_HEX_LEN);\n  const tKeyLocalStoreString = currentStorage.get<string>(tkeyPubX);\n  const tKeyLocalStore = JSON.parse(tKeyLocalStoreString || \"{}\") as TkeyLocalStoreData;\n  return tKeyLocalStore.factorKey;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey-mpc/share-serialization\");","import { ShareSerializationModule } from \"@tkey-mpc/share-serialization\";\nimport BN from \"bn.js\";\n\n/**\n * Converts a mnemonic to a BN.\n * @param shareMnemonic - The mnemonic to convert.\n * @returns A BN respective to your mnemonic\n */\nexport function mnemonicToKey(shareMnemonic: string): string {\n  const factorKey = ShareSerializationModule.deserializeMnemonic(shareMnemonic);\n  return factorKey.toString(\"hex\");\n}\n\n/**\n * Converts a BN to a mnemonic.\n * @param shareBN - The BN to convert.\n * @returns A mnemonic respective to your BN\n */\nexport function keyToMnemonic(shareHex: string): string {\n  const shareBN = new BN(shareHex, \"hex\");\n  const mnemonic = ShareSerializationModule.serializeMnemonic(shareBN);\n  return mnemonic;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/objectSpread2\");","import { Point as TkeyPoint } from \"@tkey-mpc/common-types\";\nimport type { BNString } from \"@toruslabs/torus.js\";\nimport BN from \"bn.js\";\nimport { curve } from \"elliptic\";\n\nimport { CURVE } from \"./constants\";\n\ntype EllipticPoint = curve.base.BasePoint;\nconst ZERO_POINT = CURVE.g.mul(new BN(0)) as EllipticPoint;\n\n/**\n * Class `Point` represents an elliptic curve point over curve `CURVE`.\n */\nexport class Point {\n  private p: EllipticPoint;\n\n  /**\n   * Constructs a new Point from an elliptic point.\n   * @param p - The elliptic point to be represented.\n   */\n  constructor(p: EllipticPoint) {\n    this.p = p;\n  }\n\n  /**\n   * Creates a new Point from a private Key.\n   * @param p - The TKey Point.\n   * @returns The Point encoded by `p`.\n   */\n  public static fromPrivateKey(privateKey: BNString): Point {\n    const ep = CURVE.keyFromPrivate(privateKey.toString(\"hex\")).getPublic();\n    return new Point(ep);\n  }\n\n  /**\n   * Creates a new Point from a TKey Point.\n   * @param p - The TKey Point.\n   * @returns The Point encoded by `p`.\n   */\n  public static fromTkeyPoint(p: TkeyPoint): Point {\n    const ep = CURVE.keyFromPublic({ x: p.x.toString(\"hex\"), y: p.y.toString(\"hex\") }).getPublic();\n    return new Point(ep);\n  }\n\n  /**\n   * Creates a new Point from an SEC1-encoded byte buffer.\n   * @param buf - The SEC1-encoded point.\n   * @returns The Point encoded by `buf`.\n   */\n  public static fromBufferSEC1(buf: Buffer): Point {\n    // \"elliptic\"@6.5.4 can't decode zero point.\n    if (buf.length === 1 && buf[0] === 0) {\n      return new Point(ZERO_POINT);\n    }\n\n    const p = CURVE.keyFromPublic(buf.toString(\"hex\"), \"hex\").getPublic();\n    return new Point(p);\n  }\n\n  /**\n   * Converts this point to a TKey Point.\n   * @returns A TKey Point representing this point.\n   * @throws If this point cannot be represented by a TKey Point. For example,\n   * if this point encodes the point at infinity.\n   */\n  public toTkeyPoint(): TkeyPoint {\n    if (this.p.isInfinity()) {\n      throw new Error(\"Point at infinity can't be represented as tkey point.\");\n    }\n\n    const x = this.p.getX().toString(\"hex\");\n    const y = this.p.getY().toString(\"hex\");\n    return new TkeyPoint(x, y);\n  }\n\n  /**\n   * Converts this point to a byte buffer in SEC1 format.\n   * @param compressed - Whether to use compressed format.\n   * @returns The SEC1-encoded representation of the point.\n   */\n  public toBufferSEC1(compressed: boolean): Buffer {\n    // \"elliptic\"@6.5.4 can't encode zero point.\n    if (this.p.isInfinity()) {\n      return Buffer.from(\"00\", \"hex\");\n    }\n\n    return Buffer.from(this.p.encode(\"hex\", compressed), \"hex\");\n  }\n\n  /**\n   * Checks for point equality between `this` and `p`.\n   * @param p - The point to compare to.\n   * @returns True if `this == p`. False otherwise.\n   */\n  public equals(p: Point): boolean {\n    return this.p.eq(p.p);\n  }\n}\n","import { getPubKeyPoint, Point as tkeyPoint, StringifiedType } from \"@tkey-mpc/common-types\";\nimport { keccak256 } from \"@toruslabs/torus.js\";\nimport BN from \"bn.js\";\n\nimport { FactorKeyTypeShareDescription, TssShareType, VALID_SHARE_INDICES } from \"../constants\";\nimport type { Web3AuthMPCCoreKit } from \"../mpcCoreKit\";\nimport { Point } from \"../point\";\n\nexport class TssSecurityQuestionStore {\n  shareIndex: string;\n\n  factorPublicKey: string;\n\n  question: string;\n\n  constructor(shareIndex: string, factorPublicKey: string, question: string) {\n    this.shareIndex = shareIndex;\n    this.factorPublicKey = factorPublicKey;\n    this.question = question;\n  }\n\n  static fromJSON(json: StringifiedType) {\n    const { shareIndex, factorPublicKey, question } = json;\n    return new TssSecurityQuestionStore(shareIndex, factorPublicKey, question);\n  }\n\n  toJSON(): StringifiedType {\n    return {\n      shareIndex: this.shareIndex,\n      factorPublicKey: this.factorPublicKey,\n      question: this.question,\n    };\n  }\n}\n\nexport interface setSecurityQuestionParams {\n  mpcCoreKit: Web3AuthMPCCoreKit;\n  question: string;\n  answer: string;\n  shareType?: TssShareType;\n  description?: Record<string, string>;\n  tssIndex?: TssShareType;\n}\n\nexport interface changeSecurityQuestionParams {\n  mpcCoreKit: Web3AuthMPCCoreKit;\n  newQuestion: string;\n  newAnswer: string;\n  answer: string;\n}\n\nexport class TssSecurityQuestion {\n  storeDomainName = \"tssSecurityQuestion\";\n\n  async setSecurityQuestion(params: setSecurityQuestionParams): Promise<string> {\n    const { mpcCoreKit, question, answer, description } = params;\n    let { shareType } = params;\n\n    if (!mpcCoreKit.tKey) {\n      throw new Error(\"Tkey not initialized, call init first.\");\n    }\n    if (!question || !answer) {\n      throw new Error(\"question and answer are required\");\n    }\n    const domainKey = `${this.storeDomainName}:${params.mpcCoreKit.tKey.tssTag}`;\n\n    // default using recovery index\n    if (!shareType) {\n      shareType = TssShareType.RECOVERY;\n    } else if (!VALID_SHARE_INDICES.includes(shareType)) {\n      throw new Error(`invalid share type: must be one of ${VALID_SHARE_INDICES}`);\n    }\n    // Check for existing security question\n    const tkey = mpcCoreKit.tKey;\n    const storeDomain = tkey.metadata.getGeneralStoreDomain(domainKey) as StringifiedType;\n    if (storeDomain && storeDomain.question) {\n      throw new Error(\"Security question already exists\");\n    }\n\n    // const pubKey = Point.fromTkeyPoint(mpcCoreKit.tKey.getTSSPub()).toBufferSEC1(true).toString(\"hex\");\n    const pubKey = Point.fromTkeyPoint(tkey.getKeyDetails().pubKey).toBufferSEC1(true).toString(\"hex\") + tkey.tssTag;\n    let hash = keccak256(Buffer.from(answer + pubKey, \"utf8\"));\n    hash = hash.startsWith(\"0x\") ? hash.slice(2) : hash;\n    const factorKeyBN = new BN(hash, \"hex\");\n\n    const descriptionFinal = {\n      question,\n      ...description,\n    };\n\n    await mpcCoreKit.createFactor({\n      factorKey: factorKeyBN,\n      shareType,\n      shareDescription: FactorKeyTypeShareDescription.SecurityQuestions,\n      additionalMetadata: descriptionFinal,\n    });\n    // set store domain\n    const tkeyPt = getPubKeyPoint(factorKeyBN);\n    const factorPub = Point.fromTkeyPoint(tkeyPt).toBufferSEC1(true).toString(\"hex\");\n    const storeData = new TssSecurityQuestionStore(shareType.toString(), factorPub, question);\n    tkey.metadata.setGeneralStoreDomain(domainKey, storeData.toJSON());\n\n    // check for auto commit\n    if (!tkey.manualSync) await tkey._syncShareMetadata();\n\n    return factorKeyBN.toString(\"hex\").padStart(64, \"0\");\n  }\n\n  async changeSecurityQuestion(params: changeSecurityQuestionParams) {\n    const { mpcCoreKit, newQuestion, newAnswer, answer } = params;\n    if (!newQuestion || !newAnswer || !answer) {\n      throw new Error(\"question and answer are required\");\n    }\n    // Check for existing security question\n    const tkey = mpcCoreKit.tKey;\n    // const pubKey = Point.fromTkeyPoint(mpcCoreKit.tKey.getTSSPub()).toBufferSEC1(true).toString(\"hex\");\n    const pubKey = Point.fromTkeyPoint(tkey.getKeyDetails().pubKey).toBufferSEC1(true).toString(\"hex\") + tkey.tssTag;\n\n    const domainKey = `${this.storeDomainName}:${params.mpcCoreKit.tKey.tssTag}`;\n    const storeDomain = tkey.metadata.getGeneralStoreDomain(domainKey) as StringifiedType;\n    if (!storeDomain || !storeDomain.question) {\n      throw new Error(\"Security question does not exists\");\n    }\n\n    const store = TssSecurityQuestionStore.fromJSON(storeDomain);\n    const preHash = answer + pubKey;\n    let hash = keccak256(Buffer.from(preHash, \"utf8\"));\n    hash = hash.startsWith(\"0x\") ? hash.slice(2) : hash;\n    const factorKeyBN = new BN(hash, \"hex\");\n    const factorKeyPt = Point.fromTkeyPoint(getPubKeyPoint(factorKeyBN));\n    if (factorKeyPt.toBufferSEC1(true).toString(\"hex\") !== store.factorPublicKey) {\n      throw new Error(\"Invalid answer\");\n    }\n\n    // create new factor key\n    const prenewHash = newAnswer + pubKey;\n    let newHash = keccak256(Buffer.from(prenewHash, \"utf8\"));\n    newHash = newHash.startsWith(\"0x\") ? newHash.slice(2) : newHash;\n    const newAnswerBN = new BN(newHash, \"hex\");\n    const newFactorPt = Point.fromTkeyPoint(getPubKeyPoint(newAnswerBN));\n    await mpcCoreKit.createFactor({\n      factorKey: newAnswerBN,\n      shareType: parseInt(store.shareIndex) as TssShareType,\n      shareDescription: FactorKeyTypeShareDescription.SecurityQuestions,\n    });\n\n    // update mpcCoreKit state to use new factor key during change password if mpc factor key is security question factor\n    if (mpcCoreKit.state.factorKey.eq(factorKeyBN)) {\n      await mpcCoreKit.inputFactorKey(newAnswerBN);\n    }\n    // delete after create factor to prevent last key issue\n    // delete old factor key and device share\n    await mpcCoreKit.deleteFactor(factorKeyPt.toTkeyPoint(), factorKeyBN);\n\n    store.factorPublicKey = newFactorPt.toBufferSEC1(true).toString(\"hex\");\n    store.question = newQuestion;\n    tkey.metadata.setGeneralStoreDomain(domainKey, store.toJSON());\n\n    // check for auto commit\n    if (!tkey.manualSync) await tkey._syncShareMetadata();\n  }\n\n  // Should we check with answer before deleting?\n  async deleteSecurityQuestion(mpcCoreKit: Web3AuthMPCCoreKit, deleteFactorKey = true) {\n    if (!mpcCoreKit.tKey) {\n      throw new Error(\"Tkey not initialized, call init first.\");\n    }\n\n    const domainKey = `${this.storeDomainName}:${mpcCoreKit.tKey.tssTag}`;\n    const tkey = mpcCoreKit.tKey;\n    if (deleteFactorKey) {\n      const storeDomain = tkey.metadata.getGeneralStoreDomain(domainKey) as StringifiedType;\n      if (!storeDomain || !storeDomain.question) {\n        throw new Error(\"Security question does not exists\");\n      }\n\n      const store = TssSecurityQuestionStore.fromJSON(storeDomain);\n      if (store.factorPublicKey) {\n        await mpcCoreKit.deleteFactor(tkeyPoint.fromCompressedPub(store.factorPublicKey));\n      }\n    }\n    tkey.metadata.deleteGeneralStoreDomain(domainKey);\n    // check for auto commit\n    if (!tkey.manualSync) await tkey._syncShareMetadata();\n  }\n\n  async recoverFactor(mpcCoreKit: Web3AuthMPCCoreKit, answer: string): Promise<string> {\n    if (!mpcCoreKit.tKey) {\n      throw new Error(\"Tkey not initialized, call init first.\");\n    }\n    if (!answer) {\n      throw new Error(\"question and answer are required\");\n    }\n\n    const tkey = mpcCoreKit.tKey;\n\n    const domainKey = `${this.storeDomainName}:${mpcCoreKit.tKey.tssTag}`;\n    const storeDomain = tkey.metadata.getGeneralStoreDomain(domainKey) as StringifiedType;\n    if (!storeDomain || !storeDomain.question) {\n      throw new Error(\"Security question does not exists\");\n    }\n\n    const store = TssSecurityQuestionStore.fromJSON(storeDomain);\n\n    // const pubKey = Point.fromTkeyPoint(mpcCoreKit.tKey.getTSSPub()).toBufferSEC1(true).toString(\"hex\");\n    const pubKey = Point.fromTkeyPoint(tkey.getKeyDetails().pubKey).toBufferSEC1(true).toString(\"hex\") + tkey.tssTag;\n\n    let hash = keccak256(Buffer.from(answer + pubKey, \"utf8\"));\n    hash = hash.startsWith(\"0x\") ? hash.slice(2) : hash;\n    const factorKeyBN = new BN(hash, \"hex\");\n    const factorKeyPt = Point.fromTkeyPoint(getPubKeyPoint(factorKeyBN));\n\n    if (factorKeyPt.toBufferSEC1(true).toString(\"hex\") !== store.factorPublicKey) {\n      throw new Error(\"Invalid answer\");\n    }\n\n    return hash;\n  }\n\n  getQuestion(mpcCoreKit: Web3AuthMPCCoreKit): string {\n    if (!mpcCoreKit.tKey) {\n      throw new Error(\"Tkey not initialized, call init first.\");\n    }\n    const tkey = mpcCoreKit.tKey;\n\n    const domainKey = `${this.storeDomainName}:${mpcCoreKit.tKey.tssTag}`;\n    const storeDomain = tkey.metadata.getGeneralStoreDomain(domainKey) as StringifiedType;\n    if (!storeDomain || !storeDomain.question) {\n      throw new Error(\"Security question does not exists\");\n    }\n\n    const store = TssSecurityQuestionStore.fromJSON(storeDomain);\n    return store.question;\n  }\n}\n","export * from \"./browserStorage\";\nexport * from \"./factorSerialization\";\nexport * from \"./securityQuestion\";\n","import { Point as TkeyPoint, ShareDescriptionMap } from \"@tkey-mpc/common-types\";\nimport ThresholdKey from \"@tkey-mpc/core\";\nimport type {\n  AGGREGATE_VERIFIER_TYPE,\n  ExtraParams,\n  LoginWindowResponse,\n  SubVerifierDetails,\n  TorusVerifierResponse,\n  UX_MODE_TYPE,\n  WebAuthnExtraParams,\n} from \"@toruslabs/customauth\";\nimport { CustomChainConfig, SafeEventEmitterProvider } from \"@web3auth-mpc/base\";\nimport BN from \"bn.js\";\n\nimport { FactorKeyTypeShareDescription, TssShareType, USER_PATH, WEB3AUTH_NETWORK } from \"./constants\";\n\nexport type CoreKitMode = UX_MODE_TYPE | \"nodejs\" | \"react-native\";\n\nexport interface IStorage {\n  getItem(key: string): string | null;\n  setItem(key: string, value: string): void;\n}\nexport interface IAsyncStorage {\n  async?: boolean;\n  getItem(key: string): Promise<string | null>;\n  setItem(key: string, value: string): Promise<void>;\n}\n\nexport type SupportedStorageType = \"local\" | \"session\" | \"memory\" | IStorage;\n\nexport interface InitParams {\n  /**\n   * @defaultValue `true`\n   * handle the redirect result during init()\n   */\n  handleRedirectResult: boolean;\n  /**\n   * @defaultValue `true`\n   * rehydrate the session during init()\n   */\n  rehydrate?: boolean;\n}\n\nexport interface BaseLoginParams {\n  // offset in seconds\n  serverTimeOffset?: number;\n}\n\nexport interface SubVerifierDetailsParams extends BaseLoginParams {\n  subVerifierDetails: SubVerifierDetails;\n}\n\nexport interface AggregateVerifierLoginParams extends BaseLoginParams {\n  aggregateVerifierIdentifier: string;\n  subVerifierDetailsArray: SubVerifierDetails[];\n  aggregateVerifierType?: AGGREGATE_VERIFIER_TYPE;\n}\n\nexport interface IFactorKey {\n  factorKey: BN;\n  shareType: TssShareType;\n}\n\nexport enum COREKIT_STATUS {\n  NOT_INITIALIZED = \"NOT_INITIALIZED\",\n  INITIALIZED = \"INITIALIZED\",\n  REQUIRED_SHARE = \"REQUIRED_SHARE\",\n  LOGGED_IN = \"LOGGED_IN\",\n}\n\nexport type MPCKeyDetails = {\n  metadataPubKey: TkeyPoint;\n  threshold: number;\n  requiredFactors: number;\n  totalFactors: number;\n  shareDescriptions: ShareDescriptionMap;\n  tssPubKey?: TkeyPoint;\n};\n\nexport type OauthLoginParams = (SubVerifierDetailsParams | AggregateVerifierLoginParams) & { importTssKey?: string };\nexport type UserInfo = TorusVerifierResponse & LoginWindowResponse;\n\nexport interface EnableMFAParams {\n  /**\n   * A BN used for encrypting your Device/ Recovery TSS Key Share. You can generate it using `generateFactorKey()` function or use an existing one.\n   */\n  factorKey?: BN;\n  /**\n   * Setting the Description of Share - Security Questions, Device Share, Seed Phrase, Password Share, Social Share, Other. Default is Other.\n   */\n  shareDescription?: FactorKeyTypeShareDescription;\n  /**\n   * Additional metadata information you want to be stored alongside this factor for easy identification.\n   */\n  additionalMetadata?: Record<string, string>;\n}\n\nexport interface CreateFactorParams extends EnableMFAParams {\n  /**\n   * Setting the Type of Share - Device or Recovery.\n   **/\n  shareType: TssShareType;\n}\n\nexport interface IdTokenLoginParams {\n  /**\n   * Name of the verifier created on Web3Auth Dashboard. In case of Aggregate Verifier, the name of the top level aggregate verifier.\n   */\n  verifier: string;\n\n  /**\n   * Unique Identifier for the User. The verifier identifier field set for the verifier/ sub verifier. E.g. \"sub\" field in your on jwt id token.\n   */\n  verifierId: string;\n\n  /**\n   * The idToken received from the Auth Provider.\n   */\n  idToken: string;\n\n  /**\n   * Name of the sub verifier in case of aggregate verifier setup. This field should only be provided in case of an aggregate verifier.\n   */\n  subVerifier?: string;\n\n  /**\n   * Extra verifier params in case of a WebAuthn verifier type.\n   */\n  extraVerifierParams?: WebAuthnExtraParams;\n\n  /**\n   * Any additional parameter (key value pair) you'd like to pass to the login function.\n   */\n  additionalParams?: ExtraParams;\n\n  /**\n   * Key to import key into Tss during first time login.\n   */\n  importTssKey?: string;\n}\n\nexport interface Web3AuthState {\n  oAuthKey?: string;\n  signatures?: string[];\n  userInfo?: UserInfo;\n  tssShareIndex?: number;\n  tssPubKey?: Buffer;\n  factorKey?: BN;\n}\n\nexport interface ICoreKit {\n  /**\n   * The tKey instance, if initialized.\n   * TKey is the core module on which this wrapper SDK sits for easy integration.\n   **/\n  tKey: ThresholdKey | null;\n\n  /**\n   * Provider for making the blockchain calls.\n   **/\n  provider: SafeEventEmitterProvider | null;\n\n  /**\n   * Signatures generated from the OAuth Login.\n   **/\n  signatures: string[] | null;\n\n  /**\n   * Status of the current MPC Core Kit Instance\n   **/\n  status: COREKIT_STATUS;\n\n  /**\n   * The current sdk state.\n   */\n  state: Web3AuthState;\n\n  /**\n   * The current session id.\n   */\n  sessionId: string;\n\n  /**\n   * The function used to initailise the state of MPCCoreKit\n   * Also is useful to resume an existing session.\n   * @param initParams - Contains flag for handleRedirectResult. Default is true.\n   */\n  init(initParams?: InitParams): Promise<void>;\n\n  /**\n   * Login into the SDK in an implicit flow and initialize all relevant components.\n   * @param loginParams - Parameters for Implicit Login.\n   */\n  loginWithOauth(loginParams: OauthLoginParams): Promise<void>;\n\n  /**\n   * Login into the SDK using ID Token based login and initialize all relevant components.\n   * @param idTokenLoginParams - Parameters with ID Token based Login.\n   */\n  loginWithJWT(idTokenLoginParams: IdTokenLoginParams): Promise<void>;\n\n  /**\n   * Enable MFA for the user. Deletes the Cloud factor and generates a new\n   * factor key and a backup factor key. Recommended for Non Custodial Flow.\n   * Stores the factor key in browser storage and returns the backup factor key.\n   *\n   * ** NOTE before enableMFA, you will need to commitChanges if manualSync is true.\n   *\n   * @param enableMFAParams - Parameters for recovery factor for MFA.\n   * @param recoveryFactor - Default is true. If false, recovery factor will NOT be created.\n   * @returns The backup factor key if if recoveryFacort is true else empty string.\n   */\n  enableMFA(enableMFAParams: EnableMFAParams, recoveryFactor?: boolean): Promise<string>;\n\n  /**\n   * Second step for login where the user inputs their factor key.\n   * @param factorKey - A BN used for encrypting your Device/ Recovery TSS Key\n   * Share. You can generate it using `generateFactorKey()` function or use an\n   * existing one.\n   */\n  inputFactorKey(factorKey: BN): Promise<void>;\n\n  /**\n   * Returns the current Factor Key and TssShareType in MPC Core Kit State\n   **/\n  getCurrentFactorKey(): IFactorKey;\n\n  /**\n   * Creates a new factor for authentication. Generates and returns a new factor\n   * key if no factor key is provided in `params`.\n   * @param createFactorParams - Parameters for creating a new factor.\n   * @returns The factor key.\n   */\n  createFactor(createFactorParams: CreateFactorParams): Promise<string>;\n\n  /**\n   * Deletes the factor identified by the given public key, including all\n   * associated metadata.\n   * @param factorPub - The public key of the factor to delete.\n   */\n  deleteFactor(factorPub: TkeyPoint): Promise<void>;\n\n  /**\n   * Logs out the user, terminating the session.\n   */\n  logout(): Promise<void>;\n\n  /**\n   * Get user information provided by the OAuth provider.\n   */\n  getUserInfo(): UserInfo;\n\n  /**\n   * Get information about how the keys of the user is managed according to the information in the metadata server.\n   */\n  getKeyDetails(): MPCKeyDetails;\n\n  /**\n   * Commit the changes made to the user's account when in manual sync mode.\n   */\n  commitChanges(): Promise<void>;\n\n  /**\n   * Export the user's current TSS MPC account as a private key\n   */\n  _UNSAFE_exportTssKey(): Promise<string>;\n}\n\nexport type WEB3AUTH_NETWORK_TYPE = (typeof WEB3AUTH_NETWORK)[keyof typeof WEB3AUTH_NETWORK];\n\nexport type USER_PATH_TYPE = (typeof USER_PATH)[keyof typeof USER_PATH];\n\nexport interface Web3AuthOptions {\n  /**\n   * The Web3Auth Client ID for your application. Find one at https://dashboard.web3auth.io\n   */\n  web3AuthClientId: string;\n\n  /**\n   * Chain Config for the chain you want to connect to. Currently supports only EVM based chains.\n   */\n  chainConfig?: CustomChainConfig;\n\n  /**\n   * @defaultValue `false`\n   */\n  manualSync?: boolean;\n\n  /**\n   * @defaultValue `${window.location.origin}/serviceworker`\n   */\n  baseUrl?: string;\n\n  /**\n   *\n   * @defaultValue `'sapphire_mainnet'`\n   */\n  web3AuthNetwork?: WEB3AUTH_NETWORK_TYPE;\n\n  /**\n   *\n   * @defaultValue `'local'`\n   */\n  storageKey?: SupportedStorageType;\n\n  /**\n   *  asyncStorageKey take precedence over storageKey.\n   *  if asyncStorageKey is provided, storageKey will be ignored.\n   * @defaultValue `undefined`\n   */\n  asyncStorageKey?: IAsyncStorage;\n\n  /**\n   * @defaultValue 86400\n   */\n  sessionTime?: number;\n\n  /**\n   * @defaultValue `'POPUP'`\n   */\n  uxMode?: CoreKitMode;\n\n  /**\n   * @defaultValue `false`\n   * enables logging of the internal packages.\n   */\n  enableLogging?: boolean;\n\n  /**\n   * This option is used to specify the url path where user will be\n   * redirected after login. Redirect Uri for OAuth is baseUrl/redirectPathName.\n   *\n   *\n   * @defaultValue `\"redirect\"`\n   *\n   * @remarks\n   * At verifier's interface (where you obtain client id), please use baseUrl/redirectPathName\n   * as the redirect_uri\n   *\n   * Torus Direct SDK installs a service worker relative to baseUrl to capture\n   * the auth redirect at `redirectPathName` path.\n   *\n   * For ex: While using serviceworker if `baseUrl` is \"http://localhost:3000/serviceworker\" and\n   * `redirectPathName` is 'redirect' (which is default)\n   * then user will be redirected to http://localhost:3000/serviceworker/redirect page after login\n   * where service worker will capture the results and send it back to original window where login\n   * was initiated.\n   *\n   * For browsers where service workers are not supported or if you wish to not use\n   * service workers,create and serve redirect page (i.e redirect.html file which is\n   * available in serviceworker folder of this package)\n   *\n   * If you are using redirect uxMode, you can get the results directly on your `redirectPathName`\n   * path using `getRedirectResult` function.\n   *\n   * For ex: if baseUrl is \"http://localhost:3000\" and `redirectPathName` is 'auth'\n   * then user will be redirected to http://localhost:3000/auth page after login\n   * where you can get login result by calling `getRedirectResult` on redirected page mount.\n   *\n   * Please refer to examples https://github.com/torusresearch/customauth/tree/master/examples\n   * for more understanding.\n   *\n   */\n  redirectPathName?: string;\n\n  /**\n   * @defaultValue `false`\n   * Disables the cloud factor key, enabling the one key semi custodial flow.\n   * Recommended for Non Custodial Flow.\n   */\n  disableHashedFactorKey?: boolean;\n\n  /**\n   * @defaultValue `null`\n   * Overwrite tss-lib for nodejs.\n   * Required for nodejs mode.\n   * Do not use this option for non nodejs mode.\n   */\n  tssLib?: unknown;\n\n  /**\n   * @defaultValue `Web3AuthOptions.web3AuthClientId`\n   * Overwrites the default value ( clientId ) used as nonce for hashing the hash factor key.\n   *\n   * If you want to aggregate the mfa status of client id 1 and client id 2  apps\n   * set hashedFactorNonce to some common clientID, which can be either client id 1 or client id 2 or any other unique string\n   * #PR 72\n   * Do not use this unless you know what you are doing.\n   */\n  hashedFactorNonce?: string;\n}\n\nexport type Web3AuthOptionsWithDefaults = Required<Web3AuthOptions>;\n\nexport interface SessionData {\n  oAuthKey: string;\n  factorKey: string;\n  tssShareIndex: number;\n  tssPubKey: string;\n  signatures: string[];\n  userInfo: UserInfo;\n}\n\nexport interface TkeyLocalStoreData {\n  factorKey: string;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey-mpc/core\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey-mpc/service-provider-torus\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey-mpc/storage-layer-torus\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/customauth\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/fetch-node-details\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/metadata-helpers\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/openlogin-session-manager\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/tss-client\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@web3auth-mpc/ethereum-provider\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bowser\");","/* eslint-disable @typescript-eslint/member-ordering */\nimport { BNString, encrypt, getPubKeyPoint, Point as TkeyPoint, SHARE_DELETED, ShareStore, StringifiedType } from \"@tkey-mpc/common-types\";\nimport ThresholdKey, { CoreError, lagrangeInterpolation } from \"@tkey-mpc/core\";\nimport { TorusServiceProvider } from \"@tkey-mpc/service-provider-torus\";\nimport { ShareSerializationModule } from \"@tkey-mpc/share-serialization\";\nimport { TorusStorageLayer } from \"@tkey-mpc/storage-layer-torus\";\nimport { SIGNER_MAP } from \"@toruslabs/constants\";\nimport { AGGREGATE_VERIFIER, TORUS_METHOD, TorusAggregateLoginResponse, TorusLoginResponse, UX_MODE } from \"@toruslabs/customauth\";\nimport type { UX_MODE_TYPE } from \"@toruslabs/customauth/dist/types/utils/enums\";\nimport { generatePrivate } from \"@toruslabs/eccrypto\";\nimport { NodeDetailManager } from \"@toruslabs/fetch-node-details\";\nimport { keccak256 } from \"@toruslabs/metadata-helpers\";\nimport { OpenloginSessionManager } from \"@toruslabs/openlogin-session-manager\";\nimport TorusUtils, { TorusKey } from \"@toruslabs/torus.js\";\nimport { Client, getDKLSCoeff, setupSockets } from \"@toruslabs/tss-client\";\nimport type * as TssLib from \"@toruslabs/tss-lib\";\nimport { CHAIN_NAMESPACES, log, SafeEventEmitterProvider } from \"@web3auth-mpc/base\";\nimport { EthereumSigningProvider } from \"@web3auth-mpc/ethereum-provider\";\nimport BN from \"bn.js\";\nimport bowser from \"bowser\";\n\nimport {\n  CURVE,\n  DEFAULT_CHAIN_CONFIG,\n  DELIMITERS,\n  ERRORS,\n  FactorKeyTypeShareDescription,\n  FIELD_ELEMENT_HEX_LEN,\n  MAX_FACTORS,\n  SOCIAL_TKEY_INDEX,\n  TssShareType,\n  VALID_SHARE_INDICES,\n  WEB3AUTH_NETWORK,\n} from \"./constants\";\nimport { AsyncStorage, asyncStoreFactor, BrowserStorage, storeWebBrowserFactor } from \"./helper/browserStorage\";\nimport {\n  AggregateVerifierLoginParams,\n  COREKIT_STATUS,\n  CoreKitMode,\n  CreateFactorParams,\n  EnableMFAParams,\n  ICoreKit,\n  IdTokenLoginParams,\n  IFactorKey,\n  InitParams,\n  MPCKeyDetails,\n  OauthLoginParams,\n  SessionData,\n  SubVerifierDetailsParams,\n  UserInfo,\n  Web3AuthOptions,\n  Web3AuthOptionsWithDefaults,\n  Web3AuthState,\n} from \"./interfaces\";\nimport { Point } from \"./point\";\nimport {\n  addFactorAndRefresh,\n  deleteFactorAndRefresh,\n  generateFactorKey,\n  generateTSSEndpoints,\n  getHashedPrivateKey,\n  parseToken,\n  scalarBNToBufferSEC1,\n} from \"./utils\";\n\nexport class Web3AuthMPCCoreKit implements ICoreKit {\n  public state: Web3AuthState = {};\n\n  private options: Web3AuthOptionsWithDefaults;\n\n  private privKeyProvider: EthereumSigningProvider | null = null;\n\n  private torusSp: TorusServiceProvider | null = null;\n\n  private storageLayer: TorusStorageLayer | null = null;\n\n  private tkey: ThresholdKey | null = null;\n\n  private sessionManager!: OpenloginSessionManager<SessionData>;\n\n  private currentStorage!: BrowserStorage | AsyncStorage;\n\n  private nodeDetailManager!: NodeDetailManager;\n\n  private _storageBaseKey = \"corekit_store\";\n\n  private enableLogging = false;\n\n  private ready = false;\n\n  constructor(options: Web3AuthOptions) {\n    if (!options.chainConfig) options.chainConfig = DEFAULT_CHAIN_CONFIG;\n    if (options.chainConfig.chainNamespace !== CHAIN_NAMESPACES.EIP155) {\n      throw new Error(\"You must specify a eip155 chain config.\");\n    }\n    if (!options.web3AuthClientId) {\n      throw new Error(\"You must specify a web3auth clientId.\");\n    }\n\n    const isNodejsOrRN = this.isNodejsOrRN(options.uxMode);\n\n    if (!options.storageKey) options.storageKey = \"local\";\n    if (isNodejsOrRN && [\"local\", \"session\"].includes(options.storageKey.toString()) && !options.asyncStorageKey) {\n      throw new Error(`${options.uxMode} mode do not storage of type : ${options.storageKey}`);\n    }\n\n    if (isNodejsOrRN && !options.tssLib) {\n      throw new Error(`${options.uxMode} mode requires tssLib`);\n    }\n\n    if (options.enableLogging) {\n      log.enableAll();\n      this.enableLogging = true;\n    } else log.setLevel(\"error\");\n    if (typeof options.manualSync !== \"boolean\") options.manualSync = false;\n    if (!options.web3AuthNetwork) options.web3AuthNetwork = WEB3AUTH_NETWORK.MAINNET;\n    if (!options.sessionTime) options.sessionTime = 86400;\n    if (!options.uxMode) options.uxMode = UX_MODE.REDIRECT;\n    if (!options.redirectPathName) options.redirectPathName = \"redirect\";\n    if (!options.baseUrl) options.baseUrl = isNodejsOrRN ? \"https://localhost\" : `${window?.location.origin}/serviceworker`;\n    if (!options.disableHashedFactorKey) options.disableHashedFactorKey = false;\n    if (!options.hashedFactorNonce) options.hashedFactorNonce = options.web3AuthClientId;\n\n    this.options = options as Web3AuthOptionsWithDefaults;\n\n    if (this.options.asyncStorageKey) {\n      this.currentStorage = AsyncStorage.getInstance(this._storageBaseKey, options.asyncStorageKey);\n    } else {\n      this.currentStorage = BrowserStorage.getInstance(this._storageBaseKey, this.options.storageKey);\n    }\n\n    this.nodeDetailManager = new NodeDetailManager({\n      network: this.options.web3AuthNetwork,\n      enableLogging: options.enableLogging,\n    });\n\n    const asyncConstructor = async () => {\n      const sessionId = await this.currentStorage.get<string>(\"sessionId\");\n      this.sessionManager = new OpenloginSessionManager({\n        sessionTime: this.options.sessionTime,\n        sessionId,\n      });\n    };\n    asyncConstructor();\n  }\n\n  get tKey(): ThresholdKey {\n    if (this.tkey === null) throw new Error(\"Tkey not initialized\");\n    return this.tkey;\n  }\n\n  get provider(): SafeEventEmitterProvider | null {\n    return this.privKeyProvider?.provider ? this.privKeyProvider.provider : null;\n  }\n\n  set provider(_: SafeEventEmitterProvider | null) {\n    throw new Error(\"Not implemented\");\n  }\n\n  get signatures(): string[] {\n    return this.state?.signatures ? this.state.signatures : [];\n  }\n\n  set signatures(_: string[] | null) {\n    throw new Error(\"Not implemented\");\n  }\n\n  // this return oauthkey which is used by demo to reset account.\n  // this is not the same metadataKey from tkey.\n  // will be fixed in next major release\n  get metadataKey(): string | null {\n    return this.state?.oAuthKey ? this.state.oAuthKey : null;\n  }\n\n  set metadataKey(_: string | null) {\n    throw new Error(\"Not implemented\");\n  }\n\n  get status(): COREKIT_STATUS {\n    try {\n      // metadata will be present if tkey is initialized (1 share)\n      // if 2 shares are present, then privKey will be present after metadatakey(tkey) reconstruction\n      const { tkey } = this;\n      if (!tkey) return COREKIT_STATUS.NOT_INITIALIZED;\n      if (!tkey.metadata) return COREKIT_STATUS.INITIALIZED;\n      if (!tkey.privKey || !this.state.factorKey) return COREKIT_STATUS.REQUIRED_SHARE;\n      return COREKIT_STATUS.LOGGED_IN;\n    } catch (e) {}\n    return COREKIT_STATUS.NOT_INITIALIZED;\n  }\n\n  get sessionId(): string {\n    return this.sessionManager.sessionId;\n  }\n\n  private get verifier(): string {\n    if (this.state.userInfo?.aggregateVerifier) {\n      return this.state.userInfo.aggregateVerifier;\n    }\n    return this.state?.userInfo?.verifier ? this.state.userInfo.verifier : \"\";\n  }\n\n  private get verifierId(): string {\n    return this.state?.userInfo?.verifierId ? this.state.userInfo.verifierId : \"\";\n  }\n\n  private get isRedirectMode(): boolean {\n    return this.options.uxMode === UX_MODE.REDIRECT;\n  }\n\n  // RecoverTssKey only valid for user that enable MFA where user has 2 type shares :\n  // TssShareType.DEVICE and TssShareType.RECOVERY\n  // if the factors key provided is the same type recovery will not works\n  public async _UNSAFE_recoverTssKey(factorKey: string[]) {\n    this.checkReady();\n    const factorKeyBN = new BN(factorKey[0], \"hex\");\n    const shareStore0 = await this.getFactorKeyMetadata(factorKeyBN);\n    await this.tKey.initialize({ withShare: shareStore0 });\n\n    this.tkey.privKey = new BN(factorKey[1], \"hex\");\n\n    const tssShares: BN[] = [];\n    const tssIndexes: number[] = [];\n    const tssIndexesBN: BN[] = [];\n    for (let i = 0; i < factorKey.length; i++) {\n      const factorKeyBNInput = new BN(factorKey[i], \"hex\");\n      const { tssIndex, tssShare } = await this.tKey.getTSSShare(factorKeyBNInput);\n      if (tssIndexes.includes(tssIndex)) {\n        // reset instance before throw error\n        await this.init();\n        throw new Error(\"Duplicate TSS Index\");\n      }\n      tssIndexes.push(tssIndex);\n      tssIndexesBN.push(new BN(tssIndex));\n      tssShares.push(tssShare);\n    }\n\n    const finalKey = lagrangeInterpolation(tssShares, tssIndexesBN);\n    // reset instance after recovery completed\n    await this.init();\n    return finalKey.toString(\"hex\", 64);\n  }\n\n  public async init(params: InitParams = { handleRedirectResult: true }): Promise<void> {\n    this.resetState();\n    if (params.rehydrate === undefined) params.rehydrate = true;\n\n    const nodeDetails = await this.nodeDetailManager.getNodeDetails({ verifier: \"test-verifier\", verifierId: \"test@example.com\" });\n\n    if (!nodeDetails) {\n      throw new Error(\"error getting node details, please try again!\");\n    }\n\n    this.torusSp = new TorusServiceProvider({\n      useTSS: true,\n      customAuthArgs: {\n        web3AuthClientId: this.options.web3AuthClientId,\n        baseUrl: this.options.baseUrl,\n        uxMode: this.isNodejsOrRN(this.options.uxMode) ? UX_MODE.REDIRECT : (this.options.uxMode as UX_MODE_TYPE),\n        network: this.options.web3AuthNetwork,\n        redirectPathName: this.options.redirectPathName,\n        locationReplaceOnRedirect: true,\n      },\n      nodeEndpoints: nodeDetails.torusNodeEndpoints,\n      nodePubKeys: nodeDetails.torusNodePub.map((i) => ({ x: i.X, y: i.Y })),\n    });\n\n    this.storageLayer = new TorusStorageLayer({\n      hostUrl: `${new URL(nodeDetails.torusNodeEndpoints[0]).origin}/metadata`,\n      enableLogging: this.enableLogging,\n    });\n\n    const shareSerializationModule = new ShareSerializationModule();\n\n    this.tkey = new ThresholdKey({\n      enableLogging: this.enableLogging,\n      serviceProvider: this.torusSp,\n      storageLayer: this.storageLayer,\n      manualSync: this.options.manualSync,\n      modules: {\n        shareSerialization: shareSerializationModule,\n      },\n    });\n\n    if (this.isRedirectMode) {\n      await (this.tKey.serviceProvider as TorusServiceProvider).init({ skipSw: true, skipPrefetch: true });\n    } else if (this.options.uxMode === UX_MODE.POPUP) {\n      await (this.tKey.serviceProvider as TorusServiceProvider).init({});\n    }\n    this.ready = true;\n\n    // try handle redirect flow if enabled and return(redirect) from oauth login\n    if (\n      params.handleRedirectResult &&\n      this.options.uxMode === UX_MODE.REDIRECT &&\n      (window?.location.hash.includes(\"#state\") || window?.location.hash.includes(\"#access_token\"))\n    ) {\n      // on failed redirect, instance is reseted.\n      await this.handleRedirectResult();\n\n      // if not redirect flow try to rehydrate session if available\n    } else if (params.rehydrate && this.sessionManager.sessionId) {\n      // swallowed, should not throw on rehydrate timed out session\n      const sessionResult = await this.sessionManager.authorizeSession().catch(async (err) => {\n        log.info(\"rehydrate session error\", err);\n      });\n\n      // try rehydrate session\n      if (sessionResult) {\n        await this.rehydrateSession(sessionResult);\n      } else {\n        // feature gating on no session rehydration\n        await this.featureRequest();\n      }\n    } else {\n      // feature gating if not redirect flow or session rehydration\n      await this.featureRequest();\n    }\n\n    // if not redirect flow or session rehydration, ask for factor key to login\n  }\n\n  public async loginWithOauth(params: OauthLoginParams): Promise<void> {\n    this.checkReady();\n    if (this.isNodejsOrRN(this.options.uxMode)) throw new Error(`Oauth login is NOT supported in ${this.options.uxMode}`);\n    const { importTssKey } = params;\n    const tkeyServiceProvider = this.tKey.serviceProvider as TorusServiceProvider;\n    try {\n      // oAuth login.\n      const verifierParams = params as SubVerifierDetailsParams;\n      const aggregateParams = params as AggregateVerifierLoginParams;\n      if (verifierParams.subVerifierDetails) {\n        // single verifier login.\n        const loginResponse = await tkeyServiceProvider.triggerLogin((params as SubVerifierDetailsParams).subVerifierDetails);\n\n        if (this.isRedirectMode) return;\n\n        this.updateState({\n          oAuthKey: this._getOAuthKey(loginResponse),\n          userInfo: loginResponse.userInfo,\n          signatures: this._getSignatures(loginResponse.sessionData.sessionTokenData),\n        });\n      } else if (aggregateParams.subVerifierDetailsArray) {\n        const loginResponse = await tkeyServiceProvider.triggerAggregateLogin({\n          aggregateVerifierType: aggregateParams.aggregateVerifierType || AGGREGATE_VERIFIER.SINGLE_VERIFIER_ID,\n          verifierIdentifier: aggregateParams.aggregateVerifierIdentifier as string,\n          subVerifierDetailsArray: aggregateParams.subVerifierDetailsArray,\n        });\n\n        if (this.isRedirectMode) return;\n\n        this.updateState({\n          oAuthKey: this._getOAuthKey(loginResponse),\n          userInfo: loginResponse.userInfo[0],\n          signatures: this._getSignatures(loginResponse.sessionData.sessionTokenData),\n        });\n      }\n\n      await this.setupTkey(importTssKey);\n    } catch (err: unknown) {\n      log.error(\"login error\", err);\n      if (err instanceof CoreError) {\n        if (err.code === 1302) throw new Error(ERRORS.TKEY_SHARES_REQUIRED);\n      }\n      throw new Error((err as Error).message);\n    }\n  }\n\n  public async loginWithJWT(idTokenLoginParams: IdTokenLoginParams): Promise<void> {\n    this.checkReady();\n    const { importTssKey } = idTokenLoginParams;\n    const { verifier, verifierId, idToken } = idTokenLoginParams;\n    try {\n      // oAuth login.\n      let loginResponse: TorusKey;\n      if (!idTokenLoginParams.subVerifier) {\n        // single verifier login.\n        loginResponse = await (this.tKey.serviceProvider as TorusServiceProvider).customAuthInstance.getTorusKey(\n          verifier,\n          verifierId,\n          { verifier_id: verifierId },\n          idToken,\n          {\n            ...idTokenLoginParams.extraVerifierParams,\n            ...idTokenLoginParams.additionalParams,\n          }\n        );\n        (this.tKey.serviceProvider as TorusServiceProvider).verifierType = \"normal\";\n      } else {\n        // aggregate verifier login\n        loginResponse = await (this.tKey.serviceProvider as TorusServiceProvider).customAuthInstance.getAggregateTorusKey(verifier, verifierId, [\n          { verifier: idTokenLoginParams.subVerifier, idToken, extraVerifierParams: idTokenLoginParams.extraVerifierParams },\n        ]);\n        (this.tKey.serviceProvider as TorusServiceProvider).verifierType = \"aggregate\";\n      }\n\n      const oAuthShare = this._getOAuthKey(loginResponse);\n\n      (this.tKey.serviceProvider as TorusServiceProvider).postboxKey = new BN(oAuthShare, \"hex\");\n      (this.tKey.serviceProvider as TorusServiceProvider).verifierName = verifier;\n      (this.tKey.serviceProvider as TorusServiceProvider).verifierId = verifierId;\n\n      this.updateState({\n        oAuthKey: oAuthShare,\n        userInfo: { ...parseToken(idToken), verifier, verifierId },\n        signatures: this._getSignatures(loginResponse.sessionData.sessionTokenData),\n      });\n\n      await this.setupTkey(importTssKey);\n    } catch (err: unknown) {\n      log.error(\"login error\", err);\n      if (err instanceof CoreError) {\n        if (err.code === 1302) throw new Error(ERRORS.TKEY_SHARES_REQUIRED);\n      }\n      throw new Error((err as Error).message);\n    }\n  }\n\n  public async handleRedirectResult(): Promise<void> {\n    this.checkReady();\n\n    try {\n      const result = await this.torusSp.customAuthInstance.getRedirectResult();\n\n      if (result.method === TORUS_METHOD.TRIGGER_LOGIN) {\n        const data = result.result as TorusLoginResponse;\n        if (!data) throw new Error(\"Invalid login params passed\");\n        this.updateState({\n          oAuthKey: this._getOAuthKey(data),\n          userInfo: data.userInfo,\n          signatures: this._getSignatures(data.sessionData.sessionTokenData),\n        });\n        this.torusSp.verifierType = \"normal\";\n        const userInfo = this.getUserInfo();\n        this.torusSp.verifierName = userInfo.verifier;\n      } else if (result.method === TORUS_METHOD.TRIGGER_AGGREGATE_LOGIN) {\n        const data = result.result as TorusAggregateLoginResponse;\n        if (!data) throw new Error(\"Invalid login params passed\");\n        this.updateState({\n          oAuthKey: this._getOAuthKey(data),\n          userInfo: data.userInfo[0],\n          signatures: this._getSignatures(data.sessionData.sessionTokenData),\n        });\n        this.torusSp.verifierType = \"aggregate\";\n        const userInfo = this.getUserInfo();\n        this.torusSp.verifierName = userInfo.aggregateVerifier;\n      } else {\n        throw new Error(\"Unsupported method type\");\n      }\n\n      const userInfo = this.getUserInfo();\n      if (!this.state.oAuthKey) throw new Error(\"oAuthKey not present\");\n      this.torusSp.postboxKey = new BN(this.state.oAuthKey, \"hex\");\n      this.torusSp.verifierId = userInfo.verifierId;\n      await this.setupTkey();\n    } catch (error: unknown) {\n      this.resetState();\n      log.error(\"error while handling redirect result\", error);\n      throw new Error((error as Error).message);\n    }\n  }\n\n  public async inputFactorKey(factorKey: BN): Promise<void> {\n    this.checkReady();\n    try {\n      // input tkey device share when required share > 0 ( or not reconstructed )\n      // assumption tkey shares will not changed\n      if (!this.tKey.privKey) {\n        const factorKeyMetadata = await this.getFactorKeyMetadata(factorKey);\n        await this.tKey.inputShareStoreSafe(factorKeyMetadata, true);\n      }\n\n      // Finalize initialization.\n      await this.tKey.reconstructKey();\n      await this.finalizeTkey(factorKey);\n    } catch (err: unknown) {\n      log.error(\"login error\", err);\n      if (err instanceof CoreError) {\n        if (err.code === 1302) throw new Error(ERRORS.TKEY_SHARES_REQUIRED);\n      }\n      throw new Error((err as Error).message);\n    }\n  }\n\n  public getCurrentFactorKey(): IFactorKey {\n    this.checkReady();\n    if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n    if (!this.state.tssShareIndex) throw new Error(\"TSS Share Type (Index) not present\");\n    try {\n      return {\n        factorKey: this.state.factorKey,\n        shareType: this.state.tssShareIndex,\n      };\n    } catch (err: unknown) {\n      log.error(\"state error\", err);\n      throw new Error((err as Error).message);\n    }\n  }\n\n  public getTssPublicKey(): TkeyPoint {\n    this.checkReady();\n    return this.tKey.getTSSPub();\n  }\n\n  public async enableMFA(enableMFAParams: EnableMFAParams, recoveryFactor = true): Promise<string> {\n    this.checkReady();\n\n    const hashedFactorKey = getHashedPrivateKey(this.state.oAuthKey, this.options.hashedFactorNonce);\n    if (!(await this.checkIfFactorKeyValid(hashedFactorKey))) {\n      if (this.tKey._localMetadataTransitions[0].length) throw new Error(\"CommitChanges are required before enabling MFA\");\n      throw new Error(\"MFA already enabled\");\n    }\n\n    try {\n      let browserData;\n\n      if (this.isNodejsOrRN(this.options.uxMode)) {\n        browserData = {\n          browserName: \"Node Env\",\n          browserVersion: \"\",\n          deviceName: \"nodejs\",\n        };\n      } else {\n        // try {\n        const browserInfo = bowser.parse(navigator.userAgent);\n        const browserName = `${browserInfo.browser.name}`;\n        browserData = {\n          browserName,\n          browserVersion: browserInfo.browser.version,\n          deviceName: browserInfo.os.name,\n        };\n      }\n      const deviceFactorKey = new BN(await this.createFactor({ shareType: TssShareType.DEVICE, additionalMetadata: browserData }), \"hex\");\n      if (this.currentStorage instanceof AsyncStorage) {\n        asyncStoreFactor(deviceFactorKey, this, this.options.asyncStorageKey);\n      } else {\n        storeWebBrowserFactor(deviceFactorKey, this, this.options.storageKey);\n      }\n      await this.inputFactorKey(new BN(deviceFactorKey, \"hex\"));\n\n      const hashedFactorPub = getPubKeyPoint(hashedFactorKey);\n      await this.deleteFactor(hashedFactorPub, hashedFactorKey);\n      await this.deleteMetadataShareBackup(hashedFactorKey);\n\n      // only recovery factor = true\n      if (recoveryFactor) {\n        const backupFactorKey = await this.createFactor({ shareType: TssShareType.RECOVERY, ...enableMFAParams });\n        return backupFactorKey;\n      }\n      // update to undefined for next major release\n      return \"\";\n    } catch (err: unknown) {\n      log.error(\"error enabling MFA\", err);\n      throw new Error((err as Error).message);\n    }\n  }\n\n  public getTssFactorPub = (): string[] => {\n    this.checkReady();\n    if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n    const factorPubsList = this.tKey.metadata.factorPubs[this.tKey.tssTag];\n    return factorPubsList.map((factorPub) => Point.fromTkeyPoint(factorPub).toBufferSEC1(true).toString(\"hex\"));\n  };\n\n  public async createFactor(createFactorParams: CreateFactorParams): Promise<string> {\n    this.checkReady();\n\n    let { shareType, factorKey, shareDescription, additionalMetadata } = createFactorParams;\n\n    if (!VALID_SHARE_INDICES.includes(shareType)) {\n      throw new Error(`invalid share type: must be one of ${VALID_SHARE_INDICES}`);\n    }\n    if (!factorKey) {\n      factorKey = generateFactorKey().private;\n    }\n    if (!shareDescription) {\n      shareDescription = FactorKeyTypeShareDescription.Other;\n    }\n    if (!additionalMetadata) {\n      additionalMetadata = {};\n    }\n\n    const factorPub = getPubKeyPoint(factorKey);\n\n    if (this.getTssFactorPub().includes(Point.fromTkeyPoint(factorPub).toBufferSEC1(true).toString(\"hex\"))) {\n      throw new Error(\"Factor already exists\");\n    }\n\n    try {\n      await this.copyOrCreateShare(shareType, factorPub);\n      await this.backupMetadataShare(factorKey);\n      await this.addFactorDescription(factorKey, shareDescription, additionalMetadata);\n      if (!this.tKey.manualSync) await this.tKey._syncShareMetadata();\n      return scalarBNToBufferSEC1(factorKey).toString(\"hex\");\n    } catch (error) {\n      log.error(\"error creating factor\", error);\n      throw error;\n    }\n  }\n\n  // function for setting up provider\n  public getPublic: () => Promise<Buffer> = async () => {\n    let { tssPubKey } = this.state;\n    if (tssPubKey.length === FIELD_ELEMENT_HEX_LEN + 1) {\n      tssPubKey = tssPubKey.subarray(1);\n    }\n    return Buffer.from(tssPubKey);\n  };\n\n  public sign = async (msgHash: Buffer): Promise<{ v: number; r: Buffer; s: Buffer }> => {\n    // if (this.state.remoteClient) {\n    //   return this.remoteSign(msgHash);\n    // }\n    return this.localSign(msgHash);\n  };\n\n  public localSign = async (msgHash: Buffer) => {\n    // PreSetup\n    const { tssShareIndex } = this.state;\n    let tssPubKey = await this.getPublic();\n\n    const { torusNodeTSSEndpoints } = await this.nodeDetailManager.getNodeDetails({\n      verifier: \"test-verifier\",\n      verifierId: \"test@example.com\",\n    });\n\n    if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n    const { tssShare } = await this.tKey.getTSSShare(this.state.factorKey);\n    const tssNonce = this.getTssNonce();\n\n    if (!tssPubKey || !torusNodeTSSEndpoints) {\n      throw new Error(\"tssPubKey or torusNodeTSSEndpoints not available\");\n    }\n\n    if (tssPubKey.length === FIELD_ELEMENT_HEX_LEN + 1) {\n      tssPubKey = tssPubKey.subarray(1);\n    }\n\n    const vid = `${this.verifier}${DELIMITERS.Delimiter1}${this.verifierId}`;\n    const sessionId = `${vid}${DELIMITERS.Delimiter2}default${DELIMITERS.Delimiter3}${tssNonce}${DELIMITERS.Delimiter4}`;\n\n    const parties = 4;\n    const clientIndex = parties - 1;\n    // 1. setup\n    // generate endpoints for servers\n    const { nodeIndexes } = await (this.tKey.serviceProvider as TorusServiceProvider).getTSSPubKey(\n      this.tKey.tssTag,\n      this.tKey.metadata.tssNonces[this.tKey.tssTag]\n    );\n    const {\n      endpoints,\n      tssWSEndpoints,\n      partyIndexes,\n      nodeIndexesReturned: participatingServerDKGIndexes,\n    } = generateTSSEndpoints(torusNodeTSSEndpoints, parties, clientIndex, nodeIndexes);\n    const randomSessionNonce = keccak256(Buffer.from(generatePrivate().toString(\"hex\") + Date.now(), \"utf8\")).toString(\"hex\");\n    const tssImportUrl = `${torusNodeTSSEndpoints[0]}/v1/clientWasm`;\n    // session is needed for authentication to the web3auth infrastructure holding the factor 1\n    const currentSession = `${sessionId}${randomSessionNonce}`;\n\n    let tss: typeof TssLib;\n    if (this.isNodejsOrRN(this.options.uxMode)) {\n      tss = this.options.tssLib as typeof TssLib;\n    } else {\n      tss = await import(\"@toruslabs/tss-lib\");\n      await tss.default(tssImportUrl);\n    }\n    // setup mock shares, sockets and tss wasm files.\n    const [sockets] = await Promise.all([setupSockets(tssWSEndpoints, randomSessionNonce)]);\n\n    const dklsCoeff = getDKLSCoeff(true, participatingServerDKGIndexes, tssShareIndex as number);\n    const denormalisedShare = dklsCoeff.mul(tssShare).umod(CURVE.curve.n);\n    const share = scalarBNToBufferSEC1(denormalisedShare).toString(\"base64\");\n\n    if (!currentSession) {\n      throw new Error(`sessionAuth does not exist ${currentSession}`);\n    }\n\n    const signatures = await this.getSigningSignatures(msgHash.toString(\"hex\"));\n    if (!signatures) {\n      throw new Error(`Signature does not exist ${signatures}`);\n    }\n\n    const client = new Client(currentSession, clientIndex, partyIndexes, endpoints, sockets, share, tssPubKey.toString(\"base64\"), true, tssImportUrl);\n    const serverCoeffs: Record<number, string> = {};\n    for (let i = 0; i < participatingServerDKGIndexes.length; i++) {\n      const serverIndex = participatingServerDKGIndexes[i];\n      serverCoeffs[serverIndex] = getDKLSCoeff(false, participatingServerDKGIndexes, tssShareIndex as number, serverIndex).toString(\"hex\");\n    }\n\n    client.precompute(tss, { signatures, server_coeffs: serverCoeffs });\n\n    await client.ready().catch((err) => {\n      client.cleanup(tss, { signatures, server_coeffs: serverCoeffs });\n      throw err;\n    });\n\n    let { r, s, recoveryParam } = await client.sign(tss, Buffer.from(msgHash).toString(\"base64\"), true, \"\", \"keccak256\", {\n      signatures,\n    });\n\n    if (recoveryParam < 27) {\n      recoveryParam += 27;\n    }\n    // skip await cleanup\n    client.cleanup(tss, { signatures, server_coeffs: serverCoeffs });\n    return { v: recoveryParam, r: scalarBNToBufferSEC1(r), s: scalarBNToBufferSEC1(s) };\n  };\n\n  async deleteFactor(factorPub: TkeyPoint, factorKey?: BNString): Promise<void> {\n    if (!this.state.factorKey) throw new Error(\"Factor key not present\");\n    if (!this.tKey.metadata.factorPubs) throw new Error(\"Factor pubs not present\");\n    const remainingFactors = this.tKey.metadata.factorPubs[this.tKey.tssTag].length || 0;\n    if (remainingFactors <= 1) throw new Error(\"Cannot delete last factor\");\n    const fpp = Point.fromTkeyPoint(factorPub);\n    const stateFpp = Point.fromTkeyPoint(getPubKeyPoint(this.state.factorKey));\n    if (fpp.equals(stateFpp)) {\n      throw new Error(\"Cannot delete current active factor\");\n    }\n\n    await deleteFactorAndRefresh(this.tKey, factorPub, this.state.factorKey, this.signatures);\n    const factorPubHex = fpp.toBufferSEC1(true).toString(\"hex\");\n    const allDesc = this.tKey.metadata.getShareDescription();\n    const keyDesc = allDesc[factorPubHex];\n    if (keyDesc) {\n      keyDesc.forEach(async (desc) => {\n        await this.tKey?.deleteShareDescription(factorPubHex, desc);\n      });\n    }\n\n    // delete factorKey share metadata if factorkey is provided\n    if (factorKey) {\n      const factorKeyBN = new BN(factorKey, \"hex\");\n      const derivedFactorPub = Point.fromTkeyPoint(getPubKeyPoint(factorKeyBN));\n      // only delete if factorPub matches\n      if (derivedFactorPub.equals(fpp)) {\n        await this.deleteMetadataShareBackup(factorKeyBN);\n      }\n    }\n\n    if (!this.tKey.manualSync) await this.tKey._syncShareMetadata();\n  }\n\n  public async logout(): Promise<void> {\n    if (this.sessionManager.sessionId) {\n      // throw new Error(\"User is not logged in.\");\n      await this.sessionManager.invalidateSession();\n    }\n    // to accommodate async storage\n    await this.currentStorage.set(\"sessionId\", \"\");\n\n    this.resetState();\n    await this.init({ handleRedirectResult: false });\n  }\n\n  public getUserInfo(): UserInfo {\n    if (!this.state.userInfo) {\n      throw new Error(\"user is not logged in.\");\n    }\n    return this.state.userInfo;\n  }\n\n  public getKeyDetails(): MPCKeyDetails {\n    this.checkReady();\n    const tkeyDetails = this.tKey.getKeyDetails();\n    const tssPubKey = this.state.tssPubKey ? this.tKey.getTSSPub() : undefined;\n\n    const factors = this.tKey.metadata.factorPubs ? this.tKey.metadata.factorPubs[this.tKey.tssTag] : [];\n    const keyDetails: MPCKeyDetails = {\n      // use tkey's for now\n      requiredFactors: tkeyDetails.requiredShares,\n      threshold: tkeyDetails.threshold,\n      totalFactors: factors.length + 1,\n      shareDescriptions: this.tKey.getMetadata().getShareDescription(),\n      metadataPubKey: tkeyDetails.pubKey,\n      tssPubKey,\n    };\n    return keyDetails;\n  }\n\n  public async commitChanges(): Promise<void> {\n    this.checkReady();\n    if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n\n    try {\n      // in case for manualsync = true, _syncShareMetadata will not call syncLocalMetadataTransitions()\n      // it will not create a new LocalMetadataTransition\n      // manual call syncLocalMetadataTransitions() required to sync local transitions to storage\n      await this.tKey._syncShareMetadata();\n      await this.tKey.syncLocalMetadataTransitions();\n    } catch (error: unknown) {\n      log.error(\"sync metadata error\", error);\n      throw error;\n    }\n  }\n\n  public async setManualSync(manualSync: boolean): Promise<void> {\n    this.checkReady();\n    // sync local transistion to storage before allow changes\n    await this.tKey.syncLocalMetadataTransitions();\n    this.options.manualSync = manualSync;\n    this.tKey.manualSync = manualSync;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  private async importTssKey(tssKey: string, factorPub: TkeyPoint, newTSSIndex: TssShareType = TssShareType.DEVICE): Promise<void> {\n    if (!this.state.signatures) throw new Error(\"signatures not present\");\n\n    const tssKeyBN = new BN(tssKey, \"hex\");\n    await this.tKey.importTssKey({ tag: this.tKey.tssTag, importKey: tssKeyBN, factorPub, newTSSIndex }, { authSignatures: this.state.signatures });\n  }\n\n  public async _UNSAFE_exportTssKey(): Promise<string> {\n    if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n    if (!this.state.signatures) throw new Error(\"signatures not present\");\n\n    const exportTssKey = await this.tKey._UNSAFE_exportTssKey({\n      factorKey: this.state.factorKey,\n      authSignatures: this.state.signatures,\n      selectedServers: [],\n    });\n\n    return exportTssKey.toString(\"hex\", FIELD_ELEMENT_HEX_LEN);\n  }\n\n  private getTssNonce(): number {\n    if (!this.tKey.metadata.tssNonces) throw new Error(\"tssNonce not present\");\n    const tssNonce = this.tKey.metadata.tssNonces[this.tKey.tssTag];\n    return tssNonce;\n  }\n\n  private async setupTkey(importTssKey?: string): Promise<void> {\n    if (!this.state.oAuthKey) {\n      throw new Error(\"user not logged in\");\n    }\n    const existingUser = await this.isMetadataPresent(this.state.oAuthKey);\n\n    if (!existingUser) {\n      // Generate or use hash factor and initialize tkey with it.\n      let factorKey: BN;\n      if (this.options.disableHashedFactorKey) {\n        factorKey = generateFactorKey().private;\n        // delete previous hashed factorKey if present\n        const hashedFactorKey = getHashedPrivateKey(this.state.oAuthKey, this.options.hashedFactorNonce);\n        await this.deleteMetadataShareBackup(hashedFactorKey);\n      } else {\n        factorKey = getHashedPrivateKey(this.state.oAuthKey, this.options.hashedFactorNonce);\n      }\n      const deviceTSSIndex = TssShareType.DEVICE;\n      const factorPub = getPubKeyPoint(factorKey);\n      if (!importTssKey) {\n        const deviceTSSShare = new BN(generatePrivate());\n        await this.tKey.initialize({ useTSS: true, factorPub, deviceTSSShare, deviceTSSIndex });\n      } else {\n        await this.tKey.initialize();\n        await this.importTssKey(importTssKey, factorPub, deviceTSSIndex);\n      }\n\n      // Finalize initialization.\n      await this.tKey.reconstructKey();\n      await this.finalizeTkey(factorKey);\n\n      // Store factor description.\n      await this.backupMetadataShare(factorKey);\n      if (this.options.disableHashedFactorKey) {\n        await this.addFactorDescription(factorKey, FactorKeyTypeShareDescription.Other);\n      } else {\n        await this.addFactorDescription(factorKey, FactorKeyTypeShareDescription.HashedShare);\n      }\n    } else {\n      if (importTssKey) throw new Error(\"Cannot import tss key for existing user\");\n      await this.tKey.initialize({ neverInitializeNewKey: true });\n      const hashedFactorKey = getHashedPrivateKey(this.state.oAuthKey, this.options.hashedFactorNonce);\n      if ((await this.checkIfFactorKeyValid(hashedFactorKey)) && !this.options.disableHashedFactorKey) {\n        // Initialize tkey with existing hashed share if available.\n        const factorKeyMetadata: ShareStore = await this.getFactorKeyMetadata(hashedFactorKey);\n        await this.tKey.inputShareStoreSafe(factorKeyMetadata, true);\n        await this.tKey.reconstructKey();\n        await this.finalizeTkey(hashedFactorKey);\n      }\n    }\n  }\n\n  private async finalizeTkey(factorKey: BN) {\n    // Read tss meta data.\n    const { tssIndex: tssShareIndex } = await this.tKey.getTSSShare(factorKey);\n    const tssPubKey = Point.fromTkeyPoint(this.tKey.getTSSPub()).toBufferSEC1(false);\n\n    this.updateState({ tssShareIndex, tssPubKey, factorKey });\n\n    // Finalize setup.\n    if (!this.tKey.manualSync) await this.tKey.syncLocalMetadataTransitions();\n    await this.setupProvider();\n    await this.createSession();\n  }\n\n  private checkReady() {\n    if (!this.ready) {\n      throw Error(\"MPC Core Kit not initialized, call init first!\");\n    }\n  }\n\n  private async rehydrateSession(result: SessionData) {\n    try {\n      this.checkReady();\n\n      const factorKey = new BN(result.factorKey, \"hex\");\n      if (!factorKey) {\n        throw new Error(\"Invalid factor key\");\n      }\n      this.torusSp.postboxKey = new BN(result.oAuthKey, \"hex\");\n      this.torusSp.verifierName = result.userInfo.aggregateVerifier || result.userInfo.verifier;\n      this.torusSp.verifierId = result.userInfo.verifierId;\n      this.torusSp.verifierType = result.userInfo.aggregateVerifier ? \"aggregate\" : \"normal\";\n      const factorKeyMetadata = await this.getFactorKeyMetadata(factorKey);\n      await this.tKey.initialize({ neverInitializeNewKey: true });\n      await this.tKey.inputShareStoreSafe(factorKeyMetadata, true);\n      await this.tKey.reconstructKey();\n\n      this.updateState({\n        factorKey: new BN(result.factorKey, \"hex\"),\n        oAuthKey: result.oAuthKey,\n        tssShareIndex: result.tssShareIndex,\n        tssPubKey: Buffer.from(result.tssPubKey.padStart(FIELD_ELEMENT_HEX_LEN, \"0\"), \"hex\"),\n        signatures: result.signatures,\n        userInfo: result.userInfo,\n      });\n\n      await this.setupProvider();\n    } catch (err) {\n      log.error(\"error trying to authorize session\", err);\n    }\n  }\n\n  private async createSession() {\n    try {\n      const sessionId = OpenloginSessionManager.generateRandomSessionKey();\n      this.sessionManager.sessionId = sessionId;\n      const { oAuthKey, factorKey, userInfo, tssShareIndex, tssPubKey } = this.state;\n      if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n      const { tssShare } = await this.tKey.getTSSShare(this.state.factorKey);\n      if (!oAuthKey || !factorKey || !tssShare || !tssPubKey || !userInfo) {\n        throw new Error(\"User not logged in\");\n      }\n      const payload: SessionData = {\n        oAuthKey,\n        factorKey: factorKey?.toString(\"hex\"),\n        tssShareIndex: tssShareIndex as number,\n        tssPubKey: Buffer.from(tssPubKey).toString(\"hex\"),\n        signatures: this.signatures,\n        userInfo,\n      };\n      await this.sessionManager.createSession(payload);\n      // to accommodate async storage\n      await this.currentStorage.set(\"sessionId\", sessionId);\n    } catch (err) {\n      log.error(\"error creating session\", err);\n    }\n  }\n\n  private async isMetadataPresent(privateKey: string) {\n    const privateKeyBN = new BN(privateKey, \"hex\");\n    const metadata = await this.tKey?.storageLayer.getMetadata<{ message: string }>({ privKey: privateKeyBN });\n    if (metadata && Object.keys(metadata).length > 0 && metadata.message !== \"KEY_NOT_FOUND\") {\n      return true;\n    }\n    return false;\n  }\n\n  private async checkIfFactorKeyValid(factorKey: BN): Promise<boolean> {\n    this.checkReady();\n    const factorKeyMetadata = await this.tKey?.storageLayer.getMetadata<StringifiedType>({ privKey: factorKey });\n    if (!factorKeyMetadata || factorKeyMetadata.message === \"KEY_NOT_FOUND\" || factorKeyMetadata.message === \"SHARE_DELETED\") {\n      return false;\n    }\n    log.info(\"factorKeyMetadata\", factorKeyMetadata);\n    return true;\n  }\n\n  private async getFactorKeyMetadata(factorKey: BN): Promise<ShareStore> {\n    this.checkReady();\n    const factorKeyMetadata = await this.tKey?.storageLayer.getMetadata<StringifiedType>({ privKey: factorKey });\n    if (!factorKeyMetadata || factorKeyMetadata.message === \"KEY_NOT_FOUND\") {\n      throw new Error(\"no metadata for your factor key, reset your account\");\n    }\n    return ShareStore.fromJSON(factorKeyMetadata);\n  }\n\n  /**\n   * Copies a share and makes it available under a new factor key. If no share\n   * exists at the specified share index, a new share is created.\n   * @param newFactorTSSIndex - The index of the share to copy.\n   * @param newFactorPub - The public key of the new share.\n   */\n  private async copyOrCreateShare(newFactorTSSIndex: number, newFactorPub: TkeyPoint) {\n    this.checkReady();\n    if (!this.tKey.metadata.factorPubs || !Array.isArray(this.tKey.metadata.factorPubs[this.tKey.tssTag])) {\n      throw new Error(\"factorPubs does not exist, failed in copy factor pub\");\n    }\n    if (!this.tKey.metadata.factorEncs || typeof this.tKey.metadata.factorEncs[this.tKey.tssTag] !== \"object\") {\n      throw new Error(\"factorEncs does not exist, failed in copy factor pub\");\n    }\n    if (!this.state.factorKey) {\n      throw new Error(\"factorKey not present\");\n    }\n    if (VALID_SHARE_INDICES.indexOf(newFactorTSSIndex) === -1) {\n      throw new Error(`invalid new share index: must be one of ${VALID_SHARE_INDICES}`);\n    }\n\n    if (this.tKey.metadata.factorPubs[this.tKey.tssTag].length >= MAX_FACTORS) {\n      throw new Error(\"Maximum number of factors reached\");\n    }\n    if (this.state.tssShareIndex !== newFactorTSSIndex) {\n      if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n\n      // Generate new share.\n      await addFactorAndRefresh(this.tKey, newFactorPub, newFactorTSSIndex, this.state.factorKey, this.signatures);\n\n      // Update local share.\n      const { tssIndex } = await this.tKey.getTSSShare(this.state.factorKey);\n      this.updateState({\n        tssShareIndex: tssIndex,\n      });\n      return;\n    }\n\n    if (!this.state.factorKey) throw new Error(\"factorKey not present\");\n    const { tssShare } = await this.tKey.getTSSShare(this.state.factorKey);\n    const updatedFactorPubs = this.tKey.metadata.factorPubs[this.tKey.tssTag].concat([newFactorPub]);\n    const factorEncs = JSON.parse(JSON.stringify(this.tKey.metadata.factorEncs[this.tKey.tssTag]));\n    const factorPubID = newFactorPub.x.toString(16, FIELD_ELEMENT_HEX_LEN);\n    factorEncs[factorPubID] = {\n      tssIndex: this.state.tssShareIndex,\n      type: \"direct\",\n      userEnc: await encrypt(Point.fromTkeyPoint(newFactorPub).toBufferSEC1(false), scalarBNToBufferSEC1(tssShare)),\n      serverEncs: [],\n    };\n    this.tKey.metadata.addTSSData({\n      tssTag: this.tKey.tssTag,\n      factorPubs: updatedFactorPubs,\n      factorEncs,\n    });\n\n    if (!this.tKey.manualSync) await this.tKey._syncShareMetadata();\n  }\n\n  private async getMetadataShare(): Promise<ShareStore> {\n    try {\n      const polyId = this.tKey?.metadata.getLatestPublicPolynomial().getPolynomialID();\n      const shares = this.tKey?.shares[polyId];\n      let share: ShareStore | null = null;\n\n      for (const shareIndex in shares) {\n        if (shareIndex !== SOCIAL_TKEY_INDEX.toString()) {\n          share = shares[shareIndex];\n        }\n      }\n      if (!share) throw new Error(\"no metadata share found\");\n      return share;\n    } catch (err: unknown) {\n      log.error(\"create device share error\", err);\n      throw new Error((err as Error).message);\n    }\n  }\n\n  private async deleteMetadataShareBackup(factorKey: BN): Promise<void> {\n    await this.tKey.addLocalMetadataTransitions({ input: [{ message: SHARE_DELETED, dateAdded: Date.now() }], privKey: [factorKey] });\n    if (!this.tkey?.manualSync) await this.tkey?.syncLocalMetadataTransitions();\n  }\n\n  private async backupMetadataShare(factorKey: BN) {\n    const metadataShare = await this.getMetadataShare();\n\n    // Set metadata for factor key backup\n    await this.tKey?.addLocalMetadataTransitions({\n      input: [metadataShare],\n      privKey: [factorKey],\n    });\n    if (!this.tkey?.manualSync) await this.tkey?.syncLocalMetadataTransitions();\n  }\n\n  private async addFactorDescription(\n    factorKey: BN,\n    shareDescription: FactorKeyTypeShareDescription,\n    additionalMetadata: Record<string, string> = {},\n    updateMetadata = true\n  ) {\n    const { tssIndex } = await this.tKey.getTSSShare(factorKey);\n    const tkeyPoint = getPubKeyPoint(factorKey);\n    const factorPub = Point.fromTkeyPoint(tkeyPoint).toBufferSEC1(true).toString(\"hex\");\n    const params = {\n      module: shareDescription,\n      dateAdded: Date.now(),\n      ...additionalMetadata,\n      tssShareIndex: tssIndex,\n    };\n    await this.tKey?.addShareDescription(factorPub, JSON.stringify(params), updateMetadata);\n  }\n\n  private async setupProvider(): Promise<void> {\n    const signingProvider = new EthereumSigningProvider({ config: { chainConfig: this.options.chainConfig } });\n    await signingProvider.setupProvider({ sign: this.sign, getPublic: this.getPublic });\n    this.privKeyProvider = signingProvider;\n  }\n\n  private updateState(newState: Partial<Web3AuthState>): void {\n    this.state = { ...this.state, ...newState };\n  }\n\n  private resetState(): void {\n    this.ready = false;\n    this.tkey = null;\n    this.torusSp = null;\n    this.storageLayer = null;\n    this.privKeyProvider = null;\n  }\n\n  private _getOAuthKey(result: TorusKey): string {\n    return TorusUtils.getPostboxKey(result);\n  }\n\n  private _getSignatures(sessionData: TorusKey[\"sessionData\"][\"sessionTokenData\"]): string[] {\n    return sessionData.map((session) => JSON.stringify({ data: session.token, sig: session.signature }));\n  }\n\n  private async getSigningSignatures(data: string): Promise<string[]> {\n    if (!this.signatures) throw new Error(\"signatures not present\");\n    log.info(\"data\", data);\n    return this.signatures;\n  }\n\n  private isNodejsOrRN(params: CoreKitMode): boolean {\n    const mode = params;\n    return mode === \"nodejs\" || mode === \"react-native\";\n  }\n\n  private async featureRequest() {\n    const accessUrl = SIGNER_MAP[this.options.web3AuthNetwork];\n\n    const accessRequest = {\n      network: this.options.web3AuthNetwork,\n      client_id: this.options.web3AuthClientId,\n      is_mpc_core_kit: \"true\",\n      enable_gating: \"true\",\n    };\n    const url = new URL(`${accessUrl}/api/feature-access`);\n    url.search = new URLSearchParams(accessRequest).toString();\n    const result = await fetch(url);\n\n    if (result.status !== 200) {\n      // reset state on no mpc access\n      this.resetState();\n      throw new Error(\"MPC access denied, please subscribe to our plan to use MPC\");\n    }\n    return result.json();\n  }\n}\n","export * from \"./constants\";\nexport * from \"./helper\";\nexport * from \"./interfaces\";\nexport * from \"./mpcCoreKit\";\nexport * from \"./point\";\nexport * from \"./utils\";\n"],"names":["TORUS_SAPPHIRE_NETWORK","CHAIN_NAMESPACES","ec","EllipticCurve","DEFAULT_CHAIN_CONFIG","chainNamespace","EIP155","chainId","rpcTarget","displayName","blockExplorer","ticker","tickerName","decimals","WEB3AUTH_NETWORK","MAINNET","SAPPHIRE_MAINNET","DEVNET","SAPPHIRE_DEVNET","USER_PATH","NEW","EXISTING","REHYDRATE","RECOVER","FactorKeyTypeShareDescription","DELIMITERS","Delimiter1","Delimiter2","Delimiter3","Delimiter4","ERRORS","TKEY_SHARES_REQUIRED","INVALID_BACKUP_SHARE","SOCIAL_FACTOR_INDEX","TssShareType","VALID_SHARE_INDICES","DEVICE","RECOVERY","SCALAR_LEN","FIELD_ELEMENT_HEX_LEN","CURVE","MAX_FACTORS","SOCIAL_TKEY_INDEX","getPubKeyPoint","randomSelection","generatePrivate","keccak256","BN","VALID_TSS_INDICES","generateFactorKey","factorKey","factorPub","private","pub","generateTSSEndpoints","tssNodeEndpoints","parties","clientIndex","nodeIndexes","endpoints","tssWSEndpoints","partyIndexes","nodeIndexesReturned","i","push","targetNodeIndex","URL","origin","storageAvailable","type","storage","window","localStorage","sessionStorage","x","setItem","removeItem","error","parseToken","token","base64Url","split","base64","replace","JSON","parse","atob","refreshTssShares","tKey","factorPubs","tssIndices","factorKeyForExistingTSSShare","signatures","updateMetadata","arguments","length","undefined","tssShare","tssIndex","getTSSShare","rssNodeDetails","_getRssNodeDetails","serverEndpoints","serverPubKeys","serverThreshold","randomSelectedServers","Array","fill","map","_","Math","ceil","verifierNameVerifierId","serviceProvider","getVerifierNameVerifierId","_refreshTSSShares","selectedServers","authSignatures","addFactorAndRefresh","newFactorPub","newFactorTSSIndex","Error","indexOf","metadata","isArray","tssTag","existingFactorPubs","updatedFactorPubs","concat","existingTSSIndexes","fb","getFactorEncs","updatedTSSIndexes","deleteFactorAndRefresh","factorPubToDelete","factorIndex","findIndex","p","eq","slice","splice","getHashedPrivateKey","postboxKey","clientId","uid","hashUid","Buffer","from","scalarBNToBufferSEC1","s","toArrayLike","MemoryStorage","constructor","_defineProperty","getItem","key","_store","value","clear","BrowserStorage","storeKey","_storeKey","resetStore","getInstance","storageKey","instance","toJSON","result","currStore","getStore","stringify","get","store","set","remove","_BrowserStorage","AsyncStorage","_AsyncStorage","asyncStoreFactor","mpcCoreKit","getMetadata","currentStorage","tkeyPubX","pubKey","toString","padStart","asyncGetFactor","tKeyLocalStoreString","tKeyLocalStore","storeWebBrowserFactor","getWebBrowserFactor","ShareSerializationModule","mnemonicToKey","shareMnemonic","deserializeMnemonic","keyToMnemonic","shareHex","shareBN","mnemonic","serializeMnemonic","Point","TkeyPoint","ZERO_POINT","g","mul","fromPrivateKey","privateKey","ep","keyFromPrivate","getPublic","fromTkeyPoint","keyFromPublic","y","fromBufferSEC1","buf","toTkeyPoint","isInfinity","getX","getY","toBufferSEC1","compressed","encode","equals","tkeyPoint","TssSecurityQuestionStore","shareIndex","factorPublicKey","question","fromJSON","json","TssSecurityQuestion","setSecurityQuestion","params","answer","description","shareType","domainKey","storeDomainName","includes","tkey","storeDomain","getGeneralStoreDomain","getKeyDetails","hash","startsWith","factorKeyBN","descriptionFinal","_objectSpread","createFactor","shareDescription","SecurityQuestions","additionalMetadata","tkeyPt","storeData","setGeneralStoreDomain","manualSync","_syncShareMetadata","changeSecurityQuestion","newQuestion","newAnswer","preHash","factorKeyPt","prenewHash","newHash","newAnswerBN","newFactorPt","parseInt","state","inputFactorKey","deleteFactor","deleteSecurityQuestion","deleteFactorKey","fromCompressedPub","deleteGeneralStoreDomain","recoverFactor","getQuestion","COREKIT_STATUS","encrypt","SHARE_DELETED","ShareStore","ThresholdKey","CoreError","lagrangeInterpolation","TorusServiceProvider","TorusStorageLayer","SIGNER_MAP","AGGREGATE_VERIFIER","TORUS_METHOD","UX_MODE","NodeDetailManager","OpenloginSessionManager","TorusUtils","Client","getDKLSCoeff","setupSockets","log","EthereumSigningProvider","bowser","Web3AuthMPCCoreKit","options","_window","checkReady","factorPubsList","tssPubKey","subarray","msgHash","localSign","tssShareIndex","torusNodeTSSEndpoints","nodeDetailManager","getNodeDetails","verifier","verifierId","tssNonce","getTssNonce","vid","sessionId","getTSSPubKey","tssNonces","participatingServerDKGIndexes","randomSessionNonce","Date","now","tssImportUrl","currentSession","tss","isNodejsOrRN","uxMode","tssLib","default","sockets","Promise","all","dklsCoeff","denormalisedShare","umod","curve","n","share","getSigningSignatures","client","serverCoeffs","serverIndex","precompute","server_coeffs","ready","catch","err","cleanup","r","recoveryParam","sign","v","chainConfig","web3AuthClientId","asyncStorageKey","enableLogging","enableAll","setLevel","web3AuthNetwork","sessionTime","REDIRECT","redirectPathName","baseUrl","location","disableHashedFactorKey","hashedFactorNonce","_storageBaseKey","network","asyncConstructor","sessionManager","provider","_this$privKeyProvider","privKeyProvider","_this$state","metadataKey","_this$state2","oAuthKey","status","NOT_INITIALIZED","INITIALIZED","privKey","REQUIRED_SHARE","LOGGED_IN","e","_this$state$userInfo","_this$state3","userInfo","aggregateVerifier","_this$state4","isRedirectMode","_UNSAFE_recoverTssKey","shareStore0","getFactorKeyMetadata","initialize","withShare","tssShares","tssIndexes","tssIndexesBN","factorKeyBNInput","init","finalKey","_window2","_window3","handleRedirectResult","resetState","rehydrate","nodeDetails","torusSp","useTSS","customAuthArgs","locationReplaceOnRedirect","nodeEndpoints","torusNodeEndpoints","nodePubKeys","torusNodePub","X","Y","storageLayer","hostUrl","shareSerializationModule","modules","shareSerialization","skipSw","skipPrefetch","POPUP","sessionResult","authorizeSession","info","rehydrateSession","featureRequest","loginWithOauth","importTssKey","tkeyServiceProvider","verifierParams","aggregateParams","subVerifierDetails","loginResponse","triggerLogin","updateState","_getOAuthKey","_getSignatures","sessionData","sessionTokenData","subVerifierDetailsArray","triggerAggregateLogin","aggregateVerifierType","SINGLE_VERIFIER_ID","verifierIdentifier","aggregateVerifierIdentifier","setupTkey","code","message","loginWithJWT","idTokenLoginParams","idToken","subVerifier","customAuthInstance","getTorusKey","verifier_id","extraVerifierParams","additionalParams","verifierType","getAggregateTorusKey","oAuthShare","verifierName","getRedirectResult","method","TRIGGER_LOGIN","data","getUserInfo","TRIGGER_AGGREGATE_LOGIN","factorKeyMetadata","inputShareStoreSafe","reconstructKey","finalizeTkey","getCurrentFactorKey","getTssPublicKey","getTSSPub","enableMFA","enableMFAParams","recoveryFactor","hashedFactorKey","checkIfFactorKeyValid","_localMetadataTransitions","browserData","browserName","browserVersion","deviceName","browserInfo","navigator","userAgent","browser","name","version","os","deviceFactorKey","hashedFactorPub","deleteMetadataShareBackup","backupFactorKey","createFactorParams","Other","getTssFactorPub","copyOrCreateShare","backupMetadataShare","addFactorDescription","remainingFactors","fpp","stateFpp","factorPubHex","allDesc","getShareDescription","keyDesc","forEach","desc","_this$tKey","deleteShareDescription","derivedFactorPub","logout","invalidateSession","tkeyDetails","factors","keyDetails","requiredFactors","requiredShares","threshold","totalFactors","shareDescriptions","metadataPubKey","commitChanges","syncLocalMetadataTransitions","setManualSync","tssKey","newTSSIndex","tssKeyBN","tag","importKey","_UNSAFE_exportTssKey","exportTssKey","existingUser","isMetadataPresent","deviceTSSIndex","deviceTSSShare","HashedShare","neverInitializeNewKey","setupProvider","createSession","generateRandomSessionKey","payload","_this$tKey2","privateKeyBN","Object","keys","_this$tKey3","_this$tKey4","factorEncs","factorPubID","userEnc","serverEncs","addTSSData","getMetadataShare","_this$tKey5","_this$tKey6","polyId","getLatestPublicPolynomial","getPolynomialID","shares","_this$tkey","_this$tkey2","addLocalMetadataTransitions","input","dateAdded","_this$tKey7","_this$tkey3","_this$tkey4","metadataShare","_this$tKey8","module","addShareDescription","signingProvider","config","newState","getPostboxKey","session","sig","signature","mode","accessUrl","accessRequest","client_id","is_mpc_core_kit","enable_gating","url","search","URLSearchParams","fetch"],"sourceRoot":""}