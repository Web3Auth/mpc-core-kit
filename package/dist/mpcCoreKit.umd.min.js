/*! For license information please see mpcCoreKit.umd.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MpcCoreKit=t():e.MpcCoreKit=t()}(self,(()=>(()=>{var e={9090:(e,t)=>{var r;function i(e,t){navigator.onLine||e("offline"),e("error",t)}function n(e,t,r){navigator.serviceWorker.register(e,r).then((function(e){t("registered",e),e.waiting?t("updated",e):e.onupdatefound=function(){t("updatefound",e);var r=e.installing;r.onstatechange=function(){"installed"===r.state&&(navigator.serviceWorker.controller?t("updated",e):t("cached",e))}}})).catch((function(e){return i(t,e)}))}"undefined"!=typeof window&&(r="undefined"==typeof document||"interactive"!==document.readyState&&"complete"!==document.readyState?"undefined"!=typeof Promise?new Promise((function(e){return window.addEventListener("load",e)})):{then:function(e){return window.addEventListener("load",e)}}:Promise.resolve()),t.k=function(e,t){void 0===t&&(t={});var s=t.registrationOptions;void 0===s&&(s={}),delete t.registrationOptions;var o=function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];t&&t[e]&&t[e].apply(t,r)};"serviceWorker"in navigator&&r.then((function(){Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))?(function(e,t,r){fetch(e).then((function(i){404===i.status?(t("error",new Error("Service worker not found at "+e)),unregister()):-1===i.headers.get("content-type").indexOf("javascript")?(t("error",new Error("Expected "+e+" to have javascript content-type, but received "+i.headers.get("content-type"))),unregister()):n(e,t,r)})).catch((function(e){return i(t,e)}))}(e,o,s),navigator.serviceWorker.ready.then((function(e){o("ready",e)})).catch((function(e){return i(o,e)}))):(n(e,o,s),navigator.serviceWorker.ready.then((function(e){o("ready",e)})).catch((function(e){return i(o,e)})))}))}},1352:(e,t,r)=>{"use strict";r.d(t,{BroadcastChannel:()=>je});var i={};r.r(i),r.d(i,{averageResponseTime:()=>x,canBeUsed:()=>_,close:()=>v,create:()=>b,microSeconds:()=>m,onMessage:()=>S,postMessage:()=>w,type:()=>g});var n={};r.r(n),r.d(n,{TRANSACTION_SETTINGS:()=>T,averageResponseTime:()=>Y,canBeUsed:()=>V,cleanOldMessages:()=>U,close:()=>z,commitIndexedDBTransaction:()=>K,create:()=>j,createDatabase:()=>C,getAllMessages:()=>R,getIdb:()=>N,getMessagesHigherThan:()=>B,getOldMessages:()=>D,microSeconds:()=>E,onMessage:()=>H,postMessage:()=>J,removeMessagesById:()=>F,type:()=>O,writeMessage:()=>L});var s={};r.r(s),r.d(s,{addStorageEventListener:()=>te,averageResponseTime:()=>ae,canBeUsed:()=>oe,close:()=>ne,create:()=>ie,getLocalStorage:()=>Q,microSeconds:()=>W,onMessage:()=>se,postMessage:()=>ee,removeStorageEventListener:()=>re,storageKey:()=>Z,type:()=>G});var o={};r.r(o),r.d(o,{averageResponseTime:()=>Ee,canBeUsed:()=>Me,close:()=>ke,create:()=>xe,getSocketInstance:()=>we,microSeconds:()=>le,onMessage:()=>Pe,postMessage:()=>ve,removeStorageEventListener:()=>_e,setupSocketConnection:()=>Se,storageKey:()=>be,type:()=>ye});var a={};r.r(a),r.d(a,{SIMULATE_DELAY_TIME:()=>Oe,averageResponseTime:()=>Be,canBeUsed:()=>Re,close:()=>Ke,create:()=>Ne,microSeconds:()=>Ie,onMessage:()=>Le,postMessage:()=>Ce,type:()=>Ae});var c=r(3065),h=r.n(c);Promise.resolve(!1),Promise.resolve(!0);const d=Promise.resolve();function u(e,t){return e||(e=0),new Promise((r=>setTimeout((()=>r(t)),e)))}function f(){return Math.random().toString(36).substring(2)}let l=0;function p(){let e=1e3*Date.now();return e<=l&&(e=l+1),l=e,e}const y=h().getLogger("broadcast-channel");y.setLevel("error");const m=p,g="native";function b(e){const t={time:p(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=e=>{t.messagesCallback&&t.messagesCallback(e.data)},t}function v(e){e.bc.close(),e.subFns=[]}function w(e,t){try{return e.bc.postMessage(t,!1),d}catch(e){return Promise.reject(e)}}function S(e,t){e.messagesCallback=t}function _(){if("undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1}function x(){return 150}class k{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,P()),this._to||(this._to=!0,setTimeout((()=>{this._to=!1,function(e){const t=P()-e.ttl,r=e.map[Symbol.iterator]();for(;;){const i=r.next().value;if(!i)return;const n=i[0];if(!(i[1]<t))return;e.map.delete(n)}}(this)}),0))}clear(){this.map.clear()}}function P(){return Date.now()}function M(e={}){const t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),t.server||(t.server={}),t.server.url||(t.server.url="https://session.web3auth.io"),t.server.removeTimeout||(t.server.removeTimeout=3e5),e.methods&&(t.methods=e.methods),t}const E=p,I="pubkey.broadcast-channel-0-",A="messages",T={durability:"relaxed"},O="idb";function N(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function K(e){e.commit&&e.commit()}function C(e){const t=N(),r=I+e,i=t.open(r);return i.onupgradeneeded=e=>{e.target.result.createObjectStore(A,{keyPath:"id",autoIncrement:!0})},new Promise(((e,t)=>{i.onerror=e=>t(e),i.onsuccess=()=>{e(i.result)}}))}function L(e,t,r){const i={uuid:t,time:Date.now(),data:r},n=e.transaction([A],"readwrite",T);return new Promise(((e,t)=>{n.oncomplete=()=>e(),n.onerror=e=>t(e),n.objectStore(A).add(i),K(n)}))}function R(e){const t=e.transaction(A,"readonly",T),r=t.objectStore(A),i=[];return new Promise((e=>{r.openCursor().onsuccess=r=>{const n=r.target.result;n?(i.push(n.value),n.continue()):(K(t),e(i))}}))}function B(e,t){const r=e.transaction(A,"readonly",T),i=r.objectStore(A),n=[];let s=IDBKeyRange.bound(t+1,1/0);if(i.getAll){const e=i.getAll(s);return new Promise(((t,r)=>{e.onerror=e=>r(e),e.onsuccess=function(e){t(e.target.result)}}))}return new Promise(((e,o)=>{const a=function(){try{return s=IDBKeyRange.bound(t+1,1/0),i.openCursor(s)}catch(e){return i.openCursor()}}();a.onerror=e=>o(e),a.onsuccess=i=>{const s=i.target.result;s?s.value.id<t+1?s.continue(t+1):(n.push(s.value),s.continue()):(K(r),e(n))}}))}function F(e,t){const r=e.transaction([A],"readwrite",T).objectStore(A);return Promise.all(t.map((e=>{const t=r.delete(e);return new Promise((e=>{t.onsuccess=()=>e()}))})))}function D(e,t){const r=Date.now()-t,i=e.transaction(A,"readonly",T),n=i.objectStore(A),s=[];return new Promise((e=>{n.openCursor().onsuccess=t=>{const n=t.target.result;if(n){const t=n.value;if(!(t.time<r))return K(i),void e(s);s.push(t),n.continue()}else e(s)}}))}function U(e,t){return D(e,t).then((t=>F(e,t.map((e=>e.id)))))}function j(e,t){return t=M(t),C(e).then((r=>{const i={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:f(),eMIs:new k(2*t.idb.ttl),writeBlockPromise:d,messagesCallback:null,readQueuePromises:[],db:r,time:p()};return r.onclose=function(){i.closed=!0,t.idb.onclose&&t.idb.onclose()},q(i),i}))}function q(e){e.closed||$(e).then((()=>u(e.options.idb.fallbackInterval))).then((()=>q(e)))}function $(e){return e.closed?d:e.messagesCallback?B(e.db,e.lastCursorId).then((t=>{const r=t.filter((e=>!!e)).map((t=>(t.id>e.lastCursorId&&(e.lastCursorId=t.id),t))).filter((t=>function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e))).sort(((e,t)=>e.time-t.time));return r.forEach((t=>{e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),d})):d}function z(e){e.closed=!0,e.db.close()}function J(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((()=>L(e.db,e.uuid,t))).then((()=>{0===Math.floor(11*Math.random()+0)&&U(e.db,e.options.idb.ttl)})),e.writeBlockPromise}function H(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,$(e)}function V(){return!!N()}function Y(e){return 2*e.idb.fallbackInterval}const W=p,X="pubkey.broadcastChannel-",G="localstorage";function Q(){let e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function Z(e){return X+e}function ee(e,t){return new Promise((r=>{u().then((()=>{const i=Z(e.channelName),n={token:f(),time:Date.now(),data:t,uuid:e.uuid},s=JSON.stringify(n);Q().setItem(i,s);const o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=i,o.newValue=s,window.dispatchEvent(o),r()}))}))}function te(e,t){const r=Z(e),i=e=>{e.key===r&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",i),i}function re(e){window.removeEventListener("storage",e)}function ie(e,t){if(t=M(t),!oe())throw new Error("BroadcastChannel: localstorage cannot be used");const r=f(),i=new k(t.localstorage.removeTimeout),n={channelName:e,uuid:r,time:p(),eMIs:i};return n.listener=te(e,(e=>{n.messagesCallback&&e.uuid!==r&&e.token&&!i.has(e.token)&&(e.data.time&&e.data.time<n.messagesCallbackTime||(i.add(e.token),n.messagesCallback(e.data)))})),n}function ne(e){re(e.listener)}function se(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function oe(){const e=Q();if(!e)return!1;try{const t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function ae(){const e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}var ce=r(7115),he=r(9024),de=r(3077),ue=r(8303),fe=r(8287).hp;const le=p,pe="pubkey.broadcastChannel-",ye="server";let me=null;const ge=new Set;function be(e){return pe+e}function ve(e,t){return new Promise(((r,i)=>{u().then((async()=>{const n=be(e.channelName),s=(0,de.S)(fe.from(n,"utf8")),o=await(0,ue.yv)(s.toString("hex"),{token:f(),time:Date.now(),data:t,uuid:e.uuid}),a={sameOriginCheck:!0,sameIpCheck:!0,key:(0,he.qb)(s).toString("hex"),data:o,signature:(await(0,he._S)(s,(0,de.S)(fe.from(o,"utf8")))).toString("hex")};return e.timeout&&(a.timeout=e.timeout),fetch(e.serverUrl+"/channel/set",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(r).catch(i)}))}))}function we(e){if(me)return me;const t=(0,ce.io)(e,{transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:10});return t.on("connect_error",(e=>{t.io.opts.transports=["polling","websocket"],y.error("connect error",e)})),t.on("connect",(async()=>{const{engine:e}=t.io;y.debug("initially connected to",e.transport.name),e.once("upgrade",(()=>{y.debug("upgraded",e.transport.name)})),e.once("close",(e=>{y.debug("connection closed",e)}))})),t.on("error",(e=>{y.error("socket errored",e),t.disconnect()})),me=t,t}function Se(e,t,r){const i=we(e),n=be(t.channelName),s=(0,de.S)(fe.from(n,"utf8")),o=(0,he.qb)(s).toString("hex");i.connected?i.emit("check_auth_status",o,{sameOriginCheck:!0,sameIpCheck:!0}):i.once("connect",(()=>{y.debug("connected with socket"),i.emit("check_auth_status",o,{sameOriginCheck:!0,sameIpCheck:!0})}));const a=()=>{i.once("connect",(async()=>{ge.has(t.channelName)&&i.emit("check_auth_status",o,{sameOriginCheck:!0,sameIpCheck:!0})}))},c=()=>{i&&ge.has(t.channelName)?i.connected||"visible"!==document.visibilityState||a():document.removeEventListener("visibilitychange",c)};return i.on("disconnect",(()=>{y.debug("socket disconnected"),ge.has(t.channelName)&&(y.error("socket disconnected unexpectedly, reconnecting socket"),a())})),i.on(`${o}_success`,(async e=>{try{const t=await(0,ue.af)(s.toString("hex"),e);y.info(t),r(t)}catch(e){y.error(e)}})),"undefined"!=typeof document&&document.addEventListener("visibilitychange",c),i}function _e(){me&&me.disconnect()}function xe(e,t){t=M(t);const r={channelName:e,uuid:f(),eMIs:new k(t.server.removeTimeout),serverUrl:t.server.url,time:p()};return t.server.timeout&&(r.timeout=t.server.timeout),Se(t.server.url,r,(e=>{r.messagesCallback&&e.uuid!==r.uuid&&e.token&&!r.eMIs.has(e.token)&&(r.eMIs.add(e.token),r.messagesCallback(e.data))})),ge.add(e),r}function ke(e){ge.delete(e.channelName)}function Pe(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function Me(){return!0}function Ee(){return 500}const Ie=p,Ae="simulate",Te=new Set,Oe=5;function Ne(e){const t={time:p(),name:e,messagesCallback:null};return Te.add(t),t}function Ke(e){Te.delete(e)}function Ce(e,t){return new Promise((r=>setTimeout((()=>{Array.from(Te).forEach((r=>{r.name===e.name&&r!==e&&r.messagesCallback&&r.time<t.time&&r.messagesCallback(t)})),r()}),Oe)))}function Le(e,t){e.messagesCallback=t}function Re(){return!0}function Be(){return Oe}const Fe=[i,n,s,o],De=new Set;let Ue=0;const je=function(e,t){this.id=Ue++,De.add(this),this.name=e,this.options=M(t),this.method=function(e){let t=[].concat(e.methods,Fe).filter(Boolean);if(e.type){if("simulate"===e.type)return a;const r=t.find((t=>t.type===e.type));if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((e=>"idb"!==e.type)));const r=t.find((t=>t.canBeUsed(e)));if(r)return r;throw new Error(`No useable method found in ${JSON.stringify(Fe.map((e=>e.type)))}`)}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,function(e){const t=e.method.create(e.name,e.options);var r;(r=t)&&"function"==typeof r.then?(e._prepP=t,t.then((t=>{e._state=t}))):e._state=t}(this)};function qe(e,t,r){const i={time:e.method.microSeconds(),type:t,data:r};return(e._prepP?e._prepP:d).then((()=>{const t=e.method.postMessage(e._state,i);return e._uMP.add(t),t.catch().then((()=>e._uMP.delete(t))),t}))}function $e(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function ze(e,t,r){e._addEL[t].push(r),function(e){if(!e._iL&&$e(e)){const t=t=>{e._addEL[t.type].forEach((r=>{(t.time>=r.time||"server"===e.method.type)&&r.fn(t.data)}))},r=e.method.microSeconds();e._prepP?e._prepP.then((()=>{e._iL=!0,e.method.onMessage(e._state,t,r)})):(e._iL=!0,e.method.onMessage(e._state,t,r))}}(e)}function Je(e,t,r){e._addEL[t]=e._addEL[t].filter((e=>e!==r)),function(e){if(e._iL&&!$e(e)){e._iL=!1;const t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}je._pubkey=!0,je.prototype={postMessage(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return qe(this,"message",e)},postInternal(e){return qe(this,"internal",e)},set onmessage(e){const t={time:this.method.microSeconds(),fn:e};Je(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,ze(this,"message",t)):this._onML=null},addEventListener(e,t){ze(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener(e,t){Je(this,e,this._addEL[e].find((e=>e.fn===t)))},close(){if(this.closed)return;De.delete(this),this.closed=!0;const e=this._prepP?this._prepP:d;return this._onML=null,this._addEL.message=[],e.then((()=>Promise.all(Array.from(this._uMP)))).then((()=>Promise.all(this._befC.map((e=>e()))))).then((()=>this.method.close(this._state)))},get type(){return this.method.type},get isClosed(){return this.closed}}},9024:(e,t,r)=>{"use strict";r.d(t,{F_:()=>b,Yc:()=>k,_S:()=>w,qb:()=>v,w:()=>x});var i=r(6729),n=r(8287).hp;const s=new i.ec("secp256k1"),o=globalThis.crypto||globalThis.msCrypto||{},a=o.subtle||o.webkitSubtle,c=n.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),h=n.alloc(32,0);function d(e,t){if(!e)throw new Error(t||"Assertion failed")}function u(e){return t=e,!(!n.isBuffer(t)||32!==t.length)&&e.compare(h)>0&&e.compare(c)<0;var t}function f(e){if(void 0===o.getRandomValues)return n.from(o.randomBytes(e));const t=new Uint8Array(e);return o.getRandomValues(t),n.from(t)}async function l(e){if(!o.createHash){const t=await a.digest("SHA-512",e);return new Uint8Array(t)}const t=o.createHash("sha512").update(e).digest();return new Uint8Array(t)}function p(e){return async function(t,r,i){if(a&&a[e]&&a.importKey){const s={name:"AES-CBC"},o=await a.importKey("raw",r,s,!1,[e]),c={name:"AES-CBC",iv:t},h=await a[e](c,o,i);return n.from(new Uint8Array(h))}if("encrypt"===e&&o.createCipheriv){const e=o.createCipheriv("aes-256-cbc",r,t),s=e.update(i),a=e.final();return n.concat([s,a])}if("decrypt"===e&&o.createDecipheriv){const e=o.createDecipheriv("aes-256-cbc",r,t),s=e.update(i),a=e.final();return n.concat([s,a])}throw new Error(`Unsupported operation: ${e}`)}}const y=p("encrypt"),m=p("decrypt");async function g(e,t){if(!o.createHmac){const r={name:"HMAC",hash:{name:"SHA-256"}},i=await a.importKey("raw",new Uint8Array(e),r,!1,["sign","verify"]),s=await a.sign("HMAC",i,t);return n.from(new Uint8Array(s))}const r=o.createHmac("sha256",n.from(e));return r.update(t),r.digest()}const b=function(){let e=f(32);for(;!u(e);)e=f(32);return e},v=function(e){return d(32===e.length,"Bad private key"),d(u(e),"Bad private key"),n.from(s.keyFromPrivate(e).getPublic("array"))},w=async function(e,t){return d(32===e.length,"Bad private key"),d(u(e),"Bad private key"),d(t.length>0,"Message should not be empty"),d(t.length<=32,"Message is too long"),n.from(s.sign(t,e,{canonical:!0}).toDER())},S=async function(e,t){d(n.isBuffer(e),"Bad private key"),d(n.isBuffer(t),"Bad public key"),d(32===e.length,"Bad private key"),d(u(e),"Bad private key"),d(65===t.length||33===t.length,"Bad public key"),65===t.length&&d(4===t[0],"Bad public key"),33===t.length&&d(2===t[0]||3===t[0],"Bad public key");const r=s.keyFromPrivate(e),i=s.keyFromPublic(t),o=r.derive(i.getPublic());return n.from(o.toArray())},_=async function(e,t){d(n.isBuffer(e),"Bad private key"),d(n.isBuffer(t),"Bad public key"),d(32===e.length,"Bad private key"),d(u(e),"Bad private key"),d(65===t.length||33===t.length,"Bad public key"),65===t.length&&d(4===t[0],"Bad public key"),33===t.length&&d(2===t[0]||3===t[0],"Bad public key");const r=s.keyFromPrivate(e),i=s.keyFromPublic(t),o=r.derive(i.getPublic());return n.from(o.toString(16,64),"hex")},x=async function(e,t,r){let i=(r=r||{}).ephemPrivateKey||f(32);for(;!u(i);)i=r.ephemPrivateKey||f(32);const s=v(i),o=await S(i,e),a=await l(o),c=r.iv||f(16),h=a.slice(0,32),d=a.slice(32),p=await y(c,n.from(h),t),m=n.concat([c,s,p]);return{iv:c,ephemPublicKey:s,ciphertext:p,mac:await g(n.from(d),m)}},k=async function(e,t,r){const i=null!=r&&r,s=i?_:S,o=await s(e,t.ephemPublicKey),a=await l(o),c=a.slice(0,32),h=a.slice(32),d=n.concat([t.iv,t.ephemPublicKey,t.ciphertext]),u=await async function(e,t,r){return function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}(await g(e,t),r)}(n.from(h),d,t.mac);if(!u&&!1===i)return k(e,t,!0);if(!u&&!0===i)throw new Error("bad MAC after trying padded");const f=await m(t.iv,n.from(c),t.ciphertext);return n.from(new Uint8Array(f))}},3077:(e,t,r)=>{"use strict";r.d(t,{S:()=>o,ec:()=>a});var i=r(6729),n=r(9463),s=r(8287).hp;function o(e){return s.from((0,n.So)(e))}const a=new i.ec("secp256k1")},8303:(e,t,r)=>{"use strict";r.d(t,{af:()=>a,yv:()=>o});var i=r(9024),n=r(3077),s=r(8287).hp;async function o(e,t){const r=JSON.stringify(t),n=s.from(r,"utf-8"),o=(a=await(0,i.w)((0,i.qb)(s.from(e,"hex")),n),{iv:s.from(a.iv).toString("hex"),ephemPublicKey:s.from(a.ephemPublicKey).toString("hex"),ciphertext:s.from(a.ciphertext).toString("hex"),mac:s.from(a.mac).toString("hex")});var a;return JSON.stringify(o)}async function a(e,t){const r=(c=JSON.parse(t),{iv:s.from(c.iv,"hex"),ephemPublicKey:s.from(c.ephemPublicKey,"hex"),ciphertext:s.from(c.ciphertext,"hex"),mac:s.from(c.mac,"hex")}),o=n.ec.keyFromPrivate(e),a=(await(0,i.Yc)(s.from(o.getPrivate().toString("hex",64),"hex"),r)).toString("utf-8");var c;return JSON.parse(a)}},6674:(e,t,r)=>{(()=>{"use strict";var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{AwaitableMap:()=>o,MapQueue:()=>a,deriveShareCoefficients:()=>l,fraction:()=>d,lagrangeCoefficient:()=>u,lagrangeCoefficients:()=>f});const n=r(3693);var s=t.n(n);class o{constructor(){s()(this,"map",new Map),s()(this,"queue",new Map)}get size(){return this.map.size}getSync(e){return this.map.get(e)}async get(e,t=0){return this.map.get(e)||new Promise((r=>{const i={resolve:r,timeout:setTimeout((()=>{const t=this.queue.get(e);if(t){const e=t.indexOf(i);e>=0&&t.splice(e,1)}r(void 0)}),t)};let n=this.queue.get(e);n||(n=[],this.queue.set(e,n)),n.push(i)}))}set(e,t){this.map.set(e,t);const r=this.queue.get(e);if(r){for(const e of r)clearTimeout(e.timeout),e.resolve(t);this.queue.delete(e)}}delete(e){this.map.delete(e),this.queue.delete(e)}forEach(e){this.map.forEach(e)}clear(){this.map.clear(),this.queue.clear()}}class a{constructor(){s()(this,"buffer",new Map),s()(this,"queue",new Map)}async pop(e,t=0){const r=this.buffer.get(e);return r&&r.length>0?r.splice(0,1)[0]:new Promise((r=>{const i={resolve:r,timeout:setTimeout((()=>{const t=this.queue.get(e);if(t){const e=t.indexOf(i);e>=0&&t.splice(e,1)}r(void 0)}),t)};let n=this.queue.get(e);n||(n=[],this.queue.set(e,n)),n.push(i)}))}push(e,t){const r=this.queue.get(e);if(r&&r.length>0){const e=r.splice(0,1)[0];return clearTimeout(e.timeout),void e.resolve(t)}let i=this.buffer.get(e);i||(i=[],this.buffer.set(e,i)),i.push(t)}delete(e){this.buffer.delete(e),this.queue.delete(e)}forEach(e){this.buffer.forEach(((t,r)=>{t.forEach((t=>{e(t,r)}))}))}clear(){this.buffer.clear(),this.queue.clear()}}const c=r(9404);var h=t.n(c);function d(e,t,r){return e.mul(t.invm(r)).umod(r)}function u(e,t,r,i){return e.filter(((e,r)=>r!==t)).reduce(((n,s)=>{const o=d(r.sub(s),e[t].sub(s),i);return n.mul(o).umod(i)}),new(h())(1))}function f(e,t,r){const i=e.map((e=>new(h())(e))),n=new(h())(t);return i.map(((e,t)=>u(i,t,n,r)))}function l(e,t,r,i=1,n=2){const s=f([i,n],0,r),o=f(e,0,r);if(e.includes(t))throw new Error(`Invalid server x-coordinates: overlapping with client x-coordinate: ${e} ${t}`);const a=f([t,...e],0,r);return{serverCoefficients:o.map(((e,t)=>d(s[0].mul(e),a[t+1],r))),clientCoefficient:d(s[1],a[0],r)}}e.exports=i})()},7526:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),r=t[0],i=t[1];return 3*(r+i)/4-i},t.toByteArray=function(e){var t,r,s=a(e),o=s[0],c=s[1],h=new n(function(e,t,r){return 3*(t+r)/4-r}(0,o,c)),d=0,u=c>0?o-4:o;for(r=0;r<u;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],h[d++]=t>>16&255,h[d++]=t>>8&255,h[d++]=255&t;return 2===c&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,h[d++]=255&t),1===c&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,h[d++]=t>>8&255,h[d++]=255&t),h},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,s=[],o=16383,a=0,h=i-n;a<h;a+=o)s.push(c(e,a,a+o>h?h:a+o));return 1===n?(t=e[i-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[i-2]<<8)+e[i-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),s.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=s[o],i[s.charCodeAt(o)]=o;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,i){for(var n,s,o=[],a=t;a<i;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=n)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},2788:(e,t,r)=>{"use strict";var i=r(8287).hp,n=r(2931);function s(e,t){return void 0===t&&(t="utf8"),i.isBuffer(e)?a(e.toString("base64")):a(i.from(e,t).toString("base64"))}function o(e){return e=e.toString(),n.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function a(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var c=s;c.encode=s,c.decode=function(e,t){return void 0===t&&(t="utf8"),i.from(o(e),"base64").toString(t)},c.toBase64=o,c.fromBase64=a,c.toBuffer=function(e){return i.from(o(e),"base64")},t.default=c},2931:(e,t,r)=>{"use strict";var i=r(8287).hp;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.length,r=t%4;if(!r)return e;var n=t,s=4-r,o=t+s,a=i.alloc(o);for(a.write(e);s--;)a.write("=",n++);return a.toString()}},4711:(e,t,r)=>{e.exports=r(2788).default,e.exports.default=e.exports},9404:function(e,t,r){!function(e,t){"use strict";function i(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function s(e,t,r){if(s.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var o;"object"==typeof e?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(7790).Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=48&&r<=57?r-48:r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:void i(!1,"Invalid character in "+e)}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function h(e,t,r,n){for(var s=0,o=0,a=Math.min(e.length,r),c=t;c<a;c++){var h=e.charCodeAt(c)-48;s*=n,o=h>=49?h-49+10:h>=17?h-17+10:h,i(h>=0&&o<n,"Invalid character"),s+=o}return s}function d(e,t){e.words=t.words,e.length=t.length,e.negative=t.negative,e.red=t.red}if(s.isBN=function(e){return e instanceof s||null!==e&&"object"==typeof e&&e.constructor.wordSize===s.wordSize&&Array.isArray(e.words)},s.max=function(e,t){return e.cmp(t)>0?e:t},s.min=function(e,t){return e.cmp(t)<0?e:t},s.prototype._init=function(e,t,r){if("number"==typeof e)return this._initNumber(e,t,r);if("object"==typeof e)return this._initArray(e,t,r);"hex"===t&&(t=16),i(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,r):(this._parseBase(e,t,n),"le"===r&&this._initArray(this.toArray(),t,r)))},s.prototype._initNumber=function(e,t,r){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(i(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),t,r)},s.prototype._initArray=function(e,t,r){if(i("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=e.length-1,s=0;n>=0;n-=3)o=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<e.length;n+=3)o=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this._strip()},s.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this._strip()},s.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var s=e.length-r,o=s%i,a=Math.min(s,s-o)+r,c=0,d=r;d<a;d+=i)c=h(e,d,d+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==o){var u=1;for(c=h(e,d,e.length,t),d=0;d<o;d++)u*=t;this.imuln(u),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this._strip()},s.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},s.prototype._move=function(e){d(e,this)},s.prototype.clone=function(){var e=new s(null);return this.copy(e),e},s.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=u}catch(e){s.prototype.inspect=u}else s.prototype.inspect=u;function u(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],p=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function y(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],s=0|t.words[0],o=n*s,a=67108863&o,c=o/67108864|0;r.words[0]=a;for(var h=1;h<i;h++){for(var d=c>>>26,u=67108863&c,f=Math.min(h,t.length-1),l=Math.max(0,h-e.length+1);l<=f;l++){var p=h-l|0;d+=(o=(n=0|e.words[p])*(s=0|t.words[l])+u)/67108864|0,u=67108863&o}r.words[h]=0|u,c=0|d}return 0!==c?r.words[h]=0|c:r.length--,r._strip()}s.prototype.toString=function(e,t){var r;if(t=0|t||1,16===(e=e||10)||"hex"===e){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],c=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?f[6-c.length]+c+r:c+r}for(0!==s&&(r=s.toString(16)+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(e===(0|e)&&e>=2&&e<=36){var h=l[e],d=p[e];r="";var u=this.clone();for(u.negative=0;!u.isZero();){var y=u.modrn(d).toString(e);r=(u=u.idivn(d)).isZero()?y+r:f[h-y.length]+y+r}for(this.isZero()&&(r="0"+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(e,t){return this.toArrayLike(o,e,t)}),s.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},s.prototype.toArrayLike=function(e,t,r){this._strip();var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0");var o=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)}(e,s);return this["_toArrayLike"+("le"===t?"LE":"BE")](o,n),o},s.prototype._toArrayLikeLE=function(e,t){for(var r=0,i=0,n=0,s=0;n<this.length;n++){var o=this.words[n]<<s|i;e[r++]=255&o,r<e.length&&(e[r++]=o>>8&255),r<e.length&&(e[r++]=o>>16&255),6===s?(r<e.length&&(e[r++]=o>>24&255),i=0,s=0):(i=o>>>24,s+=2)}if(r<e.length)for(e[r++]=i;r<e.length;)e[r++]=0},s.prototype._toArrayLikeBE=function(e,t){for(var r=e.length-1,i=0,n=0,s=0;n<this.length;n++){var o=this.words[n]<<s|i;e[r--]=255&o,r>=0&&(e[r--]=o>>8&255),r>=0&&(e[r--]=o>>16&255),6===s?(r>=0&&(e[r--]=o>>24&255),i=0,s=0):(i=o>>>24,s+=2)}if(r>=0)for(e[r--]=i;r>=0;)e[r--]=0},Math.clz32?s.prototype._countBits=function(e){return 32-Math.clz32(e)}:s.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},s.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 8191&t||(r+=13,t>>>=13),127&t||(r+=7,t>>>=7),15&t||(r+=4,t>>>=4),3&t||(r+=2,t>>>=2),1&t||r++,r},s.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},s.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},s.prototype.ior=function(e){return i(!(this.negative|e.negative)),this.iuor(e)},s.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},s.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},s.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this._strip()},s.prototype.iand=function(e){return i(!(this.negative|e.negative)),this.iuand(e)},s.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},s.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},s.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this._strip()},s.prototype.ixor=function(e){return i(!(this.negative|e.negative)),this.iuxor(e)},s.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},s.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},s.prototype.inotn=function(e){i("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),r=e%26;this._expand(t),r>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this._strip()},s.prototype.notn=function(e){return this.clone().inotn(e)},s.prototype.setn=function(e,t){i("number"==typeof e&&e>=0);var r=e/26|0,n=e%26;return this._expand(r+1),this.words[r]=t?this.words[r]|1<<n:this.words[r]&~(1<<n),this._strip()},s.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,s=0;s<i.length;s++)t=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&t,n=t>>>26;for(;0!==n&&s<r.length;s++)t=(0|r.words[s])+n,this.words[s]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},s.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var s=0,o=0;o<i.length;o++)s=(t=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&t;for(;0!==s&&o<r.length;o++)s=(t=(0|r.words[o])+s)>>26,this.words[o]=67108863&t;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(e){return this.clone().isub(e)};var m=function(e,t,r){var i,n,s,o=e.words,a=t.words,c=r.words,h=0,d=0|o[0],u=8191&d,f=d>>>13,l=0|o[1],p=8191&l,y=l>>>13,m=0|o[2],g=8191&m,b=m>>>13,v=0|o[3],w=8191&v,S=v>>>13,_=0|o[4],x=8191&_,k=_>>>13,P=0|o[5],M=8191&P,E=P>>>13,I=0|o[6],A=8191&I,T=I>>>13,O=0|o[7],N=8191&O,K=O>>>13,C=0|o[8],L=8191&C,R=C>>>13,B=0|o[9],F=8191&B,D=B>>>13,U=0|a[0],j=8191&U,q=U>>>13,$=0|a[1],z=8191&$,J=$>>>13,H=0|a[2],V=8191&H,Y=H>>>13,W=0|a[3],X=8191&W,G=W>>>13,Q=0|a[4],Z=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],se=8191&ne,oe=ne>>>13,ae=0|a[7],ce=8191&ae,he=ae>>>13,de=0|a[8],ue=8191&de,fe=de>>>13,le=0|a[9],pe=8191&le,ye=le>>>13;r.negative=e.negative^t.negative,r.length=19;var me=(h+(i=Math.imul(u,j))|0)+((8191&(n=(n=Math.imul(u,q))+Math.imul(f,j)|0))<<13)|0;h=((s=Math.imul(f,q))+(n>>>13)|0)+(me>>>26)|0,me&=67108863,i=Math.imul(p,j),n=(n=Math.imul(p,q))+Math.imul(y,j)|0,s=Math.imul(y,q);var ge=(h+(i=i+Math.imul(u,z)|0)|0)+((8191&(n=(n=n+Math.imul(u,J)|0)+Math.imul(f,z)|0))<<13)|0;h=((s=s+Math.imul(f,J)|0)+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(g,j),n=(n=Math.imul(g,q))+Math.imul(b,j)|0,s=Math.imul(b,q),i=i+Math.imul(p,z)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(y,z)|0,s=s+Math.imul(y,J)|0;var be=(h+(i=i+Math.imul(u,V)|0)|0)+((8191&(n=(n=n+Math.imul(u,Y)|0)+Math.imul(f,V)|0))<<13)|0;h=((s=s+Math.imul(f,Y)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(w,j),n=(n=Math.imul(w,q))+Math.imul(S,j)|0,s=Math.imul(S,q),i=i+Math.imul(g,z)|0,n=(n=n+Math.imul(g,J)|0)+Math.imul(b,z)|0,s=s+Math.imul(b,J)|0,i=i+Math.imul(p,V)|0,n=(n=n+Math.imul(p,Y)|0)+Math.imul(y,V)|0,s=s+Math.imul(y,Y)|0;var ve=(h+(i=i+Math.imul(u,X)|0)|0)+((8191&(n=(n=n+Math.imul(u,G)|0)+Math.imul(f,X)|0))<<13)|0;h=((s=s+Math.imul(f,G)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(x,j),n=(n=Math.imul(x,q))+Math.imul(k,j)|0,s=Math.imul(k,q),i=i+Math.imul(w,z)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(S,z)|0,s=s+Math.imul(S,J)|0,i=i+Math.imul(g,V)|0,n=(n=n+Math.imul(g,Y)|0)+Math.imul(b,V)|0,s=s+Math.imul(b,Y)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(y,X)|0,s=s+Math.imul(y,G)|0;var we=(h+(i=i+Math.imul(u,Z)|0)|0)+((8191&(n=(n=n+Math.imul(u,ee)|0)+Math.imul(f,Z)|0))<<13)|0;h=((s=s+Math.imul(f,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(M,j),n=(n=Math.imul(M,q))+Math.imul(E,j)|0,s=Math.imul(E,q),i=i+Math.imul(x,z)|0,n=(n=n+Math.imul(x,J)|0)+Math.imul(k,z)|0,s=s+Math.imul(k,J)|0,i=i+Math.imul(w,V)|0,n=(n=n+Math.imul(w,Y)|0)+Math.imul(S,V)|0,s=s+Math.imul(S,Y)|0,i=i+Math.imul(g,X)|0,n=(n=n+Math.imul(g,G)|0)+Math.imul(b,X)|0,s=s+Math.imul(b,G)|0,i=i+Math.imul(p,Z)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(y,Z)|0,s=s+Math.imul(y,ee)|0;var Se=(h+(i=i+Math.imul(u,re)|0)|0)+((8191&(n=(n=n+Math.imul(u,ie)|0)+Math.imul(f,re)|0))<<13)|0;h=((s=s+Math.imul(f,ie)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,j),n=(n=Math.imul(A,q))+Math.imul(T,j)|0,s=Math.imul(T,q),i=i+Math.imul(M,z)|0,n=(n=n+Math.imul(M,J)|0)+Math.imul(E,z)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(x,V)|0,n=(n=n+Math.imul(x,Y)|0)+Math.imul(k,V)|0,s=s+Math.imul(k,Y)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(S,X)|0,s=s+Math.imul(S,G)|0,i=i+Math.imul(g,Z)|0,n=(n=n+Math.imul(g,ee)|0)+Math.imul(b,Z)|0,s=s+Math.imul(b,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(y,re)|0,s=s+Math.imul(y,ie)|0;var _e=(h+(i=i+Math.imul(u,se)|0)|0)+((8191&(n=(n=n+Math.imul(u,oe)|0)+Math.imul(f,se)|0))<<13)|0;h=((s=s+Math.imul(f,oe)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(N,j),n=(n=Math.imul(N,q))+Math.imul(K,j)|0,s=Math.imul(K,q),i=i+Math.imul(A,z)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(T,z)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(M,V)|0,n=(n=n+Math.imul(M,Y)|0)+Math.imul(E,V)|0,s=s+Math.imul(E,Y)|0,i=i+Math.imul(x,X)|0,n=(n=n+Math.imul(x,G)|0)+Math.imul(k,X)|0,s=s+Math.imul(k,G)|0,i=i+Math.imul(w,Z)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(S,Z)|0,s=s+Math.imul(S,ee)|0,i=i+Math.imul(g,re)|0,n=(n=n+Math.imul(g,ie)|0)+Math.imul(b,re)|0,s=s+Math.imul(b,ie)|0,i=i+Math.imul(p,se)|0,n=(n=n+Math.imul(p,oe)|0)+Math.imul(y,se)|0,s=s+Math.imul(y,oe)|0;var xe=(h+(i=i+Math.imul(u,ce)|0)|0)+((8191&(n=(n=n+Math.imul(u,he)|0)+Math.imul(f,ce)|0))<<13)|0;h=((s=s+Math.imul(f,he)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(L,j),n=(n=Math.imul(L,q))+Math.imul(R,j)|0,s=Math.imul(R,q),i=i+Math.imul(N,z)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(K,z)|0,s=s+Math.imul(K,J)|0,i=i+Math.imul(A,V)|0,n=(n=n+Math.imul(A,Y)|0)+Math.imul(T,V)|0,s=s+Math.imul(T,Y)|0,i=i+Math.imul(M,X)|0,n=(n=n+Math.imul(M,G)|0)+Math.imul(E,X)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(x,Z)|0,n=(n=n+Math.imul(x,ee)|0)+Math.imul(k,Z)|0,s=s+Math.imul(k,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(S,re)|0,s=s+Math.imul(S,ie)|0,i=i+Math.imul(g,se)|0,n=(n=n+Math.imul(g,oe)|0)+Math.imul(b,se)|0,s=s+Math.imul(b,oe)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,he)|0)+Math.imul(y,ce)|0,s=s+Math.imul(y,he)|0;var ke=(h+(i=i+Math.imul(u,ue)|0)|0)+((8191&(n=(n=n+Math.imul(u,fe)|0)+Math.imul(f,ue)|0))<<13)|0;h=((s=s+Math.imul(f,fe)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(F,j),n=(n=Math.imul(F,q))+Math.imul(D,j)|0,s=Math.imul(D,q),i=i+Math.imul(L,z)|0,n=(n=n+Math.imul(L,J)|0)+Math.imul(R,z)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(N,V)|0,n=(n=n+Math.imul(N,Y)|0)+Math.imul(K,V)|0,s=s+Math.imul(K,Y)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(T,X)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(M,Z)|0,n=(n=n+Math.imul(M,ee)|0)+Math.imul(E,Z)|0,s=s+Math.imul(E,ee)|0,i=i+Math.imul(x,re)|0,n=(n=n+Math.imul(x,ie)|0)+Math.imul(k,re)|0,s=s+Math.imul(k,ie)|0,i=i+Math.imul(w,se)|0,n=(n=n+Math.imul(w,oe)|0)+Math.imul(S,se)|0,s=s+Math.imul(S,oe)|0,i=i+Math.imul(g,ce)|0,n=(n=n+Math.imul(g,he)|0)+Math.imul(b,ce)|0,s=s+Math.imul(b,he)|0,i=i+Math.imul(p,ue)|0,n=(n=n+Math.imul(p,fe)|0)+Math.imul(y,ue)|0,s=s+Math.imul(y,fe)|0;var Pe=(h+(i=i+Math.imul(u,pe)|0)|0)+((8191&(n=(n=n+Math.imul(u,ye)|0)+Math.imul(f,pe)|0))<<13)|0;h=((s=s+Math.imul(f,ye)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,i=Math.imul(F,z),n=(n=Math.imul(F,J))+Math.imul(D,z)|0,s=Math.imul(D,J),i=i+Math.imul(L,V)|0,n=(n=n+Math.imul(L,Y)|0)+Math.imul(R,V)|0,s=s+Math.imul(R,Y)|0,i=i+Math.imul(N,X)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(K,X)|0,s=s+Math.imul(K,G)|0,i=i+Math.imul(A,Z)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(T,Z)|0,s=s+Math.imul(T,ee)|0,i=i+Math.imul(M,re)|0,n=(n=n+Math.imul(M,ie)|0)+Math.imul(E,re)|0,s=s+Math.imul(E,ie)|0,i=i+Math.imul(x,se)|0,n=(n=n+Math.imul(x,oe)|0)+Math.imul(k,se)|0,s=s+Math.imul(k,oe)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,he)|0)+Math.imul(S,ce)|0,s=s+Math.imul(S,he)|0,i=i+Math.imul(g,ue)|0,n=(n=n+Math.imul(g,fe)|0)+Math.imul(b,ue)|0,s=s+Math.imul(b,fe)|0;var Me=(h+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,ye)|0)+Math.imul(y,pe)|0))<<13)|0;h=((s=s+Math.imul(y,ye)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(F,V),n=(n=Math.imul(F,Y))+Math.imul(D,V)|0,s=Math.imul(D,Y),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,G)|0)+Math.imul(R,X)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(N,Z)|0,n=(n=n+Math.imul(N,ee)|0)+Math.imul(K,Z)|0,s=s+Math.imul(K,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(T,re)|0,s=s+Math.imul(T,ie)|0,i=i+Math.imul(M,se)|0,n=(n=n+Math.imul(M,oe)|0)+Math.imul(E,se)|0,s=s+Math.imul(E,oe)|0,i=i+Math.imul(x,ce)|0,n=(n=n+Math.imul(x,he)|0)+Math.imul(k,ce)|0,s=s+Math.imul(k,he)|0,i=i+Math.imul(w,ue)|0,n=(n=n+Math.imul(w,fe)|0)+Math.imul(S,ue)|0,s=s+Math.imul(S,fe)|0;var Ee=(h+(i=i+Math.imul(g,pe)|0)|0)+((8191&(n=(n=n+Math.imul(g,ye)|0)+Math.imul(b,pe)|0))<<13)|0;h=((s=s+Math.imul(b,ye)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(F,X),n=(n=Math.imul(F,G))+Math.imul(D,X)|0,s=Math.imul(D,G),i=i+Math.imul(L,Z)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(R,Z)|0,s=s+Math.imul(R,ee)|0,i=i+Math.imul(N,re)|0,n=(n=n+Math.imul(N,ie)|0)+Math.imul(K,re)|0,s=s+Math.imul(K,ie)|0,i=i+Math.imul(A,se)|0,n=(n=n+Math.imul(A,oe)|0)+Math.imul(T,se)|0,s=s+Math.imul(T,oe)|0,i=i+Math.imul(M,ce)|0,n=(n=n+Math.imul(M,he)|0)+Math.imul(E,ce)|0,s=s+Math.imul(E,he)|0,i=i+Math.imul(x,ue)|0,n=(n=n+Math.imul(x,fe)|0)+Math.imul(k,ue)|0,s=s+Math.imul(k,fe)|0;var Ie=(h+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,ye)|0)+Math.imul(S,pe)|0))<<13)|0;h=((s=s+Math.imul(S,ye)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(F,Z),n=(n=Math.imul(F,ee))+Math.imul(D,Z)|0,s=Math.imul(D,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(R,re)|0,s=s+Math.imul(R,ie)|0,i=i+Math.imul(N,se)|0,n=(n=n+Math.imul(N,oe)|0)+Math.imul(K,se)|0,s=s+Math.imul(K,oe)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,he)|0)+Math.imul(T,ce)|0,s=s+Math.imul(T,he)|0,i=i+Math.imul(M,ue)|0,n=(n=n+Math.imul(M,fe)|0)+Math.imul(E,ue)|0,s=s+Math.imul(E,fe)|0;var Ae=(h+(i=i+Math.imul(x,pe)|0)|0)+((8191&(n=(n=n+Math.imul(x,ye)|0)+Math.imul(k,pe)|0))<<13)|0;h=((s=s+Math.imul(k,ye)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(F,re),n=(n=Math.imul(F,ie))+Math.imul(D,re)|0,s=Math.imul(D,ie),i=i+Math.imul(L,se)|0,n=(n=n+Math.imul(L,oe)|0)+Math.imul(R,se)|0,s=s+Math.imul(R,oe)|0,i=i+Math.imul(N,ce)|0,n=(n=n+Math.imul(N,he)|0)+Math.imul(K,ce)|0,s=s+Math.imul(K,he)|0,i=i+Math.imul(A,ue)|0,n=(n=n+Math.imul(A,fe)|0)+Math.imul(T,ue)|0,s=s+Math.imul(T,fe)|0;var Te=(h+(i=i+Math.imul(M,pe)|0)|0)+((8191&(n=(n=n+Math.imul(M,ye)|0)+Math.imul(E,pe)|0))<<13)|0;h=((s=s+Math.imul(E,ye)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(F,se),n=(n=Math.imul(F,oe))+Math.imul(D,se)|0,s=Math.imul(D,oe),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,he)|0)+Math.imul(R,ce)|0,s=s+Math.imul(R,he)|0,i=i+Math.imul(N,ue)|0,n=(n=n+Math.imul(N,fe)|0)+Math.imul(K,ue)|0,s=s+Math.imul(K,fe)|0;var Oe=(h+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,ye)|0)+Math.imul(T,pe)|0))<<13)|0;h=((s=s+Math.imul(T,ye)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(F,ce),n=(n=Math.imul(F,he))+Math.imul(D,ce)|0,s=Math.imul(D,he),i=i+Math.imul(L,ue)|0,n=(n=n+Math.imul(L,fe)|0)+Math.imul(R,ue)|0,s=s+Math.imul(R,fe)|0;var Ne=(h+(i=i+Math.imul(N,pe)|0)|0)+((8191&(n=(n=n+Math.imul(N,ye)|0)+Math.imul(K,pe)|0))<<13)|0;h=((s=s+Math.imul(K,ye)|0)+(n>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,i=Math.imul(F,ue),n=(n=Math.imul(F,fe))+Math.imul(D,ue)|0,s=Math.imul(D,fe);var Ke=(h+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,ye)|0)+Math.imul(R,pe)|0))<<13)|0;h=((s=s+Math.imul(R,ye)|0)+(n>>>13)|0)+(Ke>>>26)|0,Ke&=67108863;var Ce=(h+(i=Math.imul(F,pe))|0)+((8191&(n=(n=Math.imul(F,ye))+Math.imul(D,pe)|0))<<13)|0;return h=((s=Math.imul(D,ye))+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,c[0]=me,c[1]=ge,c[2]=be,c[3]=ve,c[4]=we,c[5]=Se,c[6]=_e,c[7]=xe,c[8]=ke,c[9]=Pe,c[10]=Me,c[11]=Ee,c[12]=Ie,c[13]=Ae,c[14]=Te,c[15]=Oe,c[16]=Ne,c[17]=Ke,c[18]=Ce,0!==h&&(c[19]=h,r.length++),r};function g(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,c=Math.min(s,t.length-1),h=Math.max(0,s-e.length+1);h<=c;h++){var d=s-h,u=(0|e.words[d])*(0|t.words[h]),f=67108863&u;a=67108863&(f=f+a|0),n+=(o=(o=o+(u/67108864|0)|0)+(f>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r._strip()}function b(e,t,r){return g(e,t,r)}function v(e,t){this.x=e,this.y=t}Math.imul||(m=y),s.prototype.mulTo=function(e,t){var r=this.length+e.length;return 10===this.length&&10===e.length?m(this,e,t):r<63?y(this,e,t):r<1024?g(this,e,t):b(this,e,t)},v.prototype.makeRBT=function(e){for(var t=new Array(e),r=s.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},v.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},v.prototype.permute=function(e,t,r,i,n,s){for(var o=0;o<s;o++)i[o]=t[e[o]],n[o]=r[e[o]]},v.prototype.transform=function(e,t,r,i,n,s){this.permute(s,e,t,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,c=Math.cos(2*Math.PI/a),h=Math.sin(2*Math.PI/a),d=0;d<n;d+=a)for(var u=c,f=h,l=0;l<o;l++){var p=r[d+l],y=i[d+l],m=r[d+l+o],g=i[d+l+o],b=u*m-f*g;g=u*g+f*m,m=b,r[d+l]=p+m,i[d+l]=y+g,r[d+l+o]=p-m,i[d+l+o]=y-g,l!==a&&(b=c*u-h*f,f=c*f+h*u,u=b)}},v.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},v.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},v.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},v.prototype.convert13b=function(e,t,r,n){for(var s=0,o=0;o<t;o++)s+=0|e[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*t;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},v.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},v.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),c=new Array(i),h=new Array(i),d=new Array(i),u=new Array(i),f=r.words;f.length=i,this.convert13b(e.words,e.length,o,i),this.convert13b(t.words,t.length,h,i),this.transform(o,s,a,c,i,n),this.transform(h,s,d,u,i,n);for(var l=0;l<i;l++){var p=a[l]*d[l]-c[l]*u[l];c[l]=a[l]*u[l]+c[l]*d[l],a[l]=p}return this.conjugate(a,c,i),this.transform(a,c,f,s,i,n),this.conjugate(f,s,i),this.normalize13b(f,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r._strip()},s.prototype.mul=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},s.prototype.mulf=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),b(this,e,t)},s.prototype.imul=function(e){return this.clone().mulTo(e,this)},s.prototype.imuln=function(e){var t=e<0;t&&(e=-e),i("number"==typeof e),i(e<67108864);for(var r=0,n=0;n<this.length;n++){var s=(0|this.words[n])*e,o=(67108863&s)+(67108863&r);r>>=26,r+=s/67108864|0,r+=o>>>26,this.words[n]=67108863&o}return 0!==r&&(this.words[n]=r,this.length++),t?this.ineg():this},s.prototype.muln=function(e){return this.clone().imuln(e)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=e.words[i]>>>n&1}return t}(e);if(0===t.length)return new s(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(e){i("number"==typeof e&&e>=0);var t,r=e%26,n=(e-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(t=0;t<this.length;t++){var a=this.words[t]&s,c=(0|this.words[t])-a<<r;this.words[t]=c|o,o=a>>>26-r}o&&(this.words[t]=o,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this._strip()},s.prototype.ishln=function(e){return i(0===this.negative),this.iushln(e)},s.prototype.iushrn=function(e,t,r){var n;i("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var s=e%26,o=Math.min((e-s)/26,this.length),a=67108863^67108863>>>s<<s,c=r;if(n-=o,n=Math.max(0,n),c){for(var h=0;h<o;h++)c.words[h]=this.words[h];c.length=o}if(0===o);else if(this.length>o)for(this.length-=o,h=0;h<this.length;h++)this.words[h]=this.words[h+o];else this.words[0]=0,this.length=1;var d=0;for(h=this.length-1;h>=0&&(0!==d||h>=n);h--){var u=0|this.words[h];this.words[h]=d<<26-s|u>>>s,d=u&a}return c&&0!==d&&(c.words[c.length++]=d),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(e,t,r){return i(0===this.negative),this.iushrn(e,t,r)},s.prototype.shln=function(e){return this.clone().ishln(e)},s.prototype.ushln=function(e){return this.clone().iushln(e)},s.prototype.shrn=function(e){return this.clone().ishrn(e)},s.prototype.ushrn=function(e){return this.clone().iushrn(e)},s.prototype.testn=function(e){i("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26,n=1<<t;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(e){i("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==t&&r++,this.length=Math.min(r,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this._strip()},s.prototype.maskn=function(e){return this.clone().imaskn(e)},s.prototype.iaddn=function(e){return i("number"==typeof e),i(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},s.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},s.prototype.isubn=function(e){if(i("number"==typeof e),i(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this._strip()},s.prototype.addn=function(e){return this.clone().iaddn(e)},s.prototype.subn=function(e){return this.clone().isubn(e)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(e,t,r){var n,s,o=e.length+r;this._expand(o);var a=0;for(n=0;n<e.length;n++){s=(0|this.words[n+r])+a;var c=(0|e.words[n])*t;a=((s-=67108863&c)>>26)-(c/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this._strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this._strip()},s.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new s(null)).length=c+1,a.words=new Array(a.length);for(var h=0;h<a.length;h++)a.words[h]=0}var d=i.clone()._ishlnsubmul(n,1,c);0===d.negative&&(i=d,a&&(a.words[c]=1));for(var u=c-1;u>=0;u--){var f=67108864*(0|i.words[n.length+u])+(0|i.words[n.length+u-1]);for(f=Math.min(f/o|0,67108863),i._ishlnsubmul(n,f,u);0!==i.negative;)f--,i.negative=0,i._ishlnsubmul(n,1,u),i.isZero()||(i.negative^=1);a&&(a.words[u]=f)}return a&&a._strip(),i._strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(e,t,r){return i(!e.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(e)),{div:n,mod:o}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&e.negative?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(e)),{div:a.div,mod:o}):e.length>this.length||this.cmp(e)<0?{div:new s(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new s(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new s(this.modrn(e.words[0]))}:this._wordDiv(e,t);var n,o,a},s.prototype.div=function(e){return this.divmod(e,"div",!1).div},s.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},s.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},s.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},s.prototype.modrn=function(e){var t=e<0;t&&(e=-e),i(e<=67108863);for(var r=(1<<26)%e,n=0,s=this.length-1;s>=0;s--)n=(r*n+(0|this.words[s]))%e;return t?-n:n},s.prototype.modn=function(e){return this.modrn(e)},s.prototype.idivn=function(e){var t=e<0;t&&(e=-e),i(e<=67108863);for(var r=0,n=this.length-1;n>=0;n--){var s=(0|this.words[n])+67108864*r;this.words[n]=s/e|0,r=s%e}return this._strip(),t?this.ineg():this},s.prototype.divn=function(e){return this.clone().idivn(e)},s.prototype.egcd=function(e){i(0===e.negative),i(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new s(1),o=new s(0),a=new s(0),c=new s(1),h=0;t.isEven()&&r.isEven();)t.iushrn(1),r.iushrn(1),++h;for(var d=r.clone(),u=t.clone();!t.isZero();){for(var f=0,l=1;!(t.words[0]&l)&&f<26;++f,l<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(d),o.isub(u)),n.iushrn(1),o.iushrn(1);for(var p=0,y=1;!(r.words[0]&y)&&p<26;++p,y<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(d),c.isub(u)),a.iushrn(1),c.iushrn(1);t.cmp(r)>=0?(t.isub(r),n.isub(a),o.isub(c)):(r.isub(t),a.isub(n),c.isub(o))}return{a,b:c,gcd:r.iushln(h)}},s.prototype._invmp=function(e){i(0===e.negative),i(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,o=new s(1),a=new s(0),c=r.clone();t.cmpn(1)>0&&r.cmpn(1)>0;){for(var h=0,d=1;!(t.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(t.iushrn(h);h-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);for(var u=0,f=1;!(r.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(r.iushrn(u);u-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(r)>=0?(t.isub(r),o.isub(a)):(r.isub(t),a.isub(o))}return(n=0===t.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(e),n},s.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var s=t;t=r,r=s}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},s.prototype.invm=function(e){return this.egcd(e).a.umod(e)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(e){return this.words[0]&e},s.prototype.bincn=function(e){i("number"==typeof e);var t=e%26,r=(e-t)/26,n=1<<t;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(e){var t,r=e<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this._strip(),this.length>1)t=1;else{r&&(e=-e),i(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},s.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},s.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},s.prototype.gtn=function(e){return 1===this.cmpn(e)},s.prototype.gt=function(e){return 1===this.cmp(e)},s.prototype.gten=function(e){return this.cmpn(e)>=0},s.prototype.gte=function(e){return this.cmp(e)>=0},s.prototype.ltn=function(e){return-1===this.cmpn(e)},s.prototype.lt=function(e){return-1===this.cmp(e)},s.prototype.lten=function(e){return this.cmpn(e)<=0},s.prototype.lte=function(e){return this.cmp(e)<=0},s.prototype.eqn=function(e){return 0===this.cmpn(e)},s.prototype.eq=function(e){return 0===this.cmp(e)},s.red=function(e){return new M(e)},s.prototype.toRed=function(e){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(e){return this.red=e,this},s.prototype.forceRed=function(e){return i(!this.red,"Already a number in reduction context"),this._forceRed(e)},s.prototype.redAdd=function(e){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},s.prototype.redIAdd=function(e){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},s.prototype.redSub=function(e){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},s.prototype.redISub=function(e){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},s.prototype.redShl=function(e){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},s.prototype.redMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},s.prototype.redIMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(e){return i(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var w={k256:null,p224:null,p192:null,p25519:null};function S(e,t){this.name=e,this.p=new s(t,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function _(){S.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function x(){S.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function k(){S.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function P(){S.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function M(e){if("string"==typeof e){var t=s._prime(e);this.m=t.p,this.prime=t}else i(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function E(e){M.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}S.prototype._tmp=function(){var e=new s(null);return e.words=new Array(Math.ceil(this.n/13)),e},S.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},S.prototype.split=function(e,t){e.iushrn(this.n,0,t)},S.prototype.imulK=function(e){return e.imul(this.k)},n(_,S),_.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=s&r,n=10;n<e.length;n++){var o=0|e.words[n];e.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,e.words[n-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},_.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(x,S),n(k,S),n(P,S),P.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},s._prime=function(e){if(w[e])return w[e];var t;if("k256"===e)t=new _;else if("p224"===e)t=new x;else if("p192"===e)t=new k;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new P}return w[e]=t,t},M.prototype._verify1=function(e){i(0===e.negative,"red works only with positives"),i(e.red,"red works only with red numbers")},M.prototype._verify2=function(e,t){i(!(e.negative|t.negative),"red works only with positives"),i(e.red&&e.red===t.red,"red works only with red numbers")},M.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(d(e,e.umod(this.m)._forceRed(this)),e)},M.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},M.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},M.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},M.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},M.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},M.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},M.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},M.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},M.prototype.isqr=function(e){return this.imul(e,e.clone())},M.prototype.sqr=function(e){return this.mul(e,e)},M.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(i(t%2==1),3===t){var r=this.m.add(new s(1)).iushrn(2);return this.pow(e,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),c=a.redNeg(),h=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new s(2*d*d).toRed(this);0!==this.pow(d,h).cmp(c);)d.redIAdd(c);for(var u=this.pow(d,n),f=this.pow(e,n.addn(1).iushrn(1)),l=this.pow(e,n),p=o;0!==l.cmp(a);){for(var y=l,m=0;0!==y.cmp(a);m++)y=y.redSqr();i(m<p);var g=this.pow(u,new s(1).iushln(p-m-1));f=f.redMul(g),u=g.redSqr(),l=l.redMul(u),p=m}return f},M.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},M.prototype.pow=function(e,t){if(t.isZero())return new s(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],o=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var h=t.words[i],d=c-1;d>=0;d--){var u=h>>d&1;n!==r[0]&&(n=this.sqr(n)),0!==u||0!==o?(o<<=1,o|=u,(4==++a||0===i&&0===d)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}c=26}return n},M.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},M.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},s.mont=function(e){return new E(e)},n(E,M),E.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},E.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},E.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new s(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=r.nmd(e),this)},6880:function(e){e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i=r(18),n=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,i){void 0===i&&(i=!1);var n=e.getVersionPrecision(t),s=e.getVersionPrecision(r),o=Math.max(n,s),a=0,c=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),i=t+new Array(r+1).join(".0");return e.map(i.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(i&&(a=o-Math.min(n,s)),o-=1;o>=a;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===a)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}},e.map=function(e,t){var r,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)i.push(t(e[r]));return i},e.find=function(e,t){var r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){var n=e[r];if(t(n,r))return n}},e.assign=function(e){for(var t,r,i=e,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=n,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(91))&&i.__esModule?i:{default:i},s=r(18);function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(t.prototype,null),r&&o(t,r),e}();t.default=a,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i=c(r(92)),n=c(r(93)),s=c(r(94)),o=c(r(95)),a=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},i=0,n={},s=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(n[t]=o,s+=1):"object"==typeof o&&(r[t]=o,i+=1)})),i>0){var o=Object.keys(r),c=a.default.find(o,(function(e){return t.isOS(e)}));if(c){var h=this.satisfies(r[c]);if(void 0!==h)return h}var d=a.default.find(o,(function(e){return t.isPlatform(e)}));if(d){var u=this.satisfies(r[d]);if(void 0!==u)return u}}if(s>0){var f=Object.keys(n),l=a.default.find(f,(function(e){return t.isBrowser(e,!0)}));if(void 0!==l)return this.compareVersion(n[l])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),n=a.default.getBrowserTypeByAlias(i);return t&&n&&(i=n.toLowerCase()),i===r},t.compareVersion=function(e){var t=[0],r=e,i=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(i=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(i=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(n,r,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=h,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=n.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(t),i={name:s.OS_MAP.MacOS,version:t};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=n.default.getAndroidVersionName(t),i={name:s.OS_MAP.Android,version:t};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})},5037:(e,t,r)=>{var i;function n(e){this.rand=e}if(e.exports=function(e){return i||(i=new n(null)),i.generate(e)},e.exports.Rand=n,n.prototype.generate=function(e){return this._rand(e)},n.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?n.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?n.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(n.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var s=r(3776);if("function"!=typeof s.randomBytes)throw new Error("Not supported");n.prototype._rand=function(e){return s.randomBytes(e)}}catch(e){}},8287:(e,t,r)=>{"use strict";const i=r(7526),n=r(251),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.hp=c,t.IS=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|y(e,t);let i=a(r);const n=i.write(e,t);return n!==r&&(i=i.slice(0,n)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(W(e,Uint8Array)){const t=new Uint8Array(e);return l(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(W(e,ArrayBuffer)||e&&W(e.buffer,ArrayBuffer))return l(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(W(e,SharedArrayBuffer)||e&&W(e.buffer,SharedArrayBuffer)))return l(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return c.from(i,t,r);const n=function(e){if(c.isBuffer(e)){const t=0|p(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||X(e.length)?a(0):f(e):"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return d(e),a(e<0?0:0|p(e))}function f(e){const t=e.length<0?0:0|p(e.length),r=a(t);for(let i=0;i<t;i+=1)r[i]=255&e[i];return r}function l(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(i,c.prototype),i}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function y(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||W(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let n=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(e).length;default:if(n)return i?-1:H(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,r);case"utf8":case"utf-8":return M(this,t,r);case"ascii":return I(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return P(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}function b(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),X(r=+r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:v(e,t,r,i,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,i,n){let s,o=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){let i=-1;for(s=r;s<a;s++)if(h(e,s)===h(t,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===c)return i*o}else-1!==i&&(s-=s-i),i=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){let r=!0;for(let i=0;i<c;i++)if(h(e,s+i)!==h(t,i)){r=!1;break}if(r)return s}return-1}function w(e,t,r,i){r=Number(r)||0;const n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;const s=t.length;let o;for(i>s/2&&(i=s/2),o=0;o<i;++o){const i=parseInt(t.substr(2*o,2),16);if(X(i))return o;e[r+o]=i}return o}function S(e,t,r,i){return Y(H(t,e.length-r),e,r,i)}function _(e,t,r,i){return Y(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function x(e,t,r,i){return Y(V(t),e,r,i)}function k(e,t,r,i){return Y(function(e,t){let r,i,n;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),i=r>>8,n=r%256,s.push(n),s.push(i);return s}(t,e.length-r),e,r,i)}function P(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function M(e,t,r){r=Math.min(e.length,r);const i=[];let n=t;for(;n<r;){const t=e[n];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(n+o<=r){let r,i,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[n+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(s=c));break;case 3:r=e[n+1],i=e[n+2],128==(192&r)&&128==(192&i)&&(c=(15&t)<<12|(63&r)<<6|63&i,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[n+1],i=e[n+2],a=e[n+3],128==(192&r)&&128==(192&i)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&i)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),n+=o}return function(e){const t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);let r="",i=0;for(;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=E));return r}(i)}c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return function(e,t,r){return d(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},c.allocUnsafe=function(e){return u(e)},c.allocUnsafeSlow=function(e){return u(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(W(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),W(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,i=t.length;for(let n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const i=c.allocUnsafe(t);let n=0;for(r=0;r<e.length;++r){let t=e[r];if(W(t,Uint8Array))n+t.length>i.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(i,n)):Uint8Array.prototype.set.call(i,t,n);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,n)}n+=t.length}return i},c.byteLength=y,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?M(this,0,e):m.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const r=t.IS;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,r,i,n){if(W(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(n>>>=0)-(i>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(s,o),h=this.slice(i,n),d=e.slice(t,r);for(let e=0;e<a;++e)if(h[e]!==d[e]){s=h[e],o=d[e];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},c.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}const n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let s=!1;for(;;)switch(i){case"hex":return w(this,e,t,r);case"utf8":case"utf-8":return S(this,e,t,r);case"ascii":case"latin1":case"binary":return _(this,e,t,r);case"base64":return x(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const E=4096;function I(e,t,r){let i="";r=Math.min(e.length,r);for(let n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function A(e,t,r){let i="";r=Math.min(e.length,r);for(let n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function T(e,t,r){const i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=t;i<r;++i)n+=G[e[i]];return n}function O(e,t,r){const i=e.slice(t,r);let n="";for(let e=0;e<i.length-1;e+=2)n+=String.fromCharCode(i[e]+256*i[e+1]);return n}function N(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function K(e,t,r,i,n,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function C(e,t,r,i,n){q(t,i,n,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function L(e,t,r,i,n){q(t,i,n,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function R(e,t,r,i,n,s){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,i,s){return t=+t,r>>>=0,s||R(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function F(e,t,r,i,s){return t=+t,r>>>=0,s||R(e,0,r,8),n.write(e,t,r,i,52,8),r+8}c.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const i=this.subarray(e,t);return Object.setPrototypeOf(i,c.prototype),i},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||N(e,t,this.length);let i=this[e],n=1,s=0;for(;++s<t&&(n*=256);)i+=this[e+s]*n;return i},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||N(e,t,this.length);let i=this[e+--t],n=1;for(;t>0&&(n*=256);)i+=this[e+--t]*n;return i},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=Q((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const i=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,n=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(i)+(BigInt(n)<<BigInt(32))})),c.prototype.readBigUInt64BE=Q((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const i=t*2**24+65536*this[++e]+256*this[++e]+this[++e],n=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)})),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||N(e,t,this.length);let i=this[e],n=1,s=0;for(;++s<t&&(n*=256);)i+=this[e+s]*n;return n*=128,i>=n&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||N(e,t,this.length);let i=t,n=1,s=this[e+--i];for(;i>0&&(n*=256);)s+=this[e+--i]*n;return n*=128,s>=n&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=Q((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const i=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=Q((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const i=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),n.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),n.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),n.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||N(e,8,this.length),n.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,i){e=+e,t>>>=0,r>>>=0,i||K(this,e,t,r,Math.pow(2,8*r)-1,0);let n=1,s=0;for(this[t]=255&e;++s<r&&(n*=256);)this[t+s]=e/n&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,i){e=+e,t>>>=0,r>>>=0,i||K(this,e,t,r,Math.pow(2,8*r)-1,0);let n=r-1,s=1;for(this[t+n]=255&e;--n>=0&&(s*=256);)this[t+n]=e/s&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=Q((function(e,t=0){return C(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=Q((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*r-1);K(this,e,t,r,i-1,-i)}let n=0,s=1,o=0;for(this[t]=255&e;++n<r&&(s*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/s|0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*r-1);K(this,e,t,r,i-1,-i)}let n=r-1,s=1,o=0;for(this[t+n]=255&e;--n>=0&&(s*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/s|0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||K(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=Q((function(e,t=0){return C(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=Q((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,i){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);const n=i-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,i):Uint8Array.prototype.set.call(e,this.subarray(r,i),t),n},c.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){const t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let n;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{const s=c.isBuffer(e)?e:c.from(e,i),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=s[n%o]}return this};const D={};function U(e,t,r){D[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function j(e){let t="",r=e.length;const i="-"===e[0]?1:0;for(;r>=i+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function q(e,t,r,i,n,s){if(e>r||e<t){const i="bigint"==typeof t?"n":"";let n;throw n=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(s+1)}${i}`:`>= -(2${i} ** ${8*(s+1)-1}${i}) and < 2 ** ${8*(s+1)-1}${i}`:`>= ${t}${i} and <= ${r}${i}`,new D.ERR_OUT_OF_RANGE("value",n,e)}!function(e,t,r){$(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||z(t,e.length-(r+1))}(i,n,s)}function $(e,t){if("number"!=typeof e)throw new D.ERR_INVALID_ARG_TYPE(t,"number",e)}function z(e,t,r){if(Math.floor(e)!==e)throw $(e,r),new D.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new D.ERR_BUFFER_OUT_OF_BOUNDS;throw new D.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(e,t,r){let i=`The value of "${e}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>2**32?n=j(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=j(n)),n+="n"),i+=` It must be ${t}. Received ${n}`,i}),RangeError);const J=/[^+/0-9A-Za-z-_]/g;function H(e,t){let r;t=t||1/0;const i=e.length;let n=null;const s=[];for(let o=0;o<i;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function V(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(J,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,i){let n;for(n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function W(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const G=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const i=16*r;for(let n=0;n<16;++n)t[i+n]=e[r]+e[n]}return t}();function Q(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},8075:(e,t,r)=>{"use strict";var i=r(453),n=r(487),s=n(i("String.prototype.indexOf"));e.exports=function(e,t){var r=i(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?n(r):r}},487:(e,t,r)=>{"use strict";var i=r(6743),n=r(453),s=r(6897),o=r(9675),a=n("%Function.prototype.apply%"),c=n("%Function.prototype.call%"),h=n("%Reflect.apply%",!0)||i.call(c,a),d=r(655),u=n("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new o("a function is required");var t=h(i,c,arguments);return s(t,1+u(0,e.length-(arguments.length-1)),!0)};var f=function(){return h(i,a,arguments)};d?d(e.exports,"apply",{value:f}):e.exports.apply=f},4744:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function n(e,t,r){return e.concat(t).map((function(e){return i(e,r)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,r,c){(c=c||{}).arrayMerge=c.arrayMerge||n,c.isMergeableObject=c.isMergeableObject||t,c.cloneUnlessOtherwiseSpecified=i;var h=Array.isArray(r);return h===Array.isArray(e)?h?c.arrayMerge(e,r,c):function(e,t,r){var n={};return r.isMergeableObject(e)&&s(e).forEach((function(t){n[t]=i(e[t],r)})),s(t).forEach((function(s){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(o(e,s)&&r.isMergeableObject(t[s])?n[s]=function(e,t){if(!t.customMerge)return a;var r=t.customMerge(e);return"function"==typeof r?r:a}(s,r)(e[s],t[s],r):n[s]=i(t[s],r))})),n}(e,r,c):i(r,c)}a.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return a(e,r,t)}),{})};var c=a;e.exports=c},41:(e,t,r)=>{"use strict";var i=r(655),n=r(8068),s=r(9675),o=r(5795);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new s("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new s("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,d=arguments.length>6&&arguments[6],u=!!o&&o(e,t);if(i)i(e,t,{configurable:null===h&&u?u.configurable:!h,enumerable:null===a&&u?u.enumerable:!a,value:r,writable:null===c&&u?u.writable:!c});else{if(!d&&(a||c||h))throw new n("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=r}}},6729:(e,t,r)=>{"use strict";var i=t;i.version=r(1636).rE,i.utils=r(7011),i.rand=r(5037),i.curve=r(894),i.curves=r(480),i.ec=r(7447),i.eddsa=r(8650)},6677:(e,t,r)=>{"use strict";var i=r(9404),n=r(7011),s=n.getNAF,o=n.getJSF,a=n.assert;function c(e,t){this.type=e,this.p=new i(t.p,16),this.red=t.prime?i.red(t.prime):i.mont(this.p),this.zero=new i(0).toRed(this.red),this.one=new i(1).toRed(this.red),this.two=new i(2).toRed(this.red),this.n=t.n&&new i(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function h(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=c,c.prototype.point=function(){throw new Error("Not implemented")},c.prototype.validate=function(){throw new Error("Not implemented")},c.prototype._fixedNafMul=function(e,t){a(e.precomputed);var r=e._getDoubles(),i=s(t,1,this._bitLength),n=(1<<r.step+1)-(r.step%2==0?2:1);n/=3;var o,c,h=[];for(o=0;o<i.length;o+=r.step){c=0;for(var d=o+r.step-1;d>=o;d--)c=(c<<1)+i[d];h.push(c)}for(var u=this.jpoint(null,null,null),f=this.jpoint(null,null,null),l=n;l>0;l--){for(o=0;o<h.length;o++)(c=h[o])===l?f=f.mixedAdd(r.points[o]):c===-l&&(f=f.mixedAdd(r.points[o].neg()));u=u.add(f)}return u.toP()},c.prototype._wnafMul=function(e,t){var r=4,i=e._getNAFPoints(r);r=i.wnd;for(var n=i.points,o=s(t,r,this._bitLength),c=this.jpoint(null,null,null),h=o.length-1;h>=0;h--){for(var d=0;h>=0&&0===o[h];h--)d++;if(h>=0&&d++,c=c.dblp(d),h<0)break;var u=o[h];a(0!==u),c="affine"===e.type?u>0?c.mixedAdd(n[u-1>>1]):c.mixedAdd(n[-u-1>>1].neg()):u>0?c.add(n[u-1>>1]):c.add(n[-u-1>>1].neg())}return"affine"===e.type?c.toP():c},c.prototype._wnafMulAdd=function(e,t,r,i,n){var a,c,h,d=this._wnafT1,u=this._wnafT2,f=this._wnafT3,l=0;for(a=0;a<i;a++){var p=(h=t[a])._getNAFPoints(e);d[a]=p.wnd,u[a]=p.points}for(a=i-1;a>=1;a-=2){var y=a-1,m=a;if(1===d[y]&&1===d[m]){var g=[t[y],null,null,t[m]];0===t[y].y.cmp(t[m].y)?(g[1]=t[y].add(t[m]),g[2]=t[y].toJ().mixedAdd(t[m].neg())):0===t[y].y.cmp(t[m].y.redNeg())?(g[1]=t[y].toJ().mixedAdd(t[m]),g[2]=t[y].add(t[m].neg())):(g[1]=t[y].toJ().mixedAdd(t[m]),g[2]=t[y].toJ().mixedAdd(t[m].neg()));var b=[-3,-1,-5,-7,0,7,5,1,3],v=o(r[y],r[m]);for(l=Math.max(v[0].length,l),f[y]=new Array(l),f[m]=new Array(l),c=0;c<l;c++){var w=0|v[0][c],S=0|v[1][c];f[y][c]=b[3*(w+1)+(S+1)],f[m][c]=0,u[y]=g}}else f[y]=s(r[y],d[y],this._bitLength),f[m]=s(r[m],d[m],this._bitLength),l=Math.max(f[y].length,l),l=Math.max(f[m].length,l)}var _=this.jpoint(null,null,null),x=this._wnafT4;for(a=l;a>=0;a--){for(var k=0;a>=0;){var P=!0;for(c=0;c<i;c++)x[c]=0|f[c][a],0!==x[c]&&(P=!1);if(!P)break;k++,a--}if(a>=0&&k++,_=_.dblp(k),a<0)break;for(c=0;c<i;c++){var M=x[c];0!==M&&(M>0?h=u[c][M-1>>1]:M<0&&(h=u[c][-M-1>>1].neg()),_="affine"===h.type?_.mixedAdd(h):_.add(h))}}for(a=0;a<i;a++)u[a]=null;return n?_:_.toP()},c.BasePoint=h,h.prototype.eq=function(){throw new Error("Not implemented")},h.prototype.validate=function(){return this.curve.validate(this)},c.prototype.decodePoint=function(e,t){e=n.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?a(e[e.length-1]%2==0):7===e[0]&&a(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},h.prototype.encodeCompressed=function(e){return this.encode(e,!0)},h.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},h.prototype.encode=function(e,t){return n.encode(this._encode(t),e)},h.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},h.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},h.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],i=this,n=0;n<t;n+=e){for(var s=0;s<e;s++)i=i.dbl();r.push(i)}return{step:e,points:r}},h.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,i=1===r?null:this.dbl(),n=1;n<r;n++)t[n]=t[n-1].add(i);return{wnd:e,points:t}},h.prototype._getBeta=function(){return null},h.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}},1298:(e,t,r)=>{"use strict";var i=r(7011),n=r(9404),s=r(6698),o=r(6677),a=i.assert;function c(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,o.call(this,"edwards",e),this.a=new n(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new n(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new n(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function h(e,t,r,i,s){o.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===i?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new n(t,16),this.y=new n(r,16),this.z=i?new n(i,16):this.curve.one,this.t=s&&new n(s,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}s(c,o),e.exports=c,c.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},c.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},c.prototype.jpoint=function(e,t,r,i){return this.point(e,t,r,i)},c.prototype.pointFromX=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),i=this.c2.redSub(this.a.redMul(r)),s=this.one.redSub(this.c2.redMul(this.d).redMul(r)),o=i.redMul(s.redInvm()),a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");var c=a.fromRed().isOdd();return(t&&!c||!t&&c)&&(a=a.redNeg()),this.point(e,a)},c.prototype.pointFromY=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),i=r.redSub(this.c2),s=r.redMul(this.d).redMul(this.c2).redSub(this.a),o=i.redMul(s.redInvm());if(0===o.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");return a.fromRed().isOdd()!==t&&(a=a.redNeg()),this.point(a,e)},c.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),i=t.redMul(this.a).redAdd(r),n=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===i.cmp(n)},s(h,o.BasePoint),c.prototype.pointFromJSON=function(e){return h.fromJSON(this,e)},c.prototype.point=function(e,t,r,i){return new h(this,e,t,r,i)},h.fromJSON=function(e,t){return new h(e,t[0],t[1],t[2])},h.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},h.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},h.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var i=this.curve._mulA(e),n=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),s=i.redAdd(t),o=s.redSub(r),a=i.redSub(t),c=n.redMul(o),h=s.redMul(a),d=n.redMul(a),u=o.redMul(s);return this.curve.point(c,h,u,d)},h.prototype._projDbl=function(){var e,t,r,i,n,s,o=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),c=this.y.redSqr();if(this.curve.twisted){var h=(i=this.curve._mulA(a)).redAdd(c);this.zOne?(e=o.redSub(a).redSub(c).redMul(h.redSub(this.curve.two)),t=h.redMul(i.redSub(c)),r=h.redSqr().redSub(h).redSub(h)):(n=this.z.redSqr(),s=h.redSub(n).redISub(n),e=o.redSub(a).redISub(c).redMul(s),t=h.redMul(i.redSub(c)),r=h.redMul(s))}else i=a.redAdd(c),n=this.curve._mulC(this.z).redSqr(),s=i.redSub(n).redSub(n),e=this.curve._mulC(o.redISub(i)).redMul(s),t=this.curve._mulC(i).redMul(a.redISub(c)),r=i.redMul(s);return this.curve.point(e,t,r)},h.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},h.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),i=this.t.redMul(this.curve.dd).redMul(e.t),n=this.z.redMul(e.z.redAdd(e.z)),s=r.redSub(t),o=n.redSub(i),a=n.redAdd(i),c=r.redAdd(t),h=s.redMul(o),d=a.redMul(c),u=s.redMul(c),f=o.redMul(a);return this.curve.point(h,d,f,u)},h.prototype._projAdd=function(e){var t,r,i=this.z.redMul(e.z),n=i.redSqr(),s=this.x.redMul(e.x),o=this.y.redMul(e.y),a=this.curve.d.redMul(s).redMul(o),c=n.redSub(a),h=n.redAdd(a),d=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(s).redISub(o),u=i.redMul(c).redMul(d);return this.curve.twisted?(t=i.redMul(h).redMul(o.redSub(this.curve._mulA(s))),r=c.redMul(h)):(t=i.redMul(h).redMul(o.redSub(s)),r=this.curve._mulC(c).redMul(h)),this.curve.point(u,t,r)},h.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},h.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},h.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},h.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},h.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},h.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},h.prototype.getX=function(){return this.normalize(),this.x.fromRed()},h.prototype.getY=function(){return this.normalize(),this.y.fromRed()},h.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},h.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),i=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(i),0===this.x.cmp(t))return!0}},h.prototype.toP=h.prototype.normalize,h.prototype.mixedAdd=h.prototype.add},894:(e,t,r)=>{"use strict";var i=t;i.base=r(6677),i.short=r(9188),i.mont=r(370),i.edwards=r(1298)},370:(e,t,r)=>{"use strict";var i=r(9404),n=r(6698),s=r(6677),o=r(7011);function a(e){s.call(this,"mont",e),this.a=new i(e.a,16).toRed(this.red),this.b=new i(e.b,16).toRed(this.red),this.i4=new i(4).toRed(this.red).redInvm(),this.two=new i(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function c(e,t,r){s.BasePoint.call(this,e,"projective"),null===t&&null===r?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new i(t,16),this.z=new i(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}n(a,s),e.exports=a,a.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),i=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===i.redSqrt().redSqr().cmp(i)},n(c,s.BasePoint),a.prototype.decodePoint=function(e,t){return this.point(o.toArray(e,t),1)},a.prototype.point=function(e,t){return new c(this,e,t)},a.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},c.prototype.precompute=function(){},c.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},c.fromJSON=function(e,t){return new c(e,t[0],t[1]||e.one)},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},c.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),i=e.redMul(t),n=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(i,n)},c.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),i=this.x.redSub(this.z),n=e.x.redAdd(e.z),s=e.x.redSub(e.z).redMul(r),o=n.redMul(i),a=t.z.redMul(s.redAdd(o).redSqr()),c=t.x.redMul(s.redISub(o).redSqr());return this.curve.point(a,c)},c.prototype.mul=function(e){for(var t=e.clone(),r=this,i=this.curve.point(null,null),n=[];0!==t.cmpn(0);t.iushrn(1))n.push(t.andln(1));for(var s=n.length-1;s>=0;s--)0===n[s]?(r=r.diffAdd(i,this),i=i.dbl()):(i=r.diffAdd(i,this),r=r.dbl());return i},c.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},c.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},9188:(e,t,r)=>{"use strict";var i=r(7011),n=r(9404),s=r(6698),o=r(6677),a=i.assert;function c(e){o.call(this,"short",e),this.a=new n(e.a,16).toRed(this.red),this.b=new n(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function h(e,t,r,i){o.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new n(t,16),this.y=new n(r,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function d(e,t,r,i){o.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===i?(this.x=this.curve.one,this.y=this.curve.one,this.z=new n(0)):(this.x=new n(t,16),this.y=new n(r,16),this.z=new n(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}s(c,o),e.exports=c,c.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,r;if(e.beta)t=new n(e.beta,16).toRed(this.red);else{var i=this._getEndoRoots(this.p);t=(t=i[0].cmp(i[1])<0?i[0]:i[1]).toRed(this.red)}if(e.lambda)r=new n(e.lambda,16);else{var s=this._getEndoRoots(this.n);0===this.g.mul(s[0]).x.cmp(this.g.x.redMul(t))?r=s[0]:(r=s[1],a(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:r,basis:e.basis?e.basis.map((function(e){return{a:new n(e.a,16),b:new n(e.b,16)}})):this._getEndoBasis(r)}}},c.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:n.mont(e),r=new n(2).toRed(t).redInvm(),i=r.redNeg(),s=new n(3).toRed(t).redNeg().redSqrt().redMul(r);return[i.redAdd(s).fromRed(),i.redSub(s).fromRed()]},c.prototype._getEndoBasis=function(e){for(var t,r,i,s,o,a,c,h,d,u=this.n.ushrn(Math.floor(this.n.bitLength()/2)),f=e,l=this.n.clone(),p=new n(1),y=new n(0),m=new n(0),g=new n(1),b=0;0!==f.cmpn(0);){var v=l.div(f);h=l.sub(v.mul(f)),d=m.sub(v.mul(p));var w=g.sub(v.mul(y));if(!i&&h.cmp(u)<0)t=c.neg(),r=p,i=h.neg(),s=d;else if(i&&2==++b)break;c=h,l=f,f=h,m=p,p=d,g=y,y=w}o=h.neg(),a=d;var S=i.sqr().add(s.sqr());return o.sqr().add(a.sqr()).cmp(S)>=0&&(o=t,a=r),i.negative&&(i=i.neg(),s=s.neg()),o.negative&&(o=o.neg(),a=a.neg()),[{a:i,b:s},{a:o,b:a}]},c.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],i=t[1],n=i.b.mul(e).divRound(this.n),s=r.b.neg().mul(e).divRound(this.n),o=n.mul(r.a),a=s.mul(i.a),c=n.mul(r.b),h=s.mul(i.b);return{k1:e.sub(o).sub(a),k2:c.add(h).neg()}},c.prototype.pointFromX=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),i=r.redSqrt();if(0!==i.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var s=i.fromRed().isOdd();return(t&&!s||!t&&s)&&(i=i.redNeg()),this.point(e,i)},c.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,i=this.a.redMul(t),n=t.redSqr().redMul(t).redIAdd(i).redIAdd(this.b);return 0===r.redSqr().redISub(n).cmpn(0)},c.prototype._endoWnafMulAdd=function(e,t,r){for(var i=this._endoWnafT1,n=this._endoWnafT2,s=0;s<e.length;s++){var o=this._endoSplit(t[s]),a=e[s],c=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),c=c.neg(!0)),i[2*s]=a,i[2*s+1]=c,n[2*s]=o.k1,n[2*s+1]=o.k2}for(var h=this._wnafMulAdd(1,i,n,2*s,r),d=0;d<2*s;d++)i[d]=null,n[d]=null;return h},s(h,o.BasePoint),c.prototype.point=function(e,t,r){return new h(this,e,t,r)},c.prototype.pointFromJSON=function(e,t){return h.fromJSON(this,e,t)},h.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,i=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(i)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(i)}}}return t}},h.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},h.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var i=e.point(t[0],t[1],r);if(!t[2])return i;function n(t){return e.point(t[0],t[1],r)}var s=t[2];return i.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[i].concat(s.doubles.points.map(n))},naf:s.naf&&{wnd:s.naf.wnd,points:[i].concat(s.naf.points.map(n))}},i},h.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},h.prototype.isInfinity=function(){return this.inf},h.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),i=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,i)},h.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),i=e.redInvm(),n=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(i),s=n.redSqr().redISub(this.x.redAdd(this.x)),o=n.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)},h.prototype.getX=function(){return this.x.fromRed()},h.prototype.getY=function(){return this.y.fromRed()},h.prototype.mul=function(e){return e=new n(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},h.prototype.mulAdd=function(e,t,r){var i=[this,t],n=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n):this.curve._wnafMulAdd(1,i,n,2)},h.prototype.jmulAdd=function(e,t,r){var i=[this,t],n=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n,!0):this.curve._wnafMulAdd(1,i,n,2,!0)},h.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},h.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,i=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(i)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(i)}}}return t},h.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},s(d,o.BasePoint),c.prototype.jpoint=function(e,t,r){return new d(this,e,t,r)},d.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),i=this.y.redMul(t).redMul(e);return this.curve.point(r,i)},d.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},d.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(t),n=e.x.redMul(r),s=this.y.redMul(t.redMul(e.z)),o=e.y.redMul(r.redMul(this.z)),a=i.redSub(n),c=s.redSub(o);if(0===a.cmpn(0))return 0!==c.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=a.redSqr(),d=h.redMul(a),u=i.redMul(h),f=c.redSqr().redIAdd(d).redISub(u).redISub(u),l=c.redMul(u.redISub(f)).redISub(s.redMul(d)),p=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(f,l,p)},d.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,i=e.x.redMul(t),n=this.y,s=e.y.redMul(t).redMul(this.z),o=r.redSub(i),a=n.redSub(s);if(0===o.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=o.redSqr(),h=c.redMul(o),d=r.redMul(c),u=a.redSqr().redIAdd(h).redISub(d).redISub(d),f=a.redMul(d.redISub(u)).redISub(n.redMul(h)),l=this.z.redMul(o);return this.curve.jpoint(u,f,l)},d.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var i=this.curve.a,n=this.curve.tinv,s=this.x,o=this.y,a=this.z,c=a.redSqr().redSqr(),h=o.redAdd(o);for(t=0;t<e;t++){var d=s.redSqr(),u=h.redSqr(),f=u.redSqr(),l=d.redAdd(d).redIAdd(d).redIAdd(i.redMul(c)),p=s.redMul(u),y=l.redSqr().redISub(p.redAdd(p)),m=p.redISub(y),g=l.redMul(m);g=g.redIAdd(g).redISub(f);var b=h.redMul(a);t+1<e&&(c=c.redMul(f)),s=y,a=b,h=g}return this.curve.jpoint(s,h.redMul(n),a)},d.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},d.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),s=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(i).redISub(s);o=o.redIAdd(o);var a=i.redAdd(i).redIAdd(i),c=a.redSqr().redISub(o).redISub(o),h=s.redIAdd(s);h=(h=h.redIAdd(h)).redIAdd(h),e=c,t=a.redMul(o.redISub(c)).redISub(h),r=this.y.redAdd(this.y)}else{var d=this.x.redSqr(),u=this.y.redSqr(),f=u.redSqr(),l=this.x.redAdd(u).redSqr().redISub(d).redISub(f);l=l.redIAdd(l);var p=d.redAdd(d).redIAdd(d),y=p.redSqr(),m=f.redIAdd(f);m=(m=m.redIAdd(m)).redIAdd(m),e=y.redISub(l).redISub(l),t=p.redMul(l.redISub(e)).redISub(m),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},d.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),s=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(i).redISub(s);o=o.redIAdd(o);var a=i.redAdd(i).redIAdd(i).redIAdd(this.curve.a),c=a.redSqr().redISub(o).redISub(o);e=c;var h=s.redIAdd(s);h=(h=h.redIAdd(h)).redIAdd(h),t=a.redMul(o.redISub(c)).redISub(h),r=this.y.redAdd(this.y)}else{var d=this.z.redSqr(),u=this.y.redSqr(),f=this.x.redMul(u),l=this.x.redSub(d).redMul(this.x.redAdd(d));l=l.redAdd(l).redIAdd(l);var p=f.redIAdd(f),y=(p=p.redIAdd(p)).redAdd(p);e=l.redSqr().redISub(y),r=this.y.redAdd(this.z).redSqr().redISub(u).redISub(d);var m=u.redSqr();m=(m=(m=m.redIAdd(m)).redIAdd(m)).redIAdd(m),t=l.redMul(p.redISub(e)).redISub(m)}return this.curve.jpoint(e,t,r)},d.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,i=this.z,n=i.redSqr().redSqr(),s=t.redSqr(),o=r.redSqr(),a=s.redAdd(s).redIAdd(s).redIAdd(e.redMul(n)),c=t.redAdd(t),h=(c=c.redIAdd(c)).redMul(o),d=a.redSqr().redISub(h.redAdd(h)),u=h.redISub(d),f=o.redSqr();f=(f=(f=f.redIAdd(f)).redIAdd(f)).redIAdd(f);var l=a.redMul(u).redISub(f),p=r.redAdd(r).redMul(i);return this.curve.jpoint(d,l,p)},d.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),i=t.redSqr(),n=e.redAdd(e).redIAdd(e),s=n.redSqr(),o=this.x.redAdd(t).redSqr().redISub(e).redISub(i),a=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(s)).redSqr(),c=i.redIAdd(i);c=(c=(c=c.redIAdd(c)).redIAdd(c)).redIAdd(c);var h=n.redIAdd(o).redSqr().redISub(s).redISub(a).redISub(c),d=t.redMul(h);d=(d=d.redIAdd(d)).redIAdd(d);var u=this.x.redMul(a).redISub(d);u=(u=u.redIAdd(u)).redIAdd(u);var f=this.y.redMul(h.redMul(c.redISub(h)).redISub(o.redMul(a)));f=(f=(f=f.redIAdd(f)).redIAdd(f)).redIAdd(f);var l=this.z.redAdd(o).redSqr().redISub(r).redISub(a);return this.curve.jpoint(u,f,l)},d.prototype.mul=function(e,t){return e=new n(e,t),this.curve._wnafMul(this,e)},d.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var i=t.redMul(this.z),n=r.redMul(e.z);return 0===this.y.redMul(n).redISub(e.y.redMul(i)).cmpn(0)},d.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var i=e.clone(),n=this.curve.redN.redMul(t);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(n),0===this.x.cmp(r))return!0}},d.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},d.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},480:(e,t,r)=>{"use strict";var i,n=t,s=r(7952),o=r(894),a=r(7011).assert;function c(e){"short"===e.type?this.curve=new o.short(e):"edwards"===e.type?this.curve=new o.edwards(e):this.curve=new o.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function h(e,t){Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:function(){var r=new c(t);return Object.defineProperty(n,e,{configurable:!0,enumerable:!0,value:r}),r}})}n.PresetCurve=c,h("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:s.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),h("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:s.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),h("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:s.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),h("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:s.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),h("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:s.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),h("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["9"]}),h("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{i=r(4011)}catch(e){i=void 0}h("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:s.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",i]})},7447:(e,t,r)=>{"use strict";var i=r(9404),n=r(2723),s=r(7011),o=r(480),a=r(5037),c=s.assert,h=r(1200),d=r(8545);function u(e){if(!(this instanceof u))return new u(e);"string"==typeof e&&(c(Object.prototype.hasOwnProperty.call(o,e),"Unknown curve "+e),e=o[e]),e instanceof o.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=u,u.prototype.keyPair=function(e){return new h(this,e)},u.prototype.keyFromPrivate=function(e,t){return h.fromPrivate(this,e,t)},u.prototype.keyFromPublic=function(e,t){return h.fromPublic(this,e,t)},u.prototype.genKeyPair=function(e){e||(e={});for(var t=new n({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||a(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),s=this.n.sub(new i(2));;){var o=new i(t.generate(r));if(!(o.cmp(s)>0))return o.iaddn(1),this.keyFromPrivate(o)}},u.prototype._truncateToN=function(e,t,r){var n;if(i.isBN(e)||"number"==typeof e)n=(e=new i(e,16)).byteLength();else if("object"==typeof e)n=e.length,e=new i(e,16);else{var s=e.toString();n=s.length+1>>>1,e=new i(s,16)}"number"!=typeof r&&(r=8*n);var o=r-this.n.bitLength();return o>0&&(e=e.ushrn(o)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},u.prototype.sign=function(e,t,r,s){if("object"==typeof r&&(s=r,r=null),s||(s={}),"string"!=typeof e&&"number"!=typeof e&&!i.isBN(e)){c("object"==typeof e&&e&&"number"==typeof e.length,"Expected message to be an array-like, a hex string, or a BN instance"),c(e.length>>>0===e.length);for(var o=0;o<e.length;o++)c((255&e[o])===e[o])}t=this.keyFromPrivate(t,r),e=this._truncateToN(e,!1,s.msgBitLength),c(!e.isNeg(),"Can not sign a negative message");var a=this.n.byteLength(),h=t.getPrivate().toArray("be",a),u=e.toArray("be",a);c(new i(u).eq(e),"Can not sign message");for(var f=new n({hash:this.hash,entropy:h,nonce:u,pers:s.pers,persEnc:s.persEnc||"utf8"}),l=this.n.sub(new i(1)),p=0;;p++){var y=s.k?s.k(p):new i(f.generate(this.n.byteLength()));if(!((y=this._truncateToN(y,!0)).cmpn(1)<=0||y.cmp(l)>=0)){var m=this.g.mul(y);if(!m.isInfinity()){var g=m.getX(),b=g.umod(this.n);if(0!==b.cmpn(0)){var v=y.invm(this.n).mul(b.mul(t.getPrivate()).iadd(e));if(0!==(v=v.umod(this.n)).cmpn(0)){var w=(m.getY().isOdd()?1:0)|(0!==g.cmp(b)?2:0);return s.canonical&&v.cmp(this.nh)>0&&(v=this.n.sub(v),w^=1),new d({r:b,s:v,recoveryParam:w})}}}}}},u.prototype.verify=function(e,t,r,i,n){n||(n={}),e=this._truncateToN(e,!1,n.msgBitLength),r=this.keyFromPublic(r,i);var s=(t=new d(t,"hex")).r,o=t.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a,c=o.invm(this.n),h=c.mul(e).umod(this.n),u=c.mul(s).umod(this.n);return this.curve._maxwellTrick?!(a=this.g.jmulAdd(h,r.getPublic(),u)).isInfinity()&&a.eqXToP(s):!(a=this.g.mulAdd(h,r.getPublic(),u)).isInfinity()&&0===a.getX().umod(this.n).cmp(s)},u.prototype.recoverPubKey=function(e,t,r,n){c((3&r)===r,"The recovery param is more than two bits"),t=new d(t,n);var s=this.n,o=new i(e),a=t.r,h=t.s,u=1&r,f=r>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&f)throw new Error("Unable to find sencond key candinate");a=f?this.curve.pointFromX(a.add(this.curve.n),u):this.curve.pointFromX(a,u);var l=t.r.invm(s),p=s.sub(o).mul(l).umod(s),y=h.mul(l).umod(s);return this.g.mulAdd(p,a,y)},u.prototype.getKeyRecoveryParam=function(e,t,r,i){if(null!==(t=new d(t,i)).recoveryParam)return t.recoveryParam;for(var n=0;n<4;n++){var s;try{s=this.recoverPubKey(e,t,n)}catch(e){continue}if(s.eq(r))return n}throw new Error("Unable to find valid recovery factor")}},1200:(e,t,r)=>{"use strict";var i=r(9404),n=r(7011).assert;function s(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=s,s.fromPublic=function(e,t,r){return t instanceof s?t:new s(e,{pub:t,pubEnc:r})},s.fromPrivate=function(e,t,r){return t instanceof s?t:new s(e,{priv:t,privEnc:r})},s.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},s.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},s.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},s.prototype._importPrivate=function(e,t){this.priv=new i(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},s.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?n(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||n(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},s.prototype.derive=function(e){return e.validate()||n(e.validate(),"public point not validated"),e.mul(this.priv).getX()},s.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},s.prototype.verify=function(e,t,r){return this.ec.verify(e,t,this,void 0,r)},s.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},8545:(e,t,r)=>{"use strict";var i=r(9404),n=r(7011),s=n.assert;function o(e,t){if(e instanceof o)return e;this._importDER(e,t)||(s(e.r&&e.s,"Signature without r or s"),this.r=new i(e.r,16),this.s=new i(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function a(){this.place=0}function c(e,t){var r=e[t.place++];if(!(128&r))return r;var i=15&r;if(0===i||i>4)return!1;if(0===e[t.place])return!1;for(var n=0,s=0,o=t.place;s<i;s++,o++)n<<=8,n|=e[o],n>>>=0;return!(n<=127)&&(t.place=o,n)}function h(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function d(e,t){if(t<128)e.push(t);else{var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}}e.exports=o,o.prototype._importDER=function(e,t){e=n.toArray(e,t);var r=new a;if(48!==e[r.place++])return!1;var s=c(e,r);if(!1===s)return!1;if(s+r.place!==e.length)return!1;if(2!==e[r.place++])return!1;var o=c(e,r);if(!1===o)return!1;if(128&e[r.place])return!1;var h=e.slice(r.place,o+r.place);if(r.place+=o,2!==e[r.place++])return!1;var d=c(e,r);if(!1===d)return!1;if(e.length!==d+r.place)return!1;if(128&e[r.place])return!1;var u=e.slice(r.place,d+r.place);if(0===h[0]){if(!(128&h[1]))return!1;h=h.slice(1)}if(0===u[0]){if(!(128&u[1]))return!1;u=u.slice(1)}return this.r=new i(h),this.s=new i(u),this.recoveryParam=null,!0},o.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=h(t),r=h(r);!(r[0]||128&r[1]);)r=r.slice(1);var i=[2];d(i,t.length),(i=i.concat(t)).push(2),d(i,r.length);var s=i.concat(r),o=[48];return d(o,s.length),o=o.concat(s),n.encode(o,e)}},8650:(e,t,r)=>{"use strict";var i=r(7952),n=r(480),s=r(7011),o=s.assert,a=s.parseBytes,c=r(6661),h=r(220);function d(e){if(o("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof d))return new d(e);e=n[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=i.sha512}e.exports=d,d.prototype.sign=function(e,t){e=a(e);var r=this.keyFromSecret(t),i=this.hashInt(r.messagePrefix(),e),n=this.g.mul(i),s=this.encodePoint(n),o=this.hashInt(s,r.pubBytes(),e).mul(r.priv()),c=i.add(o).umod(this.curve.n);return this.makeSignature({R:n,S:c,Rencoded:s})},d.prototype.verify=function(e,t,r){if(e=a(e),(t=this.makeSignature(t)).S().gte(t.eddsa.curve.n)||t.S().isNeg())return!1;var i=this.keyFromPublic(r),n=this.hashInt(t.Rencoded(),i.pubBytes(),e),s=this.g.mul(t.S());return t.R().add(i.pub().mul(n)).eq(s)},d.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return s.intFromLE(e.digest()).umod(this.curve.n)},d.prototype.keyFromPublic=function(e){return c.fromPublic(this,e)},d.prototype.keyFromSecret=function(e){return c.fromSecret(this,e)},d.prototype.makeSignature=function(e){return e instanceof h?e:new h(this,e)},d.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},d.prototype.decodePoint=function(e){var t=(e=s.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),i=!!(128&e[t]),n=s.intFromLE(r);return this.curve.pointFromY(n,i)},d.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},d.prototype.decodeInt=function(e){return s.intFromLE(e)},d.prototype.isPoint=function(e){return e instanceof this.pointClass}},6661:(e,t,r)=>{"use strict";var i=r(7011),n=i.assert,s=i.parseBytes,o=i.cachedProperty;function a(e,t){this.eddsa=e,this._secret=s(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=s(t.pub)}a.fromPublic=function(e,t){return t instanceof a?t:new a(e,{pub:t})},a.fromSecret=function(e,t){return t instanceof a?t:new a(e,{secret:t})},a.prototype.secret=function(){return this._secret},o(a,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),o(a,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),o(a,"privBytes",(function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,i=t.slice(0,e.encodingLength);return i[0]&=248,i[r]&=127,i[r]|=64,i})),o(a,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),o(a,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),o(a,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),a.prototype.sign=function(e){return n(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},a.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},a.prototype.getSecret=function(e){return n(this._secret,"KeyPair is public only"),i.encode(this.secret(),e)},a.prototype.getPublic=function(e){return i.encode(this.pubBytes(),e)},e.exports=a},220:(e,t,r)=>{"use strict";var i=r(9404),n=r(7011),s=n.assert,o=n.cachedProperty,a=n.parseBytes;function c(e,t){this.eddsa=e,"object"!=typeof t&&(t=a(t)),Array.isArray(t)&&(s(t.length===2*e.encodingLength,"Signature has invalid size"),t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),s(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof i&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}o(c,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),o(c,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),o(c,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),o(c,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),c.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},c.prototype.toHex=function(){return n.encode(this.toBytes(),"hex").toUpperCase()},e.exports=c},4011:e=>{e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},7011:(e,t,r)=>{"use strict";var i=t,n=r(9404),s=r(3349),o=r(4367);i.assert=s,i.toArray=o.toArray,i.zero2=o.zero2,i.toHex=o.toHex,i.encode=o.encode,i.getNAF=function(e,t,r){var i,n=new Array(Math.max(e.bitLength(),r)+1);for(i=0;i<n.length;i+=1)n[i]=0;var s=1<<t+1,o=e.clone();for(i=0;i<n.length;i++){var a,c=o.andln(s-1);o.isOdd()?(a=c>(s>>1)-1?(s>>1)-c:c,o.isubn(a)):a=0,n[i]=a,o.iushrn(1)}return n},i.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var i,n=0,s=0;e.cmpn(-n)>0||t.cmpn(-s)>0;){var o,a,c=e.andln(3)+n&3,h=t.andln(3)+s&3;3===c&&(c=-1),3===h&&(h=-1),o=1&c?3!=(i=e.andln(7)+n&7)&&5!==i||2!==h?c:-c:0,r[0].push(o),a=1&h?3!=(i=t.andln(7)+s&7)&&5!==i||2!==c?h:-h:0,r[1].push(a),2*n===o+1&&(n=1-n),2*s===a+1&&(s=1-s),e.iushrn(1),t.iushrn(1)}return r},i.cachedProperty=function(e,t,r){var i="_"+t;e.prototype[t]=function(){return void 0!==this[i]?this[i]:this[i]=r.call(this)}},i.parseBytes=function(e){return"string"==typeof e?i.toArray(e,"hex"):e},i.intFromLE=function(e){return new n(e,"hex","le")}},655:(e,t,r)=>{"use strict";var i=r(453)("%Object.defineProperty%",!0)||!1;if(i)try{i({},"a",{value:1})}catch(e){i=!1}e.exports=i},1237:e=>{"use strict";e.exports=EvalError},9383:e=>{"use strict";e.exports=Error},9290:e=>{"use strict";e.exports=RangeError},9538:e=>{"use strict";e.exports=ReferenceError},8068:e=>{"use strict";e.exports=SyntaxError},9675:e=>{"use strict";e.exports=TypeError},5345:e=>{"use strict";e.exports=URIError},7007:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}y(e,t,s,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function h(e,t,r,i){var n,s,o,h;if(a(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=c(e))>0&&o.length>n&&!o.warned){o.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=o.length,h=d,console&&console.warn&&console.warn(h)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=d.bind(i);return n.listener=r,i.wrapFn=n,n}function f(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):p(n,n.length)}function l(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function y(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var h=c.length,d=p(c,h);for(r=0;r<h;++r)i(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return h(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return h(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,o;if(a(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},s.prototype.listenerCount=l,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},9353:e=>{"use strict";var t=Object.prototype.toString,r=Math.max,i=function(e,t){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var n=0;n<t.length;n+=1)r[n+e.length]=t[n];return r};e.exports=function(e){var n=this;if("function"!=typeof n||"[object Function]"!==t.apply(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var s,o=function(e){for(var t=[],r=1,i=0;r<e.length;r+=1,i+=1)t[i]=e[r];return t}(arguments),a=r(0,n.length-o.length),c=[],h=0;h<a;h++)c[h]="$"+h;if(s=Function("binder","return function ("+function(e){for(var t="",r=0;r<e.length;r+=1)t+=e[r],r+1<e.length&&(t+=",");return t}(c)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var t=n.apply(this,i(o,arguments));return Object(t)===t?t:this}return n.apply(e,i(o,arguments))})),n.prototype){var d=function(){};d.prototype=n.prototype,s.prototype=new d,d.prototype=null}return s}},6743:(e,t,r)=>{"use strict";var i=r(9353);e.exports=Function.prototype.bind||i},453:(e,t,r)=>{"use strict";var i,n=r(9383),s=r(1237),o=r(9290),a=r(9538),c=r(8068),h=r(9675),d=r(5345),u=Function,f=function(e){try{return u('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var p=function(){throw new h},y=l?function(){try{return p}catch(e){try{return l(arguments,"callee").get}catch(e){return p}}}():p,m=r(4039)(),g=r(24)(),b=Object.getPrototypeOf||(g?function(e){return e.__proto__}:null),v={},w="undefined"!=typeof Uint8Array&&b?b(Uint8Array):i,S={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":m&&b?b([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":s,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":u,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&b?b(b([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&m&&b?b((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":o,"%ReferenceError%":a,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&m&&b?b((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&b?b(""[Symbol.iterator]()):i,"%Symbol%":m?Symbol:i,"%SyntaxError%":c,"%ThrowTypeError%":y,"%TypedArray%":w,"%TypeError%":h,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":d,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet};if(b)try{null.error}catch(e){var _=b(b(e));S["%Error.prototype%"]=_}var x=function e(t){var r;if("%AsyncFunction%"===t)r=f("async function () {}");else if("%GeneratorFunction%"===t)r=f("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=f("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var n=e("%AsyncGenerator%");n&&b&&(r=b(n.prototype))}return S[t]=r,r},k={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},P=r(6743),M=r(9957),E=P.call(Function.call,Array.prototype.concat),I=P.call(Function.apply,Array.prototype.splice),A=P.call(Function.call,String.prototype.replace),T=P.call(Function.call,String.prototype.slice),O=P.call(Function.call,RegExp.prototype.exec),N=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,K=/\\(\\)?/g,C=function(e,t){var r,i=e;if(M(k,i)&&(i="%"+(r=k[i])[0]+"%"),M(S,i)){var n=S[i];if(n===v&&(n=x(i)),void 0===n&&!t)throw new h("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:n}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new h("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new h('"allowMissing" argument must be a boolean');if(null===O(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=T(e,0,1),r=T(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var i=[];return A(e,N,(function(e,t,r,n){i[i.length]=r?A(n,K,"$1"):t||e})),i}(e),i=r.length>0?r[0]:"",n=C("%"+i+"%",t),s=n.name,o=n.value,a=!1,d=n.alias;d&&(i=d[0],I(r,E([0,1],d)));for(var u=1,f=!0;u<r.length;u+=1){var p=r[u],y=T(p,0,1),m=T(p,-1);if(('"'===y||"'"===y||"`"===y||'"'===m||"'"===m||"`"===m)&&y!==m)throw new c("property names with quotes must have matching quotes");if("constructor"!==p&&f||(a=!0),M(S,s="%"+(i+="."+p)+"%"))o=S[s];else if(null!=o){if(!(p in o)){if(!t)throw new h("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=r.length){var g=l(o,p);o=(f=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:o[p]}else f=M(o,p),o=o[p];f&&!a&&(S[s]=o)}}return o}},5795:(e,t,r)=>{"use strict";var i=r(453)("%Object.getOwnPropertyDescriptor%",!0);if(i)try{i([],"length")}catch(e){i=null}e.exports=i},592:(e,t,r)=>{"use strict";var i=r(655),n=function(){return!!i};n.hasArrayLengthDefineBug=function(){if(!i)return null;try{return 1!==i([],"length",{value:1}).length}catch(e){return!0}},e.exports=n},24:e=>{"use strict";var t={__proto__:null,foo:{}},r=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof r)}},4039:(e,t,r)=>{"use strict";var i="undefined"!=typeof Symbol&&Symbol,n=r(1333);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==typeof i("foo")&&"symbol"==typeof Symbol("bar")&&n()}},1333:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(e,t);if(42!==n.value||!0!==n.enumerable)return!1}return!0}},7952:(e,t,r)=>{var i=t;i.utils=r(7426),i.common=r(6166),i.sha=r(6229),i.ripemd=r(6784),i.hmac=r(8948),i.sha1=i.sha.sha1,i.sha256=i.sha.sha256,i.sha224=i.sha.sha224,i.sha384=i.sha.sha384,i.sha512=i.sha.sha512,i.ripemd160=i.ripemd.ripemd160},6166:(e,t,r)=>{"use strict";var i=r(7426),n=r(3349);function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}t.BlockHash=s,s.prototype.update=function(e,t){if(e=i.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=i.join32(e,0,e.length-r,this.endian);for(var n=0;n<e.length;n+=this._delta32)this._update(e,n,n+this._delta32)}return this},s.prototype.digest=function(e){return this.update(this._pad()),n(null===this.pending),this._digest(e)},s.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,i=new Array(r+this.padLength);i[0]=128;for(var n=1;n<r;n++)i[n]=0;if(e<<=3,"big"===this.endian){for(var s=8;s<this.padLength;s++)i[n++]=0;i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=e>>>24&255,i[n++]=e>>>16&255,i[n++]=e>>>8&255,i[n++]=255&e}else for(i[n++]=255&e,i[n++]=e>>>8&255,i[n++]=e>>>16&255,i[n++]=e>>>24&255,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,s=8;s<this.padLength;s++)i[n++]=0;return i}},8948:(e,t,r)=>{"use strict";var i=r(7426),n=r(3349);function s(e,t,r){if(!(this instanceof s))return new s(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(i.toArray(t,r))}e.exports=s,s.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),n(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},s.prototype.update=function(e,t){return this.inner.update(e,t),this},s.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},6784:(e,t,r)=>{"use strict";var i=r(7426),n=r(6166),s=i.rotl32,o=i.sum32,a=i.sum32_3,c=i.sum32_4,h=n.BlockHash;function d(){if(!(this instanceof d))return new d;h.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function u(e,t,r,i){return e<=15?t^r^i:e<=31?t&r|~t&i:e<=47?(t|~r)^i:e<=63?t&i|r&~i:t^(r|~i)}function f(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function l(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}i.inherits(d,h),t.ripemd160=d,d.blockSize=512,d.outSize=160,d.hmacStrength=192,d.padLength=64,d.prototype._update=function(e,t){for(var r=this.h[0],i=this.h[1],n=this.h[2],h=this.h[3],d=this.h[4],b=r,v=i,w=n,S=h,_=d,x=0;x<80;x++){var k=o(s(c(r,u(x,i,n,h),e[p[x]+t],f(x)),m[x]),d);r=d,d=h,h=s(n,10),n=i,i=k,k=o(s(c(b,u(79-x,v,w,S),e[y[x]+t],l(x)),g[x]),_),b=_,_=S,S=s(w,10),w=v,v=k}k=a(this.h[1],n,S),this.h[1]=a(this.h[2],h,_),this.h[2]=a(this.h[3],d,b),this.h[3]=a(this.h[4],r,v),this.h[4]=a(this.h[0],i,w),this.h[0]=k},d.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"little"):i.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],y=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],m=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],g=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},6229:(e,t,r)=>{"use strict";t.sha1=r(3917),t.sha224=r(7714),t.sha256=r(2287),t.sha384=r(1911),t.sha512=r(7766)},3917:(e,t,r)=>{"use strict";var i=r(7426),n=r(6166),s=r(6225),o=i.rotl32,a=i.sum32,c=i.sum32_5,h=s.ft_1,d=n.BlockHash,u=[1518500249,1859775393,2400959708,3395469782];function f(){if(!(this instanceof f))return new f;d.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}i.inherits(f,d),e.exports=f,f.blockSize=512,f.outSize=160,f.hmacStrength=80,f.padLength=64,f.prototype._update=function(e,t){for(var r=this.W,i=0;i<16;i++)r[i]=e[t+i];for(;i<r.length;i++)r[i]=o(r[i-3]^r[i-8]^r[i-14]^r[i-16],1);var n=this.h[0],s=this.h[1],d=this.h[2],f=this.h[3],l=this.h[4];for(i=0;i<r.length;i++){var p=~~(i/20),y=c(o(n,5),h(p,s,d,f),l,r[i],u[p]);l=f,f=d,d=o(s,30),s=n,n=y}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],d),this.h[3]=a(this.h[3],f),this.h[4]=a(this.h[4],l)},f.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},7714:(e,t,r)=>{"use strict";var i=r(7426),n=r(2287);function s(){if(!(this instanceof s))return new s;n.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}i.inherits(s,n),e.exports=s,s.blockSize=512,s.outSize=224,s.hmacStrength=192,s.padLength=64,s.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h.slice(0,7),"big"):i.split32(this.h.slice(0,7),"big")}},2287:(e,t,r)=>{"use strict";var i=r(7426),n=r(6166),s=r(6225),o=r(3349),a=i.sum32,c=i.sum32_4,h=i.sum32_5,d=s.ch32,u=s.maj32,f=s.s0_256,l=s.s1_256,p=s.g0_256,y=s.g1_256,m=n.BlockHash,g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function b(){if(!(this instanceof b))return new b;m.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=g,this.W=new Array(64)}i.inherits(b,m),e.exports=b,b.blockSize=512,b.outSize=256,b.hmacStrength=192,b.padLength=64,b.prototype._update=function(e,t){for(var r=this.W,i=0;i<16;i++)r[i]=e[t+i];for(;i<r.length;i++)r[i]=c(y(r[i-2]),r[i-7],p(r[i-15]),r[i-16]);var n=this.h[0],s=this.h[1],m=this.h[2],g=this.h[3],b=this.h[4],v=this.h[5],w=this.h[6],S=this.h[7];for(o(this.k.length===r.length),i=0;i<r.length;i++){var _=h(S,l(b),d(b,v,w),this.k[i],r[i]),x=a(f(n),u(n,s,m));S=w,w=v,v=b,b=a(g,_),g=m,m=s,s=n,n=a(_,x)}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],m),this.h[3]=a(this.h[3],g),this.h[4]=a(this.h[4],b),this.h[5]=a(this.h[5],v),this.h[6]=a(this.h[6],w),this.h[7]=a(this.h[7],S)},b.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},1911:(e,t,r)=>{"use strict";var i=r(7426),n=r(7766);function s(){if(!(this instanceof s))return new s;n.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}i.inherits(s,n),e.exports=s,s.blockSize=1024,s.outSize=384,s.hmacStrength=192,s.padLength=128,s.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h.slice(0,12),"big"):i.split32(this.h.slice(0,12),"big")}},7766:(e,t,r)=>{"use strict";var i=r(7426),n=r(6166),s=r(3349),o=i.rotr64_hi,a=i.rotr64_lo,c=i.shr64_hi,h=i.shr64_lo,d=i.sum64,u=i.sum64_hi,f=i.sum64_lo,l=i.sum64_4_hi,p=i.sum64_4_lo,y=i.sum64_5_hi,m=i.sum64_5_lo,g=n.BlockHash,b=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function v(){if(!(this instanceof v))return new v;g.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=b,this.W=new Array(160)}function w(e,t,r,i,n){var s=e&r^~e&n;return s<0&&(s+=4294967296),s}function S(e,t,r,i,n,s){var o=t&i^~t&s;return o<0&&(o+=4294967296),o}function _(e,t,r,i,n){var s=e&r^e&n^r&n;return s<0&&(s+=4294967296),s}function x(e,t,r,i,n,s){var o=t&i^t&s^i&s;return o<0&&(o+=4294967296),o}function k(e,t){var r=o(e,t,28)^o(t,e,2)^o(t,e,7);return r<0&&(r+=4294967296),r}function P(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=4294967296),r}function M(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=4294967296),r}function E(e,t){var r=o(e,t,1)^o(e,t,8)^c(e,t,7);return r<0&&(r+=4294967296),r}function I(e,t){var r=a(e,t,1)^a(e,t,8)^h(e,t,7);return r<0&&(r+=4294967296),r}function A(e,t){var r=a(e,t,19)^a(t,e,29)^h(e,t,6);return r<0&&(r+=4294967296),r}i.inherits(v,g),e.exports=v,v.blockSize=1024,v.outSize=512,v.hmacStrength=192,v.padLength=128,v.prototype._prepareBlock=function(e,t){for(var r=this.W,i=0;i<32;i++)r[i]=e[t+i];for(;i<r.length;i+=2){var n=(m=r[i-4],g=r[i-3],b=void 0,(b=o(m,g,19)^o(g,m,29)^c(m,g,6))<0&&(b+=4294967296),b),s=A(r[i-4],r[i-3]),a=r[i-14],h=r[i-13],d=E(r[i-30],r[i-29]),u=I(r[i-30],r[i-29]),f=r[i-32],y=r[i-31];r[i]=l(n,s,a,h,d,u,f,y),r[i+1]=p(n,s,a,h,d,u,f,y)}var m,g,b},v.prototype._update=function(e,t){this._prepareBlock(e,t);var r,i,n,a=this.W,c=this.h[0],h=this.h[1],l=this.h[2],p=this.h[3],g=this.h[4],b=this.h[5],v=this.h[6],E=this.h[7],I=this.h[8],A=this.h[9],T=this.h[10],O=this.h[11],N=this.h[12],K=this.h[13],C=this.h[14],L=this.h[15];s(this.k.length===a.length);for(var R=0;R<a.length;R+=2){var B=C,F=L,D=(n=void 0,(n=o(r=I,i=A,14)^o(r,i,18)^o(i,r,9))<0&&(n+=4294967296),n),U=M(I,A),j=w(I,0,T,0,N),q=S(0,A,0,O,0,K),$=this.k[R],z=this.k[R+1],J=a[R],H=a[R+1],V=y(B,F,D,U,j,q,$,z,J,H),Y=m(B,F,D,U,j,q,$,z,J,H);B=k(c,h),F=P(c,h),D=_(c,0,l,0,g),U=x(0,h,0,p,0,b);var W=u(B,F,D,U),X=f(B,F,D,U);C=N,L=K,N=T,K=O,T=I,O=A,I=u(v,E,V,Y),A=f(E,E,V,Y),v=g,E=b,g=l,b=p,l=c,p=h,c=u(V,Y,W,X),h=f(V,Y,W,X)}d(this.h,0,c,h),d(this.h,2,l,p),d(this.h,4,g,b),d(this.h,6,v,E),d(this.h,8,I,A),d(this.h,10,T,O),d(this.h,12,N,K),d(this.h,14,C,L)},v.prototype._digest=function(e){return"hex"===e?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},6225:(e,t,r)=>{"use strict";var i=r(7426).rotr32;function n(e,t,r){return e&t^~e&r}function s(e,t,r){return e&t^e&r^t&r}function o(e,t,r){return e^t^r}t.ft_1=function(e,t,r,i){return 0===e?n(t,r,i):1===e||3===e?o(t,r,i):2===e?s(t,r,i):void 0},t.ch32=n,t.maj32=s,t.p32=o,t.s0_256=function(e){return i(e,2)^i(e,13)^i(e,22)},t.s1_256=function(e){return i(e,6)^i(e,11)^i(e,25)},t.g0_256=function(e){return i(e,7)^i(e,18)^e>>>3},t.g1_256=function(e){return i(e,17)^i(e,19)^e>>>10}},7426:(e,t,r)=>{"use strict";var i=r(3349),n=r(6698);function s(e,t){return 55296==(64512&e.charCodeAt(t))&&!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1))}function o(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function a(e){return 1===e.length?"0"+e:e}function c(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}t.inherits=n,t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16))}else for(var i=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?r[i++]=o:o<2048?(r[i++]=o>>6|192,r[i++]=63&o|128):s(e,n)?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n)),r[i++]=o>>18|240,r[i++]=o>>12&63|128,r[i++]=o>>6&63|128,r[i++]=63&o|128):(r[i++]=o>>12|224,r[i++]=o>>6&63|128,r[i++]=63&o|128)}else for(n=0;n<e.length;n++)r[n]=0|e[n];return r},t.toHex=function(e){for(var t="",r=0;r<e.length;r++)t+=a(e[r].toString(16));return t},t.htonl=o,t.toHex32=function(e,t){for(var r="",i=0;i<e.length;i++){var n=e[i];"little"===t&&(n=o(n)),r+=c(n.toString(16))}return r},t.zero2=a,t.zero8=c,t.join32=function(e,t,r,n){var s=r-t;i(s%4==0);for(var o=new Array(s/4),a=0,c=t;a<o.length;a++,c+=4){var h;h="big"===n?e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]:e[c+3]<<24|e[c+2]<<16|e[c+1]<<8|e[c],o[a]=h>>>0}return o},t.split32=function(e,t){for(var r=new Array(4*e.length),i=0,n=0;i<e.length;i++,n+=4){var s=e[i];"big"===t?(r[n]=s>>>24,r[n+1]=s>>>16&255,r[n+2]=s>>>8&255,r[n+3]=255&s):(r[n+3]=s>>>24,r[n+2]=s>>>16&255,r[n+1]=s>>>8&255,r[n]=255&s)}return r},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,r){return e+t+r>>>0},t.sum32_4=function(e,t,r,i){return e+t+r+i>>>0},t.sum32_5=function(e,t,r,i,n){return e+t+r+i+n>>>0},t.sum64=function(e,t,r,i){var n=e[t],s=i+e[t+1]>>>0,o=(s<i?1:0)+r+n;e[t]=o>>>0,e[t+1]=s},t.sum64_hi=function(e,t,r,i){return(t+i>>>0<t?1:0)+e+r>>>0},t.sum64_lo=function(e,t,r,i){return t+i>>>0},t.sum64_4_hi=function(e,t,r,i,n,s,o,a){var c=0,h=t;return c+=(h=h+i>>>0)<t?1:0,c+=(h=h+s>>>0)<s?1:0,e+r+n+o+(c+=(h=h+a>>>0)<a?1:0)>>>0},t.sum64_4_lo=function(e,t,r,i,n,s,o,a){return t+i+s+a>>>0},t.sum64_5_hi=function(e,t,r,i,n,s,o,a,c,h){var d=0,u=t;return d+=(u=u+i>>>0)<t?1:0,d+=(u=u+s>>>0)<s?1:0,d+=(u=u+a>>>0)<a?1:0,e+r+n+o+c+(d+=(u=u+h>>>0)<h?1:0)>>>0},t.sum64_5_lo=function(e,t,r,i,n,s,o,a,c,h){return t+i+s+a+h>>>0},t.rotr64_hi=function(e,t,r){return(t<<32-r|e>>>r)>>>0},t.rotr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0},t.shr64_hi=function(e,t,r){return e>>>r},t.shr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0}},9957:(e,t,r)=>{"use strict";var i=Function.prototype.call,n=Object.prototype.hasOwnProperty,s=r(6743);e.exports=s.call(i,n)},2723:(e,t,r)=>{"use strict";var i=r(7952),n=r(4367),s=r(3349);function o(e){if(!(this instanceof o))return new o(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=n.toArray(e.entropy,e.entropyEnc||"hex"),r=n.toArray(e.nonce,e.nonceEnc||"hex"),i=n.toArray(e.pers,e.persEnc||"hex");s(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,i)}e.exports=o,o.prototype._init=function(e,t,r){var i=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var n=0;n<this.V.length;n++)this.K[n]=0,this.V[n]=1;this._update(i),this._reseed=1,this.reseedInterval=281474976710656},o.prototype._hmac=function(){return new i.hmac(this.hash,this.K)},o.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},o.prototype.reseed=function(e,t,r,i){"string"!=typeof t&&(i=r,r=t,t=null),e=n.toArray(e,t),r=n.toArray(r,i),s(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},o.prototype.generate=function(e,t,r,i){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(i=r,r=t,t=null),r&&(r=n.toArray(r,i||"hex"),this._update(r));for(var s=[];s.length<e;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,e);return this._update(r),this._reseed++,n.encode(o,t)}},251:(e,t)=>{t.read=function(e,t,r,i,n){var s,o,a=8*n-i-1,c=(1<<a)-1,h=c>>1,d=-7,u=r?n-1:0,f=r?-1:1,l=e[t+u];for(u+=f,s=l&(1<<-d)-1,l>>=-d,d+=a;d>0;s=256*s+e[t+u],u+=f,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=i;d>0;o=256*o+e[t+u],u+=f,d-=8);if(0===s)s=1-h;else{if(s===c)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,i),s-=h}return(l?-1:1)*o*Math.pow(2,s-i)},t.write=function(e,t,r,i,n,s){var o,a,c,h=8*s-n-1,d=(1<<h)-1,u=d>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,l=i?0:s-1,p=i?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+u>=1?f/c:f*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=d?(a=0,o=d):o+u>=1?(a=(t*c-1)*Math.pow(2,n),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;e[r+l]=255&a,l+=p,a/=256,n-=8);for(o=o<<n|a,h+=n;h>0;e[r+l]=255&o,l+=p,o/=256,h-=8);e[r+l-p]|=128*y}},6698:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},4634:e=>{var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},5473:(e,t,r)=>{"use strict";var i=("undefined"!=typeof JSON?JSON:r(4343)).stringify,n=r(4634),s=r(1189),o=r(487),a=r(8075),c=a("Array.prototype.join"),h=a("Array.prototype.push"),d=function(e,t){for(var r="",i=0;i<e;i+=1)r+=t;return r},u=function(e,t,r){return r};e.exports=function(e){var t=arguments.length>1?arguments[1]:void 0,r=t&&t.space||"";"number"==typeof r&&(r=d(r," "));var a=!!t&&"boolean"==typeof t.cycles&&t.cycles,f=t&&t.replacer?o(t.replacer):u,l="function"==typeof t?t:t&&t.cmp,p=l&&function(e){var t=l.length>2&&function(t){return e[t]};return function(r,i){return l({key:r,value:e[r]},{key:i,value:e[i]},t?{__proto__:null,get:t}:void 0)}},y=[];return function e(t,o,u,l){var m=r?"\n"+d(l,r):"",g=r?": ":":";if(u&&u.toJSON&&"function"==typeof u.toJSON&&(u=u.toJSON()),void 0!==(u=f(t,o,u))){if("object"!=typeof u||null===u)return i(u);if(n(u)){for(var b=[],v=0;v<u.length;v++){var w=e(u,v,u[v],l+1)||i(null);h(b,m+r+w)}return"["+c(b,",")+m+"]"}if(-1!==y.indexOf(u)){if(a)return i("__cycle__");throw new TypeError("Converting circular structure to JSON")}h(y,u);var S=s(u).sort(p&&p(u));for(b=[],v=0;v<S.length;v++){var _=e(u,o=S[v],u[o],l+1);if(_){var x=i(o)+g+_;h(b,m+r+x)}}return y.splice(y.indexOf(u),1),"{"+c(b,",")+m+"}"}}({"":e},"",e,0)}},4343:(e,t,r)=>{"use strict";t.parse=r(5776),t.stringify=r(9086)},5776:e=>{"use strict";var t,r,i,n={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function s(e){throw{name:"SyntaxError",message:e,at:t,text:i}}function o(e){return e&&e!==r&&s("Expected '"+e+"' instead of '"+r+"'"),r=i.charAt(t),t+=1,r}function a(){var e,t="";for("-"===r&&(t="-",o("-"));r>="0"&&r<="9";)t+=r,o();if("."===r)for(t+=".";o()&&r>="0"&&r<="9";)t+=r;if("e"===r||"E"===r)for(t+=r,o(),"-"!==r&&"+"!==r||(t+=r,o());r>="0"&&r<="9";)t+=r,o();return e=Number(t),isFinite(e)||s("Bad number"),e}function c(){var e,t,i,a="";if('"'===r)for(;o();){if('"'===r)return o(),a;if("\\"===r)if(o(),"u"===r){for(i=0,t=0;t<4&&(e=parseInt(o(),16),isFinite(e));t+=1)i=16*i+e;a+=String.fromCharCode(i)}else{if("string"!=typeof n[r])break;a+=n[r]}else a+=r}s("Bad string")}function h(){for(;r&&r<=" ";)o()}function d(){switch(h(),r){case"{":return function(){var e,t={};if("{"===r){if(o("{"),h(),"}"===r)return o("}"),t;for(;r;){if(e=c(),h(),o(":"),Object.prototype.hasOwnProperty.call(t,e)&&s('Duplicate key "'+e+'"'),t[e]=d(),h(),"}"===r)return o("}"),t;o(","),h()}}s("Bad object")}();case"[":return function(){var e=[];if("["===r){if(o("["),h(),"]"===r)return o("]"),e;for(;r;){if(e.push(d()),h(),"]"===r)return o("]"),e;o(","),h()}}s("Bad array")}();case'"':return c();case"-":return a();default:return r>="0"&&r<="9"?a():function(){switch(r){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null;default:s("Unexpected '"+r+"'")}}()}}e.exports=function(e,n){var o;return i=e,t=0,r=" ",o=d(),h(),r&&s("Syntax error"),"function"==typeof n?function e(t,r){var i,s,o=t[r];if(o&&"object"==typeof o)for(i in d)Object.prototype.hasOwnProperty.call(o,i)&&(void 0===(s=e(o,i))?delete o[i]:o[i]=s);return n.call(t,r,o)}({"":o},""):o}},9086:e=>{"use strict";var t,r,i,n=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function o(e){return n.lastIndex=0,n.test(e)?'"'+e.replace(n,(function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function a(e,n){var s,c,h,d,u,f=t,l=n[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof i&&(l=i.call(n,e,l)),typeof l){case"string":return o(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(t+=r,u=[],"[object Array]"===Object.prototype.toString.apply(l)){for(d=l.length,s=0;s<d;s+=1)u[s]=a(s,l)||"null";return h=0===u.length?"[]":t?"[\n"+t+u.join(",\n"+t)+"\n"+f+"]":"["+u.join(",")+"]",t=f,h}if(i&&"object"==typeof i)for(d=i.length,s=0;s<d;s+=1)"string"==typeof(c=i[s])&&(h=a(c,l))&&u.push(o(c)+(t?": ":":")+h);else for(c in l)Object.prototype.hasOwnProperty.call(l,c)&&(h=a(c,l))&&u.push(o(c)+(t?": ":":")+h);return h=0===u.length?"{}":t?"{\n"+t+u.join(",\n"+t)+"\n"+f+"}":"{"+u.join(",")+"}",t=f,h}}e.exports=function(e,n,s){var o;if(t="",r="","number"==typeof s)for(o=0;o<s;o+=1)r+=" ";else"string"==typeof s&&(r=s);if(i=n,n&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw new Error("JSON.stringify");return a("",{"":e})}},3065:function(e,t,r){var i,n;!function(){"use strict";i=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],n={},s=null;function o(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var r=this.getLevel(),n=0;n<i.length;n++){var s=i[n];this[s]=n<r?e:this.methodFactory(s,r,this.name)}if(this.log=this.debug,typeof console===t&&r<this.levels.SILENT)return"No console available for logging"}function h(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,n,s){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&r?a:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}(i)||h.apply(this,arguments)}function u(e,r){var o,a,h,u=this,f="loglevel";function l(){var e;if(typeof window!==t&&f){try{e=window.localStorage[f]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,i=encodeURIComponent(f),n=r.indexOf(i+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n+i.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function p(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?f+=":"+e:"symbol"==typeof e&&(f=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=r||d,u.getLevel=function(){return null!=h?h:null!=a?a:o},u.setLevel=function(e,r){return h=p(e),!1!==r&&function(e){var r=(i[e]||"silent").toUpperCase();if(typeof window!==t&&f){try{return void(window.localStorage[f]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+r+";"}catch(e){}}}(h),c.call(u)},u.setDefaultLevel=function(e){a=p(e),l()||u.setLevel(e,!1)},u.resetLevel=function(){h=null,function(){if(typeof window!==t&&f){try{window.localStorage.removeItem(f)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(s!==u&&(o=p(s.getLevel())),c.call(u),s===u)for(var e in n)n[e].rebuild()},o=p(s?s.getLevel():"WARN");var y=l();null!=y&&(h=p(y)),c.call(u)}(s=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=n[e];return t||(t=n[e]=new u(e,s.methodFactory)),t};var f=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=f),s},s.getLoggers=function(){return n},s.default=s,s},void 0===(n=i.call(t,r,t,e))||(e.exports=n)}()},3349:e=>{function t(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=t,t.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)}},4367:(e,t)=>{"use strict";var r=t;function i(e){return 1===e.length?"0"+e:e}function n(e){for(var t="",r=0;r<e.length;r++)t+=i(e[r].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var i=0;i<e.length;i++)r[i]=0|e[i];return r}if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16));else for(i=0;i<e.length;i++){var n=e.charCodeAt(i),s=n>>8,o=255&n;s?r.push(s,o):r.push(o)}return r},r.zero2=i,r.toHex=n,r.encode=function(e,t){return"hex"===t?n(e):e}},8875:(e,t,r)=>{"use strict";var i;if(!Object.keys){var n=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=r(1093),a=Object.prototype.propertyIsEnumerable,c=!a.call({toString:null},"toString"),h=a.call((function(){}),"prototype"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],u=function(e){var t=e.constructor;return t&&t.prototype===e},f={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},l=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!f["$"+e]&&n.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{u(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();i=function(e){var t=null!==e&&"object"==typeof e,r="[object Function]"===s.call(e),i=o(e),a=t&&"[object String]"===s.call(e),f=[];if(!t&&!r&&!i)throw new TypeError("Object.keys called on a non-object");var p=h&&r;if(a&&e.length>0&&!n.call(e,0))for(var y=0;y<e.length;++y)f.push(String(y));if(i&&e.length>0)for(var m=0;m<e.length;++m)f.push(String(m));else for(var g in e)p&&"prototype"===g||!n.call(e,g)||f.push(String(g));if(c)for(var b=function(e){if("undefined"==typeof window||!l)return u(e);try{return u(e)}catch(e){return!1}}(e),v=0;v<d.length;++v)b&&"constructor"===d[v]||!n.call(e,d[v])||f.push(d[v]);return f}}e.exports=i},1189:(e,t,r)=>{"use strict";var i=Array.prototype.slice,n=r(1093),s=Object.keys,o=s?function(e){return s(e)}:r(8875),a=Object.keys;o.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return n(e)?a(i.call(e)):a(e)})}else Object.keys=o;return Object.keys||o},e.exports=o},1093:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var r=t.call(e),i="[object Arguments]"===r;return i||(i="[object Array]"!==r&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),i}},6897:(e,t,r)=>{"use strict";var i=r(453),n=r(41),s=r(592)(),o=r(5795),a=r(9675),c=i("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||c(t)!==t)throw new a("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],i=!0,h=!0;if("length"in e&&o){var d=o(e,"length");d&&!d.configurable&&(i=!1),d&&!d.writable&&(h=!1)}return(i||h||!r)&&(s?n(e,"length",t,!0,!0):n(e,"length",t)),e}},7998:()=>{},7790:()=>{},3776:()=>{},3693:(e,t,r)=>{var i=r(7736);e.exports=function(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},9045:(e,t,r)=>{var i=r(3738).default;e.exports=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7736:(e,t,r)=>{var i=r(3738).default,n=r(9045);e.exports=function(e){var t=n(e,"string");return"symbol"==i(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},9190:(e,t,r)=>{"use strict";function i(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function n(e,...t){if(!((r=e)instanceof Uint8Array||null!=r&&"object"==typeof r&&"Uint8Array"===r.constructor.name))throw new Error("Uint8Array expected");var r;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function s(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function o(e,t){n(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}r.d(t,{Ay:()=>a,CG:()=>o,ai:()=>i,ee:()=>n,t2:()=>s});const a={number:i,bool:function(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)},bytes:n,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");i(e.outputLen),i(e.blockLen)},exists:s,output:o}},9271:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>u,B4:()=>c,P5:()=>a,WM:()=>h,im:()=>d,lD:()=>o});const i=BigInt(2**32-1),n=BigInt(32);function s(e,t=!1){return t?{h:Number(e&i),l:Number(e>>n&i)}:{h:0|Number(e>>n&i),l:0|Number(e&i)}}function o(e,t=!1){let r=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:o,l:a}=s(e[n],t);[r[n],i[n]]=[o,a]}return[r,i]}const a=(e,t,r)=>e<<r|t>>>32-r,c=(e,t,r)=>t<<r|e>>>32-r,h=(e,t,r)=>t<<r-32|e>>>64-r,d=(e,t,r)=>e<<r-32|t>>>64-r,u={fromBig:s,split:o,toBig:(e,t)=>BigInt(e>>>0)<<n|BigInt(t>>>0),shrSH:(e,t,r)=>e>>>r,shrSL:(e,t,r)=>e<<32-r|t>>>r,rotrSH:(e,t,r)=>e>>>r|t<<32-r,rotrSL:(e,t,r)=>e<<32-r|t>>>r,rotrBH:(e,t,r)=>e<<64-r|t>>>r-32,rotrBL:(e,t,r)=>e>>>r-32|t<<64-r,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:a,rotlSL:c,rotlBH:h,rotlBL:d,add:function(e,t,r,i){const n=(t>>>0)+(i>>>0);return{h:e+r+(n/2**32|0)|0,l:0|n}},add3L:(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),add3H:(e,t,r,i)=>t+r+i+(e/2**32|0)|0,add4L:(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),add4H:(e,t,r,i,n)=>t+r+i+n+(e/2**32|0)|0,add5H:(e,t,r,i,n,s)=>t+r+i+n+s+(e/2**32|0)|0,add5L:(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0)}},2531:(e,t,r)=>{"use strict";r.d(t,{Vw:()=>f,Fc:()=>d,O8:()=>o,qv:()=>c,po:()=>p,Ow:()=>a,ZJ:()=>u,DH:()=>s,ld:()=>l});const i="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;var n=r(9190);const s=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),o=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),a=(e,t)=>e<<32-t|e>>>t,c=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],h=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255;function d(e){for(let t=0;t<e.length;t++)e[t]=h(e[t])}function u(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),(0,n.ee)(e),e}class f{clone(){return this._cloneInto()}}function l(e){const t=t=>e().update(u(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function p(e=32){if(i&&"function"==typeof i.getRandomValues)return i.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}},9463:(e,t,r)=>{"use strict";r.d(t,{So:()=>M});var i=r(9190),n=r(9271),s=r(2531);const o=[],a=[],c=[],h=BigInt(0),d=BigInt(1),u=BigInt(2),f=BigInt(7),l=BigInt(256),p=BigInt(113);for(let e=0,t=d,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],o.push(2*(5*i+r)),a.push((e+1)*(e+2)/2%64);let n=h;for(let e=0;e<7;e++)t=(t<<d^(t>>f)*p)%l,t&u&&(n^=d<<(d<<BigInt(e))-d);c.push(n)}const[y,m]=(0,n.lD)(c,!0),g=(e,t,r)=>r>32?(0,n.WM)(e,t,r):(0,n.P5)(e,t,r),b=(e,t,r)=>r>32?(0,n.im)(e,t,r):(0,n.B4)(e,t,r);class v extends s.Vw{constructor(e,t,r,n=!1,o=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,i.ai)(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,s.DH)(this.state)}keccak(){s.qv||(0,s.Fc)(this.state32),function(e,t=24){const r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const i=(t+8)%10,n=(t+2)%10,s=r[n],o=r[n+1],a=g(s,o,1)^r[i],c=b(s,o,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=a,e[t+r+1]^=c}let t=e[2],n=e[3];for(let r=0;r<24;r++){const i=a[r],s=g(t,n,i),c=b(t,n,i),h=o[r];t=e[h],n=e[h+1],e[h]=s,e[h+1]=c}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=y[i],e[1]^=m[i]}r.fill(0)}(this.state32,this.rounds),s.qv||(0,s.Fc)(this.state32),this.posOut=0,this.pos=0}update(e){(0,i.t2)(this);const{blockLen:t,state:r}=this,n=(e=(0,s.ZJ)(e)).length;for(let i=0;i<n;){const s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,128&t&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,i.t2)(this,!1),(0,i.ee)(e),this.finish();const t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,i.ai)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,i.CG)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new v(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}const w=(e,t,r)=>(0,s.ld)((()=>new v(t,e,r))),S=w(1,144,28),_=w(1,136,32),x=w(1,104,48),k=w(1,72,64);var P=r(651);(0,P.RS)(S);const M=(()=>{const e=(0,P.RS)(_);return e.create=_.create,e})();(0,P.RS)(x),(0,P.RS)(k)},651:(e,t,r)=>{"use strict";r.d(t,{RS:()=>n});var i=r(9190);function n(e){return t=>(i.Ay.bytes(t),e(t))}i.Ay.bool,i.Ay.bytes,(()=>{const e="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,t="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);t&&!e&&t("crypto")})()},7115:(e,t,r)=>{"use strict";r.d(t,{io:()=>ke});var i={};r.r(i),r.d(i,{Decoder:()=>me,Encoder:()=>pe,PacketType:()=>le,protocol:()=>fe});const n=Object.create(null);n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const s=Object.create(null);Object.keys(n).forEach((e=>{s[n[e]]=e}));const o={type:"error",data:"parser error"},a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),c="function"==typeof ArrayBuffer,h=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,d=({type:e,data:t},r,i)=>a&&t instanceof Blob?r?i(t):u(t,i):c&&(t instanceof ArrayBuffer||h(t))?r?i(t):u(new Blob([t]),i):i(n[e]+(t||"")),u=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function f(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let l;const p="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)p["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const y="function"==typeof ArrayBuffer,m=(e,t)=>{if("string"!=typeof e)return{type:"message",data:b(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:g(e.substring(1),t)}:s[r]?e.length>1?{type:s[r],data:e.substring(1)}:{type:s[r]}:o},g=(e,t)=>{if(y){const r=(e=>{let t,r,i,n,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const h=new ArrayBuffer(o),d=new Uint8Array(h);for(t=0;t<a;t+=4)r=p[e.charCodeAt(t)],i=p[e.charCodeAt(t+1)],n=p[e.charCodeAt(t+2)],s=p[e.charCodeAt(t+3)],d[c++]=r<<2|i>>4,d[c++]=(15&i)<<4|n>>2,d[c++]=(3&n)<<6|63&s;return h})(e);return b(r,t)}return{base64:!0,data:e}},b=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,v=String.fromCharCode(30);let w;function S(e){return e.reduce(((e,t)=>e+t.length),0)}function _(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let i=0;for(let n=0;n<t;n++)r[n]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),r}function x(e){if(e)return function(e){for(var t in x.prototype)e[t]=x.prototype[t];return e}(e)}x.prototype.on=x.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},x.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},x.prototype.off=x.prototype.removeListener=x.prototype.removeAllListeners=x.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n=0;n<i.length;n++)if((r=i[n])===t||r.fn===t){i.splice(n,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},x.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(r){i=0;for(var n=(r=r.slice(0)).length;i<n;++i)r[i].apply(this,t)}return this},x.prototype.emitReserved=x.prototype.emit,x.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},x.prototype.hasListeners=function(e){return!!this.listeners(e).length};const k="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function P(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const M=k.setTimeout,E=k.clearTimeout;function I(e,t){t.useNativeTimers?(e.setTimeoutFn=M.bind(k),e.clearTimeoutFn=E.bind(k)):(e.setTimeoutFn=k.setTimeout.bind(k),e.clearTimeoutFn=k.clearTimeout.bind(k))}class A extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class T extends x{constructor(e){super(),this.writable=!1,I(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new A(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=m(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}const O="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),N=64,K={};let C,L=0,R=0;function B(e){let t="";do{t=O[e%N]+t,e=Math.floor(e/N)}while(e>0);return t}function F(){const e=B(+new Date);return e!==C?(L=0,C=e):e+"."+B(L++)}for(;R<N;R++)K[O[R]]=R;let D=!1;try{D="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const U=D;function j(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||U))return new XMLHttpRequest}catch(e){}if(!t)try{return new(k[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function q(){}const $=null!=new j({xdomain:!1}).responseType;class z extends x{constructor(e,t){super(),I(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=P(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const r=this.xhr=new j(t);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{r.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof r.status?r.status:0)}),0))},r.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=z.requestsCount++,z.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=q,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete z.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function J(){for(let e in z.requests)z.requests.hasOwnProperty(e)&&z.requests[e].abort()}z.requestsCount=0,z.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",J):"function"==typeof addEventListener&&addEventListener("onpagehide"in k?"pagehide":"unload",J,!1));const H="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),V=k.WebSocket||k.MozWebSocket;r(8287).hp;const Y="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),W={websocket:class extends T{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Y?{}:P(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Y?new V(e,t,r):t?new V(e,t):new V(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;d(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}i&&H((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=F()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!V}},webtransport:class extends T{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=function(e,t){w||(w=new TextDecoder);const r=[];let i=0,n=-1,s=!1;return new TransformStream({transform(a,c){for(r.push(a);;){if(0===i){if(S(r)<1)break;const e=_(r,1);s=!(128&~e[0]),n=127&e[0],i=n<126?3:126===n?1:2}else if(1===i){if(S(r)<2)break;const e=_(r,2);n=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(S(r)<8)break;const e=_(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){c.enqueue(o);break}n=s*Math.pow(2,32)+t.getUint32(4),i=3}else{if(S(r)<n)break;const e=_(r,n);c.enqueue(m(s?e:w.decode(e),t)),i=0}if(0===n||n>e){c.enqueue(o);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=new TransformStream({transform(e,t){!function(e,t){a&&e.data instanceof Blob?e.data.arrayBuffer().then(f).then(t):c&&(e.data instanceof ArrayBuffer||h(e.data))?t(f(e.data)):d(e,!1,(e=>{l||(l=new TextEncoder),t(l.encode(e))}))}(e,(r=>{const i=r.length;let n;if(i<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,i);else if(i<65536){n=new Uint8Array(3);const e=new DataView(n.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{n=new Uint8Array(9);const e=new DataView(n.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(n[0]|=128),t.enqueue(n),t.enqueue(r)}))}});i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const n=()=>{r.read().then((({done:e,value:t})=>{e||(this.onPacket(t),n())})).catch((e=>{}))};n();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;this.writer.write(r).then((()=>{i&&H((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends T{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port}const t=e&&e.forceBase64;this.supportsBinary=$&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(v),i=[];for(let e=0;e<r.length;e++){const n=m(r[e],t);if(i.push(n),"error"===n.type)break}return i})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,i=new Array(r);let n=0;e.forEach(((e,s)=>{d(e,!1,(e=>{i[s]=e,++n===r&&t(i.join(v))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=F()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new z(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},X=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,G=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Q(e){if(e.length>2e3)throw"URI too long";const t=e,r=e.indexOf("["),i=e.indexOf("]");-1!=r&&-1!=i&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));let n=X.exec(e||""),s={},o=14;for(;o--;)s[G[o]]=n[o]||"";return-1!=r&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(r[t]=i)})),r}(0,s.query),s}class Z extends x{constructor(e,t={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Q(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Q(t.host).host),I(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,i=r.length;e<i;e++){let i=r[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new W[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Z.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;Z.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Z.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function n(){r||(r=!0,h(),t.close(),t=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=t.name,n(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&n()}const h=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",i),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{r||t.open()}),200):t.open()}onOpen(){if(this.readyState="open",Z.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(e+="string"==typeof(t=i)?function(e){let t=0,r=0;for(let i=0,n=e.length;i<n;i++)t=e.charCodeAt(i),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(i++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof r&&(i=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const n={type:e,data:t,options:r};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){Z.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}Z.protocol=4,Z.protocol;const ee="function"==typeof ArrayBuffer,te=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,re=Object.prototype.toString,ie="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===re.call(Blob),ne="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===re.call(File);function se(e){return ee&&(e instanceof ArrayBuffer||te(e))||ie&&e instanceof Blob||ne&&e instanceof File}function oe(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(oe(e[t]))return!0;return!1}if(se(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return oe(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&oe(e[t]))return!0;return!1}function ae(e){const t=[],r=e.data,i=e;return i.data=ce(r,t),i.attachments=t.length,{packet:i,buffers:t}}function ce(e,t){if(!e)return e;if(se(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=ce(e[i],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=ce(e[i],t));return r}return e}function he(e,t){return e.data=de(e.data,t),delete e.attachments,e}function de(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=de(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=de(e[r],t));return e}const ue=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],fe=5;var le;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(le||(le={}));class pe{constructor(e){this.replacer=e}encode(e){return e.type!==le.EVENT&&e.type!==le.ACK||!oe(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===le.EVENT?le.BINARY_EVENT:le.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==le.BINARY_EVENT&&e.type!==le.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ae(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function ye(e){return"[object Object]"===Object.prototype.toString.call(e)}class me extends x{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===le.BINARY_EVENT;r||t.type===le.BINARY_ACK?(t.type=r?le.EVENT:le.ACK,this.reconstructor=new ge(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!se(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===le[r.type])throw new Error("unknown packet type "+r.type);if(r.type===le.BINARY_EVENT||r.type===le.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const n=e.substring(i,t);if(n!=Number(n)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(n)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(i,t)}else r.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!me.isPayloadValid(r.type,i))throw new Error("invalid payload");r.data=i}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case le.CONNECT:return ye(t);case le.DISCONNECT:return void 0===t;case le.CONNECT_ERROR:return"string"==typeof t||ye(t);case le.EVENT:case le.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===ue.indexOf(t[0]));case le.ACK:case le.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ge{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=he(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function be(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const ve=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class we extends x{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[be(e,"open",this.onopen.bind(this)),be(e,"packet",this.onpacket.bind(this)),be(e,"error",this.onerror.bind(this)),be(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(ve.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:le.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,i=t.pop();this._registerAckCallback(e,i),r.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const n=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i),s=(...e)=>{this.io.clearTimeoutFn(n),t.apply(this,e)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...t){return new Promise(((r,i)=>{const n=(e,t)=>e?i(e):r(t);n.withError=!0,t.push(n),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:le.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case le.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case le.EVENT:case le.BINARY_EVENT:this.onevent(e);break;case le.ACK:case le.BINARY_ACK:this.onack(e);break;case le.DISCONNECT:this.ondisconnect();break;case le.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:le.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:le.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Se(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Se.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+r:e-r}return 0|Math.min(e,this.max)},Se.prototype.reset=function(){this.attempts=0},Se.prototype.setMin=function(e){this.ms=e},Se.prototype.setMax=function(e){this.max=e},Se.prototype.setJitter=function(e){this.jitter=e};class _e extends x{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,I(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Se({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||i;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Z(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=be(t,"open",(function(){r.onopen(),e&&e()})),n=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=be(t,"error",n);if(!1!==this._timeout){const e=this._timeout,r=this.setTimeoutFn((()=>{i(),n(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&r.unref(),this.subs.push((()=>{this.clearTimeoutFn(r)}))}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(be(e,"ping",this.onping.bind(this)),be(e,"data",this.ondata.bind(this)),be(e,"error",this.onerror.bind(this)),be(e,"close",this.onclose.bind(this)),be(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){H((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new we(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((()=>{this.clearTimeoutFn(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const xe={};function ke(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let i=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),i=Q(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const n=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+n+":"+i.port+t,i.href=i.protocol+"://"+n+(r&&r.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=r.source,n=r.id,s=r.path,o=xe[n]&&s in xe[n].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new _e(i,t):(xe[n]||(xe[n]=new _e(i,t)),a=xe[n]),r.query&&!t.query&&(t.query=r.queryKey),a.socket(r.path,t)}Object.assign(ke,{Manager:_e,Socket:we,io:ke,connect:ke})},1636:e=>{"use strict";e.exports={rE:"6.6.1"}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var i={};return(()=>{"use strict";r.r(i),r.d(i,{AsyncStorage:()=>I,COREKIT_STATUS:()=>Xr,DELIMITERS:()=>f,ERRORS:()=>l,FIELD_ELEMENT_HEX_LEN:()=>b,FactorKeyTypeShareDescription:()=>u,MAX_FACTORS:()=>v,MemoryStorage:()=>E,SCALAR_LEN:()=>g,SOCIAL_FACTOR_INDEX:()=>p,SOCIAL_TKEY_INDEX:()=>w,TssSecurityQuestion:()=>Wr,TssSecurityQuestionStore:()=>Yr,TssShareType:()=>y,USER_PATH:()=>d,VALID_SHARE_INDICES:()=>m,WEB3AUTH_NETWORK:()=>h,Web3AuthMPCCoreKit:()=>Rs,deriveShareCoefficients:()=>As,ed25519:()=>ps,factorKeyCurve:()=>zr,fraction:()=>ks,generateEd25519Seed:()=>ms,generateFactorKey:()=>gs,generateSessionNonce:()=>Ts,generateTSSEndpoints:()=>bs,getHashedPrivateKey:()=>Ss,getSessionId:()=>Os,keyToMnemonic:()=>ie,lagrangeCoefficient:()=>Ps,lagrangeCoefficients:()=>Ms,log:()=>Cs,makeEthereumSigner:()=>Ks,mnemonicToKey:()=>re,parseToken:()=>ws,randomBytes:()=>ys,sampleEndpoints:()=>xs,scalarBNToBufferSEC1:()=>_s,sigToRSV:()=>Ns,storageAvailable:()=>vs});const e={MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",AQUA:"aqua",CELESTE:"celeste"},t={SAPPHIRE_DEVNET:"sapphire_devnet",SAPPHIRE_MAINNET:"sapphire_mainnet"},n=[],s={[e.AQUA]:{migrationCompleted:!0,networkIdentifier:"aqua",networkMigratedTo:t.SAPPHIRE_MAINNET},[e.CELESTE]:{migrationCompleted:!0,networkIdentifier:"celeste",networkMigratedTo:t.SAPPHIRE_MAINNET},[e.CYAN]:{migrationCompleted:!0,networkIdentifier:"cyan",networkMigratedTo:t.SAPPHIRE_MAINNET},[e.MAINNET]:{migrationCompleted:!0,networkIdentifier:"mainnet",networkMigratedTo:t.SAPPHIRE_MAINNET},[e.TESTNET]:{migrationCompleted:!0,networkIdentifier:"teal",networkMigratedTo:t.SAPPHIRE_DEVNET}},o={[t.SAPPHIRE_MAINNET]:"https://signer.web3auth.io",[t.SAPPHIRE_DEVNET]:"https://signer.web3auth.io",[e.MAINNET]:"https://signer.web3auth.io",[e.TESTNET]:"https://signer.web3auth.io",[e.CYAN]:"https://signer-polygon.web3auth.io",[e.AQUA]:"https://signer-polygon.web3auth.io",[e.CELESTE]:"https://signer-polygon.web3auth.io"},a={[e.MAINNET]:"https://metadata.web3auth.io",[e.TESTNET]:"https://metadata.web3auth.io",[e.CYAN]:"https://metadata.web3auth.io",[e.AQUA]:"https://metadata.web3auth.io",[e.CELESTE]:"https://metadata.web3auth.io"},c={SECP256K1:"secp256k1",ED25519:"ed25519"},h={MAINNET:t.SAPPHIRE_MAINNET,DEVNET:t.SAPPHIRE_DEVNET},d={NEW:"NewAccount",EXISTING:"ExistingAccount",REHYDRATE:"RehydrateAccount",RECOVER:"RecoverAccount"};let u=function(e){return e.HashedShare="hashedShare",e.SecurityQuestions="tssSecurityQuestions",e.DeviceShare="deviceShare",e.SeedPhrase="seedPhrase",e.PasswordShare="passwordShare",e.SocialShare="socialShare",e.Other="Other",e}({});const f={Delimiter1:"",Delimiter2:"",Delimiter3:"",Delimiter4:""},l={TKEY_SHARES_REQUIRED:"required more shares",INVALID_BACKUP_SHARE:"invalid backup share"},p=1;let y=function(e){return e[e.DEVICE=2]="DEVICE",e[e.RECOVERY=3]="RECOVERY",e}({});const m=[y.DEVICE,y.RECOVERY],g=32,b=64,v=10,w=1;function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function _(e,t,r){return(t=function(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class x extends Error{constructor(e,t){super(e,t),_(this,"name",void 0),Object.defineProperty(this,"name",{value:new.target.name,enumerable:!1,configurable:!0}),function(e,t){const{setPrototypeOf:r}=Object;r?r(e,t):e.__proto__=t}(this,new.target.prototype),function(e,t=e.constructor){const{captureStackTrace:r}=Error;r&&r(e,t)}(this)}}class k extends x{constructor(e,t){super(t),_(this,"code",void 0),_(this,"message",void 0),this.code=e,this.message=t||"",Object.defineProperty(this,"name",{value:"TkeyError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class P extends k{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"CoreKitError"})}static fromCode(e,t=""){return new P(e,`${P.messages[e]} ${t}`)}static default(e=""){return new P(1e3,`${P.messages[1e3]} ${e}`)}static chainConfigInvalid(e=""){return P.fromCode(1001,e)}static clientIdInvalid(e=""){return P.fromCode(1002,e)}static storageTypeUnsupported(e=""){return P.fromCode(1003,e)}static oauthLoginUnsupported(e=""){return P.fromCode(1004,e)}static noValidStorageOptionFound(e=""){return P.fromCode(1005,e)}static noDataFoundInStorage(e=""){return P.fromCode(1006,e)}static invalidConfig(e=""){return P.fromCode(1007,e)}static tssLibRequired(e=""){return P.fromCode(1101,e)}static tkeyInstanceUninitialized(e=""){return P.fromCode(1102,e)}static duplicateTssIndex(e=""){return P.fromCode(1103,e)}static nodeDetailsRetrievalFailed(e=""){return P.fromCode(1104,e)}static prefetchValueExceeded(e=""){return P.fromCode(1105,e)}static invalidTorusLoginResponse(e=""){return P.fromCode(1106,e)}static invalidTorusAggregateLoginResponse(e=""){return P.fromCode(1107,e)}static unsupportedRedirectMethod(e=""){return P.fromCode(1108,e)}static postBoxKeyMissing(e=""){return P.fromCode(1109,e)}static tssShareTypeIndexMissing(e=""){return P.fromCode(1110,e)}static tssPublicKeyOrEndpointsMissing(e=""){return P.fromCode(1111,e)}static activeSessionNotFound(e=""){return P.fromCode(1112,e)}static tssNoncesMissing(e=""){return P.fromCode(1113,e)}static tssKeyImportNotAllowed(e=""){return P.fromCode(1114,e)}static factorKeyNotPresent(e=""){return P.fromCode(1201,e)}static factorKeyAlreadyExists(e=""){return P.fromCode(1202,e)}static mfaAlreadyEnabled(e=""){return P.fromCode(1203,e)}static cannotDeleteLastFactor(e=""){return P.fromCode(1204,e)}static factorInUseCannotBeDeleted(e=""){return P.fromCode(1205,e)}static userNotLoggedIn(e=""){return P.fromCode(1206,e)}static providedFactorKeyInvalid(e=""){return P.fromCode(1207,e)}static factorEncsMissing(e=""){return P.fromCode(1208,e)}static noMetadataFound(e=""){return P.fromCode(1209,e)}static newShareIndexInvalid(e=""){return P.fromCode(1210,e)}static maximumFactorsReached(e=""){return P.fromCode(1211,e)}static noMetadataShareFound(e=""){return P.fromCode(1212,e)}static signaturesNotPresent(e=""){return P.fromCode(1213,e)}static factorPubsMissing(e=""){return P.fromCode(1214,e)}static commitChangesBeforeMFA(e=""){return P.fromCode(1301,e)}static mpcCoreKitNotInitialized(e=""){return P.fromCode(1302,e)}}_(P,"messages",{1001:"You must specify a valid eip155 chain configuration in the options.",1002:"You must specify a web3auth clientId.",1003:"Unsupported storage type in this UX mode.",1004:"OAuth login is NOT supported in this UX mode.",1005:"No valid storage option found.",1006:"No data found in storage.",1007:"Invalid config.",1101:"'tssLib' is required when running in this UX mode.",1102:"'tkey' instance has not been initialized.",1103:"Duplicate TSS index found. Ensure that each TSS index is unique.",1104:"Failed to retrieve node details. Please check your network connection and try again.",1105:"The prefetch TSS public keys exceeds the maximum allowed limit of 3.",1106:"Invalid 'TorusLoginResponse' data provided.",1107:"Invalid 'TorusAggregateLoginResponse' data provided.",1108:"Unsupported method type encountered in redirect result.",1109:"OAuthKey not present in state.",1110:"TSS Share Type (Index) not present in state when getting current factor key.",1111:"'tssPubKey' or 'torusNodeTSSEndpoints' are missing.",1112:"No active session found.",1113:"tssNonces not present in metadata when getting tss nonce.",1114:"A TSS key cannot be imported for an existing user who already has a key configured.",1201:"factorKey not present in state when required.",1202:"A factor with the same key already exists.",1203:"MFA is already enabled.",1204:"Cannot delete the last remaining factor as at least one factor is required.",1205:"The factor currently in use cannot be deleted.",1206:"User is not logged in.",1207:"Provided factor key is invalid.",1208:"'factorEncs' mpt [resemt].",1209:"No metadata found for the provided factor key. Consider resetting your account if this error persists.",1210:"The new share index is not valid. It must be one of the valid share indices.",1211:"The maximum number of allowable factors (10) has been reached.",1212:"No metadata share found in the current polynomial.",1213:"No signatures found.",1214:"Factor public keys not present",1301:"The 'CommitChanges' method must be called before enabling MFA.",1302:"The MPC Core Kit is not initialized. Please ensure you call the 'init()' method to initialize the kit properly before attempting any operations."});const M=P;class E{constructor(){_(this,"_store",{})}getItem(e){return this._store[e]||null}setItem(e,t){this._store[e]=t}removeItem(e){delete this._store[e]}clear(){this._store={}}}class I{constructor(e,t){_(this,"storage",void 0),_(this,"_storeKey",void 0),this.storage=t,this._storeKey=e}async toJSON(){const e=await this.storage.getItem(this._storeKey);if(!e)throw M.noDataFoundInStorage(`No data found in storage under key '${this._storeKey}'.`);return e}async resetStore(){const e=await this.getStore();return await this.storage.setItem(this._storeKey,JSON.stringify({})),e}async getStore(){return JSON.parse(await this.storage.getItem(this._storeKey)||"{}")}async get(e){return JSON.parse(await this.storage.getItem(this._storeKey)||"{}")[e]}async set(e,t){const r=JSON.parse(await this.storage.getItem(this._storeKey)||"{}");r[e]=t,await this.storage.setItem(this._storeKey,JSON.stringify(r))}async remove(e){const t=JSON.parse(await this.storage.getItem(this._storeKey)||"{}");delete t[e],await this.storage.setItem(this._storeKey,JSON.stringify(t))}}var A=r(9404),T=r.n(A);const O=["abandon","ability","able","about","above","absent","absorb","abstract","absurd","abuse","access","accident","account","accuse","achieve","acid","acoustic","acquire","across","act","action","actor","actress","actual","adapt","add","addict","address","adjust","admit","adult","advance","advice","aerobic","affair","afford","afraid","again","age","agent","agree","ahead","aim","air","airport","aisle","alarm","album","alcohol","alert","alien","all","alley","allow","almost","alone","alpha","already","also","alter","always","amateur","amazing","among","amount","amused","analyst","anchor","ancient","anger","angle","angry","animal","ankle","announce","annual","another","answer","antenna","antique","anxiety","any","apart","apology","appear","apple","approve","april","arch","arctic","area","arena","argue","arm","armed","armor","army","around","arrange","arrest","arrive","arrow","art","artefact","artist","artwork","ask","aspect","assault","asset","assist","assume","asthma","athlete","atom","attack","attend","attitude","attract","auction","audit","august","aunt","author","auto","autumn","average","avocado","avoid","awake","aware","away","awesome","awful","awkward","axis","baby","bachelor","bacon","badge","bag","balance","balcony","ball","bamboo","banana","banner","bar","barely","bargain","barrel","base","basic","basket","battle","beach","bean","beauty","because","become","beef","before","begin","behave","behind","believe","below","belt","bench","benefit","best","betray","better","between","beyond","bicycle","bid","bike","bind","biology","bird","birth","bitter","black","blade","blame","blanket","blast","bleak","bless","blind","blood","blossom","blouse","blue","blur","blush","board","boat","body","boil","bomb","bone","bonus","book","boost","border","boring","borrow","boss","bottom","bounce","box","boy","bracket","brain","brand","brass","brave","bread","breeze","brick","bridge","brief","bright","bring","brisk","broccoli","broken","bronze","broom","brother","brown","brush","bubble","buddy","budget","buffalo","build","bulb","bulk","bullet","bundle","bunker","burden","burger","burst","bus","business","busy","butter","buyer","buzz","cabbage","cabin","cable","cactus","cage","cake","call","calm","camera","camp","can","canal","cancel","candy","cannon","canoe","canvas","canyon","capable","capital","captain","car","carbon","card","cargo","carpet","carry","cart","case","cash","casino","castle","casual","cat","catalog","catch","category","cattle","caught","cause","caution","cave","ceiling","celery","cement","census","century","cereal","certain","chair","chalk","champion","change","chaos","chapter","charge","chase","chat","cheap","check","cheese","chef","cherry","chest","chicken","chief","child","chimney","choice","choose","chronic","chuckle","chunk","churn","cigar","cinnamon","circle","citizen","city","civil","claim","clap","clarify","claw","clay","clean","clerk","clever","click","client","cliff","climb","clinic","clip","clock","clog","close","cloth","cloud","clown","club","clump","cluster","clutch","coach","coast","coconut","code","coffee","coil","coin","collect","color","column","combine","come","comfort","comic","common","company","concert","conduct","confirm","congress","connect","consider","control","convince","cook","cool","copper","copy","coral","core","corn","correct","cost","cotton","couch","country","couple","course","cousin","cover","coyote","crack","cradle","craft","cram","crane","crash","crater","crawl","crazy","cream","credit","creek","crew","cricket","crime","crisp","critic","crop","cross","crouch","crowd","crucial","cruel","cruise","crumble","crunch","crush","cry","crystal","cube","culture","cup","cupboard","curious","current","curtain","curve","cushion","custom","cute","cycle","dad","damage","damp","dance","danger","daring","dash","daughter","dawn","day","deal","debate","debris","decade","december","decide","decline","decorate","decrease","deer","defense","define","defy","degree","delay","deliver","demand","demise","denial","dentist","deny","depart","depend","deposit","depth","deputy","derive","describe","desert","design","desk","despair","destroy","detail","detect","develop","device","devote","diagram","dial","diamond","diary","dice","diesel","diet","differ","digital","dignity","dilemma","dinner","dinosaur","direct","dirt","disagree","discover","disease","dish","dismiss","disorder","display","distance","divert","divide","divorce","dizzy","doctor","document","dog","doll","dolphin","domain","donate","donkey","donor","door","dose","double","dove","draft","dragon","drama","drastic","draw","dream","dress","drift","drill","drink","drip","drive","drop","drum","dry","duck","dumb","dune","during","dust","dutch","duty","dwarf","dynamic","eager","eagle","early","earn","earth","easily","east","easy","echo","ecology","economy","edge","edit","educate","effort","egg","eight","either","elbow","elder","electric","elegant","element","elephant","elevator","elite","else","embark","embody","embrace","emerge","emotion","employ","empower","empty","enable","enact","end","endless","endorse","enemy","energy","enforce","engage","engine","enhance","enjoy","enlist","enough","enrich","enroll","ensure","enter","entire","entry","envelope","episode","equal","equip","era","erase","erode","erosion","error","erupt","escape","essay","essence","estate","eternal","ethics","evidence","evil","evoke","evolve","exact","example","excess","exchange","excite","exclude","excuse","execute","exercise","exhaust","exhibit","exile","exist","exit","exotic","expand","expect","expire","explain","expose","express","extend","extra","eye","eyebrow","fabric","face","faculty","fade","faint","faith","fall","false","fame","family","famous","fan","fancy","fantasy","farm","fashion","fat","fatal","father","fatigue","fault","favorite","feature","february","federal","fee","feed","feel","female","fence","festival","fetch","fever","few","fiber","fiction","field","figure","file","film","filter","final","find","fine","finger","finish","fire","firm","first","fiscal","fish","fit","fitness","fix","flag","flame","flash","flat","flavor","flee","flight","flip","float","flock","floor","flower","fluid","flush","fly","foam","focus","fog","foil","fold","follow","food","foot","force","forest","forget","fork","fortune","forum","forward","fossil","foster","found","fox","fragile","frame","frequent","fresh","friend","fringe","frog","front","frost","frown","frozen","fruit","fuel","fun","funny","furnace","fury","future","gadget","gain","galaxy","gallery","game","gap","garage","garbage","garden","garlic","garment","gas","gasp","gate","gather","gauge","gaze","general","genius","genre","gentle","genuine","gesture","ghost","giant","gift","giggle","ginger","giraffe","girl","give","glad","glance","glare","glass","glide","glimpse","globe","gloom","glory","glove","glow","glue","goat","goddess","gold","good","goose","gorilla","gospel","gossip","govern","gown","grab","grace","grain","grant","grape","grass","gravity","great","green","grid","grief","grit","grocery","group","grow","grunt","guard","guess","guide","guilt","guitar","gun","gym","habit","hair","half","hammer","hamster","hand","happy","harbor","hard","harsh","harvest","hat","have","hawk","hazard","head","health","heart","heavy","hedgehog","height","hello","helmet","help","hen","hero","hidden","high","hill","hint","hip","hire","history","hobby","hockey","hold","hole","holiday","hollow","home","honey","hood","hope","horn","horror","horse","hospital","host","hotel","hour","hover","hub","huge","human","humble","humor","hundred","hungry","hunt","hurdle","hurry","hurt","husband","hybrid","ice","icon","idea","identify","idle","ignore","ill","illegal","illness","image","imitate","immense","immune","impact","impose","improve","impulse","inch","include","income","increase","index","indicate","indoor","industry","infant","inflict","inform","inhale","inherit","initial","inject","injury","inmate","inner","innocent","input","inquiry","insane","insect","inside","inspire","install","intact","interest","into","invest","invite","involve","iron","island","isolate","issue","item","ivory","jacket","jaguar","jar","jazz","jealous","jeans","jelly","jewel","job","join","joke","journey","joy","judge","juice","jump","jungle","junior","junk","just","kangaroo","keen","keep","ketchup","key","kick","kid","kidney","kind","kingdom","kiss","kit","kitchen","kite","kitten","kiwi","knee","knife","knock","know","lab","label","labor","ladder","lady","lake","lamp","language","laptop","large","later","latin","laugh","laundry","lava","law","lawn","lawsuit","layer","lazy","leader","leaf","learn","leave","lecture","left","leg","legal","legend","leisure","lemon","lend","length","lens","leopard","lesson","letter","level","liar","liberty","library","license","life","lift","light","like","limb","limit","link","lion","liquid","list","little","live","lizard","load","loan","lobster","local","lock","logic","lonely","long","loop","lottery","loud","lounge","love","loyal","lucky","luggage","lumber","lunar","lunch","luxury","lyrics","machine","mad","magic","magnet","maid","mail","main","major","make","mammal","man","manage","mandate","mango","mansion","manual","maple","marble","march","margin","marine","market","marriage","mask","mass","master","match","material","math","matrix","matter","maximum","maze","meadow","mean","measure","meat","mechanic","medal","media","melody","melt","member","memory","mention","menu","mercy","merge","merit","merry","mesh","message","metal","method","middle","midnight","milk","million","mimic","mind","minimum","minor","minute","miracle","mirror","misery","miss","mistake","mix","mixed","mixture","mobile","model","modify","mom","moment","monitor","monkey","monster","month","moon","moral","more","morning","mosquito","mother","motion","motor","mountain","mouse","move","movie","much","muffin","mule","multiply","muscle","museum","mushroom","music","must","mutual","myself","mystery","myth","naive","name","napkin","narrow","nasty","nation","nature","near","neck","need","negative","neglect","neither","nephew","nerve","nest","net","network","neutral","never","news","next","nice","night","noble","noise","nominee","noodle","normal","north","nose","notable","note","nothing","notice","novel","now","nuclear","number","nurse","nut","oak","obey","object","oblige","obscure","observe","obtain","obvious","occur","ocean","october","odor","off","offer","office","often","oil","okay","old","olive","olympic","omit","once","one","onion","online","only","open","opera","opinion","oppose","option","orange","orbit","orchard","order","ordinary","organ","orient","original","orphan","ostrich","other","outdoor","outer","output","outside","oval","oven","over","own","owner","oxygen","oyster","ozone","pact","paddle","page","pair","palace","palm","panda","panel","panic","panther","paper","parade","parent","park","parrot","party","pass","patch","path","patient","patrol","pattern","pause","pave","payment","peace","peanut","pear","peasant","pelican","pen","penalty","pencil","people","pepper","perfect","permit","person","pet","phone","photo","phrase","physical","piano","picnic","picture","piece","pig","pigeon","pill","pilot","pink","pioneer","pipe","pistol","pitch","pizza","place","planet","plastic","plate","play","please","pledge","pluck","plug","plunge","poem","poet","point","polar","pole","police","pond","pony","pool","popular","portion","position","possible","post","potato","pottery","poverty","powder","power","practice","praise","predict","prefer","prepare","present","pretty","prevent","price","pride","primary","print","priority","prison","private","prize","problem","process","produce","profit","program","project","promote","proof","property","prosper","protect","proud","provide","public","pudding","pull","pulp","pulse","pumpkin","punch","pupil","puppy","purchase","purity","purpose","purse","push","put","puzzle","pyramid","quality","quantum","quarter","question","quick","quit","quiz","quote","rabbit","raccoon","race","rack","radar","radio","rail","rain","raise","rally","ramp","ranch","random","range","rapid","rare","rate","rather","raven","raw","razor","ready","real","reason","rebel","rebuild","recall","receive","recipe","record","recycle","reduce","reflect","reform","refuse","region","regret","regular","reject","relax","release","relief","rely","remain","remember","remind","remove","render","renew","rent","reopen","repair","repeat","replace","report","require","rescue","resemble","resist","resource","response","result","retire","retreat","return","reunion","reveal","review","reward","rhythm","rib","ribbon","rice","rich","ride","ridge","rifle","right","rigid","ring","riot","ripple","risk","ritual","rival","river","road","roast","robot","robust","rocket","romance","roof","rookie","room","rose","rotate","rough","round","route","royal","rubber","rude","rug","rule","run","runway","rural","sad","saddle","sadness","safe","sail","salad","salmon","salon","salt","salute","same","sample","sand","satisfy","satoshi","sauce","sausage","save","say","scale","scan","scare","scatter","scene","scheme","school","science","scissors","scorpion","scout","scrap","screen","script","scrub","sea","search","season","seat","second","secret","section","security","seed","seek","segment","select","sell","seminar","senior","sense","sentence","series","service","session","settle","setup","seven","shadow","shaft","shallow","share","shed","shell","sheriff","shield","shift","shine","ship","shiver","shock","shoe","shoot","shop","short","shoulder","shove","shrimp","shrug","shuffle","shy","sibling","sick","side","siege","sight","sign","silent","silk","silly","silver","similar","simple","since","sing","siren","sister","situate","six","size","skate","sketch","ski","skill","skin","skirt","skull","slab","slam","sleep","slender","slice","slide","slight","slim","slogan","slot","slow","slush","small","smart","smile","smoke","smooth","snack","snake","snap","sniff","snow","soap","soccer","social","sock","soda","soft","solar","soldier","solid","solution","solve","someone","song","soon","sorry","sort","soul","sound","soup","source","south","space","spare","spatial","spawn","speak","special","speed","spell","spend","sphere","spice","spider","spike","spin","spirit","split","spoil","sponsor","spoon","sport","spot","spray","spread","spring","spy","square","squeeze","squirrel","stable","stadium","staff","stage","stairs","stamp","stand","start","state","stay","steak","steel","stem","step","stereo","stick","still","sting","stock","stomach","stone","stool","story","stove","strategy","street","strike","strong","struggle","student","stuff","stumble","style","subject","submit","subway","success","such","sudden","suffer","sugar","suggest","suit","summer","sun","sunny","sunset","super","supply","supreme","sure","surface","surge","surprise","surround","survey","suspect","sustain","swallow","swamp","swap","swarm","swear","sweet","swift","swim","swing","switch","sword","symbol","symptom","syrup","system","table","tackle","tag","tail","talent","talk","tank","tape","target","task","taste","tattoo","taxi","teach","team","tell","ten","tenant","tennis","tent","term","test","text","thank","that","theme","then","theory","there","they","thing","this","thought","three","thrive","throw","thumb","thunder","ticket","tide","tiger","tilt","timber","time","tiny","tip","tired","tissue","title","toast","tobacco","today","toddler","toe","together","toilet","token","tomato","tomorrow","tone","tongue","tonight","tool","tooth","top","topic","topple","torch","tornado","tortoise","toss","total","tourist","toward","tower","town","toy","track","trade","traffic","tragic","train","transfer","trap","trash","travel","tray","treat","tree","trend","trial","tribe","trick","trigger","trim","trip","trophy","trouble","truck","true","truly","trumpet","trust","truth","try","tube","tuition","tumble","tuna","tunnel","turkey","turn","turtle","twelve","twenty","twice","twin","twist","two","type","typical","ugly","umbrella","unable","unaware","uncle","uncover","under","undo","unfair","unfold","unhappy","uniform","unique","unit","universe","unknown","unlock","until","unusual","unveil","update","upgrade","uphold","upon","upper","upset","urban","urge","usage","use","used","useful","useless","usual","utility","vacant","vacuum","vague","valid","valley","valve","van","vanish","vapor","various","vast","vault","vehicle","velvet","vendor","venture","venue","verb","verify","version","very","vessel","veteran","viable","vibrant","vicious","victory","video","view","village","vintage","violin","virtual","virus","visa","visit","visual","vital","vivid","vocal","voice","void","volcano","volume","vote","voyage","wage","wagon","wait","walk","wall","walnut","want","warfare","warm","warrior","wash","wasp","waste","water","wave","way","wealth","weapon","wear","weasel","weather","web","wedding","weekend","weird","welcome","west","wet","whale","what","wheat","wheel","when","where","whip","whisper","wide","width","wife","wild","will","win","window","wine","wing","wink","winner","winter","wire","wisdom","wise","wish","witness","wolf","woman","wonder","wood","wool","word","work","world","worry","worth","wrap","wreck","wrestle","wrist","write","wrong","yard","year","yellow","you","young","youth","zebra","zero","zone","zoo"];var N,K=(N=function(e,t){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},N(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),C=function(e){function t(t,r){var i,n,s,o=this.constructor,a=e.call(this,t,r)||this;return Object.defineProperty(a,"name",{value:o.name,enumerable:!1,configurable:!0}),i=a,n=o.prototype,(s=Object.setPrototypeOf)?s(i,n):i.__proto__=n,function(e,t){void 0===t&&(t=e.constructor);var r=Error.captureStackTrace;r&&r(e,t)}(a),a}return K(t,e),t}(Error);class L extends C{constructor(e,t){super(t),_(this,"code",void 0),_(this,"message",void 0),this.code=e,this.message=t||"",Object.defineProperty(this,"name",{value:"TkeyError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class R extends L{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"ShareSerializationError"})}static fromCode(e,t=""){return new R(e,`${R.messages[e]}${t}`)}static default(e=""){return new R(7e3,`${R.messages[7e3]}${e}`)}static typeNotSupported(e=""){return R.fromCode(7010,e)}static invalidEntropy(e=""){return R.fromCode(7011,e)}static invalidChecksum(e=""){return R.fromCode(7012,e)}static invalidMnemonic(e=""){return R.fromCode(7013,e)}}_(R,"messages",{7e3:"Custom",7010:"Type is not supported",7011:"Invalid Entropy",7012:"Invalid Checksum",7013:"Invalid mnemonic"});var B=R,F=r(9190),D=r(2531);const U=(e,t,r)=>e&t^e&r^t&r;class j extends D.Vw{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,D.O8)(this.buffer)}update(e){(0,F.t2)(this);const{view:t,buffer:r,blockLen:i}=this,n=(e=(0,D.ZJ)(e)).length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o!==i)r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(t,0),this.pos=0);else{const t=(0,D.O8)(e);for(;i<=n-s;s+=i)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,F.t2)(this),(0,F.CG)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:n}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let e=s;e<i;e++)t[e]=0;!function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,h=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+h,a,i)}(r,i-8,BigInt(8*this.length),n),this.process(r,0);const o=(0,D.O8)(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,h[e],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:n,destroyed:s,pos:o}=this;return e.length=i,e.pos=o,e.finished=n,e.destroyed=s,i%t&&e.buffer.set(r),e}}const q=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),z=new Uint32Array(64);class J extends j{constructor(){super(64,32,8,!1),this.A=0|$[0],this.B=0|$[1],this.C=0|$[2],this.D=0|$[3],this.E=0|$[4],this.F=0|$[5],this.G=0|$[6],this.H=0|$[7]}get(){const{A:e,B:t,C:r,D:i,E:n,F:s,G:o,H:a}=this;return[e,t,r,i,n,s,o,a]}set(e,t,r,i,n,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)z[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=z[e-15],r=z[e-2],i=(0,D.Ow)(t,7)^(0,D.Ow)(t,18)^t>>>3,n=(0,D.Ow)(r,17)^(0,D.Ow)(r,19)^r>>>10;z[e]=n+z[e-7]+i+z[e-16]|0}let{A:r,B:i,C:n,D:s,E:o,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+((0,D.Ow)(o,6)^(0,D.Ow)(o,11)^(0,D.Ow)(o,25))+((d=o)&a^~d&c)+q[e]+z[e]|0,u=((0,D.Ow)(r,2)^(0,D.Ow)(r,13)^(0,D.Ow)(r,22))+U(r,i,n)|0;h=c,c=a,a=o,o=s+t|0,s=n,n=i,i=r,r=t+u|0}var d;r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(r,i,n,s,o,a,c,h)}roundClean(){z.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const H=(0,D.ld)((()=>new J));var V=r(651);const Y=(0,V.RS)(H);var W=r(8287).hp;function X(e){return parseInt(e,2)}function G(e,t,r){let i=e;for(;i.length<r;)i=t+i;return i}function Q(e){return e.map((e=>G(e.toString(2),"0",8))).join("")}function Z(e){const t=8*e.length/32,r=Y(e);return Q(Array.from(r)).slice(0,t)}class ee{constructor(){_(this,"moduleName",void 0),_(this,"tbSDK",void 0),this.moduleName="shareSerialization"}static serializeMnemonic(e){return function(e,t){let r;if(W.isBuffer(e)||(r=W.from(e,"hex")),r.length<16)throw B.invalidEntropy();if(r.length>32)throw B.invalidEntropy();if(r.length%4!=0)throw B.invalidEntropy();const i=(Q(Array.from(r))+Z(r)).match(/(.{1,11})/g).map((e=>{const r=X(e);return t[r]}));return""===t[0]?i.join(""):i.join(" ")}(e.toString("hex").padStart(64,"0"),O)}static deserializeMnemonic(e){return new(T())(function(e,t){const r=(i=e,(i||"").normalize("NFKD")).split(" ");var i;if(r.length%3!=0)throw B.invalidMnemonic();const n=r.map((e=>{const r=t.indexOf(e);if(-1===r)throw B.invalidMnemonic();return G(r.toString(2),"0",11)})).join(""),s=32*Math.floor(n.length/33),o=n.slice(0,s),a=n.slice(s),c=o.match(/(.{1,8})/g).map(X);if(c.length<16)throw B.invalidEntropy();if(c.length>32)throw B.invalidEntropy();if(c.length%4!=0)throw B.invalidEntropy();const h=W.from(c);if(Z(h)!==a)throw B.invalidChecksum();return h.toString("hex")}(e,O),"hex")}setModuleReferences(e){this.tbSDK=e,this.tbSDK._addShareSerializationMiddleware(this.serialize.bind(this),this.deserialize.bind(this))}async initialize(){}async serialize(e,t){if("mnemonic"===t)return ee.serializeMnemonic(e);throw B.typeNotSupported()}async deserialize(e,t){if("mnemonic"===t)return ee.deserializeMnemonic(e);throw B.typeNotSupported()}}var te=ee;function re(e){return te.deserializeMnemonic(e).toString("hex")}function ie(e){const t=new(T())(e,"hex");return te.serializeMnemonic(t)}function ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const oe=async e=>{const t=e instanceof Error,r="string"==typeof e;let i;if(e&&"object"==typeof e&&"status"in e&&"type"in e){const t=e,r=t.headers.get("content-type");if(r.includes("application/json")){const e=await t.json();i=new Error((null==e?void 0:e.error)||(null==e?void 0:e.message)||JSON.stringify(e))}else i=r.includes("text/plain")?new Error(await t.text()):new Error(`${t.status} ${t.type.toString()} ${t.statusText}`)}else i=r?new Error(e):t?e:new Error("Unknown error");return i};var ae=r(9024),ce=r(6729),he=r.n(ce),de=r(8287).hp;const ue=new ce.ec("secp256k1");async function fe(e,t){const r=await(0,ae.w)(e,t);return{ciphertext:r.ciphertext.toString("hex"),ephemPublicKey:r.ephemPublicKey.toString("hex"),iv:r.iv.toString("hex"),mac:r.mac.toString("hex")}}async function le(e,t){const r={ciphertext:de.from(t.ciphertext,"hex"),ephemPublicKey:de.from(t.ephemPublicKey,"hex"),iv:de.from(t.iv,"hex"),mac:de.from(t.mac,"hex")};return(0,ae.Yc)(e,r)}async function pe(e){return(t=e)&&t.stack&&""!==t.message?e:oe(e);var t}function ye(e){const t=new(T())((0,ae.F_)());return e.find((e=>e.eq(t)))?ye(e):t}const me="KEY_NOT_FOUND",ge="SHARE_DELETED";function be(e){return"0x"===e.slice(0,2)?e.slice(2):e}var ve=r(8287).hp;class we{constructor(e,t){_(this,"x",void 0),_(this,"y",void 0),this.x=new(T())(e,"hex"),this.y=new(T())(t,"hex")}static fromScalar(e,t){const r=t.g.mul(e);return we.fromElliptic(r)}static fromCompressedPub(e){const t=ue.keyFromPublic(e,"hex").getPublic();return new we(t.getX(),t.getY())}static fromJSON(e){const{x:t,y:r}=e;return new we(t,r)}static fromElliptic(e){return e.isInfinity()?new we(null,null):new we(e.getX(),e.getY())}static fromSEC1(e,t){if(2===t.length&&"00"===t){const t=e.g.mul(new(T())(0));return we.fromElliptic(t)}const r=e.keyFromPublic(t,"hex").getPublic();return we.fromElliptic(r)}encode(e){switch(e){case"arr":return ve.concat([ve.from("0x04","hex"),ve.from(this.x.toString("hex"),"hex"),ve.from(this.y.toString("hex"),"hex")]);case"elliptic-compressed":{const e=ue.keyFromPublic({x:this.x.toString("hex"),y:this.y.toString("hex")},"hex");return ve.from(e.getPublic(!0,"hex"))}default:throw new Error("encoding doesnt exist in Point")}}toEllipticPoint(e){return this.isIdentity()?e.g.mul(new(T())(0)):e.keyFromPublic({x:this.x.toString("hex"),y:this.y.toString("hex")},"hex").getPublic()}toSEC1(e,t=!1){if(this.isIdentity())return ve.from("00","hex");const r=this.toEllipticPoint(e);return ve.from(r.encode("hex",t),"hex")}toJSON(){return{x:this.x.toString("hex"),y:this.y.toString("hex")}}isIdentity(){return null===this.x&&null===this.y}equals(e){return this.isIdentity()?e.isIdentity():this.x.eq(e.x)&&this.y.eq(e.y)}}var Se=we;const _e=(e,t)=>{let r=e;if("number"==typeof r&&(r=Array.from({length:r},((e,t)=>t))),t>r.length||t<=0)return[];if(t===r.length)return[r];if(1===t)return r.reduce(((e,t)=>[...e,[t]]),[]);const i=[];let n=[];for(let e=0;e<=r.length-t+1;e+=1){n=_e(r.slice(e+1),t-1);for(let t=0;t<n.length;t+=1)i.push([r[e],...n[t]])}return i};function xe(e){return e.genKeyPair().getPrivate().toString("hex",64)}function ke(e,t,r,i=0){const n=t.map((e=>new(T())(e))),s=new(T())(r),o=new(T())(i);let a=new(T())(1),c=new(T())(1);for(let t=0;t<n.length;t+=1)if(0!==s.cmp(n[t])){let r=o.sub(n[t]);r=r.umod(e.curve.n),a=a.mul(r),a=a.umod(e.curve.n);let i=s.sub(n[t]);i=i.umod(e.curve.n),c=c.mul(i).umod(e.curve.n)}return a.mul(c.invm(e.curve.n)).umod(e.curve.n)}function Pe(e,t,r){if(t.length!==r.length)return null;let i=new(T())(0);for(let n=0;n<t.length;n+=1){let s=new(T())(1),o=new(T())(1);for(let i=0;i<t.length;i+=1)if(n!==i){s=s.mul(r[i].neg()),s=s.umod(e.curve.n);let t=r[n].sub(r[i]);t=t.umod(e.curve.n),o=o.mul(t).umod(e.curve.n)}let a=s.mul(o.invm(e.curve.n)).umod(e.curve.n);a=a.mul(t[n]).umod(e.curve.n),i=i.add(a)}return i.umod(e.curve.n)}function Me(e){return{x:e.x.toString(16,64),y:e.y.toString(16,64)}}function Ee(e,t){const r=t.g.mul(e);return Se.fromElliptic(r)}function Ie(e,t,r){return`${e}${t}${r}`}function Ae(e){return e?`ed25519Seed/${e}`:"ed25519Seed"}let Te=function(e){return e.secp256k1="secp256k1",e.ed25519="ed25519",e}({});var Oe=r(8287).hp;const Ne=e=>ue.keyFromPrivate(e.toString("hex",64)),Ke=e=>{const t=new(T())(e,"hex");return Oe.from(t.toString("hex",64),"hex")},Ce=e=>(0,ae.qb)(Ke(e)),Le=e=>{const t=(e=>ue.keyFromPrivate(e.toString("hex",64)).getPublic())(e);return new Se(t.getX().toString("hex"),t.getY().toString("hex"))};class Re{constructor(e,t){_(this,"shareCommitment",void 0),_(this,"shareIndex",void 0),this.shareCommitment=new Se(t.x,t.y),this.shareIndex=new(T())(e,"hex")}static fromJSON(e){const{shareCommitment:t,shareIndex:r}=e;return new Re(r,Se.fromJSON(t))}toJSON(){return{shareCommitment:this.shareCommitment,shareIndex:this.shareIndex.toString("hex")}}}var Be=Re;class Fe{constructor(e,t){_(this,"share",void 0),_(this,"shareIndex",void 0),this.share=new(T())(t,"hex"),this.shareIndex=new(T())(e,"hex")}static fromJSON(e){const{share:t,shareIndex:r}=e;return new Fe(r,t)}getPublicShare(){return new Be(this.shareIndex,Le(this.share))}toJSON(){return{share:this.share.toString("hex"),shareIndex:this.shareIndex.toString("hex")}}}var De=Fe;class Ue{constructor(e,t){_(this,"share",void 0),_(this,"polynomialID",void 0),this.share=e,this.polynomialID=t}static fromJSON(e){const{share:t,polynomialID:r}=e;return new Ue(De.fromJSON(t),r)}toJSON(){return{share:this.share,polynomialID:this.polynomialID.toString()}}}var je=Ue;const qe="__ONE_KEY_DELETE_NONCE__",$e=(e=>{const t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let r=0;r<58;r++){const i=e.charAt(r),n=i.charCodeAt(0);if(255!==t[n])throw new TypeError(`${i} is ambiguous`);t[n]=r}const r=58,i=e.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let s=0,o=0,a=0;for(;e[s]===i;)o++,s++;const c=(e.length-s)*n+1>>>0,h=new Uint8Array(c);for(;e[s];){let i=t[e.charCodeAt(s)];if(255===i)return;let n=0;for(let e=c-1;(0!==i||n<a)&&-1!==e;e--,n++)i+=r*h[e]>>>0,h[e]=i%256>>>0,i=i/256>>>0;if(0!==i)throw new Error("Non-zero carry");a=n,s++}let d=c-a;for(;d!==c&&0===h[d];)d++;const u=new Uint8Array(o+(c-d));let f=o;for(;d!==c;)u[f++]=h[d++];return u}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let n=0,o=0,a=0;const c=t.length;for(;a!==c&&0===t[a];)a++,n++;const h=(c-a)*s+1>>>0,d=new Uint8Array(h);for(;a!==c;){let e=t[a],i=0;for(let t=h-1;(0!==e||i<o)&&-1!==t;t--,i++)e+=256*d[t]>>>0,d[t]=e%r>>>0,e=e/r>>>0;if(0!==e)throw new Error("Non-zero carry");o=i,a++}let u=h-o;for(;u!==h&&0===d[u];)u++;let f=i.repeat(n);for(;u<h;++u)f+=e.charAt(d[u]);return f},decodeUnsafe:o,decode:function(e){const t=o(e);if(t)return t;throw new Error("Non-base58 character")}}})("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var ze=r(9463),Je=r(9271);const[He,Ve]=(()=>Je.Ay.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),Ye=new Uint32Array(80),We=new Uint32Array(80);class Xe extends j{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:n,Cl:s,Dh:o,Dl:a,Eh:c,El:h,Fh:d,Fl:u,Gh:f,Gl:l,Hh:p,Hl:y}=this;return[e,t,r,i,n,s,o,a,c,h,d,u,f,l,p,y]}set(e,t,r,i,n,s,o,a,c,h,d,u,f,l,p,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|n,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|d,this.Fl=0|u,this.Gh=0|f,this.Gl=0|l,this.Hh=0|p,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)Ye[r]=e.getUint32(t),We[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Ye[e-15],r=0|We[e-15],i=Je.Ay.rotrSH(t,r,1)^Je.Ay.rotrSH(t,r,8)^Je.Ay.shrSH(t,r,7),n=Je.Ay.rotrSL(t,r,1)^Je.Ay.rotrSL(t,r,8)^Je.Ay.shrSL(t,r,7),s=0|Ye[e-2],o=0|We[e-2],a=Je.Ay.rotrSH(s,o,19)^Je.Ay.rotrBH(s,o,61)^Je.Ay.shrSH(s,o,6),c=Je.Ay.rotrSL(s,o,19)^Je.Ay.rotrBL(s,o,61)^Je.Ay.shrSL(s,o,6),h=Je.Ay.add4L(n,c,We[e-7],We[e-16]),d=Je.Ay.add4H(h,i,a,Ye[e-7],Ye[e-16]);Ye[e]=0|d,We[e]=0|h}let{Ah:r,Al:i,Bh:n,Bl:s,Ch:o,Cl:a,Dh:c,Dl:h,Eh:d,El:u,Fh:f,Fl:l,Gh:p,Gl:y,Hh:m,Hl:g}=this;for(let e=0;e<80;e++){const t=Je.Ay.rotrSH(d,u,14)^Je.Ay.rotrSH(d,u,18)^Je.Ay.rotrBH(d,u,41),b=Je.Ay.rotrSL(d,u,14)^Je.Ay.rotrSL(d,u,18)^Je.Ay.rotrBL(d,u,41),v=d&f^~d&p,w=u&l^~u&y,S=Je.Ay.add5L(g,b,w,Ve[e],We[e]),_=Je.Ay.add5H(S,m,t,v,He[e],Ye[e]),x=0|S,k=Je.Ay.rotrSH(r,i,28)^Je.Ay.rotrBH(r,i,34)^Je.Ay.rotrBH(r,i,39),P=Je.Ay.rotrSL(r,i,28)^Je.Ay.rotrBL(r,i,34)^Je.Ay.rotrBL(r,i,39),M=r&n^r&o^n&o,E=i&s^i&a^s&a;m=0|p,g=0|y,p=0|f,y=0|l,f=0|d,l=0|u,({h:d,l:u}=Je.Ay.add(0|c,0|h,0|_,0|x)),c=0|o,h=0|a,o=0|n,a=0|s,n=0|r,s=0|i;const I=Je.Ay.add3L(x,P,E);r=Je.Ay.add3H(I,_,k,M),i=0|I}({h:r,l:i}=Je.Ay.add(0|this.Ah,0|this.Al,0|r,0|i)),({h:n,l:s}=Je.Ay.add(0|this.Bh,0|this.Bl,0|n,0|s)),({h:o,l:a}=Je.Ay.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:h}=Je.Ay.add(0|this.Dh,0|this.Dl,0|c,0|h)),({h:d,l:u}=Je.Ay.add(0|this.Eh,0|this.El,0|d,0|u)),({h:f,l}=Je.Ay.add(0|this.Fh,0|this.Fl,0|f,0|l)),({h:p,l:y}=Je.Ay.add(0|this.Gh,0|this.Gl,0|p,0|y)),({h:m,l:g}=Je.Ay.add(0|this.Hh,0|this.Hl,0|m,0|g)),this.set(r,i,n,s,o,a,c,h,d,u,f,l,p,y,m,g)}roundClean(){Ye.fill(0),We.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Ge=(0,D.ld)((()=>new Xe)),Qe=(0,V.RS)(Ge);var Ze=r(5473),et=r.n(Ze),tt=r(3065),rt=r.n(tt),it=r(8287).hp;function nt(e){return`0x${it.from((0,ze.So)(e)).toString("hex")}`}const st=(e,t)=>e.genKeyPair().getPrivate().toArrayLike(t),ot=e=>{if(e===c.ED25519)return new ce.ec(c.ED25519);if(e===c.SECP256K1)return new ce.ec(c.SECP256K1);throw new Error(`Invalid keyType: ${e}`)},at=(e,t)=>{let r=e;if("number"==typeof r&&(r=Array.from({length:r},((e,t)=>t))),t>r.length||t<=0)return[];if(t===r.length)return[r];if(1===t)return r.reduce(((e,t)=>[...e,[t]]),[]);const i=[];let n=[];for(let e=0;e<=r.length-t+1;e+=1){n=at(r.slice(e+1),t-1);for(let t=0;t<n.length;t+=1)i.push([r[e],...n[t]])}return i},ct=(e,t)=>{const r={};for(let i=0;i<e.length;i+=1){const n=et()(e[i]);if(r[n]=r[n]?r[n]+1:1,r[n]===t)return e[i]}};function ht(e){return{iv:it.from(e.iv).toString("hex"),ephemPublicKey:it.from(e.ephemPublicKey).toString("hex"),ciphertext:it.from(e.ciphertext).toString("hex"),mac:it.from(e.mac).toString("hex"),mode:"AES256"}}function dt(e){return{ephemPublicKey:it.from(e.ephemPublicKey,"hex"),iv:it.from(e.iv,"hex"),mac:it.from(e.mac,"hex")}}function ut(e,t,r){const i=`${t}${r}`,n=nt(it.from(i,"utf8")).slice(2);return new A.BN(n,"hex").mod(new A.BN(e.length)).toNumber()}function ft(e){const t=e.length;if(0===t)return 0;const r=e.sort((function(e,t){return e-t}));return t%2!=0?r[Math.floor(t/2)]:(r[t/2-1]+r[t/2])/2}function lt(e,t){return async function r(i){try{if(i>0){const e=2**i*100;await(n=e,new Promise(((e,t)=>{n>0?setTimeout(e,n):t(new Error("value of milliseconds must be greater than 0"))})))}return await e()}catch(e){const n=e.message;if(i<t&&(["Timed out","Failed to fetch","fetch failed","Load failed","cancelled","NetworkError when attempting to fetch resource.","TypeError: Failed to fetch","TypeError: cancelled","TypeError: NetworkError when attempting to fetch resource."].includes(n)||n&&n.includes("reason: getaddrinfo EAI_AGAIN")))return r(i+1);throw e}var n}(0)}var pt=r(8287).hp;class yt{constructor(e,t,r){_(this,"x",void 0),_(this,"y",void 0),_(this,"ecCurve",void 0),this.x=new(T())(e,"hex"),this.y=new(T())(t,"hex"),this.ecCurve=r}encode(e){switch(e){case"arr":return pt.concat([pt.from("04","hex"),pt.from(this.x.toString("hex",64),"hex"),pt.from(this.y.toString("hex",64),"hex")]);case"elliptic-compressed":{const e=this.ecCurve.keyFromPublic({x:this.x.toString("hex",64),y:this.y.toString("hex",64)},"hex");return pt.from(e.getPublic(!0,"hex"))}default:throw new Error("encoding doesn't exist in Point")}}}class mt{constructor(e,t){_(this,"share",void 0),_(this,"shareIndex",void 0),this.share=new(T())(t,"hex"),this.shareIndex=new(T())(e,"hex")}static fromJSON(e){const{share:t,shareIndex:r}=e;return new mt(r,t)}toJSON(){return{share:this.share.toString("hex",64),shareIndex:this.shareIndex.toString("hex",64)}}}class gt{constructor(e,t){_(this,"polynomial",void 0),_(this,"ecCurve",void 0),this.polynomial=e,this.ecCurve=t}getThreshold(){return this.polynomial.length}polyEval(e){const t=new(T())(e,"hex");let r=new(T())(t),i=new(T())(0);i=i.add(this.polynomial[0]);for(let e=1;e<this.polynomial.length;e+=1){const n=r.mul(this.polynomial[e]);i=i.add(n),i=i.umod(this.ecCurve.n),r=r.mul(new(T())(t)),r=r.umod(this.ecCurve.n)}return i}generateShares(e){const t=e.map((e=>"number"==typeof e?new(T())(e):e instanceof T()?e:"string"==typeof e?new(T())(e,"hex"):e)),r={};for(let e=0;e<t.length;e+=1)r[t[e].toString("hex",64)]=new mt(t[e],this.polyEval(t[e]));return r}}var bt=r(8287).hp;function vt(e,t){const r=new(T())(st(t,bt));return e.find((e=>e.eq(r)))?vt(e,t):r}const wt=e=>Array.from({length:e},(()=>new(T())(0))),St=(e,t,r)=>{let i=wt(r.length);const n=((e,t,r)=>{let i=new(T())(1);const n=r[t].x;for(let s=r.length-1;s>=0;s-=1)if(t!==s){let t=new(T())(n);t=t.sub(r[s].x),t=t.umod(e.n),i=i.mul(t),i=i.umod(e.n)}return i})(e,t,r);if(0===n.cmp(new(T())(0)))throw new Error("Denominator for interpolationPoly is 0");i[0]=n.invm(e.n);for(let n=0;n<r.length;n+=1){const s=wt(r.length);if(n!==t){let o;for(o=n<t?n+1:n,o-=1;o>=0;o-=1){s[o+1]=s[o+1].add(i[o]).umod(e.n);let t=new(T())(r[n].x);t=t.mul(i[o]).umod(e.n),s[o]=s[o].sub(t).umod(e.n)}i=s}}return i};function _t(e,t,r){if(t.length!==r.length)throw new Error("shares not equal to nodeIndex length in lagrangeInterpolation");let i=new(T())(0);for(let n=0;n<t.length;n+=1){let s=new(T())(1),o=new(T())(1);for(let i=0;i<t.length;i+=1)if(n!==i){s=s.mul(r[i].neg()),s=s.umod(e.n);let t=r[n].sub(r[i]);t=t.umod(e.n),o=o.mul(t).umod(e.n)}let a=s.mul(o.invm(e.n)).umod(e.n);a=a.mul(t[n]).umod(e.n),i=i.add(a)}return i.umod(e.n)}function xt(e,t,r,i){let n=r;if(r||(n=vt([new(T())(0)],e)),!i){const r=[n];for(let i=0;i<t;i+=1){const t=vt(r,e);r.push(t)}return new gt(r,e)}if(!Array.isArray(i))throw new Error("deterministic shares in generateRandomPolynomial should be an array");if(i.length>t)throw new Error("deterministicShares in generateRandomPolynomial should be less or equal than degree to ensure an element of randomness");const s={};i.forEach((t=>{s[t.shareIndex.toString("hex",64)]=new yt(t.shareIndex,t.share,e)}));for(let r=0;r<t-i.length;r+=1){let t=vt([new(T())(0)],e);for(;void 0!==s[t.toString("hex",64)];)t=vt([new(T())(0)],e);s[t.toString("hex",64)]=new yt(t,new(T())(st(e,bt)),e)}return s[0]=new yt(new(T())(0),n,e),function(e,t){return((e,t)=>{const r=(e=>{const t=[...e];return t.sort(((e,t)=>e.x.cmp(t.x))),t})(t),i=wt(r.length);for(let t=0;t<r.length;t+=1){const n=St(e,t,r);for(let s=0;s<r.length;s+=1){let o=new(T())(r[t].y);o=o.mul(n[s]),i[s]=i[s].add(o).umod(e.n)}}return new gt(i,e)})(e,t)}(e,Object.values(s))}var kt=r(4744),Pt=r.n(kt);const Mt=rt().getLogger("http-helpers");Mt.setLevel(tt.levels.INFO);let Et="torus-default",It="";function At(e){It=e}function Tt(e){Et=e}async function Ot(e,t){let r=null;try{r=new URL(e)}catch(e){}return fetch(e,t)}function Nt(){const e={};return Et&&(e["x-api-key"]=Et),It&&(e["x-embed-host"]=It),e}function Kt(e){Mt.info(`Response: ${e.status} ${e.statusText}`),Mt.info(`Url: ${e.url}`)}const Ct=async(e,t={},r={})=>{const i={mode:"cors",headers:{}};r.useAPIKey&&(i.headers=se(se({},i.headers),Nt())),t.method="GET";const n=Pt()(i,t),s=await Ot(e,n);if(s.ok){const e=s.headers.get("content-type");return null!=e&&e.includes("application/json")?s.json():s.text()}throw Kt(s),s},Lt=(e,t={},r={},i={})=>{const n={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};i.useAPIKey&&(n.headers=se(se({},n.headers),Nt())),r.method="POST";const s=Pt()(n,r);return i.isUrlEncodedData?(s.body=t,"application/json; charset=utf-8"===s.headers["Content-Type"]&&delete s.headers["Content-Type"]):s.body=JSON.stringify(t),(async(e,t)=>{let r=null;try{const i=new Promise(((t,i)=>{r=setTimeout((()=>{i(new Error(`Timed out in ${e}ms`))}),e)})),n=await Promise.race([t,i]);return null!=r&&clearTimeout(r),n}catch(e){throw null!=r&&clearTimeout(r),e}})(i.timeout||6e4,Ot(e,s).then((e=>{if(i.logTracingHeader&&function(e){const t=e.headers.get("x-web3-correlation-id");t&&Mt.info(`Request tracing with traceID = ${t}`)}(e),e.ok){const t=e.headers.get("content-type");return null!=t&&t.includes("application/json")?e.json():e.text()}throw Kt(e),e})))},Rt=async(e,t={},r={},i={})=>{const n={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};i.useAPIKey&&(n.headers=se(se({},n.headers),Nt())),r.method="PATCH";const s=Pt()(n,r);i.isUrlEncodedData?(s.body=t,"application/json; charset=utf-8"===s.headers["Content-Type"]&&delete s.headers["Content-Type"]):s.body=JSON.stringify(t);const o=await Ot(e,s);if(o.ok){const e=o.headers.get("content-type");return null!=e&&e.includes("application/json")?o.json():o.text()}throw Kt(o),o},Bt=async(e,t={},r={},i={})=>{const n={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};i.useAPIKey&&(n.headers=se(se({},n.headers),Nt())),r.method="PUT";const s=Pt()(n,r);i.isUrlEncodedData?(s.body=t,"application/json; charset=utf-8"===s.headers["Content-Type"]&&delete s.headers["Content-Type"]):s.body=JSON.stringify(t);const o=await Ot(e,s);if(o.ok){const e=o.headers.get("content-type");return null!=e&&e.includes("application/json")?o.json():o.text()}throw Kt(o),o},Ft=(e,t)=>({jsonrpc:"2.0",method:e,id:10,params:t}),Dt="GetPubKeyOrKeyAssign",Ut="https://node-1.node.web3auth.io/metadata",jt="https://node-1.dev-node.web3auth.io/metadata";var qt=r(8287).hp;const $t=e=>{const t=ot(c.SECP256K1),r=e.toString("hex",64),i=(0,ze.So)(qt.from(r,"hex")),n=new(T())(i).umod(t.n).toString("hex",64),s=qt.from(n,"hex"),o=t.keyFromPrivate(s);if(32!==s.length)throw new Error(`Key length must be equal to 32. got ${s.length}`);return{scalar:o.getPrivate(),point:o.getPublic()}};async function zt(e,t,r){const i=dt(e);return await(0,ae.Yc)(r,se(se({},i),{},{ciphertext:qt.from(t,"hex")}))}async function Jt(e,t,r){const i=dt(e);try{return await(0,ae.Yc)(r,se(se({},i),{},{ciphertext:qt.from(t,"hex")}))}catch(e){const n=t.padStart(64,"0");return rt().warn("Failed to decrypt padded share cipher",e),(0,ae.Yc)(r,se(se({},i),{},{ciphertext:qt.from(n,"hex")}))}}async function Ht(e,t,r={}){try{const i=await Lt(`${e}/get`,t,r,{useAPIKey:!0});return i&&i.message?new(T())(i.message,16):new(T())(0)}catch(e){return rt().error("get metadata error",e),new(T())(0)}}function Vt(e,t,r,i,n,s){const o=ot(c.SECP256K1).keyFromPrivate(r.toString("hex",64),"hex"),a={operation:t,timestamp:new(T())(~~(e+Date.now()/1e3)).toString(16)};n&&(a.data=n.toString("hex",64)),a.seed=s||"";const h=o.sign(nt(qt.from(et()(a),"utf8")).slice(2));return{pub_key_X:o.getPublic().getX().toString("hex",64),pub_key_Y:o.getPublic().getY().toString("hex",64),set_data:a,key_type:i,signature:qt.from(h.r.toString(16,64)+h.s.toString(16,64)+new(T())("").toString(16,2),"hex").toString("base64")}}async function Yt(e,t,r,i,n,s,o=!1,a=!0,h=new(T())(0),d="secp256k1",u=""){if(a){let a;const c=o?"getNonce":"getOrSetNonce";return a=s?function(e,t,r,i){const n=e.keyFromPrivate(i.toString("hex",64),"hex"),s={data:r,timestamp:new(T())(~~(t+Date.now()/1e3)).toString(16)},o=n.sign(nt(qt.from(et()(s),"utf8")).slice(2));return{pub_key_X:n.getPublic().getX().toString("hex"),pub_key_Y:n.getPublic().getY().toString("hex"),set_data:s,signature:qt.from(o.r.toString(16,64)+o.s.toString(16,64)+new(T())("").toString(16,2),"hex").toString("base64")}}(t,r,c,s):{pub_key_X:i,pub_key_Y:n,set_data:{data:c}},Lt(`${e}/get_or_set_nonce`,a,void 0,{useAPIKey:!0})}const f=o?"getNonce":"getOrSetNonce";if("getOrSetNonce"===f){if(!s)throw new Error("privKey is required while `getOrSetNonce` for non legacy metadata");if(0===h.cmp(new(T())(0)))throw new Error("nonce is required while `getOrSetNonce` for non legacy metadata");if(d===c.ED25519&&!u)throw new Error("seed is required while `getOrSetNonce` for non legacy metadata for ed25519 key type");const t=Vt(r,f,s,d,h,u);return Lt(`${e}/get_or_set_nonce`,t,void 0,{useAPIKey:!0})}return Lt(`${e}/get_or_set_nonce`,{pub_key_X:i,pub_key_Y:n,set_data:{operation:f},key_type:d},void 0,{useAPIKey:!0})}const Wt=async(e,t)=>{const r=$t(t),i=qt.from(e,"base64").toString("utf-8"),n=JSON.parse(i),s=se(se({},dt(n.metadata)),{},{mode:"AES256"}),o=r.scalar.toArrayLike(qt,"be",32);return await(0,ae.Yc)(o,se(se({},s),{},{ciphertext:qt.from(n.enc_text,"hex")}))};async function Xt(e,r,i,n,o){if(s[e])throw new Error("getOrSetSapphireMetadataNonce should only be used for sapphire networks");let a={pub_key_X:r,pub_key_Y:i,key_type:"secp256k1",set_data:{operation:"getOrSetNonce"}};if(o){const e=ot(c.SECP256K1).keyFromPrivate(o.toString("hex",64),"hex"),t={operation:"getOrSetNonce",timestamp:new(T())(~~(n+Date.now()/1e3)).toString(16)},r=e.sign(nt(qt.from(et()(t),"utf8")).slice(2));a=se(se({},a),{},{set_data:t,signature:qt.from(r.r.toString(16,64)+r.s.toString(16,64)+new(T())("").toString(16,2),"hex").toString("base64")})}const h=e===t.SAPPHIRE_DEVNET?jt:Ut;return Lt(`${h}/get_or_set_nonce`,a,void 0,{useAPIKey:!0})}var Gt=r(8287).hp;function Qt(e){const t=ot(c.ED25519),r=t.g,i=t.n;if(32!==e.length)throw rt().error("Invalid seed for ed25519 key derivation",e.length),new Error("Invalid seed for ed25519 key derivation");const n=Qe(e);if(64!==n.length)throw new Error("Invalid hash length for ed25519 seed");const s=new(T())(((o=Gt.from(n.slice(0,32)))[0]&=248,o[31]&=127,o[31]|=64,o),"le");var o;const a=new(T())(s.umod(i),"le");return{scalar:a,point:r.mul(a)}}function Zt(e){const t=ot(c.ED25519),r=Math.ceil(t.n.bitLength()/8),i=e.getY().toArrayLike(Gt,"le",r);return i[r-1]|=e.getX().isOdd()?128:0,i}function er(e,t){if(e===c.SECP256K1){const e=t.getPublic().encode("hex",!1).slice(2);return function(e){const t=(r=e,r.startsWith("0x")?r.slice(2):r).toLowerCase();var r;const i=Gt.from(t,"utf8"),n=Gt.from((0,ze.So)(i)).toString("hex");let s="0x";for(let e=0;e<t.length;e++)parseInt(n[e],16)>=8?s+=t[e].toUpperCase():s+=t[e];return s}(`0x${nt(Gt.from(e,"hex")).slice(26)}`)}if(e===c.ED25519){const e=Zt(t.getPublic());return $e.encode(e)}throw new Error(`Invalid keyType: ${e}`)}function tr(e,t,r){return er(e,ot(e).keyFromPublic({x:t.toString("hex",64),y:r.toString("hex",64)}))}function rr(e,t){const r=t.toString(16,64);return e.keyFromPrivate(r,"hex").getPublic()}const ir=async(e,t,r,i,n,s)=>{const o=t===c.ED25519?await(async e=>{const t=ot(c.ED25519),r=Qt(e),i=$t(r.scalar),n=await(0,ae.w)(Gt.from(i.point.encodeCompressed("hex"),"hex"),e),s={enc_text:n.ciphertext.toString("hex"),metadata:ht(n),public_key:Zt(r.point).toString("hex")},o=Gt.from(JSON.stringify(s),"utf-8").toString("base64"),a=t.genKeyPair().getPrivate(),h=r.scalar.sub(a).umod(t.n),d=t.keyFromPrivate(h.toArrayLike(Gt)),u=$t(d.getPrivate());return{oAuthKeyScalar:d.getPrivate(),oAuthPubX:d.getPublic().getX(),oAuthPubY:d.getPublic().getY(),SigningPubX:u.point.getX(),SigningPubY:u.point.getY(),metadataNonce:a,metadataSigningKey:u.scalar,encryptedSeed:o,finalUserPubKeyPoint:r.point}})(s):await(async e=>{const t=ot(c.SECP256K1),r=new(T())(e),i=new(T())(st(t,Gt)),n=r.sub(i).umod(t.n),s=t.keyFromPrivate(n.toArrayLike(Gt)),o=s.getPublic(),a=t.keyFromPrivate(r.toString("hex",64),"hex");return{oAuthKeyScalar:s.getPrivate(),oAuthPubX:o.getX(),oAuthPubY:o.getY(),SigningPubX:o.getX(),SigningPubY:o.getY(),metadataNonce:i,encryptedSeed:"",metadataSigningKey:s.getPrivate(),finalUserPubKeyPoint:a.getPublic()}})(s),{metadataNonce:a,oAuthKeyScalar:h,encryptedSeed:d,metadataSigningKey:u}=o,f=1+~~(n.length/2)-1,l=[];for(const e of i)l.push(new(T())(e));const p=e.keyFromPrivate(h.toString("hex",64),"hex").getPublic(),y=xt(e,f,h).generateShares(l),m=Vt(r,"getOrSetNonce",u,t,a,d),g=Gt.from(et()(m.set_data),"utf8").toString("base64"),b=[],v=[];for(let e=0;e<l.length;e++){const t=y[l[e].toString("hex",64)].toJSON();if(!n[e])throw new Error(`Missing node pub key for node index: ${l[e].toString("hex",64)}`);const r=new ce.ec("secp256k1").keyFromPublic({x:n[e].X,y:n[e].Y});v.push((0,ae.w)(Gt.from(r.getPublic().encodeCompressed("hex"),"hex"),Gt.from(t.share.padStart(64,"0"),"hex")))}const w=await Promise.all(v);for(let e=0;e<l.length;e+=1){const r=y[l[e].toString("hex",64)].toJSON(),i=ht(w[e]),n={encrypted_seed:o.encryptedSeed,final_user_point:o.finalUserPubKeyPoint,oauth_pub_key_x:p.getX().toString("hex"),oauth_pub_key_y:p.getY().toString("hex"),signing_pub_key_x:o.SigningPubX.toString("hex"),signing_pub_key_y:o.SigningPubY.toString("hex"),encrypted_share:i.ciphertext,encrypted_share_metadata:i,node_index:Number.parseInt(r.shareIndex,16),key_type:t,nonce_data:g,nonce_signature:m.signature};b.push(n)}return b};async function nr(e){return(0,D.po)(e)}class sr extends L{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"CoreError"})}static fromCode(e,t=""){return new sr(e,`${sr.messages[e]} ${t}`)}static default(e=""){return new sr(1e3,`${sr.messages[1e3]} ${e}`)}static metadataUndefined(e=""){return sr.fromCode(1101,e)}static delete1OutOf1OnlyManualSync(e=""){return sr.fromCode(1601,e)}static metadataGetFailed(e=""){return sr.fromCode(1102,e)}static metadataPostFailed(e=""){return sr.fromCode(1103,e)}static tkeyStoreInvalid(e=""){return sr.fromCode(1201,e)}static tkeyEncryptionFailed(e=""){return sr.fromCode(1202,e)}static tkeyDecryptionFailed(e=""){return sr.fromCode(1203,e)}static privateKeyUnavailable(e=""){return sr.fromCode(1301,e)}static unableToReconstruct(e=""){return sr.fromCode(1302,e)}static incorrectReconstruction(e=""){return sr.fromCode(1303,e)}static encryptedShareStoreUnavailable(e=""){return sr.fromCode(1306,e)}static acquireLockFailed(e=""){return sr.fromCode(1401,e)}static releaseLockFailed(e=""){return sr.fromCode(1402,e)}static privKeyUnavailable(e=""){return sr.fromCode(1501,e)}static metadataPubKeyUnavailable(e=""){return sr.fromCode(1502,e)}static authMetadataGetUnavailable(e=""){return sr.fromCode(1503,e)}static authMetadataSetUnavailable(e=""){return sr.fromCode(1504,e)}}_(sr,"messages",{1e3:"Custom",1001:"Unable to delete service provider share",1002:"Wrong share index",1003:"Unable to updateSDK",1101:"metadata not found, SDK likely not initialized",1102:"getMetadata errored",1103:"setMetadata errored",1104:"previouslyFetchedCloudMetadata provided in initialization is outdated",1105:"previouslyFetchedCloudMetadata.nonce should never be higher than the latestShareDetails, please contact support",1201:"Invalid tkeyStore",1202:"Encryption failed",1203:"Decryption failed",1301:"Private key not available. Please reconstruct key first",1302:"Unable to reconstruct",1303:"reconstructed key is not pub key",1304:"Share found in unexpected polynomial",1305:"Input is not supported",1306:"no encrypted share store for share exists",1307:"Share doesn't exist",1308:"Share was deleted",1401:"Unable to acquire lock",1402:"Unable to release lock",1501:"privkey unavailable",1502:"metadata pubkey unavailable",1503:"getAuthMetadata errored",1504:"setAuthMetadata errored",1601:"delete1OutOf1 requires manualSync=true"});var or=sr;class ar{constructor(e){_(this,"polynomialCommitments",void 0),_(this,"polynomialId",void 0),this.polynomialCommitments=e}static fromJSON(e){const t=e.polynomialCommitments.map((e=>Se.fromJSON(e)));return new ar(t)}getThreshold(){return this.polynomialCommitments.length}getPolynomialID(){let e="";for(let t=0;t<this.polynomialCommitments.length;t+=1){let r=this.polynomialCommitments[t].encode("elliptic-compressed").toString();0!==t&&(r=`|${r}`),e+=r}return this.polynomialId=e,this.polynomialId}toJSON(){return{polynomialCommitments:this.polynomialCommitments}}}var cr=ar;class hr{constructor(e){_(this,"polynomial",void 0),_(this,"publicPolynomial",void 0),this.polynomial=e}static fromJSON(e){const{polynomial:t}=e;return new hr(t.map((e=>new(T())(e,"hex"))))}getThreshold(){return this.polynomial.length}polyEval(e){const t=new(T())(e,"hex");let r=new(T())(t),i=new(T())(0);i=i.add(this.polynomial[0]);for(let e=1;e<this.polynomial.length;e+=1){const n=r.mul(this.polynomial[e]);i=i.add(n),i=i.umod(ue.curve.n),r=r.mul(new(T())(t)),r=r.umod(ue.curve.n)}return i}generateShares(e){const t=e.map((e=>"number"==typeof e?new(T())(e):e instanceof T()?e:"string"==typeof e?new(T())(e,"hex"):e)),r={};for(let e=0;e<t.length;e+=1)r[t[e].toString("hex")]=new De(t[e],this.polyEval(t[e]));return r}getPublicPolynomial(){const e=[];for(let t=0;t<this.polynomial.length;t+=1)e.push(Le(this.polynomial[t]));return this.publicPolynomial=new cr(e),this.publicPolynomial}getPolynomialID(){return this.publicPolynomial.polynomialId}toJSON(){return{polynomial:this.polynomial.map((e=>e.toString("hex")))}}}var dr=hr;function ur(){return ue.genKeyPair().getPrivate()}const fr=e=>Array.from({length:e},(()=>new(T())(0))),lr=(e,t)=>{let r=fr(t.length);const i=((e,t)=>{let r=new(T())(1);const i=t[e].x;for(let n=t.length-1;n>=0;n-=1)if(e!==n){let e=new(T())(i);e=e.sub(t[n].x),e=e.umod(ue.curve.n),r=r.mul(e),r=r.umod(ue.curve.n)}return r})(e,t);if(0===i.cmp(new(T())(0)))throw or.default("Denominator for interpolationPoly is 0");r[0]=i.invm(ue.curve.n);for(let i=0;i<t.length;i+=1){const n=fr(t.length);if(i!==e){let s;for(s=i<e?i+1:i,s-=1;s>=0;s-=1){n[s+1]=n[s+1].add(r[s]),n[s+1]=n[s+1].umod(ue.curve.n);let e=new(T())(t[i].x);e=e.mul(r[s]),e=e.umod(ue.curve.n),n[s]=n[s].sub(e),n[s]=n[s].umod(ue.curve.n)}r=n}}return r},pr=e=>{const t=(e=>{const t=[...e];return t.sort(((e,t)=>e.x.cmp(t.x))),t})(e),r=fr(t.length);for(let e=0;e<t.length;e+=1){const i=lr(e,t);for(let n=0;n<t.length;n+=1){let s=new(T())(t[e].y);s=s.mul(i[n]),r[n]=r[n].add(s),r[n]=r[n].umod(ue.curve.n)}}return new dr(r)};function yr(e){return pr(e)}function mr(e,t,r){let i=t;if(t||(i=ye([new(T())(0)])),!r){const t=[i];for(let r=0;r<e;r+=1){const e=ye(t);t.push(e)}return new dr(t)}if(!Array.isArray(r))throw or.default("deterministic shares in generateRandomPolynomial should be an array");if(r.length>e)throw or.default("deterministicShares in generateRandomPolynomial should be less or equal than degree to ensure an element of randomness");const n={};r.forEach((e=>{n[e.shareIndex.toString("hex")]=new Se(e.shareIndex,e.share)}));for(let t=0;t<e-r.length;t+=1){let e=ye([new(T())(0)]);for(;void 0!==n[e.toString("hex")];)e=ye([new(T())(0)]);n[e.toString("hex")]=new Se(e,ur())}return n[0]=new Se(new(T())(0),i),yr(Object.values(n))}function gr(e,t){const r=[];for(let t=0;t<e.length;t+=1){const i=ue.keyFromPublic({x:e[t].x.toString("hex"),y:e[t].y.toString("hex")},"");r.push(i.getPublic())}let i=r[0];for(let e=1;e<r.length;e+=1){const n=t.pow(new(T())(e)).umod(ue.n),s=r[e].mul(n);i=i.add(s)}return new Se(i.getX(),i.getY())}class br{constructor(e){_(this,"pubKey",void 0),_(this,"publicPolynomials",void 0),_(this,"publicShares",void 0),_(this,"polyIDList",void 0),_(this,"generalStore",void 0),_(this,"tkeyStore",void 0),_(this,"scopedStore",void 0),_(this,"nonce",void 0),_(this,"tssKeyTypes",void 0),_(this,"tssNonces",void 0),_(this,"tssPolyCommits",void 0),_(this,"factorPubs",void 0),_(this,"factorEncs",void 0),this.publicPolynomials={},this.publicShares={},this.generalStore={},this.tkeyStore={},this.scopedStore={},this.pubKey=e,this.polyIDList=[],this.nonce=0,this.tssKeyTypes={},this.tssPolyCommits={},this.tssNonces={},this.factorPubs={},this.factorEncs={}}static fromJSON(e){const{pubKey:t,polyIDList:r,generalStore:i,tkeyStore:n,scopedStore:s,nonce:o,tssKeyTypes:a,tssPolyCommits:c,tssNonces:h,factorPubs:d,factorEncs:u}=e,f=Se.fromSEC1(ue,t),l=new br(f),p=[];if(i&&(l.generalStore=i),n&&(l.tkeyStore=n),s&&(l.scopedStore=s),o&&(l.nonce=o),a){l.tssKeyTypes={};for(const e in a)l.tssKeyTypes[e]=a[e]}if(c){l.tssPolyCommits={};for(const e in c)l.tssPolyCommits[e]=c[e].map((e=>new Se(e.x,e.y)))}if(h){l.tssNonces={};for(const e in h)l.tssNonces[e]=h[e]}if(d){l.factorPubs={};for(const e in d)l.factorPubs[e]=d[e].map((e=>new Se(e.x,e.y)))}u&&(l.factorEncs=u);for(let e=0;e<r.length;e+=1){const t=r[e].split("|"),i=t.findIndex((e=>"0x0"===e)),n=t.slice(0,i),s=t.slice(i+1,t.length),o=n.join("|"),a=[];n.forEach((e=>{a.push(Se.fromCompressedPub(e))}));const c=new cr(a);l.publicPolynomials[o]=c,p.push([o,s])}return l.polyIDList=p,l}getShareIndexesForPolynomial(e){const t=this.polyIDList.filter((t=>t[0]===e));if(t.length<1)throw or.default("there is no matching polyID");if(t.length>1)throw or.default("there is more than one matching polyID");return t[0][1]}getLatestPublicPolynomial(){return this.publicPolynomials[this.polyIDList[this.polyIDList.length-1][0]]}addPublicShare(e,t){e in this.publicShares||(this.publicShares[e]={}),this.publicShares[e][t.shareIndex.toString("hex")]=t}setGeneralStoreDomain(e,t){this.generalStore[e]=t}getGeneralStoreDomain(e){return this.generalStore[e]}deleteGeneralStoreDomain(e){delete this.generalStore[e]}setTkeyStoreDomain(e,t){this.tkeyStore[e]=t}getTkeyStoreDomain(e){return this.tkeyStore[e]}addFromPolynomialAndShares(e,t){const r=e.getPublicPolynomial(),i=r.getPolynomialID();this.publicPolynomials[i]=r;const n=[];if(Array.isArray(t))for(let e=0;e<t.length;e+=1)this.addPublicShare(r.getPolynomialID(),t[e].getPublicShare()),n.push(t[e].shareIndex.toString("hex"));else for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(this.addPublicShare(r.getPolynomialID(),t[e].getPublicShare()),n.push(t[e].shareIndex.toString("hex")));this.polyIDList.push([i,n])}setScopedStore(e,t){this.scopedStore[e]=t}async getEncryptedShare(e){const t=e.share.getPublicShare(),r=this.scopedStore.encryptedShares;if(!r)throw or.encryptedShareStoreUnavailable(`${e}`);const i=r[t.shareCommitment.x.toString("hex")];if(!i)throw or.encryptedShareStoreUnavailable(`${e}`);const n=await le(Ke(e.share.share),i);return je.fromJSON(JSON.parse(n.toString()))}getShareDescription(){return this.getGeneralStoreDomain("shareDescriptions")}addShareDescription(e,t){const r=this.getGeneralStoreDomain("shareDescriptions")||{};r[e]?r[e].push(t):r[e]=[t],this.setGeneralStoreDomain("shareDescriptions",r)}deleteShareDescription(e,t){const r=this.getGeneralStoreDomain("shareDescriptions"),i=r[e].indexOf(t);if(!(i>-1))throw or.default(`No share description found for the given shareIndex: ${e} \n        and description: ${t}`);r[e].splice(i,1)}updateShareDescription(e,t,r){const i=this.getGeneralStoreDomain("shareDescriptions"),n=i[e].indexOf(t);if(!(n>-1))throw or.default(`No share description found for the given shareIndex:\n        ${e} and description: ${t}`);i[e][n]=r}shareToShareStore(e){const t=Le(e);for(let r=this.polyIDList.length-1;r>=0;r-=1){const i=this.polyIDList[r][0];for(let n=0;n<this.polyIDList[r][1].length;n+=1){const s=this.polyIDList[r][1][n];let o;if(this.publicShares[i]&&this.publicShares[i][s]&&(o=this.publicShares[i][s]),o||(o=new Be(s,gr(this.publicPolynomials[i].polynomialCommitments,new(T())(s,"hex")))),o.shareCommitment.x.eq(t.x)&&o.shareCommitment.y.eq(t.y)){const t=new De(o.shareIndex,e);return new je(t,i)}}}throw or.fromCode(1307)}clone(){return br.fromJSON(JSON.parse(et()(this)))}toJSON(){const e=[];for(let t=0;t<this.polyIDList.length;t+=1){const r=this.polyIDList[t][0],i=this.polyIDList[t][1].sort(((e,t)=>new(T())(e,"hex").cmp(new(T())(t,"hex")))),n=r.split("|").concat("0x0").concat(...i).join("|");e.push(n)}return se(se(se(se(se({pubKey:this.pubKey.toSEC1(ue,!0).toString("hex"),polyIDList:e,scopedStore:this.scopedStore,generalStore:this.generalStore,tkeyStore:this.tkeyStore,nonce:this.nonce},this.tssKeyTypes&&{tssKeyTypes:this.tssKeyTypes}),this.tssNonces&&{tssNonces:this.tssNonces}),this.tssPolyCommits&&{tssPolyCommits:this.tssPolyCommits}),this.factorPubs&&{factorPubs:this.factorPubs}),this.factorEncs&&{factorEncs:this.factorEncs})}updateTSSData(e){const{tssKeyType:t,tssTag:r,tssNonce:i,tssPolyCommits:n,factorPubs:s,factorEncs:o}=e;t&&(this.tssKeyTypes[r]=t),void 0!==i&&(this.tssNonces[r]=i),n&&(this.tssPolyCommits[r]=n),s&&(this.factorPubs[r]=s),o&&(this.factorEncs[r]=o)}}var vr=br,wr=r(8287).hp;class Sr{constructor(e,t){_(this,"metadata",void 0),_(this,"privKey",void 0),this.metadata=e,this.privKey=t}static fromJSON(e){const{data:t,sig:r}=e;if(!t)throw or.metadataUndefined();const i=vr.fromJSON(t);if(!i.pubKey)throw or.metadataPubKeyUnavailable();if(!ue.keyFromPublic(i.pubKey.toSEC1(ue)).verify(be(nt(wr.from(et()(t),"utf8"))),r))throw or.default("Signature not valid for returning metadata");return new Sr(i)}toJSON(){const e=this.metadata;if(!this.privKey)throw or.privKeyUnavailable();return{data:e,sig:Ne(this.privKey).sign(be(nt(wr.from(et()(e),"utf8")))).toDER("hex")}}}var _r=Sr,xr=r(8287).hp;const kr="ed25519Seed";class Pr{constructor(e){_(this,"modules",void 0),_(this,"enableLogging",void 0),_(this,"serviceProvider",void 0),_(this,"storageLayer",void 0),_(this,"shares",void 0),_(this,"lastFetchedCloudMetadata",void 0),_(this,"metadata",void 0),_(this,"manualSync",void 0),_(this,"_localMetadataTransitions",void 0),_(this,"_refreshMiddleware",void 0),_(this,"_reconstructKeyMiddleware",void 0),_(this,"_shareSerializationMiddleware",void 0),_(this,"storeDeviceShare",void 0),_(this,"haveWriteMetadataLock",void 0),_(this,"serverTimeOffset",0),_(this,"privKey",void 0),_(this,"_ed25519Seed",void 0);const{enableLogging:t=!1,modules:r={},serviceProvider:i,storageLayer:n,manualSync:s=!1,serverTimeOffset:o}=e||{};this.enableLogging=t,this.serviceProvider=i,this.storageLayer=n,this.modules=r,this.shares={},this.privKey=void 0,this.manualSync=s,this._refreshMiddleware={},this._reconstructKeyMiddleware={},this._shareSerializationMiddleware=void 0,this.storeDeviceShare=void 0,this._localMetadataTransitions=[[],[]],this.setModuleReferences(),this.haveWriteMetadataLock="",this.serverTimeOffset=o}get secp256k1Key(){return void 0!==this.privKey?this.privKey:null}get ed25519Key(){return void 0!==this._ed25519Seed?this._ed25519Seed:null}set secp256k1Key(e){this.privKey=e}set ed25519Key(e){this._ed25519Seed=e}static async fromJSON(e,t){const{enableLogging:r,privKey:i,metadata:n,shares:s,_localMetadataTransitions:o,manualSync:a,lastFetchedCloudMetadata:c,serverTimeOffset:h}=e,{storageLayer:d,serviceProvider:u,modules:f}=t,l=new Pr({enableLogging:r,storageLayer:d,serviceProvider:u,modules:f,manualSync:a,serverTimeOffset:h});i&&(l.privKey=new(T())(i,"hex"));for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e)){const t=s[e];for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const r=t[e];t[e]=je.fromJSON(r)}}l.shares=s;const p=Object.keys(JSON.parse(et()(new _r(new vr(new Se("0","0")),new(T())("0","hex"))))),y=Object.keys(JSON.parse(et()(new je(new De("0","0"),"")))),m={message:"Sample message",dateAdded:Date.now()},g=Object.keys(m),b=[],v=[];if(o[0].forEach(((e,t)=>{e?b.push(new(T())(e,"hex")):b.push(void 0);const r=Object.keys(o[1][t]);if(r.length===p.length&&r.every((e=>p.includes(e)))){const e=_r.fromJSON(o[1][t]);e.privKey=i,v.push(e)}else if(r.length===y.length&&r.every((e=>y.includes(e))))v.push(je.fromJSON(o[1][t]));else{if(r.length!==g.length||!r.every((e=>g.includes(e))))throw or.default("fromJSON failed. Could not deserialise _localMetadataTransitions");v.push(o[1][t])}})),n||c){let e,t,r;if("0"===l.serviceProvider.postboxKey.toString("hex")){const e=vr.fromJSON(c).getLatestPublicPolynomial().getPolynomialID(),t=Object.keys(s[e]),i=t[Math.floor(Math.random()*(t.length-1))];t.length>=1&&(r=s[e][i])}n&&(e=vr.fromJSON(n)),c&&(t=vr.fromJSON(c)),await l.initialize({neverInitializeNewKey:!0,transitionMetadata:e,previouslyFetchedCloudMetadata:t,previousLocalMetadataTransitions:[b,v],withShare:r})}else await l.initialize({neverInitializeNewKey:!0});return l}getStorageLayer(){return this.storageLayer}getMetadata(){if(void 0!==this.metadata)return this.metadata;throw or.metadataUndefined()}async initialize(e){const t=e||{};if(t.delete1OutOf1&&!this.manualSync)throw or.delete1OutOf1OnlyManualSync();const{withShare:r,importKey:i,importEd25519Seed:n,neverInitializeNewKey:s,transitionMetadata:o,previouslyFetchedCloudMetadata:a,previousLocalMetadataTransitions:c}=t,h=c&&c[0].length>0&&c[1].length>0,d=o&&h,u=d&&void 0===a;let f,l,p,y;if(r instanceof je)f=r;else if("object"==typeof r)f=je.fromJSON(r);else{if(r)throw or.default("Input is not supported");{const e=u,r=u?c:void 0,o=await this.getGenericMetadataWithTransitionStates({serviceProvider:this.serviceProvider,includeLocalMetadataTransitions:e,_localMetadataTransitions:r,fromJSONConstructor:{fromJSON:e=>e}});if(o.message===me){if(s)throw or.default("key has not been generated yet");if(!this.serviceProvider.migratableKey||i||n)await this._initializeNewKey({initializeModules:!0,importedKey:i,delete1OutOf1:t.delete1OutOf1,importEd25519Seed:n});else{const e=this.manualSync;this.manualSync=!0,await this._initializeNewKey({initializeModules:!0,importedKey:this.serviceProvider.migratableKey,delete1OutOf1:!0}),e||await this.syncLocalMetadataTransitions(),this.manualSync=e}return this.getKeyDetails()}f=je.fromJSON(o)}}try{y=await this.catchupToLatestShare({shareStore:f})}catch(e){const t=e;if(1503!==t.code||!d)throw t}if(d&&!u){if(a.nonce<y.shareMetadata.nonce)throw or.fromCode(1104);if(a.nonce>y.shareMetadata.nonce)throw or.fromCode(1105);p=a}else p=y?y.shareMetadata.clone():void 0;d?(l=o,this._localMetadataTransitions=c):l=y.shareMetadata,this.lastFetchedCloudMetadata=p,this.metadata=l;const m=y?y.latestShare:f;if(this.inputShareStore(m),n&&this.getEd25519PublicKey())throw or.default("Ed25119 key already exists");return await this.initializeModules(),this.getKeyDetails()}async catchupToLatestShare(e){const{shareStore:t,polyID:r,includeLocalMetadataTransitions:i}=e;let n;try{n=await this.getAuthMetadata({privKey:t.share.share,includeLocalMetadataTransitions:i})}catch(e){const t=e;if(t&&1308===t.code)throw t;const r=await pe(t);throw or.authMetadataGetUnavailable(`, ${r.message}`)}try{if(r&&t.polynomialID===r)return{latestShare:t,shareMetadata:n};const e=await n.getEncryptedShare(t);return await this.catchupToLatestShare({shareStore:e,polyID:r,includeLocalMetadataTransitions:i})}catch(e){const r=e;if(r&&1308===r.code)throw r;return{latestShare:t,shareMetadata:n}}}async reconstructKey(e=!0){if(!this.metadata)throw or.metadataUndefined();const t=this.metadata.getLatestPublicPolynomial(),r=t.getThreshold(),i=t.getPolynomialID();let n=r;const s=this.metadata.getShareIndexesForPolynomial(i),o={};for(let e=0;e<s.length;e+=1)o[s[e]]=!0;const a=[];for(let e=this.metadata.polyIDList.length-1;e>=0&&n>0;e-=1){const t=this.shares[this.metadata.polyIDList[e][0]];if(t){const e=Object.keys(t);for(let r=0;r<e.length&&n>0;r+=1)if(e[r]in o){const s=t[e[r]];if(s.polynomialID===i)a.push(s);else{const e=await this.catchupToLatestShare({shareStore:s,polyID:i,includeLocalMetadataTransitions:!0});if(e.latestShare.polynomialID!==i)throw new or(1304,"Share found in unexpected polynomial");a.push(e.latestShare)}delete o[e[r]],n-=1}}}if(a.forEach((e=>{this.inputShareStore(e)})),n>0)throw or.unableToReconstruct(` require ${r} but have ${r-n}`);const c=Object.keys(this.shares[i]),h=[],d=[];for(let e=0;e<r;e+=1)h.push(this.shares[i][c[e]].share.share),d.push(this.shares[i][c[e]].share.shareIndex);const u=function(e,t){if(e.length!==t.length)throw or.default("shares not equal to nodeIndex length in lagrangeInterpolation");let r=new(T())(0);for(let i=0;i<e.length;i+=1){let n=new(T())(1),s=new(T())(1);for(let r=0;r<e.length;r+=1)if(i!==r){n=n.mul(t[r].neg()),n=n.umod(ue.curve.n);let e=t[i].sub(t[r]);e=e.umod(ue.curve.n),s=s.mul(e).umod(ue.curve.n)}let o=n.mul(s.invm(ue.curve.n)).umod(ue.curve.n);o=o.mul(e[i]).umod(ue.curve.n),r=r.add(o)}return r.umod(ue.curve.n)}(h,d),f=Le(u);if(0!==this.metadata.pubKey.x.cmp(f.x))throw or.incorrectReconstruction();this.secp256k1Key=u;const l={allKeys:[u]};if(e&&Object.keys(this._reconstructKeyMiddleware).length>0&&await Promise.all(Object.keys(this._reconstructKeyMiddleware).map((async e=>{if(Object.prototype.hasOwnProperty.call(this._reconstructKeyMiddleware,e)){const t=await this._reconstructKeyMiddleware[e]();l[e]=t,l.allKeys.push(...t)}}))),this.getEd25519PublicKey()){const e=await this.retrieveEd25519Seed();if(!e)throw or.default("Ed25519 seed not found");this._ed25519Seed=e}return se({secp256k1Key:u,ed25519Seed:this._ed25519Seed},l)}reconstructLatestPoly(){if(!this.metadata)throw or.metadataUndefined();const e=this.metadata.getLatestPublicPolynomial(),t=e.getPolynomialID(),r=e.getThreshold(),i=[],n=Object.keys(this.shares[t]);if(n.length<r)throw or.unableToReconstruct("not enough shares to reconstruct poly");if(new Set(n).size!==n.length)throw or.default("share indexes should be unique");for(let e=0;e<r;e+=1)i.push(new Se(new(T())(n[e],"hex"),this.shares[t][n[e]].share.share));return yr(i)}async deleteShare(e){if(!this.metadata)throw or.metadataUndefined();if(!this.privKey)throw or.privateKeyUnavailable();const t=new(T())(e,"hex"),r=this.outputShareStore(t);if(0===t.cmp(new(T())("1","hex")))throw new or(1001,"Unable to delete service provider share");const i=this.metadata.getLatestPublicPolynomial(),n=i.getPolynomialID(),s=this.metadata.getShareIndexesForPolynomial(n),o=[];if(s.forEach((e=>{const r=new(T())(e,"hex");0!==r.cmp(t)&&o.push(r.toString("hex"))})),s.length===o.length)throw or.default("Share index does not exist in latest polynomial");if(o.length<i.getThreshold())throw or.default(`Minimum ${i.getThreshold()} shares are required for tkey. Unable to delete share`);const a=(await this._refreshShares(i.getThreshold(),[...o],n)).shareStores;return await this.addLocalMetadataTransitions({input:[{message:ge,dateAdded:Date.now()}],privKey:[r.share.share]}),{newShareStores:a}}async generateNewShare(){if(!this.metadata)throw or.metadataUndefined();if(!this.secp256k1Key)throw or.privateKeyUnavailable();const e=this.metadata.getLatestPublicPolynomial(),t=e.getPolynomialID(),r=this.metadata.getShareIndexesForPolynomial(t),i=r.map((e=>new(T())(e,"hex"))),n=new(T())(ye(i));return{newShareStores:(await this._refreshShares(e.getThreshold(),[...r,n.toString("hex")],t)).shareStores,newShareIndex:n}}getEd25519PublicKey(){if(!this.metadata)throw or.metadataUndefined();const e=this.metadata.getGeneralStoreDomain(kr);return null==e?void 0:e.publicKey}async retrieveEd25519Seed(){if(!this.metadata)throw or.metadataUndefined();if(!this.privKey)throw or.privateKeyUnavailable();const e=this.metadata.getGeneralStoreDomain(kr),t=await this.decrypt(e.message);return this._ed25519Seed=t,t}async addLocalMetadataTransitions(e){const{privKey:t,input:r}=e;this._localMetadataTransitions[0]=[...this._localMetadataTransitions[0],...t],this._localMetadataTransitions[1]=[...this._localMetadataTransitions[1],...r],this.manualSync||await this.syncLocalMetadataTransitions()}async syncLocalMetadataTransitions(){if(!this.metadata)throw or.metadataUndefined();if(!(Array.isArray(this._localMetadataTransitions[0])&&this._localMetadataTransitions[0].length>0))return;let e=!1;this.lastFetchedCloudMetadata&&(await this.acquireWriteMetadataLock(),e=!0);try{await this.storageLayer.setMetadataStream({input:this._localMetadataTransitions[1],privKey:this._localMetadataTransitions[0],serviceProvider:this.serviceProvider}),this._localMetadataTransitions=[[],[]],this.lastFetchedCloudMetadata=this.metadata.clone()}catch(e){const t=await pe(e);throw or.metadataPostFailed(t.message)}finally{e&&await this.releaseWriteMetadataLock()}}async readMetadata(e){return this.storageLayer.getMetadata({privKey:e})}async updateSDK(e){const t=new Pr({enableLogging:this.enableLogging,modules:this.modules,serviceProvider:this.serviceProvider,storageLayer:this.storageLayer,manualSync:this.manualSync});try{await t.initialize({neverInitializeNewKey:!0,withShare:e&&e.withShare})}catch(e){throw or.fromCode(1103,`${e.message}`)}const r=t.metadata.polyIDList;let i;Object.keys(this.shares).forEach((e=>{r.find((t=>t[0]===e))?i=e:delete this.shares[e]}));const n=Object.keys(this.shares[i]).map((e=>t.inputShareStoreSafe(this.outputShareStore(e,i))));return await Promise.all(n),t}inputShareStore(e){let t;if(e instanceof je)t=e;else{if("object"!=typeof e)throw or.default("can only add type ShareStore into shares");t=je.fromJSON(e)}t.polynomialID in this.shares||(this.shares[t.polynomialID]={}),this.shares[t.polynomialID][t.share.shareIndex.toString("hex")]=t}async inputShareStoreSafe(e,t=!1){if(!this.metadata)throw or.metadataUndefined();let r;if(e instanceof je)r=e;else{if("object"!=typeof e)throw or.default("can only add type ShareStore into shares");r=je.fromJSON(e)}const i=this.metadata.getLatestPublicPolynomial().getPolynomialID();if(r.polynomialID!==i){const e=await this.catchupToLatestShare({shareStore:r,includeLocalMetadataTransitions:!0});if(!e.shareMetadata.polyIDList.find((e=>e[0]===i)))throw or.fromCode(1307);if(i!==e.latestShare.polynomialID){if(!t)throw or.default(`TKey SDK metadata seems to be outdated because shareIndex: ${e.latestShare.share.shareIndex.toString("hex")} has a more recent metadata. Please call updateSDK first`);this.metadata=e.shareMetadata}e.latestShare.polynomialID in this.shares||(this.shares[e.latestShare.polynomialID]={}),this.shares[e.latestShare.polynomialID][e.latestShare.share.shareIndex.toString("hex")]=e.latestShare}else r.polynomialID in this.shares||(this.shares[r.polynomialID]={}),this.shares[r.polynomialID][r.share.shareIndex.toString("hex")]=r}outputShareStore(e,t){if(!this.metadata)throw or.metadataUndefined();let r,i;if("number"==typeof e?r=new(T())(e):T().isBN(e)?r=e:"string"==typeof e&&(r=new(T())(e,"hex")),i=t||this.metadata.getLatestPublicPolynomial().getPolynomialID(),!this.metadata.getShareIndexesForPolynomial(i).includes(r.toString("hex")))throw new or(1002,"no such share index created");const n=this.shares[i][r.toString("hex")];if(n)return n;const s=this.reconstructLatestPoly().generateShares([r]);return new je(s[r.toString("hex")],i)}getCurrentShareIndexes(){if(!this.metadata)throw or.metadataUndefined();const e=this.metadata.getLatestPublicPolynomial().getPolynomialID();return Object.keys(this.shares[e])}getKeyDetails(){if(!this.metadata)throw or.metadataUndefined();const e=this.metadata.getLatestPublicPolynomial(),t=e.getPolynomialID(),r=e.getThreshold()-Object.keys(this.shares[t]).length;let i=this.metadata.getShareDescription();if(i){const e=this.metadata.getShareIndexesForPolynomial(t);i=Object.keys(i).reduce(((t,r)=>(e.indexOf(r)>=0&&(t[r]=i[r]),t)),{})}return{pubKey:this.metadata.pubKey,ed25519PublicKey:this.getEd25519PublicKey(),requiredShares:r,threshold:e.getThreshold(),totalShares:this.metadata.getShareIndexesForPolynomial(t).length,shareDescriptions:i}}generateAuthMetadata(e){const{input:t}=e,r=[];for(let e=0;e<t.length;e+=1)r.push(new _r(t[e],this.privKey));return r}setAuthMetadata(e){const{input:t,serviceProvider:r,privKey:i}=e,n=new _r(t,this.privKey);return this.storageLayer.setMetadata({input:n,serviceProvider:r,privKey:i})}async setAuthMetadataBulk(e){if(!this.privKey)throw or.privateKeyUnavailable();const{input:t,serviceProvider:r,privKey:i}=e,n=[];for(let e=0;e<t.length;e+=1)n.push(new _r(t[e],this.privKey));await this.addLocalMetadataTransitions({input:n,serviceProvider:r,privKey:i})}async getAuthMetadata(e){return(await this.getGenericMetadataWithTransitionStates(se(se({},e),{},{fromJSONConstructor:_r}))).metadata}async getGenericMetadataWithTransitionStates(e){if(!(e.serviceProvider&&"0"!==e.serviceProvider.postboxKey.toString("hex")||e.privKey))throw or.default("require either serviceProvider or priv key in getGenericMetadataWithTransitionStates");if(e.includeLocalMetadataTransitions){const t=e._localMetadataTransitions?e._localMetadataTransitions:this._localMetadataTransitions;let r=null;for(let i=t[0].length-1;i>=0;i-=1){const n=t[0][i];if((e.privKey&&n&&0===n.cmp(e.privKey)||e.serviceProvider&&!n)&&(r=i),null!==r)break}if(null!==r)return t[1][r]}let t;try{t=await this.storageLayer.getMetadata(e)}catch(e){const t=await pe(e);throw or.metadataGetFailed(t.message)}if(t.message===ge)throw or.fromCode(1308);return e.fromJSONConstructor.fromJSON(t)}async acquireWriteMetadataLock(){if(this.haveWriteMetadataLock)return this.metadata.nonce;if(!this.privKey)throw or.privateKeyUnavailable();let e;const t=this.lastFetchedCloudMetadata.getLatestPublicPolynomial().getPolynomialID(),r=Object.keys(this.shares[t]),i=r[Math.floor(Math.random()*(r.length-1))];e=r.length>=1?this.shares[t][i]:this.outputShareStore(i,t);const n=(await this.catchupToLatestShare({shareStore:e})).shareMetadata;if(n.nonce>this.lastFetchedCloudMetadata.nonce)throw or.acquireLockFailed(`unable to acquire write access for metadata due to \n      lastFetchedCloudMetadata (${this.lastFetchedCloudMetadata.nonce})\n           being lower than last written metadata nonce (${n.nonce}). perhaps update metadata SDK (create new tKey and init)`);if(n.nonce<this.lastFetchedCloudMetadata.nonce)throw or.acquireLockFailed(`unable to acquire write access for metadata due to \n      lastFetchedCloudMetadata (${this.lastFetchedCloudMetadata.nonce})\n      being higher than last written metadata nonce (${n.nonce}). this should never happen as it \n      should only ever be updated by getting metadata)`);const s=await this.storageLayer.acquireWriteLock({privKey:this.privKey});if(1!==s.status)throw or.acquireLockFailed(`lock cannot be acquired from storage layer status code: ${s.status}`);return this.haveWriteMetadataLock=s.id,this.metadata.nonce}async releaseWriteMetadataLock(){if(!this.haveWriteMetadataLock)throw or.releaseLockFailed("releaseWriteMetadataLock - don't have metadata lock to release");const e=await this.storageLayer.releaseWriteLock({privKey:this.privKey,id:this.haveWriteMetadataLock});if(1!==e.status)throw or.releaseLockFailed(`lock cannot be released from storage layer status code: ${e.status}`);this.haveWriteMetadataLock=""}async _syncShareMetadata(e){if(!this.metadata)throw or.metadataUndefined();const t=this.getAllShareStoresForLatestPolynomial().map((e=>e.share.share));await this.syncMultipleShareMetadata(t,e)}async syncMultipleShareMetadata(e,t){if(!this.metadata)throw or.metadataUndefined();this.metadata.nonce+=1;const r=e.map((async e=>{const r=this.metadata.clone();let i,n;try{i=await this.getAuthMetadata({privKey:e,includeLocalMetadataTransitions:!0})}catch(e){const t=await pe(e);throw or.authMetadataGetUnavailable(t.message)}return n=t?t(i.scopedStore):i.scopedStore,r.scopedStore=n,r})),i=await Promise.all(r);return this.setAuthMetadataBulk({input:i,privKey:e})}_addRefreshMiddleware(e,t){this._refreshMiddleware[e]=t}_addReconstructKeyMiddleware(e,t){this._reconstructKeyMiddleware[e]=t}_addShareSerializationMiddleware(e,t){this._shareSerializationMiddleware={serialize:e,deserialize:t}}_setDeviceStorage(e){if(this.storeDeviceShare)throw or.default("storeDeviceShare already set");this.storeDeviceShare=e}async addShareDescription(e,t,r){if(!this.metadata)throw or.metadataUndefined();this.metadata.addShareDescription(e,t),r&&await this._syncShareMetadata()}async deleteShareDescription(e,t,r){if(!this.metadata)throw or.metadataUndefined();this.metadata.deleteShareDescription(e,t),r&&await this._syncShareMetadata()}async updateShareDescription(e,t,r,i){if(!this.metadata)throw or.metadataUndefined();this.metadata.updateShareDescription(e,t,r),i&&await this._syncShareMetadata()}async encrypt(e){if(!this.privKey)throw or.privateKeyUnavailable();return fe(Ce(this.privKey),e)}async decrypt(e){if(!this.privKey)throw or.privateKeyUnavailable();return le(Ke(this.privKey),e)}async _setTKeyStoreItem(e,t){if(!this.metadata)throw or.metadataUndefined();const r=this.metadata.getTkeyStoreDomain(e)||[],i=await Promise.all(r.map((async e=>{const t=await this.decrypt(e);return JSON.parse(t.toString())}))),n=await this.encrypt(xr.from(et()(t))),s=i.findIndex((e=>e.id===t.id));s>-1?r[s]=n:r.push(n),this.metadata.setTkeyStoreDomain(e,r),await this._syncShareMetadata()}async _deleteTKeyStoreItem(e,t){if(!this.metadata)throw or.metadataUndefined();const r=this.metadata.getTkeyStoreDomain(e)||[],i=(await Promise.all(r.map((async e=>{const t=await this.decrypt(e);return JSON.parse(t.toString())})))).filter((e=>e.id!==t));this.metadata.setTkeyStoreDomain(e,i),await this._syncShareMetadata()}async getTKeyStore(e){if(!this.metadata)throw or.metadataUndefined();const t=this.metadata.getTkeyStoreDomain(e)||[];return await Promise.all(t.map((async e=>{const t=await this.decrypt(e);return JSON.parse(t.toString())})))}async getTKeyStoreItem(e,t){if(!this.metadata)throw or.metadataUndefined();const r=this.metadata.getTkeyStoreDomain(e)||[];return(await Promise.all(r.map((async e=>{const t=await this.decrypt(e);return JSON.parse(t.toString())})))).find((e=>e.id===t))}async outputShare(e,t){const{share:r}=this.outputShareStore(e).share;return t?this._shareSerializationMiddleware.serialize(r,t):r}async inputShare(e,t){if(!this.metadata)throw or.metadataUndefined();let r;if(t){const i=await this._shareSerializationMiddleware.deserialize(e,t);r=this.metadata.shareToShareStore(i)}else r=this.metadata.shareToShareStore(e);const i=this.metadata.getLatestPublicPolynomial().getPolynomialID();if(!this.metadata.getShareIndexesForPolynomial(i).includes(r.share.shareIndex.toString("hex")))throw or.default("Latest poly doesn't include this share");await this.inputShareStoreSafe(r)}toJSON(){return{shares:this.shares,enableLogging:this.enableLogging,privKey:this.privKey?this.privKey.toString("hex"):void 0,metadata:this.metadata,lastFetchedCloudMetadata:this.lastFetchedCloudMetadata,_localMetadataTransitions:this._localMetadataTransitions,manualSync:this.manualSync,serviceProvider:this.serviceProvider,storageLayer:this.storageLayer}}getAllShareStoresForLatestPolynomial(){const e=this.metadata.getLatestPublicPolynomial(),t=e.getPolynomialID(),r=this.metadata.getShareIndexesForPolynomial(t),i=e.getThreshold(),n=[],s=Object.keys(this.shares[t]);if(s.length<i)throw or.unableToReconstruct("not enough shares for polynomial reconstruction");for(let e=0;e<i;e+=1)n.push(new Se(new(T())(s[e],"hex"),this.shares[t][s[e]].share.share));const o=yr(n).generateShares(r);return r.map((e=>this.metadata.shareToShareStore(o[e].share)))}async CRITICAL_deleteTkey(){if(!this.metadata)throw or.metadataUndefined();if(!this.privKey)throw or.privateKeyUnavailable();if(this._localMetadataTransitions[0].length>0||this._localMetadataTransitions[1].length>0)throw or.default("Please sync all local state before calling this function");const e=this.getAllShareStoresForLatestPolynomial();await this.addLocalMetadataTransitions({input:[...Array(e.length).fill({message:ge,dateAdded:Date.now()}),{message:me}],privKey:[...e.map((e=>e.share.share)),void 0]}),await this.syncLocalMetadataTransitions(),this.privKey=void 0,this.metadata=void 0,this.shares={},this.lastFetchedCloudMetadata=void 0}getApi(){return{getMetadata:this.getMetadata.bind(this),getStorageLayer:this.getStorageLayer.bind(this),initialize:this.initialize.bind(this),catchupToLatestShare:this.catchupToLatestShare.bind(this),_syncShareMetadata:this._syncShareMetadata.bind(this),_addRefreshMiddleware:this._addRefreshMiddleware.bind(this),_addReconstructKeyMiddleware:this._addReconstructKeyMiddleware.bind(this),_addShareSerializationMiddleware:this._addShareSerializationMiddleware.bind(this),addShareDescription:this.addShareDescription.bind(this),generateNewShare:this.generateNewShare.bind(this),inputShareStore:this.inputShareStore.bind(this),inputShareStoreSafe:this.inputShareStoreSafe.bind(this),outputShareStore:this.outputShareStore.bind(this),inputShare:this.inputShare.bind(this),outputShare:this.outputShare.bind(this),_setDeviceStorage:this._setDeviceStorage.bind(this),encrypt:this.encrypt.bind(this),decrypt:this.decrypt.bind(this),getTKeyStore:this.getTKeyStore.bind(this),getTKeyStoreItem:this.getTKeyStoreItem.bind(this),_setTKeyStoreItem:this._setTKeyStoreItem.bind(this),_deleteTKeyStoreItem:this._deleteTKeyStoreItem.bind(this),deleteShare:this.deleteShare.bind(this)}}setModuleReferences(){Object.keys(this.modules).map((e=>this.modules[e].setModuleReferences(this.getApi())))}async initializeModules(){return Promise.all(Object.keys(this.modules).map((e=>this.modules[e].initialize())))}async _refreshShares(e,t,r){if(!this.metadata)throw or.metadataUndefined();if(!this.privKey)throw or.privateKeyUnavailable();if(e>t.length)throw or.default(`threshold should not be greater than share indexes. ${e} > ${t.length}`);this.metadata.nonce+=1;const i=mr(e-1,this.privKey),n=i.generateShares(t),s=this.metadata.getShareIndexesForPolynomial(r),o=[],a=Object.keys(this.shares[r]);if(a.length<e)throw or.unableToReconstruct("not enough shares for polynomial reconstruction");for(let t=0;t<e;t+=1)o.push(new Se(new(T())(a[t],"hex"),this.shares[r][a[t]].share.share));const c=yr(o),h=[];for(let e=0;e<s.length;e+=1){const r=s[e];t.includes(r)&&h.push(r)}this.metadata.addFromPolynomialAndShares(i,n);const d={},u={},f=i.getPolynomialID();t.forEach((e=>{u[e]=new je(n[e],f)}));const l=this.metadata.clone(),p={},y=await Promise.all(h.map((async e=>{const t=c.polyEval(new(T())(e,"hex")),i=await fe(Ce(t),xr.from(JSON.stringify(u[e])));return p[Le(t).x.toString("hex")]=i,d[e]=new je(new De(e,t),r),t})));l.setScopedStore("encryptedShares",p);const m=Array(y.length).fill(l);for(const e in this._refreshMiddleware)if(Object.prototype.hasOwnProperty.call(this._refreshMiddleware,e)){const t=this._refreshMiddleware[e](this.metadata.getGeneralStoreDomain(e),d,u);t?this.metadata.setGeneralStoreDomain(e,t):this.metadata.deleteGeneralStoreDomain(e)}const g=[],b=t.map((e=>{const t=this.metadata.clone();return g.push(t),u[e].share.share})),v=this.generateAuthMetadata({input:[...m,...g]});await this.addLocalMetadataTransitions({input:[...v,u[1]],privKey:[...y,...b,void 0]});for(let e=0;e<t.length;e+=1){const r=t[e];this.inputShareStore(u[r])}return{shareStores:u}}async _initializeNewKey({determinedShare:e,initializeModules:t,importedKey:r,importEd25519Seed:i,delete1OutOf1:n}={}){if(r)this.secp256k1Key=r;else{const e=ur();this.secp256k1Key=e}const s=ye([new(T())(1),new(T())(0)]),o=[new(T())(1),s];let a;if(e){const t=ye([new(T())(1),new(T())(0)]);a=mr(1,this.privKey,[new De(t,e)]),o.push(t)}else a=mr(1,this.privKey);const c=a.generateShares(o),h=new vr(Le(this.privKey));h.addFromPolynomialAndShares(a,c);const d=c[o[0].toString("hex")],u=new je(d,a.getPolynomialID());this.metadata=h,await this.setupEd25519Seed(i),t&&await this.initializeModules();const f=[],l=o.map((e=>(f.push(this.metadata),c[e.toString("hex")].share))),p=this.generateAuthMetadata({input:f});await this.addLocalMetadataTransitions({input:[...p,u],privKey:[...l,void 0]}),n&&await this.addLocalMetadataTransitions({input:[{message:qe}],privKey:[this.serviceProvider.postboxKey]});for(let e=0;e<o.length;e+=1){const t=o[e];this.inputShareStore(new je(c[t.toString("hex")],a.getPolynomialID()))}this.storeDeviceShare&&await this.storeDeviceShare(new je(c[o[1].toString("hex")],a.getPolynomialID()));const y={secp256k1Key:this.privKey,deviceShare:new je(c[o[1].toString("hex")],a.getPolynomialID()),userShare:void 0};return e&&(y.userShare=new je(c[o[2].toString("hex")],a.getPolynomialID())),y}async importEd25519Seed(e){if(!this.privKey)throw or.privateKeyUnavailable();if(this.getEd25519PublicKey())throw or.default("Ed25519 key already exists");const t=Qt(e);this.metadata.setGeneralStoreDomain(kr,{message:await this.encrypt(e),publicKey:t.point.encode("hex",!1)}),this._ed25519Seed=e}async setupEd25519Seed(e){if(!this.privKey)throw or.privateKeyUnavailable();let t=e;if(!e){const e=await nr(32);t=xr.from(e)}await this.importEd25519Seed(t)}}var Mr=Pr,Er=r(8287).hp;const Ir=new ce.ec("secp256k1");function Ar(e,t){if(t>e.length)throw new Error("trying to select more elements than available");const r=[],i=e.slice();for(;r.length<t;)r.push(i.splice(Math.floor(Math.random()*i.length),1)[0]);return r}function Tr(e,t){return null===t.x&&null===t.y?e.curve.g.add(e.curve.g.neg()):e.keyFromPublic({x:t.x.padStart(64,"0"),y:t.y.padStart(64,"0")}).getPublic()}function Or(e){return e.isInfinity()?{x:null,y:null}:{x:e.getX().toString(16,64),y:e.getY().toString(16,64)}}async function Nr(e,t){const r=await(0,ae.w)(e,t);return{ciphertext:r.ciphertext.toString("hex"),ephemPublicKey:r.ephemPublicKey.toString("hex"),iv:r.iv.toString("hex"),mac:r.mac.toString("hex")}}async function Kr(e,t){const r={ciphertext:Er.from(t.ciphertext,"hex"),ephemPublicKey:Er.from(t.ephemPublicKey,"hex"),iv:Er.from(t.iv,"hex"),mac:Er.from(t.mac,"hex")};return(0,ae.Yc)(e,r)}function Cr(e,t,r){const i=[];let n=0;for(void 0!==t&&(i.push(t),n++);n<=e;n++)i.push(r());return i}function Lr(e,t,r){let i=new(T())(0);for(let n=0;n<e.length;n++){const s=e[n].mul(new(T())(t).pow(new(T())(n)));i=i.add(s.umod(r))}return i.umod(r)}function Rr(e,t,r){if(e.length!==t.length)throw new Error("arrays of different lengths");let i=new(T())(0);for(let n=0;n<e.length;n++)i=i.add(e[n].mul(t[n])),r&&(i=i.umod(r));return i}function Br(e,t,r,i){const n=e.map((e=>new(T())(e))),s=new(T())(t),o=new(T())(r);let a=new(T())(1),c=new(T())(1);for(let e=0;e<n.length;e+=1)if(0!==s.cmp(n[e])){let t=o.sub(n[e]);t=t.umod(i),a=a.mul(t),a=a.umod(i);let r=s.sub(n[e]);r=r.umod(i),c=c.mul(r).umod(i)}return a.mul(c.invm(i)).umod(i)}r(8287).hp;var Fr=r(8287).hp;function Dr(e,t,r,i,n){return"string"==typeof e?Lt(`${e}${t}`,r,i,n):e.post(t,r)}class Ur{constructor(e){if(_(this,"tssPubKey",void 0),_(this,"tempPrivKey",void 0),_(this,"tempPubKey",void 0),_(this,"serverEndpoints",void 0),_(this,"serverThreshold",void 0),_(this,"serverPubKeys",void 0),_(this,"ecCurve",void 0),_(this,"keyType",void 0),"secp256k1"!==e.keyType&&"ed25519"!==e.keyType)throw new Error("Invalid keyType, only secp256k1 or ed25519 is supported");if(this.keyType=e.keyType,this.ecCurve=new ce.ec(this.keyType),this.tssPubKey=Tr(this.ecCurve,e.tssPubKey),this.serverEndpoints=e.serverEndpoints,this.serverThreshold=e.serverThreshold,this.serverPubKeys=e.serverPubKeys,e.tempKey)this.tempPrivKey=e.tempKey,this.tempPubKey=Ir.g.mul(e.tempKey);else{const e=Ir.genKeyPair();this.tempPrivKey=e.getPrivate(),this.tempPubKey=e.getPublic()}}async import(e){const{importKey:t,newLabel:r,sigs:i,dkgNewPub:n,targetIndexes:s,selectedServers:o,factorPubs:a}=e;if(a.length!==s.length)throw new Error("inconsistent factorPubs and targetIndexes lengths");const c={pubkeys:this.serverPubKeys,selected:o,threshold:this.serverThreshold},h=o.map((e=>Dr(this.serverEndpoints[e-1],"/rss_round_1",{round_name:"rss_round_1",server_set:"new",server_index:e,new_servers_info:c,user_temp_pubkey:Or(this.tempPubKey),target_index:s,auth:{label:r,sigs:i},key_type:this.keyType}))),d=s.map((e=>Br([0,1],0,e,this.ecCurve.n).umod(this.ecCurve.n))),u=[],f=[],l=[],p=[],y=()=>this.ecCurve.genKeyPair().getPrivate();for(let e=0;e<d.length;e++){const r=Cr(1,d[e].mul(t).umod(this.ecCurve.n),y);u.push(r),f.push(r.map((e=>Or(this.ecCurve.g.mul(e)))));const i=Cr(c.threshold-1,Lr(r,1,this.ecCurve.n),y);l.push(i),p.push(i.map((e=>Or(this.ecCurve.g.mul(e)))))}const m=[],g=[];for(let e=0;e<u.length;e++)m.push([]);for(let e=0;e<s.length;e++){const t=u[e];g.push(await Nr(Fr.from(`04${Or(this.tempPubKey).x.padStart(64,"0")}${Or(this.tempPubKey).y.padStart(64,"0")}`,"hex"),Fr.from(Lr(t,99,this.ecCurve.n).toString(16,64),"hex")));const r=l[e],i=m[e];for(let e=0;e<c.pubkeys.length;e++){const t=c.pubkeys[e];i.push(await Nr(Fr.from(`04${t.x.padStart(64,"0")}${t.y.padStart(64,"0")}`,"hex"),Fr.from(Lr(r,e+1,this.ecCurve.n).toString(16,64),"hex")))}}const b=[];for(let e=0;e<s.length;e++)b.push({master_poly_commits:f[e],server_poly_commits:p[e],target_encryptions:{user_enc:g[e],server_encs:m[e]}});h.push(new Promise((e=>{e({target_index:s,data:b})})));const v=await Promise.all(h),w=s.map(((e,t)=>{for(let e=0;e<v.length;e++){const r=v[e].data[t],{master_poly_commits:i,server_poly_commits:n}=r;if(2!==i.length)throw new Error("incorrect number of coeffs for master poly commits");if(n.length!==this.serverThreshold)throw new Error("incorrect number of coeffs for server poly commits")}let r=[],i=[];for(let e=0;e<v.length;e++){const n=v[e].data[t],{master_poly_commits:s,server_poly_commits:o}=n;0!==r.length||0!==i.length?(r=r.map(((e,t)=>Tr(this.ecCurve,s[t]).add(e))),i=i.map(((e,t)=>Tr(this.ecCurve,o[t]).add(e)))):(r=s.map((e=>Tr(this.ecCurve,e))),i=o.map((e=>Tr(this.ecCurve,e))))}return{mc:r,sc:i}}));s.map(((e,t)=>{const{mc:r,sc:i}=w[t],s=Tr(this.ecCurve,n).mul(Br([1,e],1,0,this.ecCurve.n)),o=r[0].mul(Br([1,e],e,0,this.ecCurve.n));if(!s.add(o).eq(this.tssPubKey))throw new Error("master poly commits inconsistent with tssPubKey");if(!r[0].add(r[1]).eq(i[0]))throw new Error("server poly commits inconsistent with master poly commits");return null}));const S=Fr.from(this.tempPrivKey.toString(16,64),"hex"),_=[];for(let e=0;e<s.length;e++){const t=v.map((t=>t.data[e].target_encryptions.user_enc)),r=(await Promise.all(t.map((e=>Kr(S,e))))).map((e=>new(T())(e))).reduce(((e,t)=>e.add(t).umod(this.ecCurve.n)),new(T())(0)),{mc:i}=w[e],n=this.ecCurve.g.mul(r),s=i[0].add(i[1].mul(new(T())(99)));if(!n.eq(s))throw new Error("decrypted user shares inconsistent with poly commits");_.push(r)}const x=await Promise.all(_.map(((e,t)=>{const r=a[t];return Nr(Fr.from(`04${r.x.padStart(64,"0")}${r.y.padStart(64,"0")}`,"hex"),Fr.from(e.toString(16,64),"hex"))}))),k=s.map(((e,t)=>{const r=v.map((e=>e.data[t].target_encryptions.server_encs)),i=[];for(let e=0;e<this.serverEndpoints.length;e++){const t=[];for(let i=0;i<this.serverThreshold+1;i++)t.push(r[i][e]);i.push(t)}return i})),P=this.serverEndpoints.map(((e,t)=>t+1)),M=await Promise.all(P.map((e=>{const t=[];return s.map(((r,i)=>{const{mc:n,sc:s}=w[i],o={master_commits:n.map(Or),server_commits:s.map(Or),server_encs:k[i][e-1],factor_pubkeys:[a[i]]};return t.push(o),null})),Dr(this.serverEndpoints[e-1],"/rss_round_2",{round_name:"rss_round_2",server_index:e,target_index:s,data:t,key_type:this.keyType}).catch((e=>rt().error(e)))})));if(M.filter((e=>e)).length<this.serverThreshold)throw new Error("not enough servers responded");const E=[];for(let e=0;e<s.length;e++)E.push({targetIndex:s[e],factorPub:a[e],serverFactorEncs:M.map((t=>t&&t.data[e].encs[0])),userFactorEnc:x[e]});return E}async refresh(e){const{targetIndexes:t,inputIndex:r,selectedServers:i,oldLabel:n,newLabel:s,sigs:o,dkgNewPub:a,inputShare:c,factorPubs:h}=e;if(h.length!==t.length)throw new Error("inconsistent factorPubs and targetIndexes lengths");const d={pubkeys:this.serverPubKeys,selected:i,threshold:this.serverThreshold},u=i.map((e=>Dr(this.serverEndpoints[e-1],"/rss_round_1",{round_name:"rss_round_1",server_set:"old",server_index:e,old_servers_info:d,new_servers_info:d,old_user_share_index:r,user_temp_pubkey:Or(this.tempPubKey),target_index:t,auth:{label:n,sigs:o},key_type:this.keyType}))).concat(i.map((e=>Dr(this.serverEndpoints[e-1],"/rss_round_1",{round_name:"rss_round_1",server_set:"new",server_index:e,old_servers_info:d,new_servers_info:d,old_user_share_index:r,user_temp_pubkey:Or(this.tempPubKey),target_index:t,auth:{label:s,sigs:o},key_type:this.keyType})))),f=Br([1,r],r,0,this.ecCurve.n),l=t.map((e=>f.mul(Br([0,1],0,e,this.ecCurve.n)).umod(this.ecCurve.n))),p=[],y=[],m=[],g=[],b=()=>this.ecCurve.genKeyPair().getPrivate();for(let e=0;e<l.length;e++){const t=Cr(1,l[e].mul(c).umod(this.ecCurve.n),b);p.push(t),y.push(t.map((e=>Or(this.ecCurve.g.mul(e)))));const r=Cr(d.threshold-1,Lr(t,1,this.ecCurve.n),b);m.push(r),g.push(r.map((e=>Or(this.ecCurve.g.mul(e)))))}const v=[],w=[];for(let e=0;e<p.length;e++)v.push([]);for(let e=0;e<t.length;e++){const t=p[e];w.push(await Nr(Fr.from(`04${Or(this.tempPubKey).x.padStart(64,"0")}${Or(this.tempPubKey).y.padStart(64,"0")}`,"hex"),Fr.from(Lr(t,99,this.ecCurve.n).toString(16,64),"hex")));const r=m[e],i=v[e];for(let e=0;e<d.pubkeys.length;e++){const t=d.pubkeys[e];i.push(await Nr(Fr.from(`04${t.x.padStart(64,"0")}${t.y.padStart(64,"0")}`,"hex"),Fr.from(Lr(r,e+1,this.ecCurve.n).toString(16,64),"hex")))}}const S=[];for(let e=0;e<t.length;e++)S.push({master_poly_commits:y[e],server_poly_commits:g[e],target_encryptions:{user_enc:w[e],server_encs:v[e]}});u.push(new Promise((e=>{e({target_index:t,data:S})})));const _=await Promise.all(u),x=t.map(((e,t)=>{for(let e=0;e<_.length;e++){const r=_[e].data[t],{master_poly_commits:i,server_poly_commits:n}=r;if(2!==i.length)throw new Error("incorrect number of coeffs for master poly commits");if(n.length!==this.serverThreshold)throw new Error("incorrect number of coeffs for server poly commits")}let r=[],i=[];for(let e=0;e<_.length;e++){const n=_[e].data[t],{master_poly_commits:s,server_poly_commits:o}=n;0!==r.length||0!==i.length?(r=r.map(((e,t)=>Tr(this.ecCurve,s[t]).add(e))),i=i.map(((e,t)=>Tr(this.ecCurve,o[t]).add(e)))):(r=s.map((e=>Tr(this.ecCurve,e))),i=o.map((e=>Tr(this.ecCurve,e))))}return{mc:r,sc:i}}));t.map(((e,t)=>{const{mc:r,sc:i}=x[t],n=Tr(this.ecCurve,a).mul(Br([1,e],1,0,this.ecCurve.n)),s=r[0].mul(Br([1,e],e,0,this.ecCurve.n));if(!n.add(s).eq(this.tssPubKey))throw new Error("master poly commits inconsistent with tssPubKey");if(!r[0].add(r[1]).eq(i[0]))throw new Error("server poly commits inconsistent with master poly commits");return null}));const k=Fr.from(this.tempPrivKey.toString(16,64),"hex"),P=[];for(let e=0;e<t.length;e++){const t=_.map((t=>t.data[e].target_encryptions.user_enc)),r=(await Promise.all(t.map((e=>Kr(k,e))))).map((e=>new(T())(e))).reduce(((e,t)=>e.add(t).umod(this.ecCurve.n)),new(T())(0)),{mc:i}=x[e],n=this.ecCurve.g.mul(r),s=i[0].add(i[1].mul(new(T())(99)));if(!n.eq(s))throw new Error("decrypted user shares inconsistent with poly commits");P.push(r)}const M=await Promise.all(P.map(((e,t)=>{const r=h[t];return Nr(Fr.from(`04${r.x.padStart(64,"0")}${r.y.padStart(64,"0")}`,"hex"),Fr.from(e.toString(16,64),"hex"))}))),E=t.map(((e,t)=>{const r=_.map((e=>e.data[t].target_encryptions.server_encs)),i=[];for(let e=0;e<this.serverEndpoints.length;e++){const t=[];for(let i=0;i<2*this.serverThreshold+1;i++)t.push(r[i][e]);i.push(t)}return i})),I=this.serverEndpoints.map(((e,t)=>t+1)),A=await Promise.all(I.map((e=>{const r=[];return t.map(((t,i)=>{const{mc:n,sc:s}=x[i],o={master_commits:n.map(Or),server_commits:s.map(Or),server_encs:E[i][e-1],factor_pubkeys:[h[i]]};return r.push(o),null})),Dr(this.serverEndpoints[e-1],"/rss_round_2",{round_name:"rss_round_2",server_index:e,target_index:t,data:r,key_type:this.keyType}).catch((e=>rt().error(e)))})));if(A.filter((e=>e)).length<this.serverThreshold)throw new Error("not enough servers responded");const O=[];for(let e=0;e<t.length;e++)O.push({targetIndex:t[e],factorPub:h[e],serverFactorEncs:A.map((t=>t&&t.data[e].encs[0])),userFactorEnc:M[e]});return O}}var jr=r(8287).hp;const qr="tssModule",$r="default",zr=new ce.ec("secp256k1"),Jr="secp256k1";class Hr extends Mr{constructor(e){super(e),_(this,"serviceProvider",null),_(this,"_tssKeyType",void 0),_(this,"_tssCurve",void 0),_(this,"_tssTag",void 0),_(this,"_accountSalt",void 0);const{serviceProvider:t,storageLayer:r,tssTag:i="default",tssKeyType:n}=e;if(t.customAuthArgs.keyType!==n)throw or.default(`service provider keyType mismatch: ${t.customAuthArgs.keyType} !== ${n}`);this.serviceProvider=t,this.storageLayer=r,this._tssTag=i,this._tssKeyType=n,this._tssCurve=new ce.ec(n)}get tssTag(){return this._tssTag}get tssKeyType(){return this._tssKeyType}get tssCurve(){return this._tssCurve}set tssTag(e){if((this.metadata.tssKeyTypes[this.tssTag]||Jr)!==this.tssKeyType)throw or.default(`tssKeyType mismatch: ${this.metadata.tssKeyTypes[this.tssTag]} !== ${this.tssKeyType}`);this._tssTag=e}async initialize(e){const t=await super.initialize(e);if(!this.metadata.tssPolyCommits[this.tssTag]&&!(null!=e&&e.skipTssInit||null!=e&&e.neverInitializeNewKey)){const{factorEncs:t,factorPubs:r,tssPolyCommits:i}=await this._initializeNewTSSKey(this.tssTag,e.deviceTSSShare,e.factorPub,e.deviceTSSIndex);this.metadata.updateTSSData({tssKeyType:this._tssKeyType,tssTag:this.tssTag,tssNonce:0,tssPolyCommits:i,factorPubs:r,factorEncs:t});const n=xe(this._tssCurve);await this._setTKeyStoreItem(qr,{id:"accountSalt",value:n}),this._accountSalt=n}if(this.metadata.tssPolyCommits[this.tssTag]&&(this.metadata.tssKeyTypes[this.tssTag]||Jr)!==this.tssKeyType)throw or.default(`tssKeyType mismatch: ${this.metadata.tssKeyTypes[this.tssTag]} !== ${this.tssKeyType}`);return t}getFactorEncs(e){if(!this.metadata)throw or.metadataUndefined();if(!this.metadata.factorEncs)throw or.default("no factor encs mapping");if(!this.metadata.factorPubs)throw or.default("no factor pubs mapping");const t=this.metadata.factorPubs[this.tssTag];if(!t)throw or.default(`no factor pubs for this tssTag ${this.tssTag}`);if(0===t.filter((t=>0===t.x.cmp(e.x)&&0===t.y.cmp(e.y))).length)throw or.default(`factor pub ${e} not found for tssTag ${this.tssTag}`);if(!this.metadata.factorEncs[this.tssTag])throw or.default(`no factor encs for tssTag ${this.tssTag}`);const r=e.x.toString(16,64);return this.metadata.factorEncs[this.tssTag][r]}async getTSSShare(e,t){const r=Ee(e,zr),i=this.getFactorEncs(r),{userEnc:n,serverEncs:s,tssIndex:o,type:a}=i,c=await le(jr.from(e.toString(16,64),"hex"),n),h=await Promise.all(s.map((t=>null===t?null:le(jr.from(e.toString(16,64),"hex"),t)))),d=[c].concat(h).map((e=>null===e?null:new(T())(e))),u=this._tssCurve,f=this.getTSSCommits().map((e=>u.keyFromPublic({x:e.x.toString(16,64),y:e.y.toString(16,64)}).getPublic())),l=d[0],p=(null==t?void 0:t.accountIndex)||0,y=(null==t?void 0:t.coefficient)||new(T())(1);if("direct"===a){const e=u.g.mul(l),t=f[0],r=f[1],i=t.add(r.mul(new(T())(o)));if(e.eq(i))return{tssIndex:o,tssShare:this.adjustTssShare(l,p,y)};throw new Error("user decryption does not match tss commitments...")}const m=d.slice(1),g=new Array(m.length).fill(null).map(((e,t)=>t+1)),b=(null==t?void 0:t.threshold)||Math.ceil(m.length/2),v=_e(m.length,b);for(let e=0;e<v.length;e++){const t=v[e],r=m.filter(((e,r)=>t.indexOf(r)>-1));if(r.includes(null))continue;const i=g.filter(((e,r)=>t.indexOf(r)>-1)),n=Rr(i.map((e=>ke(u,i,e))),r,u.n),s=Rr([ke(u,[1,99],1),ke(u,[1,99],99)],[n,l],u.n),a=u.g.mul(s),c=f[0],h=f[1];let d=c;for(let e=0;e<o;e++)d=d.add(h);if(a.eq(d))return{tssIndex:o,tssShare:this.adjustTssShare(s,p,y)}}throw new Error("could not find any combination of server decryptions that match tss commitments...")}getTSSCommits(){if(!this.metadata)throw or.metadataUndefined();const e=this.metadata.tssPolyCommits[this.tssTag];if(!e)throw or.default(`tss poly commits not found for tssTag ${this.tssTag}`);if(0===e.length)throw or.default("tss poly commits is empty");return e}getTSSPub(e){const t=this._tssCurve,r=this.getTSSCommits();if(e&&e>0){const i=this.computeAccountNonce(e),n=t.keyFromPrivate(i.toString("hex")).getPublic(),s=r[0].toEllipticPoint(t).add(n);return Se.fromElliptic(s)}return r[0]}async _getRssNodeDetails(){const{serverEndpoints:e,serverPubKeys:t,serverThreshold:r}=await this.serviceProvider.getRSSNodeDetails();if(!Array.isArray(e)||0===e.length)throw new Error("service provider tss server endpoints are missing");if(!Array.isArray(t)||0===t.length)throw new Error("service provider pub keys are missing");return{serverEndpoints:e,serverPubKeys:t,serverThreshold:r||Math.floor(e.length/2)+1}}async importTssKey(e,t){const r=this._tssCurve;if(!this.secp256k1Key)throw or.privateKeyUnavailable();if(!this.metadata)throw or.metadataUndefined();const{importKey:i,factorPub:n,newTSSIndex:s,tag:o}=e,a=this.tssTag;this._tssTag=o;try{const{selectedServers:e=[],authSignatures:a=[]}=t||{};if(!o)throw or.default("invalid param, tag is required");if(!n)throw or.default("invalid param, newFactorPub is required");if(!s)throw or.default("invalid param, newTSSIndex is required");if(0===a.length)throw or.default("invalid param, authSignatures is required");const c=this.metadata.factorPubs[o];if((null==c?void 0:c.length)>0)throw or.default("Duplicate account tag, please use a unique tag for importing key");const h=[n],d=await(async()=>{if(this._tssKeyType===Te.secp256k1)return new(T())(i);if(this._tssKeyType===Te.ed25519){const e=Ae(this.tssTag||$r);if(this.metadata.getGeneralStoreDomain(e))throw new Error("Seed already exists");const{scalar:t}=Qt(i),r=jr.from($t(t).point.encodeCompressed("hex"),"hex"),n=await fe(r,i);return this.metadata.setGeneralStoreDomain(e,{message:n}),t}throw new Error("Invalid key type")})();if(!d||d.eq(new(T())("0")))throw new Error("Invalid importedKey");const u=[s],f=this.metadata.tssNonces[this.tssTag],l=f&&f>0?f+1:0,p=`${this.serviceProvider.getVerifierNameVerifierId()}${this.tssTag}${l}`,y=Or(r.g.mul(d)),m=await this._getRssNodeDetails(),{pubKey:g,nodeIndexes:b}=await this.serviceProvider.getTSSPubKey(this.tssTag,l);let v=e;(null==b?void 0:b.length)>0?v=e.length?b.slice(0,Math.min(e.length,b.length)):b.slice(0,3):0===(null==e?void 0:e.length)&&(v=Ar(new Array(m.serverEndpoints.length).fill(null).map(((e,t)=>t+1)),Math.ceil(m.serverEndpoints.length/2)));const{serverEndpoints:w,serverPubKeys:S,serverThreshold:_}=m,x=new Ur({serverEndpoints:w,serverPubKeys:S,serverThreshold:_,tssPubKey:y,keyType:this._tssKeyType}),k=await x.import({importKey:d,dkgNewPub:Me(g),selectedServers:v,factorPubs:h.map((e=>Me(e))),targetIndexes:u,newLabel:p,sigs:a}),P=g.toEllipticPoint(r).add(Tr(r,y).neg()),M=[Se.fromJSON(y),Se.fromJSON({x:P.getX().toString(16,64),y:P.getY().toString(16,64)})],E={};for(let e=0;e<k.length;e++){const t=k[e];E[t.factorPub.x.padStart(64,"0")]={type:"hierarchical",tssIndex:t.targetIndex,userEnc:t.userFactorEnc,serverEncs:t.serverFactorEncs}}if(this.metadata.updateTSSData({tssKeyType:this._tssKeyType,tssTag:this.tssTag,tssNonce:l,tssPolyCommits:M,factorPubs:h,factorEncs:E}),!this._accountSalt){const e=xe(this._tssCurve);await this._setTKeyStoreItem(qr,{id:"accountSalt",value:e}),this._accountSalt=e}await this._syncShareMetadata()}catch(e){throw this._tssTag=a,e}}async _UNSAFE_exportTssKey(e){if(!this.metadata)throw or.metadataUndefined("metadata is undefined");if(!this.secp256k1Key)throw new Error("Tkey is not reconstructed");if(!this.metadata.tssPolyCommits[this.tssTag])throw new Error(`tss key has not been initialized for tssTag ${this.tssTag}`);const{factorKey:t,selectedServers:r,authSignatures:i,accountIndex:n}=e,{tssIndex:s}=await this.getTSSShare(t),o=2===s?3:2,a=zr.genKeyPair().getPrivate(),c=Ee(a,zr);await this.addFactorPub({existingFactorKey:t,newFactorPub:c,newTSSIndex:o,authSignatures:i,selectedServers:r,refreshShares:!0});const{tssShare:h,tssIndex:d}=await this.getTSSShare(t),{tssShare:u,tssIndex:f}=await this.getTSSShare(a),l=Pe(this._tssCurve,[u,h],[new(T())(f),new(T())(d)]);await this.deleteFactorPub({factorKey:t,deleteFactorPub:c,authSignatures:i,selectedServers:r});const p=this.computeAccountNonce(n);return l.add(p).umod(this._tssCurve.n)}async _UNSAFE_exportTssEd25519Seed(e){const t=await this._UNSAFE_exportTssKey(e),r=Ae(this.tssTag||$r),i=this.metadata.getGeneralStoreDomain(r),n=$t(t).scalar;return await le(n.toArrayLike(jr,"be",32),i.message)}async _refreshTSSShares(e,t,r,i,n,s,o){if(!this.metadata)throw or.metadataUndefined();if(!this.metadata.tssPolyCommits)throw or.default("tss poly commits obj not found");const a=this.metadata.tssPolyCommits[this.tssTag];if(!a)throw or.default(`tss commits not found for tssTag ${this.tssTag}`);if(0===a.length)throw or.default("tssCommits is empty");const c=Me(a[0]),{serverEndpoints:h,serverPubKeys:d,serverThreshold:u,selectedServers:f,authSignatures:l}=o,p=new Ur({serverEndpoints:h,serverPubKeys:d,serverThreshold:u,tssPubKey:c,keyType:this._tssKeyType});if(!this.metadata.factorPubs)throw or.default("factorPubs obj not found");if(!i)throw or.default(`factorPubs not found for tssTag ${this.tssTag}`);if(0===i.length)throw or.default("factorPubs is empty");if(!this.metadata.tssNonces)throw or.default("tssNonces obj not found");const y=this.metadata.tssNonces[this.tssTag]||0,m=`${s}${this.tssTag}${y}`,g=`${s}${this.tssTag}${y+1}`,{pubKey:b,nodeIndexes:v}=await this.serviceProvider.getTSSPubKey(this.tssTag,y+1);let w=f;(null==v?void 0:v.length)>0&&(w=v.slice(0,Math.min(f.length,v.length)));const S=await p.refresh({factorPubs:i.map((e=>Me(e))),targetIndexes:n,oldLabel:m,newLabel:g,sigs:l,dkgNewPub:Me(b),inputShare:t,inputIndex:r,selectedServers:w}),_=b.toEllipticPoint(this._tssCurve).add(Tr(this._tssCurve,c).neg()),x=[Se.fromJSON(c),Se.fromJSON({x:_.getX().toString(16,64),y:_.getY().toString(16,64)})],k={};for(let e=0;e<S.length;e++){const t=S[e];k[t.factorPub.x.padStart(64,"0")]={type:"hierarchical",tssIndex:t.targetIndex,userEnc:t.userFactorEnc,serverEncs:t.serverFactorEncs}}this.metadata.updateTSSData({tssKeyType:this._tssKeyType,tssTag:this.tssTag,tssNonce:y+1,tssPolyCommits:x,factorPubs:i,factorEncs:k}),e&&await this._syncShareMetadata()}computeAccountNonce(e){if(!e||0===e)return new(T())(0);if(this._tssKeyType===Te.ed25519)throw new Error("account index not supported with ed25519");if(!this._accountSalt)throw Error("account salt undefined");let t=(0,ze.So)(jr.from(`${e}${this._accountSalt}`));return 66===t.length&&(t=t.slice(2)),new(T())(t,"hex").umod(this._tssCurve.n)}async reconstructKey(e){const t=await super.reconstructKey(e),r=await this.getTKeyStoreItem(qr,"accountSalt");if(r&&r.value)this._accountSalt=r.value;else{const e=xe(this._tssCurve);await this._setTKeyStoreItem(qr,{id:"accountSalt",value:e}),this._accountSalt=e,this.manualSync&&await this.syncLocalMetadataTransitions()}return t}async addFactorPub(e){if(!this.metadata)throw or.metadataUndefined("metadata is undefined");if(!this.secp256k1Key)throw new Error("Tkey is not reconstructed");if(!this.metadata.tssPolyCommits[this.tssTag])throw new Error(`tss key has not been initialized for tssTag ${this.tssTag}`);const{existingFactorKey:t,newFactorPub:r,newTSSIndex:i,selectedServers:n,authSignatures:s,refreshShares:o}=e,{tssShare:a,tssIndex:c}=await this.getTSSShare(t);if(c!==i&&!o)throw or.default("newTSSIndex does not match existing tssIndex, set refreshShares to true to refresh shares");if(o){const e=this.metadata.factorPubs[this.tssTag],t=e.concat([r]),o=this.serviceProvider.getVerifierNameVerifierId(),h=await this._getRssNodeDetails(),d=Ar(new Array(h.serverEndpoints.length).fill(null).map(((e,t)=>t+1)),Math.ceil(h.serverEndpoints.length/2)),u=n||d,f=e.map((e=>this.getFactorEncs(e).tssIndex)).concat([i]);await this._refreshTSSShares(!1,a,c,t,f,o,se(se({},h),{},{selectedServers:u,authSignatures:s}))}else{if(c!==i)throw or.default("newTSSIndex does not match existing tssIndex, set refreshShares to true to refresh shares");const e=this.metadata.factorPubs[this.tssTag].concat([r]),t=JSON.parse(JSON.stringify(this.metadata.factorEncs[this.tssTag]));t[r.x.toString(16,64)]={tssIndex:c,type:"direct",userEnc:await fe(r.toSEC1(ue,!1),a.toArrayLike(jr,"be",32)),serverEncs:[]},this.metadata.updateTSSData({tssKeyType:this.tssKeyType,tssTag:this.tssTag,factorPubs:e,factorEncs:t})}await this._syncShareMetadata()}async deleteFactorPub(e){if(!this.metadata)throw or.metadataUndefined("metadata is undefined");if(!this.secp256k1Key)throw new Error("Tkey is not reconstructed");if(!this.metadata.tssPolyCommits[this.tssTag])throw new Error(`tss key has not been initialized for tssTag ${this.tssTag}`);const{factorKey:t,deleteFactorPub:r,selectedServers:i,authSignatures:n}=e,s=this.metadata.factorPubs[this.tssTag],{tssShare:o,tssIndex:a}=await this.getTSSShare(t),c=s.filter((e=>e.x.eq(r.x)&&e.y.eq(r.y)));if(0===c.length)throw or.default("could not find factorPub to delete");if(c.length>1)throw or.default("found two or more factorPubs that match, error in metadata");const h=s.filter((e=>!e.x.eq(r.x)||!e.y.eq(r.y)));this.metadata.updateTSSData({tssKeyType:this._tssKeyType,tssTag:this.tssTag,factorPubs:h});const d=await this._getRssNodeDetails(),u=Ar(new Array(d.serverEndpoints.length).fill(null).map(((e,t)=>t+1)),Math.ceil(d.serverEndpoints.length/2)),f=i||u,l=h.map((e=>this.getFactorEncs(e).tssIndex));await this._refreshTSSShares(!1,o,a,h,l,this.serviceProvider.getVerifierNameVerifierId(),se(se({},d),{},{selectedServers:f,authSignatures:n})),await this._syncShareMetadata()}adjustTssShare(e,t,r){const i=this.computeAccountNonce(t);return e.mul(r).add(i).umod(this._tssCurve.n)}async _initializeNewTSSKey(e,t,r,i){const n=this._tssCurve;let s;const o=i||2;s=t||this._tssCurve.genKeyPair().getPrivate();const{pubKey:a}=await this.serviceProvider.getTSSPubKey(e,0),c=a.toEllipticPoint(n),h=this._tssCurve.g.mul(s),d=ke(n,[1,o],1,0),u=ke(n,[1,o],o,0),f=c.mul(d).add(h.mul(u)),l=c.add(f.neg()),p=[Se.fromElliptic(f),Se.fromElliptic(l)],y=[r],m={};for(let e=0;e<y.length;e++){const t=y[e];m[t.x.toString(16,64)]={tssIndex:o,type:"direct",userEnc:await fe(t.toSEC1(zr,!1),jr.from(s.toString(16,64),"hex")),serverEncs:[]}}return{tss2:s,factorEncs:m,factorPubs:y,tssPolyCommits:p}}}var Vr=r(8287).hp;class Yr{constructor(e,t,r){_(this,"shareIndex",void 0),_(this,"factorPublicKey",void 0),_(this,"question",void 0),this.shareIndex=e,this.factorPublicKey=t,this.question=r}static fromJSON(e){const{shareIndex:t,factorPublicKey:r,question:i}=e;return new Yr(t,r,i)}toJSON(){return{shareIndex:this.shareIndex,factorPublicKey:this.factorPublicKey,question:this.question}}}class Wr{constructor(){_(this,"storeDomainName","tssSecurityQuestion")}async setSecurityQuestion(e){const{mpcCoreKit:t,question:r,answer:i,description:n}=e;let{shareType:s}=e;if(!t.tKey)throw new Error("Tkey not initialized, call init first.");if(!r||!i)throw new Error("question and answer are required");const o=`${this.storeDomainName}:${e.mpcCoreKit.tKey.tssTag}`;if(s){if(!m.includes(s))throw new Error(`invalid share type: must be one of ${m}`)}else s=y.RECOVERY;const a=t.tKey,c=a.metadata.getGeneralStoreDomain(o);if(c&&c.question)throw new Error("Security question already exists");const h=a.getKeyDetails().pubKey.toSEC1(ue,!0).toString("hex")+a.tssTag;let d=nt(Vr.from(i+h,"utf8"));d=d.startsWith("0x")?d.slice(2):d;const f=new(T())(d,"hex"),l=se({question:r},n);await t.createFactor({factorKey:f,shareType:s,shareDescription:u.SecurityQuestions,additionalMetadata:l});const p=Ee(f,zr).toSEC1(zr,!0).toString("hex"),g=new Yr(s.toString(),p,r);return a.metadata.setGeneralStoreDomain(o,g.toJSON()),a.manualSync||await a._syncShareMetadata(),f.toString("hex").padStart(64,"0")}async changeSecurityQuestion(e){const{mpcCoreKit:t,newQuestion:r,newAnswer:i,answer:n}=e;if(!r||!i||!n)throw new Error("question and answer are required");const s=t.tKey,o=s.getKeyDetails().pubKey.toSEC1(ue,!0).toString("hex")+s.tssTag,a=`${this.storeDomainName}:${e.mpcCoreKit.tKey.tssTag}`,c=s.metadata.getGeneralStoreDomain(a);if(!c||!c.question)throw new Error("Security question does not exists");const h=Yr.fromJSON(c),d=n+o;let f=nt(Vr.from(d,"utf8"));f=f.startsWith("0x")?f.slice(2):f;const l=new(T())(f,"hex"),p=Ee(l,zr);if(p.toSEC1(zr,!0).toString("hex")!==h.factorPublicKey)throw new Error("Invalid answer");const y=i+o;let m=nt(Vr.from(y,"utf8"));m=m.startsWith("0x")?m.slice(2):m;const g=new(T())(m,"hex"),b=Se.fromScalar(g,zr);await t.createFactor({factorKey:g,shareType:parseInt(h.shareIndex),shareDescription:u.SecurityQuestions}),t.state.factorKey.eq(l)&&await t.inputFactorKey(g),await t.deleteFactor(p,l),h.factorPublicKey=b.toSEC1(zr,!0).toString("hex"),h.question=r,s.metadata.setGeneralStoreDomain(a,h.toJSON()),s.manualSync||await s._syncShareMetadata()}async deleteSecurityQuestion(e,t=!0){if(!e.tKey)throw new Error("Tkey not initialized, call init first.");const r=`${this.storeDomainName}:${e.tKey.tssTag}`,i=e.tKey;if(t){const t=i.metadata.getGeneralStoreDomain(r);if(!t||!t.question)throw new Error("Security question does not exists");const n=Yr.fromJSON(t);n.factorPublicKey&&await e.deleteFactor(Se.fromSEC1(zr,n.factorPublicKey))}i.metadata.deleteGeneralStoreDomain(r),i.manualSync||await i._syncShareMetadata()}async recoverFactor(e,t){if(!e.tKey)throw new Error("Tkey not initialized, call init first.");if(!t)throw new Error("question and answer are required");const r=e.tKey,i=`${this.storeDomainName}:${e.tKey.tssTag}`,n=r.metadata.getGeneralStoreDomain(i);if(!n||!n.question)throw new Error("Security question does not exists");const s=Yr.fromJSON(n),o=r.getKeyDetails().pubKey.toSEC1(ue,!0).toString("hex")+r.tssTag;let a=nt(Vr.from(t+o,"utf8"));a=a.startsWith("0x")?a.slice(2):a;const c=new(T())(a,"hex");if(Se.fromScalar(c,zr).toSEC1(zr,!0).toString("hex")!==s.factorPublicKey)throw new Error("Invalid answer");return a}getQuestion(e){if(!e.tKey)throw new Error("Tkey not initialized, call init first.");const t=e.tKey,r=`${this.storeDomainName}:${e.tKey.tssTag}`,i=t.metadata.getGeneralStoreDomain(r);if(!i||!i.question)throw new Error("Security question does not exists");return Yr.fromJSON(i).question}}let Xr=function(e){return e.NOT_INITIALIZED="NOT_INITIALIZED",e.INITIALIZED="INITIALIZED",e.REQUIRED_SHARE="REQUIRED_SHARE",e.LOGGED_IN="LOGGED_IN",e}({});var Gr=r(4711),Qr=r.n(Gr),Zr=r(8287).hp;function ei(e,t){return ue.sign((0,ze.So)(Zr.from(et()(e),"utf8")),Ke(t),"utf-8").toDER("hex")}class ti{constructor({enableLogging:e=!1,hostUrl:t="http://localhost:5051",serverTimeOffset:r=0}){_(this,"enableLogging",void 0),_(this,"hostUrl",void 0),_(this,"storageLayerName",void 0),_(this,"serverTimeOffset",void 0),this.enableLogging=e,this.hostUrl=t,this.storageLayerName="TorusStorageLayer",this.serverTimeOffset=r}static async serializeMetadataParamsInput(e,t,r){if("object"==typeof e){const t=e;if(t.message===qe)return t.message}const i=Zr.from(et()(e));let n;return n=r?await fe(Ce(r),i):await t.encrypt(i),Qr().encode(et()(n))}static fromJSON(e){const{enableLogging:t,hostUrl:r,storageLayerName:i,serverTimeOffset:n=0}=e;if("TorusStorageLayer"===i)return new ti({enableLogging:t,hostUrl:r,serverTimeOffset:n})}async getMetadata(e){const{serviceProvider:t,privKey:r}=e,i=this.generateMetadataParams({},t,r),n=await Lt(`${this.hostUrl}/get`,i);if(""===n.message)return{message:me};const s=JSON.parse(Qr().decode(n.message));let o;return o=r?await le(Ke(r),s):await t.decrypt(s),JSON.parse(o.toString())}async setMetadata(e){try{const{serviceProvider:t,privKey:r,input:i}=e,n=this.generateMetadataParams(await ti.serializeMetadataParamsInput(i,t,r),t,r);return await Lt(`${this.hostUrl}/set`,n)}catch(e){throw await pe(e)}}async setMetadataStream(e){try{const{serviceProvider:t,privKey:r,input:i}=e,n=i,s=await Promise.all(n.map((async(e,i)=>this.generateMetadataParams(await ti.serializeMetadataParamsInput(e,t,r[i]),t,r[i])))),o=new FormData;s.forEach(((e,t)=>{o.append(t.toString(),JSON.stringify(e))}));const a={mode:"cors",method:"POST",headers:{}},c={isUrlEncodedData:!0,timeout:6e5};return await Lt(`${this.hostUrl}/bulk_set_stream`,o,a,c)}catch(e){throw await pe(e)}}generateMetadataParams(e,t,r){let i,n,s,o="tkey";const a={data:e,timestamp:new(T())(~~(this.serverTimeOffset+Date.now()/1e3)).toString(16)};e===qe&&(o="noncev2",a.data="<deleted>");const c=(0,ze.So)(Zr.from(et()(a),"utf8"));if(r){const e=Ne(r).sign(c);i=Zr.from(e.r.toString(16,64)+e.s.toString(16,64)+new(T())(0).toString(16,2),"hex").toString("base64");const t=Le(r);n=t.x.toString("hex"),s=t.y.toString("hex")}else{const e=t.retrievePubKeyPoint();i=t.sign(new(T())(c)),n=e.getX().toString("hex"),s=e.getY().toString("hex")}return{pub_key_X:n,pub_key_Y:s,set_data:a,signature:i,namespace:o}}async acquireWriteLock(e){const{serviceProvider:t,privKey:r}=e,i={timestamp:Math.floor(this.serverTimeOffset+Date.now()/1e3)};let n;n=r?ei(i,r):t.sign(new(T())((0,ze.So)(Zr.from(et()(i),"utf8"))));const s={key:Ne(r).getPublic("hex"),data:i,signature:n};return Lt(`${this.hostUrl}/acquireLock`,s)}async releaseWriteLock(e){const{serviceProvider:t,privKey:r,id:i}=e,n={timestamp:Math.floor(this.serverTimeOffset+Date.now()/1e3)};let s;s=r?ei(n,r):t.sign(new(T())((0,ze.So)(Zr.from(et()(n),"utf8"))));const o={key:Ne(r).getPublic("hex"),data:n,signature:s,id:i};return Lt(`${this.hostUrl}/releaseLock`,o)}toJSON(){return{enableLogging:this.enableLogging,hostUrl:this.hostUrl,storageLayerName:this.storageLayerName}}}var ri=ti,ii=r(8287).hp;class ni{constructor({enableLogging:e=!1,postboxKey:t}){_(this,"enableLogging",void 0),_(this,"postboxKey",void 0),_(this,"serviceProviderName",void 0),_(this,"migratableKey",null),this.enableLogging=e,this.postboxKey=new(T())(t,"hex"),this.serviceProviderName="ServiceProviderBase"}static fromJSON(e){const{enableLogging:t,postboxKey:r,serviceProviderName:i}=e;if("ServiceProviderBase"===i)return new ni({enableLogging:t,postboxKey:r})}async encrypt(e){return fe(this.retrievePubKey("ecc"),e)}async decrypt(e){return le(Ke(this.postboxKey),e)}retrievePubKeyPoint(){return Ne(this.postboxKey).getPublic()}retrievePubKey(e){if("ecc"===e)return Ce(this.postboxKey);throw new Error("Unsupported pub key type")}sign(e){const t=new(T())(e,"hex"),r=Ne(this.postboxKey).sign(t.toString("hex"));return ii.from(r.r.toString(16,64)+r.s.toString(16,64)+new(T())(0).toString(16,2),"hex").toString("base64")}toJSON(){return{enableLogging:this.enableLogging,postboxKey:this.postboxKey.toString("hex"),serviceProviderName:this.serviceProviderName}}}var si=ni;function oi(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const ai={[t.SAPPHIRE_DEVNET]:["https://node-1.dev-node.web3auth.io","https://node-2.dev-node.web3auth.io","https://node-3.dev-node.web3auth.io","https://node-4.dev-node.web3auth.io","https://node-5.dev-node.web3auth.io"],[t.SAPPHIRE_MAINNET]:["https://node-1.node.web3auth.io","https://node-2.node.web3auth.io","https://node-3.node.web3auth.io","https://node-4.node.web3auth.io","https://node-5.node.web3auth.io"]},ci=(e,t)=>{const r=ai[e];if(!r||0===r.length)throw new Error(`Unsupported network: ${e}`);const i=s[t];return r.map((e=>i&&i.networkIdentifier?`${e}/sss/${i.networkIdentifier}/jrpc`:`${e}/sss/jrpc`))},hi=(e,t)=>{const r=ai[e];if(!r||0===r.length)throw new Error(`Unsupported network: ${e}`);const i=s[t];return r.map((e=>i&&i.networkIdentifier?`${e}/rss/${i.networkIdentifier}`:`${e}/rss`))},di=(e,t,r=c.SECP256K1)=>{const i=ai[e];if(!i||0===i.length)throw new Error(`Unsupported network: ${e}`);const n=r===c.ED25519?"tss-frost":"tss",o=s[t];return i.map((e=>o&&o.networkIdentifier?`${e}/${n}/${o.networkIdentifier}`:`${e}/${n}`))},ui={[t.SAPPHIRE_MAINNET]:[{X:"e0925898fee0e9e941fdca7ee88deec99939ae9407e923535c4d4a3a3ff8b052",Y:"54b9fea924e3f3e40791f9987f4234ae4222412d65b74068032fa5d8b63375c1"},{X:"9124cf1e280aab32ba50dffd2de81cecabc13d82d2c1fe9de82f3b3523f9b637",Y:"fca939a1ceb42ce745c55b21ef094f543b457630cb63a94ef4f1afeee2b1f107"},{X:"555f681a63d469cc6c3a58a97e29ebd277425f0e6159708e7c7bf05f18f89476",Y:"606f2bcc0884fa5b64366fc3e8362e4939841b56acd60d5f4553cf36b891ac4e"},{X:"2b5f58d8e340f1ab922e89b3a69a68930edfe51364644a456335e179bc130128",Y:"4b4daa05939426e3cbe7d08f0e773d2bf36f64c00d04620ee6df2a7af4d2247"},{X:"3ecbb6a68afe72cf34ec6c0a12b5cb78a0d2e83ba402983b6adbc5f36219861a",Y:"dc1031c5cc8f0472bd521a62a64ebca9e163902c247bf05937daf4ae835091e4"}],[t.SAPPHIRE_DEVNET]:[{X:"f74389b0a4c8d10d2a687ae575f69b20f412d41ab7f1fe6b358aa14871327247",Y:"54e3a73098ed9bced3ef8821736e9794f9264a1420c0c7ad15d2fa617ba35ef7"},{X:"bc38813a6873e526087918507c78fc3a61624670ee851ecfb4f3bef55d027b5a",Y:"ac4b21229f662a0aefdfdac21cf17c3261a392c74a8790db218b34e3e4c1d56a"},{X:"b56541684ea5fa40c8337b7688d502f0e9e092098962ad344c34e94f06d293fb",Y:"759a998cef79d389082f9a75061a29190eec0cac99b8c25ddcf6b58569dad55c"},{X:"7bcb058d4c6ffc6ba4bfdfd93d141af35a66338a62c7c27cdad2ae3f8289b767",Y:"336ab1935e41ed4719e162587f0ab55518db4207a1eb36cc72303f1b86689d2b"},{X:"bf12a136ef94399ea098f926f04e26a4ec4ac70f69cce274e8893704c4951773",Y:"bdd44828020f52ce510e026338216ada184a6867eb4e19fb4c2d495d4a7e15e4"}]},fi=(e,t,r)=>({currentEpoch:"1",torusNodeEndpoints:ci(e,t),torusNodeSSSEndpoints:ci(e,t),torusNodeRSSEndpoints:hi(e,t),torusNodeTSSEndpoints:di(e,t,r),torusIndexes:[1,2,3,4,5],torusNodePub:ui[e]});function li(r,i){if(Object.values(t).includes(r))return fi(r,void 0,i);if(Object.values(e).includes(r)){const e=s[r];if(e.migrationCompleted)return fi(e.networkMigratedTo,r,i)}}const pi=rt().getLogger("fnd");var yi=class{constructor({network:e=t.SAPPHIRE_MAINNET,keyType:r=c.SECP256K1,fndServerEndpoint:i,enableLogging:n=!1}={}){_(this,"fndServerEndpoint","https://fnd.web3auth.io/node-details"),_(this,"_currentEpoch","1"),_(this,"_keyType",void 0),_(this,"_torusNodeEndpoints",[]),_(this,"_torusNodeRSSEndpoints",[]),_(this,"_torusNodeSSSEndpoints",[]),_(this,"_torusNodeTSSEndpoints",[]),_(this,"_torusNodePub",[]),_(this,"_torusIndexes",[]),_(this,"updated",void 0),_(this,"network",void 0),this.network=e,this._keyType=r,this.updated=!1,i&&(this.fndServerEndpoint=i),n?pi.enableAll():pi.disableAll()}get _nodeDetails(){return{currentEpoch:this._currentEpoch,torusNodeEndpoints:this._torusNodeEndpoints,torusNodeSSSEndpoints:this._torusNodeSSSEndpoints,torusNodeRSSEndpoints:this._torusNodeRSSEndpoints,torusNodeTSSEndpoints:this._torusNodeTSSEndpoints,torusNodePub:this._torusNodePub,torusIndexes:this._torusIndexes,updated:this.updated}}async getNodeDetails({verifier:e,verifierId:t}){try{if(this.updated&&!n.includes(this.network))return this._nodeDetails;try{const{nodeDetails:r}=await Ct(`${this.fndServerEndpoint}?network=${this.network}&verifier=${e}&verifierId=${t}&keyType=${this._keyType}`);return this.setNodeDetails(r),this._nodeDetails}catch(e){pi.error("Failed to fetch node details from server, using local.",e)}const r=li(this.network,this._keyType);if(!r)throw new Error("Failed to fetch node details");return this.setNodeDetails(r),this._nodeDetails}catch(e){throw pi.error("Failed to fetch node details",e),e}}async getMetadataUrl(){return Object.values(e).includes(this.network)?a[this.network]:(await this.getNodeDetails({verifier:"test-verifier",verifierId:"test-verifier-id"})).torusNodeEndpoints[0].replace("/sss/jrpc","/metadata")}setNodeDetails(e){const{currentEpoch:t,torusNodeEndpoints:r,torusNodeSSSEndpoints:i,torusNodeRSSEndpoints:n,torusNodeTSSEndpoints:s,torusNodePub:o,torusIndexes:a}=e;this._torusNodeEndpoints=r,this._torusNodeSSSEndpoints=i||[],this._torusNodeRSSEndpoints=n||[],this._torusNodeTSSEndpoints=s||[],this._torusNodePub=o,this._torusIndexes=a,this._currentEpoch=t,this.updated=!0}};const mi={logRequestTracing:!1},gi=rt().getLogger("torus.js");gi.disableAll();class bi extends Error{}class vi extends Error{constructor({errors:e,responses:t,predicate:r}){super(`Unable to resolve enough promises. \n      errors: ${e.map((e=>(null==e?void 0:e.message)||e)).join(", ")}, \n      predicate error: ${r},\n      ${t.length} responses,\n      responses: ${JSON.stringify(t)}`),_(this,"errors",void 0),_(this,"responses",void 0),_(this,"predicate",void 0),this.errors=e,this.responses=t,this.predicate=r}get message(){return`${super.message}. errors: ${this.errors.map((e=>(null==e?void 0:e.message)||e)).join(", ")} and ${this.responses.length} responses: ${JSON.stringify(this.responses)},\n      predicate error: ${this.predicate}`}toString(){return this.message}}const wi=(e,t)=>new Promise(((r,i)=>{let n=0;const s={resolved:!1},o=new Array(e.length).fill(void 0),a=new Array(e.length).fill(void 0);let c;e.forEach(((h,d)=>{h.then((e=>{a[d]=e})).catch((e=>{o[d]=e})).finally((()=>{if(!s.resolved)return t(a.slice(0),s).then((e=>{s.resolved=!0,r(e)})).catch((e=>{c=e})).finally((()=>{if(n+=1,n===e.length){const e=Object.values(a.reduce(((e,t)=>{if(t){var r;const{id:n,error:s}=t;(null==s||null===(r=s.data)||void 0===r?void 0:r.length)>0&&(s.data.startsWith("Error occurred while verifying params")?e[n]=(i=s.data).charAt(0).toUpperCase()+i.slice(1):e[n]=s.data)}var i;return e}),{}));if(e.length>0){const t=e.length>1?`\n${e.map((e=>` ${e}`)).join("\n")}`:e[0];i(new Error(t))}else{var t;i(new vi({errors:o,responses:a,predicate:(null===(t=c)||void 0===t?void 0:t.message)||c}))}}}))}))}))}));var Si=r(8287).hp;async function _i(e,t){const{legacyMetadataHost:r,serverTimeOffset:i,sessionAuthKey:n,enableOneKey:o,ecCurve:a,keyType:h,network:d,verifierParams:u,verifier:f,endpoints:l,isImportedShares:p}=e,y=1+~~(l.length/2);return wi(t,(async(e,t)=>{let r,s=[];if(1===e.length&&e[0]&&Array.isArray(e[0].result)){const t=e[0];e[0].result.forEach((e=>{s.push({id:t.id,jsonrpc:"2.0",result:e,error:t.error})}))}else s=e;const o=s.filter((e=>!(!e||"object"!=typeof e||e.error))),c=s.map((e=>{if(e&&e.result&&e.result.keys[0].public_key)return e.result.keys[0].public_key})),h=ct(c,y);if(!h)throw new Error("invalid result from nodes, threshold number of public key results are not matching");s.forEach((e=>{const t=e&&e.result&&e.result.keys[0].public_key&&e.result.keys[0];if(t&&!r&&!u.extended_verifier_id){var i;const e=t.public_key;(null===(i=t.nonce_data)||void 0===i||null===(i=i.pubNonce)||void 0===i?void 0:i.x)&&e.X===h.X&&(r=t.nonce_data)}}));const d=p?l.length:y;if(o.length>=d&&h){const e=[],s=[],c=[],d=[],l=[],p=[],b=[];for(let t=0;t<o.length;t+=1){var f;const r=o[t],{session_tokens:i,session_token_metadata:a,session_token_sigs:h,session_token_sig_metadata:u,keys:l,is_new_key:y,server_time_offset:v}=r.result;var m,g;if(p.push({isNewKey:y,publicKey:(null===(f=r.result)||void 0===f||null===(f=f.keys[0])||void 0===f||null===(f=f.public_key)||void 0===f?void 0:f.X)||""}),b.push(v||"0"),(null==h?void 0:h.length)>0?u&&null!==(m=u[0])&&void 0!==m&&m.ephemPublicKey?s.push(zt(u[0],h[0],n).catch((e=>gi.error("session sig decryption",e)))):s.push(Promise.resolve(Si.from(h[0],"hex"))):s.push(Promise.resolve(void 0)),(null==i?void 0:i.length)>0?a&&null!==(g=a[0])&&void 0!==g&&g.ephemPublicKey?c.push(zt(a[0],i[0],n).catch((e=>gi.error("session token sig decryption",e)))):c.push(Promise.resolve(Si.from(i[0],"base64"))):c.push(Promise.resolve(void 0)),(null==l?void 0:l.length)>0){const t=r.result.keys[0];d.push(new(T())(t.node_index)),t.share_metadata&&e.push(Jt(t.share_metadata,Si.from(t.share,"base64").toString("binary"),n).catch((e=>gi.error("share decryption",e))))}else d.push(void 0),e.push(Promise.resolve(void 0))}const v=await Promise.all(e.concat(s).concat(c)),w=v.slice(0,e.length),S=v.slice(e.length,e.length+s.length),_=v.slice(e.length+s.length,v.length),x=S.filter((e=>!!e));if(!u.extended_verifier_id&&x.length<y)throw new Error(`Insufficient number of signatures from nodes, required: ${y}, found: ${x.length}`);const k=_.filter((e=>!!e));if(!u.extended_verifier_id&&k.length<y)throw new Error(`Insufficient number of session tokens from nodes, required: ${y}, found: ${k.length}`);if(_.forEach(((e,t)=>{e&&S[t]?l.push({token:e.toString("base64"),signature:S[t].toString("hex"),node_pubx:o[t].result.node_pubx,node_puby:o[t].result.node_puby}):l.push(void 0)})),t.resolved)return;const P=w.reduce(((e,t,r)=>(t&&e.push({index:d[r],value:new(T())(t)}),e)),[]),M=at(P.length,y);let E=null;for(let e=0;e<M.length;e+=1){const t=M[e],r=P.filter(((e,r)=>t.includes(r))),i=r.map((e=>e.value)),n=r.map((e=>e.index)),s=_t(a,i,n);if(!s)continue;const o=rr(a,s),c=o.getX(),d=o.getY();if(0===c.cmp(new(T())(h.X,16))&&0===d.cmp(new(T())(h.Y,16))){E=s;break}}if(null==E)throw new Error("could not derive private key");let I=!1;p.forEach((e=>{"true"===e.isNewKey&&e.publicKey.toLowerCase()===h.X.toLowerCase()&&(I=!0)}));const A=b.map((e=>Number.parseInt(e,10)));return{privateKey:E,sessionTokenData:l,thresholdNonceData:r,nodeIndexes:d,thresholdPubKey:h,isNewKey:I,serverTimeOffsetResponse:i||ft(A)}}if(o.length<d)throw new Error("Waiting for results from more nodes, pending: "+(d-o.length));throw new Error(`Invalid results, threshold pub key: ${h}, nonce data found: ${!!r}, extended verifierId: ${u.extended_verifier_id}`)})).then((async e=>{var t;const{privateKey:l,thresholdPubKey:p,sessionTokenData:y,nodeIndexes:m,thresholdNonceData:g,isNewKey:b,serverTimeOffsetResponse:v}=e;let w=g;if(!l)throw new Error("Invalid private key returned");const S=l,_=rr(a,S),x=_.getX().toString("hex",64),k=_.getY().toString("hex",64);if(!w&&!u.extended_verifier_id&&!s[d]){const e=await Xt(d,p.X,p.Y,i,S);if(!e||g)throw new Error(`invalid metadata result from nodes, nonce metadata is empty for verifier: ${f} and verifierId: ${u.verifier_id}`);w=e}let P,M,E=new(T())(null!==(t=w)&&void 0!==t&&t.nonce?w.nonce.padStart(64,"0"):"0","hex"),I="v1";if(u.extended_verifier_id)I="v2",P=a.keyFromPublic({x,y:k}).getPublic();else if(s[d])if(o)if(w=await Yt(r,a,v,x,k,S,!b),E=new(T())(w.nonce||"0",16),I=w.typeOfUser,"v2"===I)M={X:w.pubNonce.x,Y:w.pubNonce.y},P=a.keyFromPublic({x,y:k}).getPublic().add(a.keyFromPublic({x:w.pubNonce.x,y:w.pubNonce.y}).getPublic());else{I="v1",E=await Ht(r,{pub_key_X:x,pub_key_Y:k});const e=S.add(E).umod(a.n);P=a.keyFromPrivate(e.toString(16,64),"hex").getPublic()}else{I="v1",E=await Ht(r,{pub_key_X:x,pub_key_Y:k});const e=S.add(E).umod(a.n);P=a.keyFromPrivate(e.toString(16,64),"hex").getPublic()}else I="v2",P=a.keyFromPublic({x,y:k}).getPublic().add(a.keyFromPublic({x:w.pubNonce.x,y:w.pubNonce.y}).getPublic()),M={X:w.pubNonce.x,Y:w.pubNonce.y};if(!P)throw new Error("Invalid public key, this might be a bug, please report this to web3auth team");let A="",O=!1;const N=function(e,t){return er(e,ot(e).keyFromPrivate(t.toString("hex",64),"hex"))}(h,S),K=tr(h,P.getX(),P.getY());let C="";if("v1"===I?O=null:"v2"===I&&(O=E.eq(new(T())("0"))),("v1"===I||"v2"===I&&E.gt(new(T())(0)))&&(C=S.add(E).umod(a.n).toString("hex",64)),h===c.SECP256K1)A=C;else{if(h!==c.ED25519)throw new Error(`Invalid keyType: ${h}`);if(C&&!w.seed)throw new Error("Invalid data, seed data is missing for ed25519 key, Please report this bug");C&&w.seed&&(A=(await Wt(w.seed,new(T())(C,"hex"))).toString("hex"))}let L=S,R=x,B=k;if(h===c.ED25519){const{scalar:e,point:t}=$t(l);if(L=e,R=t.getX().toString(16,64),B=t.getY().toString(16,64),p.SignerX.padStart(64,"0")!==R||p.SignerY.padStart(64,"0")!==B)throw new Error("Invalid postbox key")}return{finalKeyData:{walletAddress:K,X:P.getX().toString(16,64),Y:P.getY().toString(16,64),privKey:A},oAuthKeyData:{walletAddress:N,X:x,Y:k,privKey:S.toString("hex",64)},postboxKeyData:{privKey:L.toString("hex",64),X:R,Y:B},sessionData:{sessionTokenData:y,sessionAuthKey:n.toString("hex").padStart(64,"0")},metadata:{pubNonce:M,nonce:E,typeOfUser:I,upgraded:O,serverTimeOffset:v},nodesData:{nodeIndexes:m.map((e=>e.toNumber()))}}}))}async function xi(e){const{legacyMetadataHost:t,enableOneKey:r,ecCurve:i,keyType:n,allowHost:s,network:o,clientId:a,endpoints:h,nodePubkeys:d,indexes:u,verifier:f,verifierParams:l,idToken:p,overrideExistingKey:y,newImportedShares:m,extraParams:g,useDkg:b=!0,serverTimeOffset:v,checkCommitment:w=!0}=e;await Ct(s,{headers:{verifier:f,verifierid:l.verifier_id,network:o,clientid:a,enablegating:"true"}},{useAPIKey:!0});const S=(0,ae.F_)(),_=(0,ae.qb)(S).toString("hex"),x=_.slice(2,66),k=_.slice(66);let P=[];const M=1+~~(h.length/2);if((null==m?void 0:m.length)>0){if(m.length!==h.length)throw new Error("Invalid imported shares length");P=m}else if(!b){const e=n===c.SECP256K1?st(i,Si):await nr(32),t=await ir(i,n,v,u,d,Si.from(e));P=[...P,...t]}let E,I=[];const A=[];if(w){I=await(async e=>{const{idToken:t,endpoints:r,indexes:i,keyType:n,verifier:s,verifierParams:o,pubKeyX:a,pubKeyY:c,finalImportedShares:h,overrideExistingKey:d}=e,u=nt(Si.from(t,"utf8")),f=1+~~(3*r.length/4),l=1+~~(r.length/2),p=[];for(let e=0;e<r.length;e+=1){const t=lt((()=>Lt(r[e],Ft("CommitmentRequest",{messageprefix:"mug00",keytype:n,tokencommitment:u.slice(2),temppubx:a,temppuby:c,verifieridentifier:s,verifier_id:o.verifier_id,extended_verifier_id:o.extended_verifier_id,is_import_key_flow:h.length>0}),{},{logTracingHeader:mi.logRequestTracing})),4);p.push(t)}return new Promise(((e,t)=>{wi(p,(e=>{const t=e.filter((e=>!(!e||"object"!=typeof e||e.error)));if(h.length>0){if(d&&t.length===r.length){if(t.find((e=>!!e)))return Promise.resolve(e)}else if(!d&&t.length>=f){const n=[];for(let e=0;e<t.length;e+=1){const r=t[e];r&&"object"==typeof r&&!r.error&&r&&n.push(r.result)}const a=ct(n.map((e=>e&&e.pub_key_x)),l),c=ut(r,s,o.verifier_id),h=i[c].toString(10);if((a||!a&&t.length===r.length)&&t.find((e=>{var t;return!(!e||(null===(t=e.result)||void 0===t?void 0:t.nodeindex)!==h)})))return Promise.resolve(e)}}else if(t.length>=f&&t.find((e=>!!e)))return Promise.resolve(e);return Promise.reject(new Error(`invalid commitment results ${JSON.stringify(e)}`))})).then((t=>e(t))).catch(t)}))})({idToken:p,endpoints:h,indexes:u,keyType:n,verifier:f,verifierParams:l,pubKeyX:x,pubKeyY:k,finalImportedShares:P,overrideExistingKey:y});for(let e=0;e<I.length;e+=1){const t=I[e];t&&"object"==typeof t&&!t.error&&t&&A.push(t.result)}E=!!ct(A.map((e=>e&&e.pub_key_x)),M)}else if(!w&&P.length>0&&!y){var T,O;const e=await(async e=>{const{endpoints:t,verifier:r,verifierId:i,keyType:n}=e,s=1+~~(t.length/2),o=t.map((e=>Lt(e,Ft("VerifierLookupRequest",{verifier:r,verifier_id:i.toString(),key_type:n,client_time:Math.floor(Date.now()/1e3).toString()}),{},{logTracingHeader:mi.logRequestTracing}).catch((e=>gi.error(`${Dt} request failed`,e)))));return await wi(o,(async e=>{const t=e.filter((e=>!(!e||e.error)&&e)),n=ct(e.map((e=>e&&e.error)),s),o=ct(t.map((e=>e&&(e=>{const t={keys:[]};if(e&&e.keys&&e.keys.length>0){const r=e.keys[0];t.keys=[{pub_key_X:r.pub_key_X,pub_key_Y:r.pub_key_Y,address:r.address}]}return t})(e.result))),s);if(o||n){const e=o?ft([]):0;return Promise.resolve({keyResult:o,serverTimeOffset:e,errorResult:n})}return Promise.reject(new Error(`invalid lookup result: ${JSON.stringify(e)}\n        )} for verifier: ${r}, verifierId: ${i}`))}))})({endpoints:h,verifier:f,verifierId:l.verifier_id,keyType:n});if(e.errorResult&&(null===(T=e.errorResult)||void 0===T||null===(T=T.data)||void 0===T||!T.includes("Verifier + VerifierID has not yet been assigned")))throw new Error(`node results do not match at first lookup ${JSON.stringify(e.keyResult||{})}, ${JSON.stringify(e.errorResult||{})}`);(null===(O=e.keyResult)||void 0===O||null===(O=O.keys)||void 0===O?void 0:O.length)>0&&(E=!!e.keyResult.keys[0])}const N=[],K=y||!b&&!E;if(K){const e=ut(h,f,l.verifier_id),t=[];for(let e=0;e<h.length;e+=1){const r=P[e];if(!r)throw new Error(`invalid imported share at index ${e}`);t.push(se(se({},l),{},{idtoken:p,nodesignatures:A,verifieridentifier:f,pub_key_x:r.oauth_pub_key_x,pub_key_y:r.oauth_pub_key_y,signing_pub_key_x:r.signing_pub_key_x,signing_pub_key_y:r.signing_pub_key_y,encrypted_share:r.encrypted_share,encrypted_share_metadata:r.encrypted_share_metadata,node_index:r.node_index,key_type:r.key_type,nonce_data:r.nonce_data,nonce_signature:r.nonce_signature,sss_endpoint:h[e]},g))}const r=Lt(h[e],Ft("ImportShares",{encrypted:"yes",use_temp:!0,verifieridentifier:f,temppubx:0!==A.length||w?"":x,temppuby:0!==A.length||w?"":k,item:t,key_type:n,one_key_flow:!0}),{},{logTracingHeader:mi.logRequestTracing}).catch((e=>gi.error("share req",e)));N.push(r)}else for(let e=0;e<h.length;e+=1){const t=Lt(h[e],Ft("GetShareOrKeyAssign",{encrypted:"yes",use_temp:!0,key_type:n,distributed_metadata:!0,verifieridentifier:f,temppubx:0!==A.length||w?"":x,temppuby:0!==A.length||w?"":k,item:[se(se({},l),{},{idtoken:p,key_type:n,nodesignatures:A,verifieridentifier:f},g)],client_time:Math.floor(Date.now()/1e3).toString(),one_key_flow:!0}),{},{logTracingHeader:mi.logRequestTracing});N.push(t)}return _i({legacyMetadataHost:t,serverTimeOffset:v,sessionAuthKey:S,enableOneKey:r,ecCurve:i,keyType:n,network:o,verifier:f,verifierParams:l,endpoints:h,isImportedShares:K},N)}var ki=r(8287).hp;class Pi{constructor({enableOneKey:e=!1,clientId:t,network:r,serverTimeOffset:i=0,allowHost:n,legacyMetadataHost:h,keyType:d=c.SECP256K1}){if(_(this,"allowHost",void 0),_(this,"serverTimeOffset",void 0),_(this,"network",void 0),_(this,"clientId",void 0),_(this,"ec",void 0),_(this,"enableOneKey",void 0),_(this,"legacyMetadataHost",void 0),_(this,"keyType",c.SECP256K1),!t)throw new Error("Please provide a valid clientId in constructor");if(!r)throw new Error("Please provide a valid network in constructor");if(d===c.ED25519&&s[r])throw new Error(`keyType: ${d} is not supported by ${r} network`);this.keyType=d,this.ec=new ce.ec(this.keyType),this.serverTimeOffset=i||0,this.network=r,this.clientId=t,this.allowHost=n||`${o[r]}/api/allow`,this.enableOneKey=e,this.legacyMetadataHost=h||a[r]}static enableLogging(e=!0){e?(gi.enableAll(),mi.logRequestTracing=!0):gi.disableAll()}static setAPIKey(e){Tt(e)}static setEmbedHost(e){At(e)}static setSessionTime(e){Pi.sessionTime=e}static isGetOrSetNonceError(e){return e instanceof bi}static getPostboxKey(e){return"v1"===e.metadata.typeOfUser&&e.finalKeyData.privKey||e.postboxKeyData.privKey}async retrieveShares(e){const{verifier:t,verifierParams:r,idToken:i,nodePubkeys:n,indexes:o,endpoints:a,useDkg:h,extraParams:d={},checkCommitment:u=!0}=e;if(0===n.length)throw new Error("nodePubkeys param is required");if(n.length!==o.length)throw new Error("nodePubkeys length must be same as indexes length");if(n.length!==a.length)throw new Error("nodePubkeys length must be same as endpoints length");let f;if("boolean"==typeof h){if(!1===h&&s[this.network])throw new Error(`useDkg cannot be false for legacy network; ${this.network}`);f=this.keyType!==c.ED25519&&h}else f=this.keyType!==c.ED25519;if(!f&&0===n.length)throw new Error("nodePubkeys param is required");return d.session_token_exp_second||(d.session_token_exp_second=Pi.sessionTime),xi({legacyMetadataHost:this.legacyMetadataHost,serverTimeOffset:this.serverTimeOffset,enableOneKey:this.enableOneKey,ecCurve:this.ec,keyType:this.keyType,allowHost:this.allowHost,network:this.network,clientId:this.clientId,endpoints:a,indexes:o,verifier:t,verifierParams:r,idToken:i,useDkg:f,newImportedShares:[],overrideExistingKey:!1,nodePubkeys:n,extraParams:d,checkCommitment:u})}async retrieveSharesWithLinkedPasskey(e){const{passkeyPublicKey:t,idToken:r,nodePubkeys:i,indexes:n,endpoints:o,extraParams:a={}}=e;if(0===i.length)throw new Error("nodePubkeys param is required");if(i.length!==n.length)throw new Error("nodePubkeys length must be same as indexes length");if(i.length!==o.length)throw new Error("nodePubkeys length must be same as endpoints length");if(s[this.network])throw new Error(`retrieveSharesWithLinkedPasskey is not supported by legacy network; ${this.network}`);return async function(e){const{endpoints:t,passkeyPublicKey:r,idToken:i,keyType:n,sessionExpSecond:s,extraParams:o,serverTimeOffset:a,ecCurve:c,network:h}=e,d=(0,ae.F_)(),u=(0,ae.qb)(d).toString("hex"),f=u.slice(2,66),l=u.slice(66),p=[],y=se({},o);for(let e=0;e<t.length;e+=1){const o=Lt(t[e],Ft("RetrieveSharesWithLinkedPasskey",{encrypted:"yes",key_type:n,passkey_pub_key:r,temp_pub_x:f,temp_pub_y:l,passkey_auth_data:se({verifier_id:r,id_token:i,key_type:n,session_token_exp_second:s},y),client_time:Math.floor(Date.now()/1e3).toString()}),{},{logTracingHeader:mi.logRequestTracing});p.push(o)}return _i({legacyMetadataHost:"",serverTimeOffset:a,sessionAuthKey:d,enableOneKey:!0,ecCurve:c,keyType:n,network:h,verifierParams:{verifier_id:r},endpoints:t,isImportedShares:!1},p)}({serverTimeOffset:this.serverTimeOffset,ecCurve:this.ec,keyType:this.keyType,allowHost:this.allowHost,network:this.network,clientId:this.clientId,endpoints:o,indexes:n,nodePubkeys:i,idToken:r,passkeyPublicKey:t,extraParams:a,sessionExpSecond:Pi.sessionTime})}async getPublicAddress(e,t,{verifier:r,verifierId:i,extendedVerifierId:n}){return gi.info(t,{verifier:r,verifierId:i,extendedVerifierId:n}),this.getNewPublicAddress(e,{verifier:r,verifierId:i,extendedVerifierId:n},this.enableOneKey)}async importPrivateKey(e){const{nodeIndexes:t,newPrivateKey:r,verifier:i,verifierParams:n,idToken:o,nodePubkeys:a,endpoints:h,extraParams:d={},checkCommitment:u=!0}=e;if(s[this.network])throw new Error(`importPrivateKey is not supported by legacy network; ${this.network}`);if(h.length!==t.length)throw new Error("length of endpoints array must be same as length of nodeIndexes array");let f;if(d.session_token_exp_second||(d.session_token_exp_second=Pi.sessionTime),this.keyType===c.SECP256K1&&(f=ki.from(r.padStart(64,"0"),"hex"),32!==f.length))throw new Error("Invalid private key length for given secp256k1 key");if(this.keyType===c.ED25519&&(f=ki.from(r.padStart(64,"0"),"hex"),32!==f.length))throw new Error("Invalid private key length for given ed25519 key");const l=await ir(this.ec,this.keyType,this.serverTimeOffset,t,a,f);if(this.keyType===c.ED25519){const e=Zt(Qt(f).point),t=Zt(l[0].final_user_point);if(ki.from(e).toString("hex")!==t.toString("hex"))throw new Error("invalid shares data for ed25519 key, public key is not matching after generating shares")}return xi({legacyMetadataHost:this.legacyMetadataHost,serverTimeOffset:this.serverTimeOffset,enableOneKey:this.enableOneKey,ecCurve:this.ec,keyType:this.keyType,allowHost:this.allowHost,network:this.network,clientId:this.clientId,endpoints:h,indexes:t,verifier:i,verifierParams:n,idToken:o,useDkg:!1,overrideExistingKey:!0,newImportedShares:l,nodePubkeys:a,extraParams:d,checkCommitment:u})}async getUserTypeAndAddress(e,{verifier:t,verifierId:r,extendedVerifierId:i}){return this.getNewPublicAddress(e,{verifier:t,verifierId:r,extendedVerifierId:i},!0)}async getNewPublicAddress(e,{verifier:t,verifierId:r,extendedVerifierId:i},n){const o=await(async e=>{const{endpoints:t,network:r,verifier:i,verifierId:n,extendedVerifierId:o,keyType:a}=e,c=1+~~(t.length/2),h=t.map((e=>Lt(e,Ft(Dt,{distributed_metadata:!0,verifier:i,verifier_id:n.toString(),extended_verifier_id:o,one_key_flow:!0,key_type:a,fetch_node_index:!0,client_time:Math.floor(Date.now()/1e3).toString()}),{},{logTracingHeader:mi.logRequestTracing}).catch((e=>gi.error(`${Dt} request failed`,e)))));let d;const u=[];return await wi(h,(async e=>{const t=e.filter((e=>!(!e||e.error)&&e)),a=ct(e.map((e=>e&&e.error)),c),h=ct(t.map((e=>e&&(e=>{const t={keys:[],is_new_key:e.is_new_key};if(e&&e.keys&&e.keys.length>0){const r=e.keys[0];t.keys=[{pub_key_X:r.pub_key_X,pub_key_Y:r.pub_key_Y,address:r.address}]}return t})(e.result))),c);if(h&&!d&&!o&&!s[r]){for(let t=0;t<e.length;t++){const r=e[t];if(r&&!r.error){var f;const e=r.result.keys[0].pub_key_X.toLowerCase(),t=h.keys[0].pub_key_X.toLowerCase();if((null===(f=r.result)||void 0===f||null===(f=f.keys[0].nonce_data)||void 0===f||null===(f=f.pubNonce)||void 0===f?void 0:f.x)&&e===t){d=r.result.keys[0].nonce_data;break}}}if(!d){const e=await Xt(r,h.keys[0].pub_key_X,h.keys[0].pub_key_Y);!d&&e&&(d=e,d.nonce&&delete d.nonce)}}const l=[];if(h&&(d||o||s[r])||a){h&&e.forEach((e=>{if(e&&e.result){if(e.result.keys[0].pub_key_X.toLowerCase()===h.keys[0].pub_key_X.toLowerCase()){const t=Number.parseInt(e.result.node_index);t&&u.push(t)}const t=e.result.server_time_offset?Number.parseInt(e.result.server_time_offset,10):0;l.push(t)}}));const t=h?ft(l):0;return Promise.resolve({keyResult:h,serverTimeOffset:t,nodeIndexes:u,errorResult:a,nonceResult:d})}return Promise.reject(new Error(`invalid public key result: ${JSON.stringify(e)} and nonce result:${JSON.stringify(d||{})} for verifier: ${i}, verifierId: ${n} and extendedVerifierId: ${o} `))}))})({endpoints:e,network:this.network,verifier:t,verifierId:r,keyType:this.keyType,extendedVerifierId:i}),{errorResult:a,keyResult:c,nodeIndexes:h=[],serverTimeOffset:d}=o,u=this.serverTimeOffset||d,{nonceResult:f}=o;if(a&&JSON.stringify(a).toLowerCase().includes("verifier not supported"))throw new Error("Verifier not supported. Check if you: \n\n      1. Are on the right network (Torus testnet/mainnet) \n\n      2. Have setup a verifier on dashboard.web3auth.io?");if(a)throw new Error(`node results do not match at first lookup ${JSON.stringify(c||{})}, ${JSON.stringify(a||{})}`);if(null==c||!c.keys)throw new Error(`node results do not match at final lookup ${JSON.stringify(c||{})}, ${JSON.stringify(a||{})}`);if(!f&&!i&&!s[this.network])throw new bi("metadata nonce is missing in share response");const{pub_key_X:l,pub_key_Y:p}=c.keys[0];let y;const m=new(T())((null==f?void 0:f.nonce)||"0",16);let g,b;if(i)b=this.ec.keyFromPublic({x:l,y:p}).getPublic(),g=b;else{if(s[this.network])return this.formatLegacyPublicKeyData({isNewKey:c.is_new_key,enableOneKey:n,finalKeyResult:{keys:c.keys},serverTimeOffset:u});{const e=f;g=this.ec.keyFromPublic({x:l,y:p}).getPublic(),b=this.ec.keyFromPublic({x:l,y:p}).getPublic().add(this.ec.keyFromPublic({x:e.pubNonce.x,y:e.pubNonce.y}).getPublic()),y={X:e.pubNonce.x,Y:e.pubNonce.y}}}if(!g)throw new Error("Unable to derive oAuthPubKey");const v=g.getX().toString(16,64),w=g.getY().toString(16,64),S=tr(this.keyType,g.getX(),g.getY());if(!b)throw new Error("Unable to derive finalPubKey");const _=b?b.getX().toString(16,64):"",x=b?b.getY().toString(16,64):"";return{oAuthKeyData:{walletAddress:S,X:v,Y:w},finalKeyData:{walletAddress:b?tr(this.keyType,b.getX(),b.getY()):"",X:_,Y:x},metadata:{pubNonce:y,nonce:m,upgraded:(null==f?void 0:f.upgraded)||!1,typeOfUser:"v2",serverTimeOffset:u},nodesData:{nodeIndexes:h}}}async formatLegacyPublicKeyData(e){var t;const{finalKeyResult:r,enableOneKey:i,isNewKey:n,serverTimeOffset:s}=e,{pub_key_X:o,pub_key_Y:a}=r.keys[0];let c,h,d,u,f;const l=this.ec.keyFromPublic({x:o,y:a}).getPublic(),p=this.serverTimeOffset||s;if(i){try{c=await Yt(this.legacyMetadataHost,this.ec,p,o,a,void 0,!n),h=new(T())(c.nonce||"0",16),u=c.typeOfUser}catch{throw new bi}if("v1"===c.typeOfUser)h=await Ht(this.legacyMetadataHost,{pub_key_X:o,pub_key_Y:a}),d=this.ec.keyFromPublic({x:o,y:a}).getPublic().add(this.ec.keyFromPrivate(h.toString(16,64),"hex").getPublic());else{if("v2"!==c.typeOfUser)throw new Error("getOrSetNonce should always return typeOfUser.");d=this.ec.keyFromPublic({x:o,y:a}).getPublic().add(this.ec.keyFromPublic({x:c.pubNonce.x,y:c.pubNonce.y}).getPublic()),f={X:c.pubNonce.x,Y:c.pubNonce.y}}}else u="v1",h=await Ht(this.legacyMetadataHost,{pub_key_X:o,pub_key_Y:a}),d=this.ec.keyFromPublic({x:o,y:a}).getPublic().add(this.ec.keyFromPrivate(h.toString(16,64),"hex").getPublic());if(!l)throw new Error("Unable to derive oAuthPubKey");const y=l.getX().toString(16,64),m=l.getY().toString(16,64),g=tr(this.keyType,l.getX(),l.getY());if("v2"===u&&!d)throw new Error("Unable to derive finalPubKey");const b=d?d.getX().toString(16,64):"",v=d?d.getY().toString(16,64):"";return{oAuthKeyData:{walletAddress:g,X:y,Y:m},finalKeyData:{walletAddress:d?tr(this.keyType,d.getX(),d.getY()):"",X:b,Y:v},metadata:{pubNonce:f,nonce:h,upgraded:(null===(t=c)||void 0===t?void 0:t.upgraded)||!1,typeOfUser:u,serverTimeOffset:p},nodesData:{nodeIndexes:[]}}}}_(Pi,"sessionTime",86400);const Mi="facebook",Ei="apple",Ii="github",Ai="linkedin",Ti="twitter",Oi="weibo",Ni="line",Ki="email_password",Ci="passwordless",Li="email_passwordless",Ri="sms_passwordless",Bi="single_id_verifier",Fi="popup",Di="redirect",Ui="localStorage",ji="server",qi="triggerLogin",$i="triggerAggregateLogin";var zi=r(6880),Ji=r.n(zi),Hi=rt().getLogger("customauth");const Vi={[Ei]:"apple",[Ii]:"github",[Ai]:"linkedin",[Ti]:"twitter",[Oi]:"weibo",[Ni]:"line",[Ki]:"Username-Password-Authentication",[Ci]:"email",[Li]:"email",[Ri]:"sms"},Yi=e=>e.href.endsWith("/")?e.href:`${e.href}/`,Wi={webWorkerSupport:!1};function Xi(e,t){return t?e:e.toLowerCase()}const Gi=(e,t,r,i=!0)=>{const{name:n,sub:s}=e;if(r)return Xi(e[r],i);switch(t){case Ci:case Ki:case Li:case Ri:return Xi(n,i);case Oi:case Ii:case Ti:case Ei:case Ai:case Ni:case"jwt":return Xi(s,i);default:throw new Error("Invalid login type to get verifier id")}},Qi=(e,t)=>{const r=e.split("&").reduce(((e,t)=>{const[r,i]=t.split("=");return e[r]=i,e}),{});Hi.info(r,t);let i={},n="";return Object.keys(r).length>0&&r.state?(i=JSON.parse(Qr().decode(decodeURIComponent(decodeURIComponent(r.state))))||{},n=r.error_description||r.error||n):Object.keys(t).length>0&&t.state&&(i=JSON.parse(Qr().decode(decodeURIComponent(decodeURIComponent(t.state))))||{},t.error&&(n=t.error)),{error:n,instanceParameters:i,hashParameters:r}};function Zi(e){const{baseURL:t,query:r,hash:i}=e,n=new URL(t);if(r&&Object.keys(r).forEach((e=>{n.searchParams.append(e,r[e])})),i){const e=new URL(Zi({baseURL:t,query:i})).searchParams.toString();n.hash=e}return n.toString()}const en=e=>{try{return new URL(decodeURIComponent(e))}catch(t){throw new Error(`${(null==t?void 0:t.message)||""}, Note: Your jwt domain: (i.e ${e}) must have http:// or https:// prefix`)}};function tn(e){const[t,r]=e.split(".");return{header:JSON.parse(Qr().decode(t)),payload:JSON.parse(Qr().decode(r))}}var rn=r(7007);class nn extends rn.EventEmitter{constructor({url:e,target:t,features:r,timeout:i=3e4}){super(),_(this,"url",void 0),_(this,"target",void 0),_(this,"features",void 0),_(this,"window",void 0),_(this,"windowTimer",void 0),_(this,"iClosedWindow",void 0),_(this,"timeout",void 0),this.url=e,this.target=t||"_blank",this.features=r||function(){const e=void 0!==window.screenLeft?window.screenLeft:window.screenX,t=void 0!==window.screenTop?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,i=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,n=Math.abs((r-1200)/2/1+e);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=1200,top=${Math.abs((i-700)/2/1+t)},left=${n}`}(),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=i,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval((()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout((()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0}),this.timeout)),void 0===this.window&&clearInterval(this.windowTimer)}),500))}open(){var e;if(this.window=window.open(this.url.href,this.target,this.features),!this.window)throw new Error("popup window is blocked");return null!==(e=this.window)&&void 0!==e&&e.focus&&this.window.focus(),Promise.resolve()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}const sn=["access_token","id_token"];class on{constructor(e){_(this,"nonce",Math.random().toString(36).slice(2)),_(this,"finalURL",void 0),_(this,"params",void 0),this.params=e}get state(){return encodeURIComponent(Qr().encode(JSON.stringify(se(se({},this.params.customState||{}),{},{instanceId:this.nonce,verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin,redirectToOpener:this.params.redirectToOpener||!1}))))}async handleLoginWindow(e){const t=new nn({url:this.finalURL,features:e.popupFeatures,timeout:(i=this.params.typeOfLogin,i!==Mi&&i!==Ni||!function(){const e=Ji().getParser(navigator.userAgent).getPlatform();return e.type===Ji().PLATFORMS_MAP.tablet||e.type===Ji().PLATFORMS_MAP.mobile}()?1e4:6e4)});var i;if(this.params.uxMode!==Di){const{BroadcastChannel:e}=await Promise.resolve().then(r.bind(r,1352));return new Promise(((r,i)=>{let n;const s=async e=>{try{const{error:t,data:s}=e,o=s||{},{instanceParams:a,hashParams:{access_token:c,id_token:h}}=o,d=oi(o.hashParams,sn);if(t)return Hi.error(e),void i(new Error(`Error: ${t}. Info: ${JSON.stringify(e.data||{})}`));e.data&&a.verifier===this.params.verifier&&(Hi.info(e.data),!this.params.redirectToOpener&&n&&await n.postMessage({success:!0}),r(se(se({accessToken:c,idToken:h||""},d),{},{state:a})))}catch(e){Hi.error(e),i(e)}};if(this.params.redirectToOpener){const e=async r=>{if(!r.data)return;const i=r.data;i.channel===`redirect_channel_${this.nonce}`&&(window.removeEventListener("message",e),s(i),t.close())};window.addEventListener("message",e)}else n=new e(`redirect_channel_${this.nonce}`,Wi),n.addEventListener("message",(async e=>{await s(e),n.close(),t.close()}));try{t.open()}catch(e){return Hi.error(e),void i(e)}t.once("close",(()=>{n&&n.close(),i(new Error("user closed popup"))}))}))}return t.redirect(e.locationReplaceOnRedirect),null}}class an extends on{constructor(e){super(e),_(this,"RESPONSE_TYPE","token"),_(this,"SCOPE","identify email"),this.setFinalUrl()}setFinalUrl(){const e=new URL("https://discord.com/api/oauth2/authorize"),t=JSON.parse(JSON.stringify(this.params.jwtParams||{})),r=Pt()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.params.clientId,redirect_uri:this.params.redirect_uri,scope:this.SCOPE},t);Object.keys(r).forEach((t=>{const i=t;r[i]&&e.searchParams.append(i,r[i])})),this.finalURL=e}async getUserInfo(e){const{accessToken:t}=e,r=await Ct("https://discord.com/api/users/@me",{headers:{Authorization:`Bearer ${t}`}}),{id:i,avatar:n,email:s="",username:o="",discriminator:a=""}=r;return{profileImage:null===n?`https://cdn.discordapp.com/embed/avatars/${Number(a)%5}.png`:`https://cdn.discordapp.com/avatars/${i}/${n}.png?size=2048`,name:`${o}#${a}`,email:s,verifierId:i,verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}}class cn extends on{constructor(e){super(e),_(this,"RESPONSE_TYPE","token"),_(this,"SCOPE","public_profile email"),this.setFinalUrl()}setFinalUrl(){const e=new URL("https://www.facebook.com/v20.0/dialog/oauth"),t=JSON.parse(JSON.stringify(this.params.jwtParams||{})),r=Pt()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.params.clientId,redirect_uri:this.params.redirect_uri,scope:this.SCOPE},t);Object.keys(r).forEach((t=>{const i=t;r[i]&&e.searchParams.append(i,r[i])})),this.finalURL=e}async getUserInfo(e){const{accessToken:t}=e,r=await Ct("https://graph.facebook.com/me?fields=name,email,picture.type(large)",{headers:{Authorization:`Bearer ${t}`}}),{name:i="",id:n,picture:s,email:o=""}=r;return{email:o,name:i,profileImage:s.data.url||"",verifier:this.params.verifier,verifierId:n,typeOfLogin:this.params.typeOfLogin}}}class hn extends on{constructor(e){super(e),_(this,"RESPONSE_TYPE","token id_token"),_(this,"SCOPE","profile email openid"),_(this,"PROMPT","select_account"),this.setFinalUrl()}setFinalUrl(){const e=new URL("https://accounts.google.com/o/oauth2/v2/auth"),t=JSON.parse(JSON.stringify(this.params.jwtParams||{})),r=Pt()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.params.clientId,prompt:this.PROMPT,redirect_uri:this.params.redirect_uri,scope:this.SCOPE,nonce:this.nonce},t);Object.keys(r).forEach((t=>{const i=t;r[i]&&e.searchParams.append(i,r[i])})),this.finalURL=e}async getUserInfo(e){const{accessToken:t}=e,r=await Ct("https://www.googleapis.com/userinfo/v2/me",{headers:{Authorization:`Bearer ${t}`}}),{picture:i="",email:n="",name:s=""}=r;return{email:n,name:s,profileImage:i,verifier:this.params.verifier,verifierId:n.toLowerCase(),typeOfLogin:this.params.typeOfLogin}}}class dn extends on{constructor(e){super(e),_(this,"SCOPE","openid profile email"),_(this,"RESPONSE_TYPE","token id_token"),_(this,"PROMPT","login"),this.setFinalUrl()}setFinalUrl(){const{domain:e}=this.params.jwtParams,t=en(e);t.pathname+=t.pathname.endsWith("/")?"authorize":"/authorize";const r=JSON.parse(JSON.stringify(this.params.jwtParams));delete r.domain;const i=Pt()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.params.clientId,prompt:this.PROMPT,redirect_uri:this.params.redirect_uri,scope:this.SCOPE,connection:Vi[this.params.typeOfLogin],nonce:this.nonce},r);Object.keys(i).forEach((e=>{const r=e;i[r]&&t.searchParams.append(r,i[r])})),this.finalURL=t}async getUserInfo(e){const{idToken:t,accessToken:r}=e,{domain:i,verifierIdField:n,isVerifierIdCaseSensitive:s,user_info_route:o="userinfo"}=this.params.jwtParams;if(r)try{const e=new URL(i),t=await Ct(`${Yi(e)}${o}`,{headers:{Authorization:`Bearer ${r}`}}),{picture:a,name:c,email:h}=t;return{email:h,name:c,profileImage:a,verifierId:Gi(t,this.params.typeOfLogin,n,s),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}catch(e){rt().warn(e,"Unable to get userinfo from endpoint")}if(t){const e=tn(t).payload,{name:r,email:i,picture:o}=e;return{profileImage:o,name:r,email:i,verifierId:Gi(e,this.params.typeOfLogin,n,s),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}throw new Error("Access/id token not available")}}class un extends on{constructor(e){super(e),this.setFinalUrl()}setFinalUrl(){const e=JSON.parse(JSON.stringify(this.params.jwtParams));delete e.domain;const t=Pt()({state:this.state,client_id:this.params.clientId,nonce:this.nonce},e);this.finalURL=new URL(Zi({baseURL:this.params.redirect_uri,query:null,hash:t}))}async getUserInfo(e){const{idToken:t,accessToken:r}=e,{domain:i,verifierIdField:n,isVerifierIdCaseSensitive:s,user_info_route:o="userinfo"}=this.params.jwtParams;if(r)try{const e=new URL(i),t=await Ct(`${Yi(e)}${o}`,{headers:{Authorization:`Bearer ${r}`}}),{picture:a,name:c,email:h}=t;return{email:h,name:c,profileImage:a,verifierId:Gi(t,this.params.typeOfLogin,n,s),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}catch(e){rt().warn(e,"Unable to get userinfo from endpoint")}if(t){const e=tn(t).payload,{name:r,email:i,picture:o}=e;return{profileImage:o,name:r,email:i,verifierId:Gi(e,this.params.typeOfLogin,n,s),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}throw new Error("Access/id token not available")}handleLoginWindow(e){const{id_token:t,access_token:r}=this.params.jwtParams,i=new nn({url:this.finalURL,features:e.popupFeatures});return this.params.uxMode!==Di?Promise.resolve({state:{},idToken:t,accessToken:r}):(i.redirect(e.locationReplaceOnRedirect),null)}}var fn=r(8303),ln=r(3077);class pn{constructor(){_(this,"sessionId",void 0)}checkSessionParams(){if(!this.sessionId)throw new Error("Session id is required");this.sessionId=this.sessionId.padStart(64,"0")}request({method:e="GET",url:t,data:r={},headers:i={}}){const n={headers:i};switch(e){case"GET":return Ct(t,n);case"POST":return Lt(t,r,n);case"PUT":return Bt(t,r,n);case"PATCH":return Rt(t,r,n)}throw new Error("Invalid method type")}}var yn=r(8287).hp;class mn extends pn{constructor({sessionServerBaseUrl:e,sessionNamespace:t,sessionTime:r,sessionId:i,allowedOrigin:n}={}){super(),_(this,"sessionServerBaseUrl","https://session.web3auth.io"),_(this,"sessionNamespace",void 0),_(this,"allowedOrigin",void 0),_(this,"sessionTime",86400),_(this,"sessionId",""),e&&(this.sessionServerBaseUrl=e),t&&(this.sessionNamespace=t),r&&(this.sessionTime=r),i&&(this.sessionId=i.padStart(64,"0")),n&&(this.allowedOrigin=n||"*")}static generateRandomSessionKey(){return(0,ae.F_)().toString("hex").padStart(64,"0")}async createSession(e,t={}){super.checkSessionParams();const r=yn.from(this.sessionId,"hex"),i=(0,ae.qb)(r).toString("hex"),n=await(0,fn.yv)(this.sessionId,e),s={key:i,data:n,signature:(await(0,ae._S)(r,(0,ln.S)(yn.from(n,"utf8")))).toString("hex"),namespace:this.sessionNamespace,timeout:this.sessionTime,allowedOrigin:this.allowedOrigin};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/set`,data:s,headers:t}),this.sessionId}async authorizeSession({headers:e}={headers:{}}){super.checkSessionParams();const t={key:(0,ae.qb)(yn.from(this.sessionId,"hex")).toString("hex"),namespace:this.sessionNamespace},r=await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/get`,data:t,headers:e});if(!r.message)throw new Error("Session Expired or Invalid public key");const i=await(0,fn.af)(this.sessionId,r.message);if(i.error)throw new Error("There was an error decrypting data.");return i}async updateSession(e,t={}){super.checkSessionParams();const r=yn.from(this.sessionId,"hex"),i=(0,ae.qb)(r).toString("hex"),n=await(0,fn.yv)(this.sessionId,e),s={key:i,data:n,signature:(await(0,ae._S)(r,(0,ln.S)(yn.from(n,"utf8")))).toString("hex"),namespace:this.sessionNamespace,allowedOrigin:this.allowedOrigin};await super.request({method:"PUT",url:`${this.sessionServerBaseUrl}/v2/store/update`,data:s,headers:t})}async invalidateSession(e={}){super.checkSessionParams();const t=yn.from(this.sessionId,"hex"),r=(0,ae.qb)(t).toString("hex"),i=await(0,fn.yv)(this.sessionId,{}),n={key:r,data:i,signature:(await(0,ae._S)(t,(0,ln.S)(yn.from(i,"utf8")))).toString("hex"),namespace:this.sessionNamespace,timeout:1};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/set`,data:n,headers:e}),this.sessionId="",!0}}class gn extends on{constructor(e){super(e),this.setFinalUrl()}setFinalUrl(){const{passkeysHostUrl:e}=this.params.customState||{};if(!e)throw new Error("Invalid passkeys url.");const t=new URL(e),r=JSON.parse(JSON.stringify(this.params.jwtParams||{})),i=Pt()({state:this.state,client_id:this.params.clientId,redirect_uri:this.params.redirect_uri},r);Object.keys(i).forEach((e=>{const r=e;i[r]&&t.searchParams.append(r,i[r])})),this.finalURL=t}async getUserInfo(e,t){const{idToken:r,extraParams:i}=e,{sessionId:n}=JSON.parse(Qr().decode(i))||{};if(!n)throw new Error("sessionId not found");const{verifier_id:s,signature:o,clientDataJSON:a,authenticatorData:c,publicKey:h,challenge:d,rpOrigin:u,rpId:f,credId:l,transports:p,username:y}=await async function(e,t){try{const r=new mn({sessionId:e,sessionServerBaseUrl:t,allowedOrigin:!0});return await r.authorizeSession()}catch(e){throw rt().error("fetch data from storage server error",e),new Error("Unable to retrieve data from storage server, invalid key or key expired.")}}(n,t);if(o!==r)throw new Error("idtoken should be equal to signature");return{email:"",name:"Passkeys Login",profileImage:"",verifier:this.params.verifier,verifierId:s,typeOfLogin:this.params.typeOfLogin,extraVerifierParams:{signature:o,clientDataJSON:a,authenticatorData:c,publicKey:h,challenge:d,rpOrigin:u,rpId:f,credId:l,transports:p,username:y}}}}const bn=["access_token","id_token"];class vn extends on{constructor(e){super(e),_(this,"SCOPE","openid profile email"),_(this,"RESPONSE_TYPE","token id_token"),_(this,"PROMPT","login"),this.setFinalUrl()}setFinalUrl(){const{domain:e}=this.params.jwtParams,t=en(e);t.pathname="/passwordless/start",this.finalURL=t}async getUserInfo(e){const{idToken:t,accessToken:r}=e,{domain:i,verifierIdField:n,isVerifierIdCaseSensitive:s}=this.params.jwtParams;try{const e=new URL(i),t=await Ct(`${Yi(e)}userinfo`,{headers:{Authorization:`Bearer ${r}`}}),{picture:o,name:a,email:c}=t;return{email:c,name:a,profileImage:o,verifierId:Gi(t,this.params.typeOfLogin,n,s),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}catch(e){Hi.error(e);const r=tn(t).payload,{name:i,email:o,picture:a}=r;return{profileImage:a,name:i,email:o,verifierId:Gi(r,this.params.typeOfLogin,n,s),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}}async handleLoginWindow(){const{BroadcastChannel:e}=await Promise.resolve().then(r.bind(r,1352));return new Promise(((t,r)=>{if(this.params.redirectToOpener)return void r(new Error("Cannot use redirect to opener for passwordless"));const i=e=>{try{const{error:i,data:n}=e,s=n||{},{instanceParams:o,hashParams:{access_token:a,id_token:c}}=s,h=oi(s.hashParams,bn);if(i)return Hi.error(e.error),void r(new Error(i));e.data&&o.verifier===this.params.verifier&&(Hi.info(e.data),t(se(se({accessToken:a,idToken:c||""},h),{},{state:o})))}catch(e){Hi.error(e),r(e)}},n=new e(`redirect_channel_${this.nonce}`,Wi);n.addEventListener("message",(async e=>{i(e),n.close()}));try{const{connection:e="email",login_hint:t}=this.params.jwtParams,i=Pt()({client_id:this.params.clientId,connection:e,email:"email"===e?t:void 0,phone_number:"sms"===e?t:void 0,send:"link",authParams:{scope:this.SCOPE,state:this.state,response_type:this.RESPONSE_TYPE,redirect_uri:this.params.redirect_uri,nonce:this.nonce,prompt:this.PROMPT}},{authParams:this.params.jwtParams});Lt(this.finalURL.href,JSON.parse(JSON.stringify(i))).then((e=>{Hi.info("posted",e)})).catch((e=>{Hi.error(e),r(e)}))}catch(e){Hi.error(e),r(e)}}))}}class wn extends on{constructor(e){super(e),_(this,"RESPONSE_TYPE","token"),_(this,"SCOPE","user:read:email"),this.setFinalUrl()}setFinalUrl(){const e=new URL("https://id.twitch.tv/oauth2/authorize"),t=JSON.parse(JSON.stringify(this.params.jwtParams||{})),r=Pt()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.params.clientId,redirect_uri:this.params.redirect_uri,scope:this.SCOPE,force_verify:"true"},t);Object.keys(r).forEach((t=>{const i=t;r[i]&&e.searchParams.append(i,r[i])})),this.finalURL=e}async getUserInfo(e){const{accessToken:t}=e,r=await Ct("https://api.twitch.tv/helix/users",{headers:{Authorization:`Bearer ${t}`,"Client-ID":this.params.clientId}}),[{profile_image_url:i="",display_name:n="",email:s="",id:o}]=r.data||[];return{profileImage:i,name:n,email:s,verifierId:o,verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}}class Sn extends on{constructor(e){super(e),_(this,"SCOPE","openid profile email"),_(this,"RESPONSE_TYPE","token id_token"),_(this,"PROMPT","login"),this.setFinalUrl()}setFinalUrl(){const{domain:e}=this.params.jwtParams||{},t=en(e||"https://passwordless.web3auth.io/v6");t.pathname+=t.pathname.endsWith("/")?"authorize":"/authorize";const r=JSON.parse(JSON.stringify(this.params.jwtParams||{}));delete r.domain,this.params.customState=se(se({},this.params.customState||{}),{},{client:this.params.web3AuthClientId});const i=Pt()({state:this.state,client_id:this.params.clientId||this.params.web3AuthClientId,redirect_uri:this.params.redirect_uri,nonce:this.nonce,network:this.params.web3AuthNetwork,connection:Vi[this.params.typeOfLogin],scope:this.SCOPE,response_type:this.RESPONSE_TYPE,prompt:this.PROMPT,flow_type:(null==r?void 0:r.flow_type)||"code"},r);Object.keys(i).forEach((e=>{const r=e;i[r]&&t.searchParams.append(r,i[r])})),this.finalURL=t}async getUserInfo(e){const{idToken:t}=e,r=tn(t).payload,{name:i,email:n,picture:s}=r;return{profileImage:s,name:i,email:n,verifierId:i.toLowerCase(),verifier:this.params.verifier,typeOfLogin:this.params.typeOfLogin}}}var _n=e=>{const{verifier:t,typeOfLogin:r,clientId:i,jwtParams:n}=e;if(!t||!r||!i)throw new Error("Invalid params. Missing verifier, typeOfLogin or clientId");const{domain:s,login_hint:o,id_token:a,access_token:c}=n||{};switch(r){case"google":return new hn(e);case Mi:return new cn(e);case"twitch":return new wn(e);case"discord":return new an(e);case Li:case Ri:if(!o)throw new Error("Invalid params. Missing login_hint for web3auth passwordless login");return new Sn(e);case Ci:if(!s||!o)throw new Error("Invalid params. Missing domain or login_hint for passwordless login");return new vn(e);case Ei:case Ii:case Ai:case Ti:case Oi:case Ni:case Ki:case"jwt":case"reddit":if(a||c)return new un(e);if(!s)throw new Error("Invalid params for jwt login. Missing domain");return new dn(e);case"passkeys":return new gn(e);default:throw new Error("Unsupported login type")}},xn=r(9090);class kn{constructor(e){_(this,"sentry",null),this.sentry=e}startSpan(e,t){return this.sentry?this.sentry.startSpan(e,t):t(null)}}var Pn=r(8287).hp;class Mn{constructor(e){_(this,"currentStorageMethod",Ui),_(this,"isInitialized",!1),_(this,"storageServerUrl","https://session.web3auth.io"),_(this,"localStorageAvailable",!0),this.storageServerUrl=e}get storageMethodUsed(){return this.currentStorageMethod}init(){const e=function(){var e;const t=Ji().parse(navigator.userAgent);Hi.info(JSON.stringify(t),"current browser info");let r=!0;return null!==(e=navigator)&&void 0!==e&&e.brave&&(r=!1),t.engine.name!==Ji().ENGINE_MAP.WebKit&&t.engine.name!==Ji().ENGINE_MAP.Gecko||(r=!1),r}(),t=function(e){let t;try{t=window[e];const r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(e){const r=e;return r&&(22===r.code||1014===r.code||"QuotaExceededError"===r.name||"NS_ERROR_DOM_QUOTA_REACHED"===r.name)&&t&&0!==t.length}}(Ui);this.localStorageAvailable=t,this.currentStorageMethod=e&&t?Ui:ji,this.isInitialized=!0}async storeLoginDetails(e,t){if(!this.isInitialized)throw new Error("StorageHelper is not initialized");if(this.currentStorageMethod===ji){const r=(0,ln.S)(Pn.from(t,"utf8")),i=r.toString("hex"),n=(0,ae.qb)(r).toString("hex"),s=await(0,fn.yv)(i,e),o=(await(0,ae._S)(r,(0,ln.S)(Pn.from(s,"utf8")))).toString("hex");await Lt(`${this.storageServerUrl}/store/set`,{key:n,data:s,signature:o})}this.localStorageAvailable&&window.localStorage.setItem(`torus_login_${t}`,JSON.stringify(e))}async retrieveLoginDetails(e){if(!this.isInitialized)throw new Error("StorageHelper is not initialized");if(this.localStorageAvailable){const t=window.localStorage.getItem(`torus_login_${e}`);if(t)return JSON.parse(t||"{}")}if(this.currentStorageMethod===ji){const t=(0,ln.S)(Pn.from(e,"utf8")),r=t.toString("hex"),i=(0,ae.qb)(t).toString("hex");try{const e=await Ct(`${this.storageServerUrl}/store/get?key=${i}`);if(e.message)return await(0,fn.af)(r,e.message)}catch(e){if(404!==e.status)throw e;Hi.warn(e,"Session likely expired")}}}clearLoginDetailsStorage(e){if(!this.isInitialized)throw new Error("StorageHelper is not initialized");this.localStorageAvailable&&window.localStorage.removeItem(`torus_login_${e}`)}clearOrphanedLoginDetails(){if(!this.isInitialized)throw new Error("StorageHelper is not initialized");this.localStorageAvailable&&Object.keys(window.localStorage).forEach((e=>{e.startsWith("torus_login_")&&window.localStorage.removeItem(e)}))}}var En=r(8287).hp;const In=["access_token","id_token"],An=["access_token","id_token"],Tn=["args","method"];var On=class{constructor({baseUrl:e,network:t,enableLogging:r=!1,redirectToOpener:i=!1,redirectPathName:n="redirect",apiKey:s="torus-default",uxMode:o=Fi,locationReplaceOnRedirect:a=!1,popupFeatures:c,storageServerUrl:h="https://session.web3auth.io",sentry:d,enableOneKey:u=!1,web3AuthClientId:f,useDkg:l,metadataUrl:p="https://metadata.tor.us",keyType:y="secp256k1",serverTimeOffset:m=0,nodeDetails:g,checkCommitment:b=!0}){if(_(this,"isInitialized",void 0),_(this,"config",void 0),_(this,"torus",void 0),_(this,"nodeDetailManager",void 0),_(this,"storageHelper",void 0),_(this,"sentryHandler",void 0),!f)throw new Error("Please provide a valid web3AuthClientId in constructor");if(!t)throw new Error("Please provide a valid network in constructor");this.isInitialized=!1;const v=new URL(e);this.config={baseUrl:Yi(v),get redirect_uri(){return`${this.baseUrl}${n}`},redirectToOpener:i,uxMode:o,locationReplaceOnRedirect:a,popupFeatures:c,useDkg:l,web3AuthClientId:f,web3AuthNetwork:t,keyType:y,nodeDetails:g,checkCommitment:b};const w=new Pi({network:t,enableOneKey:u,serverTimeOffset:m,clientId:f,legacyMetadataHost:p,keyType:y});Pi.setAPIKey(s),this.torus=w,this.nodeDetailManager=new yi({network:t}),r?Hi.enableAll():Hi.disableAll(),this.storageHelper=new Mn(h),this.sentryHandler=new kn(d)}async init({skipSw:e=!1,skipInit:t=!1,skipPrefetch:r=!1}={}){if(this.storageHelper.init(),t)this.isInitialized=!0;else{if(!e){if(!(await fetch(`${this.config.baseUrl}sw.js`,{cache:"reload"})).ok)throw new Error("Service worker is not being served. Please serve it");try{return await(i=this.config.baseUrl,new Promise(((e,t)=>{const r=`${i}sw.js`;"serviceWorker"in window.navigator?(0,xn.k)(r,{ready(){Hi.info("App is being served from cache by a service worker.\n For more details, visit https://goo.gl/AFskqB"),e(void 0)},registered(){Hi.info("Service worker has been registered."),e(void 0)},cached(){Hi.info("Content has been cached for offline use."),e(void 0)},updatefound(){Hi.info("New content is downloading.")},updated(){Hi.info("New content is available; please refresh.")},offline(){Hi.info("No internet connection found. App is running in offline mode."),t(new Error("App is offline"))},error(e){Hi.error("Error during service worker registration:",e),t(e)}}):t(new Error("Service workers are not supported"))}))),void(this.isInitialized=!0)}catch(e){Hi.warn(e)}}var i,n;if(!r)return(null===(n=window)||void 0===n||null===(n=n.navigator)||void 0===n?void 0:n.userAgent.toLowerCase().indexOf("firefox"))>-1?void(this.isInitialized=!0):void await this.handlePrefetchRedirectUri();this.isInitialized=!0}}async triggerLogin(e){const{verifier:t,typeOfLogin:r,clientId:i,jwtParams:n,hash:s,queryParameters:o,customState:a}=e;if(Hi.info("Verifier: ",t),!this.isInitialized)throw new Error("Not initialized yet");const c=_n({typeOfLogin:r,clientId:i,verifier:t,redirect_uri:this.config.redirect_uri,redirectToOpener:this.config.redirectToOpener,jwtParams:n,uxMode:this.config.uxMode,customState:a,web3AuthClientId:this.config.web3AuthClientId,web3AuthNetwork:this.config.web3AuthNetwork});let h;if(s&&o){const{error:e,hashParameters:t,instanceParameters:r}=Qi(s,o);if(e)throw new Error(e);const{access_token:i,id_token:n}=t;h=se(se({accessToken:i,idToken:n},oi(t,In)),{},{state:r})}else if(this.storageHelper.clearOrphanedLoginDetails(),this.config.uxMode===Di&&await this.storageHelper.storeLoginDetails({method:qi,args:e},c.nonce),h=await c.handleLoginWindow({locationReplaceOnRedirect:this.config.locationReplaceOnRedirect,popupFeatures:this.config.popupFeatures}),this.config.uxMode===Di)return null;const d=await c.getUserInfo(h);return se(se({},await this.getTorusKey(t,d.verifierId,{verifier_id:d.verifierId},h.idToken||h.accessToken,d.extraVerifierParams)),{},{userInfo:se(se({},d),h)})}async triggerAggregateLogin(e){const{aggregateVerifierType:t,verifierIdentifier:r,subVerifierDetailsArray:i}=e;if(!this.isInitialized)throw new Error("Not initialized yet");if(!t||!r||!Array.isArray(i))throw new Error("Invalid params. Missing aggregateVerifierType, verifierIdentifier or subVerifierDetailsArray");if(t===Bi&&1!==i.length)throw new Error("Single id verifier can only have one sub verifier");const n=[],s=[];for(const t of i){const{clientId:r,typeOfLogin:i,verifier:o,jwtParams:a,hash:c,queryParameters:h,customState:d}=t,u=_n({typeOfLogin:i,clientId:r,verifier:o,redirect_uri:this.config.redirect_uri,redirectToOpener:this.config.redirectToOpener,jwtParams:a,uxMode:this.config.uxMode,customState:d,web3AuthClientId:this.config.web3AuthClientId,web3AuthNetwork:this.config.web3AuthNetwork});let f;if(c&&h){const{error:e,hashParameters:t,instanceParameters:r}=Qi(c,h);if(e)throw new Error(e);const{access_token:i,id_token:n}=t;f=se(se({accessToken:i,idToken:n},oi(t,An)),{},{state:r})}else if(this.storageHelper.clearOrphanedLoginDetails(),this.config.uxMode===Di&&await this.storageHelper.storeLoginDetails({method:$i,args:e},u.nonce),f=await u.handleLoginWindow({locationReplaceOnRedirect:this.config.locationReplaceOnRedirect,popupFeatures:this.config.popupFeatures}),this.config.uxMode===Di)return null;n.push(u.getUserInfo(f)),s.push(f)}const o=(await Promise.all(n)).map((e=>se(se({},e),{},{aggregateVerifier:r}))),a={verify_params:[],sub_verifier_ids:[],verifier_id:""},c=[];let h="",d={};for(let e=0;e<i.length;e+=1){const t=s[e],{idToken:r,accessToken:i}=t,n=o[e];a.verify_params.push({verifier_id:n.verifierId,idtoken:r||i}),a.sub_verifier_ids.push(n.verifier),c.push(r||i),h=n.verifierId,d=n.extraVerifierParams}c.sort();const u=nt(En.from(c.join(String.fromCharCode(29)),"utf8")).slice(2);return a.verifier_id=h,se(se({},await this.getTorusKey(r,h,a,u,d)),{},{userInfo:o.map(((e,t)=>se(se({},e),s[t])))})}async getTorusKey(e,t,r,i,n){const s=await this.sentryHandler.startSpan({name:"fetchNodeDetails"},(async()=>this.config.nodeDetails?this.config.nodeDetails:this.nodeDetailManager.getNodeDetails({verifier:e,verifierId:t})));Hi.debug("torus-direct/getTorusKey",{torusNodeEndpoints:s.torusNodeEndpoints});const o=await this.sentryHandler.startSpan({name:"fetchShares"},(async()=>this.torus.retrieveShares({endpoints:s.torusNodeEndpoints,indexes:s.torusIndexes,verifier:e,verifierParams:r,idToken:i,nodePubkeys:s.torusNodePub,extraParams:se({},n),useDkg:this.config.useDkg,checkCommitment:this.config.checkCommitment})));return Hi.debug("torus-direct/getTorusKey",{retrieveShares:o}),o}async getAggregateTorusKey(e,t,r){const i={verify_params:[],sub_verifier_ids:[],verifier_id:""},n=[];let s={};for(let e=0;e<r.length;e+=1){const o=r[e];i.verify_params.push({verifier_id:t,idtoken:o.idToken}),i.sub_verifier_ids.push(o.verifier),n.push(o.idToken),s=o.extraVerifierParams}n.sort();const o=nt(En.from(n.join(String.fromCharCode(29)),"utf8")).slice(2);return i.verifier_id=t,this.getTorusKey(e,t,i,o,s)}async getRedirectResult({replaceUrl:e=!0,clearLoginDetails:t=!0}={}){await this.init({skipInit:!0});const r=new URL(window.location.href),i=r.hash.substring(1),n={};if(r.searchParams.forEach(((e,t)=>{n[t]=e})),!i&&0===Object.keys(n).length)throw new Error("Found Empty hash and query parameters. This can happen if user reloads the page");const{error:s,instanceParameters:o,hashParameters:a}=Qi(i,n),{instanceId:c}=o;Hi.info(c,"instanceId");const h=await this.storageHelper.retrieveLoginDetails(c)||{},{args:d,method:u}=h,f=oi(h,Tn);if(Hi.info(d,u),s)return{error:s,state:o||{},method:u,result:{},hashParameters:a,args:d};let l;try{if(u===qi){const e=d;e.hash=i,e.queryParameters=n,l=await this.triggerLogin(e)}else if(u===$i){const e=d;e.subVerifierDetailsArray.forEach((e=>{e.hash=i,e.queryParameters=n})),l=await this.triggerAggregateLogin(e)}}catch(e){const r=await oe(e);return Hi.error(r),t&&this.storageHelper.clearLoginDetailsStorage(c),se({error:`${r.message||""}`,state:o||{},method:u,result:{},hashParameters:a,args:d},f)}if(!l)return se({error:`Init parameters not found. It might be because storage is not available. Please retry the login in a different browser. Used storage method: ${this.storageHelper.storageMethodUsed}`,state:o||{},method:u,result:{},hashParameters:a,args:d},f);if(e){const e=window.location.origin+window.location.pathname;window.history.replaceState(se(se({},window.history.state),{},{as:e,url:e}),"",e)}return t&&this.storageHelper.clearLoginDetailsStorage(c),se({method:u,result:l,state:o||{},hashParameters:a,args:d},f)}async handlePrefetchRedirectUri(){return document?new Promise(((e,t)=>{const r=document.createElement("link");r.href=this.config.redirect_uri,window.location.origin!==new URL(this.config.redirect_uri).origin&&(r.crossOrigin="anonymous"),r.type="text/html",r.rel="prefetch";const i=()=>{this.isInitialized=!0,e()};try{r.relList&&r.relList.supports&&r.relList.supports("prefetch")?(r.onload=i,r.onerror=()=>{t(new Error(`Please serve redirect.html present in serviceworker folder of this package on ${this.config.redirect_uri}`))},document.head.appendChild(r)):i()}catch(e){i()}})):Promise.resolve()}};class Nn extends si{constructor({enableLogging:e=!1,postboxKey:t,customAuthArgs:r}){super({enableLogging:e,postboxKey:t}),_(this,"customAuthInstance",void 0),_(this,"singleLoginKey",void 0),_(this,"torusKey",void 0),_(this,"migratableKey",null),_(this,"customAuthArgs",void 0),this.customAuthArgs=r,this.customAuthInstance=new On(r),this.serviceProviderName="TorusServiceProvider"}static fromJSON(e){const{enableLogging:t,postboxKey:r,customAuthArgs:i,serviceProviderName:n}=e;if("TorusServiceProvider"===n)return new Nn({enableLogging:t,postboxKey:r,customAuthArgs:i})}async init(e){return this.customAuthInstance.init(e)}async triggerLogin(e){const t=await this.customAuthInstance.triggerLogin(e);if(t){const e=Pi.getPostboxKey(t);if(this.torusKey=t,!t.metadata.upgraded){const{finalKeyData:e,oAuthKeyData:r}=t,i=e.privKey||r.privKey;this.migratableKey=new(T())(i,"hex")}this.postboxKey=new(T())(e,"hex")}return t}async triggerAggregateLogin(e){const t=await this.customAuthInstance.triggerAggregateLogin(e);if(t){const e=Pi.getPostboxKey(t);if(this.torusKey=t,!t.metadata.upgraded){const{finalKeyData:e,oAuthKeyData:r}=t,i=e.privKey||r.privKey;this.migratableKey=new(T())(i,"hex")}this.postboxKey=new(T())(e,"hex")}return t}toJSON(){return se(se({},super.toJSON()),{},{serviceProviderName:this.serviceProviderName,customAuthArgs:this.customAuthArgs})}}var Kn=Nn;class Cn extends Kn{constructor(...e){super(...e),_(this,"verifierName",void 0),_(this,"verifierId",void 0)}async getRSSNodeDetails(){if(!this.verifierId)throw new Error("no verifierId, not logged in");if(!this.verifierName)throw new Error("no verifierName, not logged in");const{torusNodeRSSEndpoints:e,torusNodePub:t}=await this.customAuthInstance.nodeDetailManager.getNodeDetails({verifier:this.verifierName,verifierId:this.verifierId});return{serverEndpoints:e,serverPubKeys:t.map((e=>({x:e.X,y:e.Y}))),serverThreshold:Math.ceil(e.length/2)}}async getTSSPubKey(e,t){if(!this.verifierName||!this.verifierId)throw new Error("verifier userinfo not found, not logged in yet");const r=await this.customAuthInstance.nodeDetailManager.getNodeDetails({verifier:this.verifierName,verifierId:this.verifierId}),i=await this.customAuthInstance.torus.getPublicAddress(r.torusNodeSSSEndpoints,r.torusNodePub,{verifier:this.verifierName,verifierId:this.verifierId,extendedVerifierId:Ie(this.verifierId,e,t)});return{pubKey:new Se(i.finalKeyData.X,i.finalKeyData.Y),nodeIndexes:i.nodesData.nodeIndexes||[]}}getVerifierNameVerifierId(){return`${this.verifierName}${this.verifierId}`}async triggerLogin(e){const t=await super.triggerLogin(e);if(t){const{verifier:e,verifierId:r}=t.userInfo;this.verifierName=e,this.verifierId=r}return t}async triggerAggregateLogin(e){const t=await super.triggerAggregateLogin(e);if(t){const{verifier:e,verifierId:r}=t.userInfo[0];this.verifierName=e,this.verifierId=r}return t}}class Ln extends he().ec{constructor(){super("ed25519")}bufferToScalar(e){return new(T())(e,"le")}generateScalar(){return this.genKeyPair().getPrivate()}scalarToBuffer(e,t){return e.toString("hex"),e.toArrayLike(t,"le",32)}pointToBuffer(e,t){const r=e.getX(),i=e.getY().toArrayLike(t,"le",32);return i[i.length-1]|=r.and(new(T())(1)).eqn(1)?128:0,i}}class Rn{constructor(){_(this,"sessionId",void 0)}checkSessionParams(){if(!this.sessionId)throw new Error("Session id is required");this.sessionId=this.sessionId.padStart(64,"0")}request({method:e="GET",url:t,data:r={},headers:i={}}){const n={headers:i};switch(e){case"GET":return Ct(t,n);case"POST":return Lt(t,r,n);case"PUT":return Bt(t,r,n);case"PATCH":return Rt(t,r,n)}throw new Error("Invalid method type")}}var Bn=r(8287).hp;class Fn extends Rn{constructor({sessionServerBaseUrl:e,sessionNamespace:t,sessionTime:r,sessionId:i,allowedOrigin:n}={}){super(),_(this,"sessionServerBaseUrl","https://session.web3auth.io"),_(this,"sessionNamespace",void 0),_(this,"allowedOrigin",void 0),_(this,"sessionTime",86400),_(this,"sessionId",""),e&&(this.sessionServerBaseUrl=e),t&&(this.sessionNamespace=t),r&&(this.sessionTime=r),i&&(this.sessionId=i.padStart(64,"0")),n&&(this.allowedOrigin=n||"*")}static generateRandomSessionKey(){return(0,ae.F_)().toString("hex").padStart(64,"0")}async createSession(e,t={}){super.checkSessionParams();const r=Bn.from(this.sessionId,"hex"),i=(0,ae.qb)(r).toString("hex"),n=await(0,fn.yv)(this.sessionId,e),s={key:i,data:n,signature:(await(0,ae._S)(r,(0,ln.S)(Bn.from(n,"utf8")))).toString("hex"),namespace:this.sessionNamespace,timeout:this.sessionTime,allowedOrigin:this.allowedOrigin};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/set`,data:s,headers:t}),this.sessionId}async authorizeSession({headers:e}={headers:{}}){super.checkSessionParams();const t={key:(0,ae.qb)(Bn.from(this.sessionId,"hex")).toString("hex"),namespace:this.sessionNamespace},r=await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/get`,data:t,headers:e});if(!r.message)throw new Error("Session Expired or Invalid public key");const i=await(0,fn.af)(this.sessionId,r.message);if(i.error)throw new Error("There was an error decrypting data.");return i}async updateSession(e,t={}){super.checkSessionParams();const r=Bn.from(this.sessionId,"hex"),i=(0,ae.qb)(r).toString("hex"),n=await(0,fn.yv)(this.sessionId,e),s={key:i,data:n,signature:(await(0,ae._S)(r,(0,ln.S)(Bn.from(n,"utf8")))).toString("hex"),namespace:this.sessionNamespace,allowedOrigin:this.allowedOrigin};await super.request({method:"PUT",url:`${this.sessionServerBaseUrl}/v2/store/update`,data:s,headers:t})}async invalidateSession(e={}){super.checkSessionParams();const t=Bn.from(this.sessionId,"hex"),r=(0,ae.qb)(t).toString("hex"),i=await(0,fn.yv)(this.sessionId,{}),n={key:r,data:i,signature:(await(0,ae._S)(t,(0,ln.S)(Bn.from(i,"utf8")))).toString("hex"),namespace:this.sessionNamespace,timeout:1};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/set`,data:n,headers:e}),this.sessionId="",!0}}var Dn=r(7998),Un=r.n(Dn),jn=r(8287).hp;new ce.ec("secp256k1");const qn=r.g.crypto||r.g.msCrypto||{},$n=qn.subtle||qn.webkitSubtle,zn=jn.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Jn=jn.alloc(32,0);function Hn(e){return t=e,!(!jn.isBuffer(t)||32!==t.length)&&e.compare(Jn)>0&&e.compare(zn)<0;var t}function Vn(e){const t=new Uint8Array(e);return void 0===qn.getRandomValues?jn.from(Un().randomBytes(e)):(qn.getRandomValues(t),jn.from(t))}function Yn(e){return async function(t,r,i){if($n){const n={name:"AES-CBC"},s=await $n.importKey("raw",r,n,!1,[e]),o={name:"AES-CBC",iv:t},a=await $n[e](o,s,i);return jn.from(new Uint8Array(a))}if("encrypt"===e){const e=Un().createCipheriv("aes-256-cbc",r,t),n=e.update(i),s=e.final();return jn.concat([n,s])}if("decrypt"===e){const e=Un().createDecipheriv("aes-256-cbc",r,t),n=e.update(i),s=e.final();return jn.concat([n,s])}throw new Error(`Unsupported operation: ${e}`)}}Yn("encrypt"),Yn("decrypt");var Wn=r(7115),Xn=r(8287).hp;const Gn="x-web3-session-id";function Qn(){return new ce.ec("secp256k1")}function Zn(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Qn(),n=e.map((e=>new(T())(e))),s=new(T())(t),o=new(T())(r);let a=new(T())(1),c=new(T())(1);for(let e=0;e<n.length;e+=1)if(0!==s.cmp(n[e])){let t=o.sub(n[e]);t=t.umod(i.curve.n),a=a.mul(t),a=a.umod(i.curve.n);let r=s.sub(n[e]);r=r.umod(i.curve.n),c=c.mul(r).umod(i.curve.n)}return a.mul(c.invm(i.curve.n)).umod(i.curve.n)}const es=(e,t,r,i)=>{const n=Qn();if(e)return Zn([1,r],r);const s=Zn(t,i),o=Zn([1,r],1);return s.mul(o).umod(n.curve.n)},ts=(e,t)=>{if(-1===t.indexOf(e))throw new Error(`party ${e} not found in parties ${t}`);const r=Qn();return Zn(t,e).invm(r.curve.n).umod(r.curve.n)},rs=(e,t,r,i)=>{const n=t.sort(((e,t)=>e-t));for(let e=0;e<n.length;e++)if(n[e]!==t[e])throw new Error("server indexes must be sorted");const s=[];let o=0;for(let e=0;e<t.length;e++){const r=e+1;s.push(r),t[e]===i&&(o=r)}const a=s.length+1;if(s.push(a),e){const n=es(e,t,r,i),o=ts(a,s),c=Qn();return o.mul(n).umod(c.curve.n)}const c=es(e,t,r,i),h=ts(o,s),d=Qn();return h.mul(c).umod(d.curve.n)};void 0===globalThis.tss_clients&&(globalThis.tss_clients=new Map),void 0===globalThis.js_read_msg&&(globalThis.js_read_msg=async function(e,t,r,i){const n=globalThis.tss_clients.get(e);if(n.log(`reading msg, ${i}`),"ga1_worker_support"===i)return"unsupported";const s=n.msgQueue.find((e=>e.sender===r&&e.recipient===t&&e.msg_type===i));return s?s.msg_data:new Promise(((e,s)=>{let o=0;const a=setInterval((()=>{const c=n.msgQueue.find((e=>e.sender===r&&e.recipient===t&&e.msg_type===i));void 0!==c&&(clearInterval(a),e(c.msg_data)),o>=1e3&&(clearInterval(a),s("Message not received in a reasonable time")),o++}),10)}))}),void 0===globalThis.js_send_msg&&(globalThis.js_send_msg=async function(e,t,r,i,n){const s=globalThis.tss_clients.get(e);if(s.log(`sending msg, ${i}`),i.indexOf("ga1_data_unprocessed")>-1)throw new Error("ga1_data_unprocessed should not be sent directly");if(s.websocketOnly)s.sockets[r].emit("send_msg",{session:e,sender:t,recipient:r,msg_type:i,msg_data:n});else{const o=e.split("")[1],a=s.lookupEndpoint(e,r);fetch(`${a}/send`,{method:"POST",headers:{[Gn]:o,"Content-Type":"application/json"},body:JSON.stringify({session:e,sender:t,recipient:r,msg_type:i,msg_data:n})})}return!0});class is{constructor(e,t,r,i,n,s,o,a,c){if(_(this,"session",void 0),_(this,"index",void 0),_(this,"parties",void 0),_(this,"msgQueue",[]),_(this,"sockets",void 0),_(this,"endpoints",void 0),_(this,"share",void 0),_(this,"pubKey",void 0),_(this,"websocketOnly",void 0),_(this,"tssLib",void 0),_(this,"_startPrecomputeTime",void 0),_(this,"_endPrecomputeTime",void 0),_(this,"_startSignTime",void 0),_(this,"_endSignTime",void 0),_(this,"log",void 0),_(this,"_consumed",void 0),_(this,"_sLessThanHalf",void 0),_(this,"_precomputeComplete",[]),_(this,"_precomputeFailed",[]),_(this,"precomputed_value",null),_(this,"_ready",!1),_(this,"_signer",void 0),_(this,"_rng",void 0),_(this,"_readyResolve",null),r.length!==n.length)throw new Error("parties and sockets length must be equal, add null for client if necessary");if(r.length!==i.length)throw new Error("parties and endpoints length must be equal, add null for client if necessary");this.session=e,this.index=t,this.parties=r,this.endpoints=i,this.sockets=n,this.share=s,this.pubKey=o,this.websocketOnly=a,this.log=console.log,this._consumed=!1,this._sLessThanHalf=!0,this.tssLib=c,n.forEach((e=>{e&&(e.hasListeners("send")&&e.off("send"),e.on("send",(async(e,t)=>{const{session:r,sender:i,recipient:n,msg_type:s,msg_data:o}=e;r===this.session?(this.msgQueue.push({session:r,sender:i,recipient:n,msg_type:s,msg_data:o}),t&&t()):this.log(`ignoring message for a different session... client session: ${this.session}, message session: ${r}`)})),e.on("precompute_complete",(async(e,t)=>{const{session:r,party:i}=e;r===this.session?(this._precomputeComplete.push(i),t&&t()):this.log(`ignoring message for a different session... client session: ${this.session}, message session: ${r}`)})),e.on("precompute_failed",(async(e,t)=>{const{session:r,party:i}=e;r===this.session?(this._precomputeFailed.push(i),t&&t()):this.log(`ignoring message for a different session... client session: ${this.session}, message session: ${r}`)})))})),globalThis.tss_clients.set(this.session,this)}get sid(){return this.session.split("")[1]}async ready(){if(null==this._readyResolve)throw new Error("Precompute needs to be called before ready");await this._readyResolve,await new Promise(((e,t)=>{let r=0;const i=setInterval((()=>{0===this._precomputeFailed.length&&this._precomputeComplete.filter(((e,t,r)=>r.indexOf(e)===t)).length===this.parties.length&&null!=this.precomputed_value?(clearInterval(i),this._ready=!0,e()):this._precomputeFailed.length>0&&t(new Error("Peer failure detected, please try again")),r>=500&&(clearInterval(i),t(new Error("Client is not ready"))),r++}),10)}))}precompute(e){this.sockets.forEach(((e,t)=>{if(null!==e&&void 0===e.id)throw new Error(`socket not connected yet, session: ${this.session}, party: ${t}`)}));const t=[];for(let r=0;r<this.parties.length;r++){const i=this.parties[r];i!==this.index&&t.push(new Promise(((t,r)=>{fetch(`${this.lookupEndpoint(this.session,i)}/precompute`,{method:"POST",headers:{"Content-Type":"application/json",[Gn]:this.sid},body:JSON.stringify(se({endpoints:this.endpoints.map(((e,t)=>t!==this.index?e:`websocket:${this.sockets[i].id}`)),session:this.session,parties:this.parties,player_index:i,threshold:this.parties.length,pubkey:this.pubKey,notifyWebsocketId:this.sockets[i].id,sendWebsocket:this.sockets[i].id},e))}).then((async e=>{const r=await e.json();if(200!==e.status)throw new Error(`precompute route failed on ${this.lookupEndpoint(this.session,i)} with status ${e.status} \n ${JSON.stringify(r)} `);return t(e)})).catch((e=>{r(e)}))})))}this._readyResolve=(async()=>{this._startPrecomputeTime=Date.now(),await Promise.all(t),this._signer=await this.tssLib.threshold_signer(this.session,this.index,this.parties.length,this.parties.length,this.share,this.pubKey),this._rng=await this.tssLib.random_generator(Xn.from(function(){let e=Vn(32);for(;!Hn(e);)e=Vn(32);return e}()).toString("base64")),await this.tssLib.setup(this._signer,this._rng);const e=await this.tssLib.precompute(new Uint8Array(this.parties),this._signer,this._rng);this.precomputed_value=e,this._precomputeComplete.push(this.index),this._consumed=!1,this._endPrecomputeTime=Date.now()})().catch((e=>{this._precomputeFailed.push(this.index),console.error(e)}))}async sign(e,t,r,i,n){if(!0===this._consumed)throw new Error("This instance has already signed a message and cannot be reused");if(!1===this._ready)throw new Error("client is not ready");if(!t){if("keccak256"!==i)throw new Error(`hash algo ${i} not supported`);if(Xn.from((0,ze.So)(Xn.from(r))).toString("base64")!==e)throw new Error("hash of original message does not match msg")}this._startSignTime=Date.now();const s=[],o=[];for(let a=0;a<this.parties.length;a++){const c=a;c===this.index?s.push(await this.tssLib.local_sign(e,t,this.precomputed_value)):o.push(new Promise(((s,o)=>{const a=this.lookupEndpoint(this.session,c);fetch(`${a}/sign`,{method:"POST",headers:{"Content-Type":"application/json",[Gn]:this.sid},body:JSON.stringify(se({session:this.session,sender:this.index,recipient:c,msg:e,hash_only:t,original_message:r,hash_algo:i},n))}).then((e=>e.json())).then((e=>s(e.sig))).catch((e=>{o(e)}))})))}(await Promise.all(o)).forEach((e=>{s.push(e)}));const a=await this.tssLib.get_r_from_precompute(this.precomputed_value),c=await this.tssLib.local_verify(e,t,a,s,this.pubKey);this._endSignTime=Date.now();const h=Xn.from(c,"base64").toString("hex"),d=new(T())(h.slice(0,64),16);let u=new(T())(h.slice(64),16),f=Xn.from(a,"base64")[63]%2;if(this._sLessThanHalf){const e=Qn(),t=e.n.div(new(T())(2));u.gt(t)&&(u=e.n.sub(u),f=(f+1)%2)}return this._consumed=!0,this._ready=!1,this._readyResolve=null,{r:d,s:u,recoveryParam:f}}lookupEndpoint(e,t){if(e!==this.session)throw new Error("incorrect session when looking up endpoint");return this.endpoints[t]}async cleanup(e){this.tssLib.random_generator_free(this._rng),this.tssLib.threshold_signer_free(this._signer),this._precomputeComplete=[],this._precomputeFailed=[],this.precomputed_value=null,this._endPrecomputeTime=null,this._startPrecomputeTime=null,this._endSignTime=null,this._startSignTime=null,this._consumed=!1,this._ready=!1,this._readyResolve=null,globalThis.tss_clients.delete(this.session),this.sockets.forEach((e=>{e&&e.connected&&e.close()})),await Promise.all(this.parties.map((async t=>(t!==this.index&&await fetch(`${this.lookupEndpoint(this.session,t)}/cleanup`,{method:"POST",headers:{"Content-Type":"application/json",[Gn]:this.sid},body:JSON.stringify(se({session:this.session},e))}),Promise.resolve(!0)))))}}function ns(e){const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)))}function ss(e){const t=String.fromCodePoint(...e);return btoa(t)}new class{constructor(){_(this,"get",(e=>new Promise((t=>{if(null!==globalThis&&void 0!==globalThis&&globalThis.localStorage){const r=globalThis.localStorage.getItem(e);t(r)}else chrome.storage.local.get(e,(r=>(t(r[e]),r)))})))),_(this,"set",((e,t)=>new Promise((r=>{null!==globalThis&&void 0!==globalThis&&globalThis.localStorage?(globalThis.localStorage.setItem(e,t),r()):chrome.storage.local.set({[e]:t},(()=>{r()}))})))),_(this,"delete",(e=>new Promise((t=>{null!==globalThis&&void 0!==globalThis&&globalThis.localStorage?(globalThis.localStorage.removeItem(e),t()):(chrome.storage.local.remove(e),t())}))))}};class os{constructor(){_(this,"items",void 0),this.items=[]}add(e){return this.items.push(e),e}free(){this.items.forEach((e=>{try{e.free()}catch(e){console.log(`Warning: freeing value: ${e}`)}})),this.items=[]}}var as=r(6674);function cs(e,t,r){return JSON.stringify([e,t,r])}class hs{constructor(e,t){_(this,"session_id",void 0),_(this,"sender_id",void 0),_(this,"messages",new as.MapQueue),_(this,"sockets",new Map),this.session_id=e,this.sender_id=t}getSocket(e){return this.sockets.get(e)}async connect(e,t){if(e.length!==t.length)throw new Error("ids must have same length as endpoints");this.close();const r=t.map((e=>{const t=new URL("socket.io",e);return(0,Wn.io)(t.origin,{path:t.pathname,transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:3})})),i=r.map((e=>new Promise(((t,r)=>{e.on("connect",t),setTimeout((()=>{r(new Error("Connection timeout"))}),1e4)}))));await Promise.all(i),r.forEach(((t,r)=>{const i=e[r];t.on("send",(async(e,t)=>{if(e.sender!==i)return void console.log(`ignoring message: wrong sender: expected ${i}, got ${e.sender}`);if(e.session!==this.session_id)return void console.log(`ignoring message: wrong session: expected ${this.session_id}, got ${e.session}`);const r={sender:e.sender,data:ns(e.msg_data),receiver:e.recipient,type:e.msg_type},n=cs(r.sender,r.receiver,r.type);this.messages.push(n,r),t&&t()})),this.sockets.set(i,t)}))}close(){this.sockets.forEach((e=>e.disconnect())),this.sockets.clear()}async send(e,t,r){const i=this.sockets.get(e);if(!i)throw new Error("Socket not found");const n={msg_data:ss(r),msg_type:t,recipient:e,sender:this.sender_id,session:this.session_id};i.emit("send_msg",n)}async receive(e,t){const r=cs(e,this.sender_id,t),i=await this.messages.pop(r,1e4);if(!i)throw new Error("Timeout");return i.data}}const ds=Qr();function us(e){let t,r=!1,i=0;try{t=window[e],r=!0,i=t.length;const n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){const t=e;return t&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&r&&0!==i}}class fs{constructor(){_(this,"store",new Map)}getItem(e){return this.store.get(e)||null}setItem(e,t){this.store.set(e,t)}removeItem(e){this.store.delete(e)}}_(class{constructor(e,t){_(this,"storage",void 0),_(this,"_storeKey",void 0),this.storage=t,this._storeKey=e;try{t.getItem(e)||this.resetStore()}catch(e){}}static getInstance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";if(!this.instanceMap.has(e)){let r;r="local"===t&&us("localStorage")?window.localStorage:"session"===t&&us("sessionStorage")?window.sessionStorage:new fs,this.instanceMap.set(e,new this(e,r))}return this.instanceMap.get(e)}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const e=this.getStore();return this.storage.removeItem(this._storeKey),e}getStore(){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")}get(e){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")[e]}set(e,t){const r=JSON.parse(this.storage.getItem(this._storeKey)||"{}");r[e]=t,this.storage.setItem(this._storeKey,JSON.stringify(r))}},"instanceMap",new Map),se(se({},{SAPPHIRE_DEVNET:"sapphire_devnet",SAPPHIRE_MAINNET:"sapphire_mainnet"}),{MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",AQUA:"aqua",CELESTE:"celeste"});var ls=r(8287).hp;const ps=()=>new ce.eddsa("ed25519");function ys(e=32){const t="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(t&&"function"==typeof t.getRandomValues)return t.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ms(){return ls.from(ys(32))}const gs=()=>{const e=zr.genKeyPair(),t=Se.fromElliptic(e.getPublic());return{private:e.getPrivate(),pub:t}},bs=(e,t,r,i)=>{const n=[],s=[],o=[],a=[];for(let c=0;c<t;c++)if(o.push(c),c===r)n.push(null),s.push(null);else{const t=i[c]-1;n.push(e[t]),s.push(new URL(e[t]).origin),a.push(i[c])}return{endpoints:n,tssWSEndpoints:s,partyIndexes:o,nodeIndexesReturned:a}};async function vs(e){try{const t="__storage_test__",r=Math.random().toString();if(await e.setItem(t,r),await e.getItem(r)!==r)throw new Error("Value mismatch");return!0}catch(e){return!1}}function ws(e){const t=e.split(".")[1];return JSON.parse((r=t,ds.decode(r)));var r}const Ss=(e,t)=>{const r=`${e}_${t}`;let i=nt(ls.from(r,"utf8"));return i=i.replace("0x",""),new(T())(i,"hex")};function _s(e){return e.toArrayLike(ls,"be",g)}function xs(e,t){if(t>e.length)throw new Error("Invalid number of endpoints");return e.slice().sort((()=>Math.random()-.5)).slice(0,t).sort(((e,t)=>e.index-t.index))}function ks(e,t,r){return t.mul(r.invm(e.n)).umod(e.n)}function Ps(e,t,r,i){return t.filter(((e,t)=>t!==r)).reduce(((n,s)=>{const o=ks(e,i.sub(s),t[r].sub(s));return n.mul(o).umod(e.n)}),new(T())(1))}function Ms(e,t,r){const i=t.map((e=>new(T())(e))),n=new(T())(r);return i.map(((t,r)=>Ps(e,i,r,n)))}const Es=1,Is=2;function As(e,t,r,i=Is){const n=Ms(e,[Es,i],0),s=Ms(e,t,0);if(t.includes(r))throw new Error(`Invalid server x-coordinates: overlapping with client x-coordinate: ${t} ${r}`);const o=Ms(e,[r,...t],0);return{serverCoefficients:s.map(((t,r)=>ks(e,n[0].mul(t),o[r+1]))),clientCoefficient:ks(e,n[1],o[0])}}function Ts(){return nt(ls.from(ur().toString("hex")+Date.now(),"utf8"))}function Os(e,t,r,i,n){return`${e}${f.Delimiter1}${t}${f.Delimiter2}${r}${f.Delimiter3}${i}${f.Delimiter4}${n}`}function Ns(e){if(65!==e.length)throw new Error(`Invalid signature length: expected 65, got ${e.length}`);return{r:e.subarray(0,32),s:e.subarray(32,64),v:e[64]}}function Ks(e){if(e.keyType!==Te.secp256k1)throw new Error(`Invalid key type: expected secp256k1, got ${e.keyType}`);return{sign:async t=>Ns(await e.sign(t,!0)),getPublic:async()=>Se.fromSEC1(ue,e.getPubKey().toString("hex")).toSEC1(ue).subarray(1)}}const Cs=rt().getLogger("mpc-core-kit");Cs.disableAll();var Ls=r(8287).hp;class Rs{constructor(e){var t;if(_(this,"state",{accountIndex:0}),_(this,"torusSp",null),_(this,"options",void 0),_(this,"storageLayer",null),_(this,"tkey",null),_(this,"sessionManager",void 0),_(this,"currentStorage",void 0),_(this,"_storageBaseKey","corekit_store"),_(this,"enableLogging",!1),_(this,"ready",!1),_(this,"_tssLib",void 0),_(this,"wasmLib",void 0),_(this,"_keyType",void 0),_(this,"atomicCallStackCounter",0),_(this,"getTssFactorPub",(()=>{if(this.checkReady(),!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when getting tss factor public key.");return this.tKey.metadata.factorPubs[this.tKey.tssTag].map((e=>e.toSEC1(zr,!0).toString("hex")))})),!e.web3AuthClientId)throw M.clientIdInvalid();this._tssLib=e.tssLib,this._keyType=e.tssLib.keyType;const r=this.isNodejsOrRN(e.uxMode);e.enableLogging?(Cs.enableAll(),this.enableLogging=!0):Cs.setLevel("error"),"boolean"!=typeof e.manualSync&&(e.manualSync=!1),e.web3AuthNetwork||(e.web3AuthNetwork=h.MAINNET),e.sessionTime||(e.sessionTime=86400),e.serverTimeOffset||(e.serverTimeOffset=0),e.uxMode||(e.uxMode=Di),e.redirectPathName||(e.redirectPathName="redirect"),e.baseUrl||(e.baseUrl=r?"https://localhost":`${null===(t=window)||void 0===t?void 0:t.location.origin}/serviceworker`),e.disableHashedFactorKey||(e.disableHashedFactorKey=!1),e.hashedFactorNonce||(e.hashedFactorNonce=e.web3AuthClientId),void 0===e.disableSessionManager&&(e.disableSessionManager=!1),this.options=e,this.currentStorage=new I(this._storageBaseKey,e.storage),e.disableSessionManager||(this.sessionManager=new Fn({sessionTime:e.sessionTime})),Pi.setSessionTime(this.options.sessionTime)}get tKey(){if(null===this.tkey)throw M.tkeyInstanceUninitialized();return this.tkey}get keyType(){return this._keyType}get signatures(){var e;return null!==(e=this.state)&&void 0!==e&&e.signatures?this.state.signatures:[]}get _storageKey(){return this._storageBaseKey}get status(){try{const{tkey:e}=this;return e?e.metadata?e.secp256k1Key&&this.state.factorKey?Xr.LOGGED_IN:Xr.REQUIRED_SHARE:Xr.INITIALIZED:Xr.NOT_INITIALIZED}catch(e){}return Xr.NOT_INITIALIZED}get sessionId(){var e;return null===(e=this.sessionManager)||void 0===e?void 0:e.sessionId}get supportsAccountIndex(){return this._keyType!==Te.ed25519}get verifier(){var e,t;return null!==(e=this.state.userInfo)&&void 0!==e&&e.aggregateVerifier?this.state.userInfo.aggregateVerifier:null!==(t=this.state)&&void 0!==t&&null!==(t=t.userInfo)&&void 0!==t&&t.verifier?this.state.userInfo.verifier:""}get verifierId(){var e;return null!==(e=this.state)&&void 0!==e&&null!==(e=e.userInfo)&&void 0!==e&&e.verifierId?this.state.userInfo.verifierId:""}get isRedirectMode(){return this.options.uxMode===Di}get useClientGeneratedTSSKey(){return this.keyType===Te.ed25519&&void 0===this.options.useClientGeneratedTSSKey||!!this.options.useClientGeneratedTSSKey}async _UNSAFE_recoverTssKey(e){this.checkReady();const t=new(T())(e[0],"hex"),r=await this.getFactorKeyMetadata(t);await this.tKey.initialize({withShare:r});const i=[],n=[],s=[];for(let t=0;t<e.length;t++){const r=new(T())(e[t],"hex"),{tssIndex:o,tssShare:a}=await this.tKey.getTSSShare(r);if(n.includes(o))throw await this.init(),M.duplicateTssIndex();n.push(o),s.push(new(T())(o)),i.push(a)}const o=Pe(this.tkey.tssCurve,i,s);return await this.init(),o.toString("hex",64)}async init(e={handleRedirectResult:!0}){var t,r;this.resetState(),void 0===e.rehydrate&&(e.rehydrate=!0);const i=li(this.options.web3AuthNetwork,this.keyType);if(this.keyType===c.ED25519&&this.options.useDKG)throw M.invalidConfig("DKG is not supported for ed25519 key type");this.torusSp=new Cn({customAuthArgs:{web3AuthClientId:this.options.web3AuthClientId,baseUrl:this.options.baseUrl,uxMode:this.isNodejsOrRN(this.options.uxMode)?Di:this.options.uxMode,network:this.options.web3AuthNetwork,redirectPathName:this.options.redirectPathName,locationReplaceOnRedirect:!0,serverTimeOffset:this.options.serverTimeOffset,keyType:this.keyType,useDkg:this.options.useDKG}}),this.storageLayer=new ri({hostUrl:`${new URL(i.torusNodeEndpoints[0]).origin}/metadata`,enableLogging:this.enableLogging});const n=new te;if(this.tkey=new Hr({enableLogging:this.enableLogging,serviceProvider:this.torusSp,storageLayer:this.storageLayer,manualSync:this.options.manualSync,modules:{shareSerialization:n},tssKeyType:this.keyType}),this.isRedirectMode?await this.torusSp.init({skipSw:!0,skipPrefetch:!0}):this.options.uxMode===Fi&&await this.torusSp.init({}),this.ready=!0,e.handleRedirectResult&&this.options.uxMode===Di&&(null!==(t=window)&&void 0!==t&&t.location.hash.includes("#state")||null!==(r=window)&&void 0!==r&&r.location.hash.includes("#access_token")))await this.handleRedirectResult();else{if(e.rehydrate&&this.sessionManager){const e=await this.currentStorage.get("sessionId");if(e){this.sessionManager.sessionId=e;const t=await this.sessionManager.authorizeSession().catch((async e=>{Cs.error("rehydrate session error",e)}));if(t)return void await this.rehydrateSession(t)}}await this.featureRequest()}}async loginWithOAuth(e){if(this.checkReady(),this.isNodejsOrRN(this.options.uxMode))throw M.oauthLoginUnsupported(`Oauth login is NOT supported in ${this.options.uxMode} mode.`);const{importTssKey:t}=e,r=this.torusSp;try{const s=e;if(e.subVerifierDetails){var i;const t=await r.triggerLogin(e.subVerifierDetails);if(this.isRedirectMode)return;this.updateState({postBoxKey:this._getPostBoxKey(t),postboxKeyNodeIndexes:null===(i=t.nodesData)||void 0===i?void 0:i.nodeIndexes,userInfo:t.userInfo,signatures:this._getSignatures(t.sessionData.sessionTokenData)})}else if(s.subVerifierDetailsArray){var n;const e=await r.triggerAggregateLogin({aggregateVerifierType:s.aggregateVerifierType||Bi,verifierIdentifier:s.aggregateVerifierIdentifier,subVerifierDetailsArray:s.subVerifierDetailsArray});if(this.isRedirectMode)return;this.updateState({postBoxKey:this._getPostBoxKey(e),postboxKeyNodeIndexes:null===(n=e.nodesData)||void 0===n?void 0:n.nodeIndexes,userInfo:e.userInfo[0],signatures:this._getSignatures(e.sessionData.sessionTokenData)})}await this.setupTkey(t)}catch(e){if(Cs.error("login error",e),e instanceof or&&1302===e.code)throw M.default(l.TKEY_SHARES_REQUIRED);throw M.default(e.message)}}async loginWithJWT(e){this.checkReady();const{prefetchTssPublicKeys:t=1}=e;if(t>3)throw M.prefetchValueExceeded(`The prefetch value '${t}' exceeds the maximum allowed limit of 3.`);const{verifier:r,verifierId:i,idToken:n,importTssKey:s}=e;this.torusSp.verifierName=r,this.torusSp.verifierId=i;try{var o;const a=[];for(let e=0;e<t;e++)a.push(this.torusSp.getTSSPubKey(this.tkey.tssTag,e));let c;c=e.subVerifier?this.torusSp.customAuthInstance.getAggregateTorusKey(r,i,[{verifier:e.subVerifier,idToken:n,extraVerifierParams:e.extraVerifierParams}]):this.torusSp.customAuthInstance.getTorusKey(r,i,{verifier_id:i},n,se(se({},e.extraVerifierParams),e.additionalParams));const[h]=await Promise.all([c,...a]),d=this._getPostBoxKey(h);this.torusSp.postboxKey=new(T())(d,"hex"),this.updateState({postBoxKey:d,postboxKeyNodeIndexes:(null===(o=h.nodesData)||void 0===o?void 0:o.nodeIndexes)||[],userInfo:se(se({},ws(n)),{},{verifier:r,verifierId:i}),signatures:this._getSignatures(h.sessionData.sessionTokenData)}),await this.setupTkey(s)}catch(e){if(Cs.error("login error",e),e instanceof or&&1302===e.code){const t=M.default(l.TKEY_SHARES_REQUIRED);throw t.stack=e.stack,t}const t=M.default(e.message);throw t.stack=e.stack,t}}async handleRedirectResult(){this.checkReady();try{const r=await this.torusSp.customAuthInstance.getRedirectResult();if(r.method===qi){var e;const t=r.result;if(!t)throw M.invalidTorusLoginResponse();this.updateState({postBoxKey:this._getPostBoxKey(t),postboxKeyNodeIndexes:(null===(e=t.nodesData)||void 0===e?void 0:e.nodeIndexes)||[],userInfo:t.userInfo,signatures:this._getSignatures(t.sessionData.sessionTokenData)});const i=this.getUserInfo();this.torusSp.verifierName=i.verifier}else{if(r.method!==$i)throw M.unsupportedRedirectMethod();{var t;const e=r.result;if(!e)throw M.invalidTorusAggregateLoginResponse();this.updateState({postBoxKey:this._getPostBoxKey(e),postboxKeyNodeIndexes:(null===(t=e.nodesData)||void 0===t?void 0:t.nodeIndexes)||[],userInfo:e.userInfo[0],signatures:this._getSignatures(e.sessionData.sessionTokenData)});const i=this.getUserInfo();this.torusSp.verifierName=i.aggregateVerifier}}const i=this.getUserInfo();if(!this.state.postBoxKey)throw M.postBoxKeyMissing("postBoxKey not present in state after processing redirect result.");this.torusSp.postboxKey=new(T())(this.state.postBoxKey,"hex"),this.torusSp.verifierId=i.verifierId,await this.setupTkey()}catch(e){throw this.resetState(),Cs.error("error while handling redirect result",e),M.default(e.message)}}async inputFactorKey(e){this.checkReady();try{if(!this.tKey.secp256k1Key){const t=await this.getFactorKeyMetadata(e);await this.tKey.inputShareStoreSafe(t,!0)}await this.tKey.reconstructKey(),await this.finalizeTkey(e)}catch(e){if(Cs.error("login error",e),e instanceof or&&1302===e.code)throw M.default(l.TKEY_SHARES_REQUIRED);throw M.default(e.message)}}setTssWalletIndex(e){this.updateState({tssPubKey:this.tKey.getTSSPub(e).toSEC1(this.tkey.tssCurve,!1),accountIndex:e})}getCurrentFactorKey(){if(this.checkReady(),!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when getting current factor key.");if(!this.state.tssShareIndex)throw M.tssShareTypeIndexMissing("TSS Share Type (Index) not present in state when getting current factor key.");try{return{factorKey:this.state.factorKey,shareType:this.state.tssShareIndex}}catch(e){throw Cs.error("state error",e),M.default(e.message)}}async enableMFA(e,t=!0){this.checkReady();const{postBoxKey:r}=this.state,i=Ss(r,this.options.hashedFactorNonce);if(!await this.checkIfFactorKeyValid(i)){if(this.tKey._localMetadataTransitions[0].length)throw M.commitChangesBeforeMFA();throw M.mfaAlreadyEnabled()}return this.atomicSync((async()=>{let r;if(this.isNodejsOrRN(this.options.uxMode))r={browserName:"Node Env",browserVersion:"",deviceName:"nodejs"};else{const e=Ji().parse(navigator.userAgent);r={browserName:`${e.browser.name}`,browserVersion:e.browser.version,deviceName:e.os.name}}const n=new(T())(await this.createFactor({shareType:y.DEVICE,additionalMetadata:r}),"hex");await this.setDeviceFactor(n),await this.inputFactorKey(new(T())(n,"hex"));const s=Ee(i,zr);let o;return await this.deleteFactor(s,i),await this.deleteMetadataShareBackup(i),t&&(o=await this.createFactor(se({shareType:y.RECOVERY},e))),o})).catch((e=>{Cs.error("error enabling MFA:",e.message);const t=M.default(e.message);throw t.stack=e.stack,t}))}async createFactor(e){this.checkReady();const{shareType:t}=e;let{factorKey:r,shareDescription:i,additionalMetadata:n}=e;if(!m.includes(t))throw M.newShareIndexInvalid(`Invalid share type provided (${t}). Valid share types are ${m}.`);r||(r=gs().private),i||(i=u.Other),n||(n={});const s=Ee(r,zr);if(this.getTssFactorPub().includes(s.toSEC1(zr,!0).toString("hex")))throw M.factorKeyAlreadyExists();return this.atomicSync((async()=>(await this.copyOrCreateShare(t,s),await this.backupMetadataShare(r),await this.addFactorDescription({factorKey:r,shareDescription:i,additionalMetadata:n,updateMetadata:!1}),_s(r).toString("hex")))).catch((e=>{Cs.error("error creating factor:",e.message);const t=M.default(`error creating factor: ${e.message}`);throw t.stack=e.stack,t}))}getPubKey(){const{tssPubKey:e}=this.state;return Ls.from(e)}getPubKeyPoint(){const{tssPubKey:e}=this.state;return Se.fromSEC1(this.tkey.tssCurve,e.toString("hex"))}getPubKeyEd25519(){const e=this.tkey.tssCurve.keyFromPublic(this.getPubKey()).getPublic();return ps().keyFromPublic(e).getPublic()}async precompute_secp256k1(){this.wasmLib=await this.loadTssWasm();const{tssShareIndex:e}=this.state,t=this.getPubKeyPoint(),{torusNodeTSSEndpoints:r}=li(this.options.web3AuthNetwork,this.keyType);if(!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when signing.");const{tssShare:i}=await this.tKey.getTSSShare(this.state.factorKey,{accountIndex:0}),n=this.getTssNonce();if(!t||!r)throw M.tssPublicKeyOrEndpointsMissing();const s=Ts(),o=Os(this.verifier,this.verifierId,this.tKey.tssTag,n,s),{nodeIndexes:a}=await this.torusSp.getTSSPubKey(this.tKey.tssTag,this.tKey.metadata.tssNonces[this.tKey.tssTag]),{endpoints:c,tssWSEndpoints:h,partyIndexes:d,nodeIndexesReturned:u}=bs(r,4,3,a),f=await(async(e,t)=>{const r=await(async(e,t)=>e.map((e=>null==e?null:(0,Wn.io)(e,{path:"/tss/socket.io",query:{sessionId:t},transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:5}))))(e,t);return await new Promise((e=>{const t=setInterval((()=>{for(let e=0;e<r.length;e++)if(null!==r[e]&&!r[e].connected)return;clearInterval(t),e(!0)}),100)})),r})(h,s),l=rs(!0,u,e).mul(i).umod(ue.curve.n),p=this.tkey.computeAccountNonce(this.state.accountIndex),y=_s(l.add(p).umod(ue.curve.n)).toString("base64");if(!o)throw M.activeSessionNotFound();const{signatures:m}=this;if(!m)throw M.signaturesNotPresent();const g=Ls.from(t.toSEC1(ue).subarray(1)).toString("base64"),b=new is(o,3,d,c,f,y,g,!0,this.wasmLib),v={};for(let t=0;t<u.length;t++){const r=u[t];v[r]=rs(!1,u,e,r).toString("hex")}return b.precompute({signatures:m,server_coeffs:v,nonce:_s(this.getAccountNonce()).toString("base64")}),await b.ready().catch((e=>{throw b.cleanup({signatures:m,server_coeffs:v}),e})),{client:b,serverCoeffs:v}}async sign(e,t=!1,r){if(this.wasmLib=await this.loadTssWasm(),this.keyType===Te.secp256k1){const i=await this.sign_ECDSA_secp256k1(e,t,r);return Ls.concat([i.r,i.s,Ls.from([i.v])])}if(this.keyType===Te.ed25519)return this.sign_ed25519(e,t);throw M.default(`sign not supported for key type ${this.keyType}`)}async deleteFactor(e,t){if(!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when deleting a factor.");if(!this.tKey.metadata.factorPubs)throw M.factorPubsMissing();await this.atomicSync((async()=>{if((this.tKey.metadata.factorPubs[this.tKey.tssTag].length||0)<=1)throw M.cannotDeleteLastFactor("Cannot delete last factor");const r=e,i=Ee(this.state.factorKey,zr);if(r.equals(i))throw M.factorInUseCannotBeDeleted("Cannot delete current active factor");await this.tKey.deleteFactorPub({factorKey:this.state.factorKey,deleteFactorPub:e,authSignatures:this.signatures});const n=r.toSEC1(zr,!0).toString("hex"),s=this.tKey.metadata.getShareDescription()[n];if(s&&await Promise.all(s.map((async e=>{var t;return null===(t=this.tKey)||void 0===t?void 0:t.metadata.deleteShareDescription(n,e)}))),t){const e=new(T())(t,"hex");Ee(e,zr).equals(r)&&await this.deleteMetadataShareBackup(e)}}))}async logout(){var e;null!==(e=this.sessionManager)&&void 0!==e&&e.sessionId&&await this.sessionManager.invalidateSession(),await this.currentStorage.set("sessionId",""),this.resetState(),await this.init({handleRedirectResult:!1,rehydrate:!1})}getUserInfo(){if(!this.state.userInfo)throw M.userNotLoggedIn();return this.state.userInfo}getKeyDetails(){this.checkReady();const e=this.tKey.getKeyDetails(),t=this.state.tssPubKey?Se.fromSEC1(this.tkey.tssCurve,this.state.tssPubKey.toString("hex")):void 0,r=this.tKey.metadata.factorPubs?this.tKey.metadata.factorPubs[this.tKey.tssTag]:[];return{requiredFactors:e.requiredShares,threshold:e.threshold,totalFactors:r.length+1,shareDescriptions:this.tKey.getMetadata().getShareDescription(),metadataPubKey:e.pubKey,tssPubKey:t,keyType:this.keyType}}async commitChanges(){if(this.checkReady(),!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when committing changes.");try{await this.tKey._syncShareMetadata(),await this.tKey.syncLocalMetadataTransitions()}catch(e){throw Cs.error("sync metadata error",e),e}}async setManualSync(e){this.checkReady(),await this.tKey.syncLocalMetadataTransitions(),this.options.manualSync=e,this.tKey.manualSync=e}async setDeviceFactor(e,t=!1){if(!t&&await this.getDeviceFactor())throw M.default("Device factor already exists");const r=this.tKey.getMetadata().pubKey.x.toString(16,b);await this.currentStorage.set(r,JSON.stringify({factorKey:e.toString("hex").padStart(64,"0")}))}async getDeviceFactor(){const e=this.tKey.getMetadata().pubKey.x.toString(16,b),t=await this.currentStorage.get(e);return JSON.parse(t||"{}").factorKey}async _UNSAFE_exportTssKey(){if(this.keyType!==Te.secp256k1)throw M.default("Wrong KeyType. Method can only be used when KeyType is secp256k1");if(!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when exporting tss key.");if(!this.state.signatures)throw M.signaturesNotPresent("Signatures not present in state when exporting tss key.");const e=await this.tKey._UNSAFE_exportTssKey({factorKey:this.state.factorKey,authSignatures:this.state.signatures}),t=this.getAccountNonce();return e.add(t).umod(this.tKey.tssCurve.n).toString("hex",b)}async _UNSAFE_exportTssEd25519Seed(){if(this.keyType!==Te.ed25519)throw M.default("Wrong KeyType. Method can only be used when KeyType is ed25519");if(!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when exporting tss ed25519 seed.");if(!this.state.signatures)throw M.signaturesNotPresent("Signatures not present in state when exporting tss ed25519 seed.");try{return await this.tKey._UNSAFE_exportTssEd25519Seed({factorKey:this.state.factorKey,authSignatures:this.state.signatures})}catch(e){throw M.default(`Error exporting ed25519 seed: ${e}`)}}updateState(e){this.state=se(se({},this.state),e)}async atomicSync(e){this.atomicCallStackCounter+=1,this.tkey.manualSync=!0;try{const t=await e();return 1===this.atomicCallStackCounter&&(this.options.manualSync||await this.commitChanges()),t}catch(e){throw e}finally{this.atomicCallStackCounter-=1,0===this.atomicCallStackCounter&&(this.tkey.manualSync=this.options.manualSync)}}async importTssKey(e,t,r=y.DEVICE){if(!this.state.signatures)throw M.signaturesNotPresent("Signatures not present in state when importing tss key.");await this.tKey.importTssKey({tag:this.tKey.tssTag,importKey:Ls.from(e,"hex"),factorPub:t,newTSSIndex:r},{authSignatures:this.state.signatures})}getTssNonce(){if(!this.tKey.metadata.tssNonces||void 0===this.tKey.metadata.tssNonces[this.tKey.tssTag])throw M.tssNoncesMissing(`tssNonce not present for tag ${this.tKey.tssTag}`);return this.tKey.metadata.tssNonces[this.tKey.tssTag]}async setupTkey(e){if(!this.state.postBoxKey)throw M.userNotLoggedIn();let t=e;if(await this.isMetadataPresent(this.state.postBoxKey)){if(t)throw M.tssKeyImportNotAllowed();await this.handleExistingUser()}else{if(!t&&this.useClientGeneratedTSSKey)if(this.keyType===Te.ed25519)t=ms().toString("hex");else{if(this.keyType!==Te.secp256k1)throw M.default("Unsupported key type");t=_s(ue.genKeyPair().getPrivate()).toString("hex")}await this.handleNewUser(t)}}async handleNewUser(e){await this.atomicSync((async()=>{let t;if(this.options.disableHashedFactorKey){t=gs().private;const e=Ss(this.state.postBoxKey,this.options.hashedFactorNonce);await this.deleteMetadataShareBackup(e)}else t=Ss(this.state.postBoxKey,this.options.hashedFactorNonce);const r=y.DEVICE,i=Ee(t,zr);if(e)await this.tKey.initialize({skipTssInit:!0}),await this.tKey.reconstructKey(),await this.importTssKey(e,i,r);else{const e=new ce.ec(this.keyType).genKeyPair().getPrivate();await this.tKey.initialize({factorPub:i,deviceTSSShare:e,deviceTSSIndex:r})}await this.tKey.reconstructKey(),await this.finalizeTkey(t),await this.backupMetadataShare(t),this.options.disableHashedFactorKey?await this.addFactorDescription({factorKey:t,shareDescription:u.Other,updateMetadata:!1}):await this.addFactorDescription({factorKey:t,shareDescription:u.HashedShare,updateMetadata:!1})}))}async handleExistingUser(){if(await this.tKey.initialize({neverInitializeNewKey:!0}),this.options.disableHashedFactorKey)return;const e=Ss(this.state.postBoxKey,this.options.hashedFactorNonce);if(this.state.factorKey=e,await this.checkIfFactorKeyValid(e)){const t=await this.getFactorKeyMetadata(e);try{await this.tKey.inputShareStoreSafe(t,!0),await this.tKey.reconstructKey(),await this.finalizeTkey(e)}catch(e){Cs.error("error initializing tkey with hashed share",e)}}else{var t;"SHARE_DELETED"===(await(null===(t=this.tKey)||void 0===t?void 0:t.readMetadata(e))).message&&Cs.warn("hashed factor deleted")}}async finalizeTkey(e){0!==this.state.accountIndex&&(Cs.warn("AccountIndex should be 0"),this.state.accountIndex=0);const{tssIndex:t}=await this.tKey.getTSSShare(e),r=this.tKey.getTSSPub().toSEC1(this.tkey.tssCurve,!1);this.updateState({tssShareIndex:t,tssPubKey:r,factorKey:e}),await this.createSession()}checkReady(){if(!this.ready)throw M.mpcCoreKitNotInitialized()}async rehydrateSession(e){try{this.checkReady();const t=new(T())(e.factorKey,"hex");if(!t)throw M.providedFactorKeyInvalid();const r=e.postBoxKey||e.oAuthKey;if(!r)throw M.default("postBoxKey or oAuthKey not present in session data");this.torusSp.postboxKey=new(T())(r,"hex"),this.torusSp.verifierName=e.userInfo.aggregateVerifier||e.userInfo.verifier,this.torusSp.verifierId=e.userInfo.verifierId;const i=await this.getFactorKeyMetadata(t);await this.tKey.initialize({neverInitializeNewKey:!0}),await this.tKey.inputShareStoreSafe(i,!0),await this.tKey.reconstructKey(),this.updateState({factorKey:new(T())(e.factorKey,"hex"),postBoxKey:r,postboxKeyNodeIndexes:e.postboxKeyNodeIndexes||[],tssShareIndex:e.tssShareIndex,tssPubKey:this.tkey.getTSSPub().toSEC1(this.tKey.tssCurve,!1),signatures:e.signatures,userInfo:e.userInfo})}catch(e){Cs.warn("failed to authorize session",e)}}async createSession(){if(!this.options.disableSessionManager&&!this.sessionManager)throw new Error("sessionManager is not available");try{const e=Fn.generateRandomSessionKey();this.sessionManager.sessionId=e;const{postBoxKey:t,factorKey:r,userInfo:i,tssShareIndex:n,tssPubKey:s,postboxKeyNodeIndexes:o}=this.state;if(!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when creating session.");const{tssShare:a}=await this.tKey.getTSSShare(this.state.factorKey,{accountIndex:this.state.accountIndex});if(!(t&&r&&a&&s&&i))throw M.userNotLoggedIn();const c={postBoxKey:t,postboxKeyNodeIndexes:o||[],factorKey:null==r?void 0:r.toString("hex"),tssShareIndex:n,tssPubKey:Ls.from(s).toString("hex"),signatures:this.signatures,userInfo:i};await this.sessionManager.createSession(c),await this.currentStorage.set("sessionId",e)}catch(e){Cs.error("error creating session",e)}}async isMetadataPresent(e){var t;const r=new(T())(e,"hex"),i=await(null===(t=this.tKey)||void 0===t?void 0:t.readMetadata(r));return!(!i||"KEY_NOT_FOUND"===i.message)}async checkIfFactorKeyValid(e){var t;this.checkReady();const r=await(null===(t=this.tKey)||void 0===t?void 0:t.readMetadata(e));return!(!r||"KEY_NOT_FOUND"===r.message||"SHARE_DELETED"===r.message)}async getFactorKeyMetadata(e){var t;this.checkReady();const r=await(null===(t=this.tKey)||void 0===t?void 0:t.readMetadata(e));if(!r||"KEY_NOT_FOUND"===r.message)throw M.noMetadataFound();return je.fromJSON(r)}async copyOrCreateShare(e,t){if(this.checkReady(),!this.tKey.metadata.factorPubs||!Array.isArray(this.tKey.metadata.factorPubs[this.tKey.tssTag]))throw M.factorPubsMissing("'factorPubs' is missing in the metadata. Failed to copy factor public key.");if(!this.tKey.metadata.factorEncs||"object"!=typeof this.tKey.metadata.factorEncs[this.tKey.tssTag])throw M.factorEncsMissing("'factorEncs' is missing in the metadata. Failed to copy factor public key.");if(!this.state.factorKey)throw M.factorKeyNotPresent("factorKey not present in state when copying or creating a share.");if(-1===m.indexOf(e))throw M.newShareIndexInvalid(`Invalid share type provided (${e}). Valid share types are ${m}.`);if(this.tKey.metadata.factorPubs[this.tKey.tssTag].length>=v)throw M.maximumFactorsReached(`The maximum number of allowable factors (${v}) has been reached.`);await this.tkey.addFactorPub({existingFactorKey:this.state.factorKey,authSignatures:this.signatures,newFactorPub:t,newTSSIndex:e,refreshShares:this.state.tssShareIndex!==e})}async getMetadataShare(){try{var e,t;const r=null===(e=this.tKey)||void 0===e?void 0:e.metadata.getLatestPublicPolynomial().getPolynomialID(),i=null===(t=this.tKey)||void 0===t?void 0:t.shares[r];let n=null;for(const e in i)e!==w.toString()&&(n=i[e]);if(!n)throw M.noMetadataShareFound();return n}catch(e){throw Cs.error("create device share error",e),M.default(e.message)}}async deleteMetadataShareBackup(e){var t,r;await this.tKey.addLocalMetadataTransitions({input:[{message:ge,dateAdded:Date.now()}],privKey:[e]}),null!==(t=this.tkey)&&void 0!==t&&t.manualSync||await(null===(r=this.tkey)||void 0===r?void 0:r.syncLocalMetadataTransitions())}async backupMetadataShare(e){var t,r,i;const n=await this.getMetadataShare();await(null===(t=this.tKey)||void 0===t?void 0:t.addLocalMetadataTransitions({input:[n],privKey:[e]})),null!==(r=this.tkey)&&void 0!==r&&r.manualSync||await(null===(i=this.tkey)||void 0===i?void 0:i.syncLocalMetadataTransitions())}async addFactorDescription(e){var t;const{factorKey:r,shareDescription:i,updateMetadata:n}=e;let{additionalMetadata:s}=e;s||(s={});const{tssIndex:o}=await this.tKey.getTSSShare(r),a=Ee(r,zr).toSEC1(zr,!0).toString("hex"),c=se(se({module:i,dateAdded:Date.now()},s),{},{tssShareIndex:o});await(null===(t=this.tKey)||void 0===t?void 0:t.addShareDescription(a,JSON.stringify(c),n))}resetState(){this.ready=!1,this.tkey=null,this.torusSp=null,this.storageLayer=null,this.state={accountIndex:0}}_getPostBoxKey(e){return Pi.getPostboxKey(e)}_getSignatures(e){return e.filter((e=>!!e)).map((e=>JSON.stringify({data:e.token,sig:e.signature})))}isNodejsOrRN(e){return"nodejs"===e||"react-native"===e}async featureRequest(){const e=o[this.options.web3AuthNetwork],t={network:this.options.web3AuthNetwork,client_id:this.options.web3AuthClientId,is_mpc_core_kit:"true",enable_gating:"true",session_time:this.options.sessionTime.toString()},r=new URL(`${e}/api/feature-access`);r.search=new URLSearchParams(t).toString();const i=await fetch(r);if(200!==i.status){this.resetState();const e=await i.json();throw M.default(e.error)}return i.json()}getAccountNonce(){return this.tkey.computeAccountNonce(this.state.accountIndex)}async sign_ECDSA_secp256k1(e,t=!1,r){const i=async(e,t,r,i)=>{const{r:n,s,recoveryParam:o}=await e.sign(r.toString("base64"),!0,"","keccak256",{signatures:i});return e.cleanup({signatures:i,server_coeffs:t}),{v:o,r:_s(n),s:_s(s)}};t||(e=(0,ln.S)(e));const n=(null==r?void 0:r.client)&&(null==r?void 0:r.serverCoeffs),{client:s,serverCoeffs:o}=n?r:await this.precompute_secp256k1(),{signatures:a}=this;if(!a)throw M.signaturesNotPresent();try{return await i(s,o,e,a)}catch(t){if(!n)throw t;const{client:r,serverCoeffs:s}=await this.precompute_secp256k1();return await i(r,s,e,a)}}async sign_ed25519(e,t=!1){if(t)throw M.default("hashed data not supported for ed25519");const r=li(this.options.web3AuthNetwork,"ed25519");if(!r.torusNodeTSSEndpoints)throw M.default("could not fetch tss node endpoints");const i=r.torusNodeTSSEndpoints.map(((e,t)=>({index:r.torusIndexes[t],url:`${e}/`}))),n=xs(i,Math.floor(i.length/2)+1),s=n.map((e=>e.index)),o=Math.max(...n.map((e=>e.index)))+1,a=new Ln,{serverCoefficients:c,clientCoefficient:h}=As(a,s,o,this.state.tssShareIndex),d=await this.getPubKey(),u=a.keyFromPublic(d).getPublic();if(0!==this.state.accountIndex)throw M.default("Account index not supported for ed25519");const{tssShare:f}=await this.tKey.getTSSShare(this.state.factorKey),l=f.mul(h).umod(a.n),p=a.scalarToBuffer(l,Ls).toString("hex"),y=this.getTssNonce(),m=Ts(),g=Os(this.verifier,this.verifierId,this.tKey.tssTag,y,m),b=n.map((e=>e.url)),v=a.pointToBuffer(u,Ls).toString("hex"),w=c.map((e=>a.scalarToBuffer(e,Ls).toString("hex"))),S=await async function(e,t,r,i,n,s,o,a,c,h){const d=new hs(t,s);await d.connect(i,n),i.forEach(((e,o)=>{const u=d.getSocket(e);if(void 0===u)throw new Error(`socket not found: party ${e}`);(async function(e,t,r,i,n,s,o,a,c,h,d){const u=n.slice(),f=s.slice().map((e=>e.endsWith("/")?e.slice(0,-1):e));u.push(o),f.push(`websocket:${a.id}`);const l={session:t,msg:ss(c),player_index:r,pubkey:i,parties:u,endpoints:f,signatures:h,share_coefficient:d},p=new URL("sign",e),y=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!y.ok){const e=(await y.json()).message;throw new Error(e)}})(new URL(n[o]),t,e,a,i,n,s,u,c,r,h?h[o]:void 0).catch((e=>{console.error(`Server ${o}: ${e}`)}))}));const u=function(){const e=new Uint8Array(32);return crypto.getRandomValues(e),e}(),f=new os;try{const t=f.add(new e.RngSeed(u)),r=f.add(e.KeyShare.from_raw(s,o,a));return f.add(await e.sign(t,d,new Uint32Array(i),r,c)).to_hex()}finally{f.free(),d.close()}}(this.wasmLib,g,this.signatures,s,b,o,p,v,e,w);return Cs.info(`signature: ${S}`),Ls.from(S,"hex")}async loadTssWasm(){return this.wasmLib?this.wasmLib:"function"==typeof this._tssLib.load?this._tssLib.load():this._tssLib.lib?this._tssLib.lib:void 0}}})(),i})()));